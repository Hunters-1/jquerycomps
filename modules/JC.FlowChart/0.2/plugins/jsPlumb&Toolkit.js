(function(){var root=this;if(typeof Math.sgn=="undefined"){Math.sgn=function(x){return x==0?0:x>0?1:-1;};}
var Vectors={subtract:function(v1,v2){return{x:v1.x-v2.x,y:v1.y-v2.y};},dotProduct:function(v1,v2){return(v1.x*v2.x)+(v1.y*v2.y);},square:function(v){return Math.sqrt((v.x*v.x)+(v.y*v.y));},scale:function(v,s){return{x:v.x*s,y:v.y*s};}},maxRecursion=64,flatnessTolerance=Math.pow(2.0,-maxRecursion-1);var _distanceFromCurve=function(point,curve){var candidates=[],w=_convertToBezier(point,curve),degree=curve.length-1,higherDegree=(2*degree)-1,numSolutions=_findRoots(w,higherDegree,candidates,0),v=Vectors.subtract(point,curve[0]),dist=Vectors.square(v),t=0.0;for(var i=0;i<numSolutions;i++){v=Vectors.subtract(point,_bezier(curve,degree,candidates[i],null,null));var newDist=Vectors.square(v);if(newDist<dist){dist=newDist;t=candidates[i];}}
v=Vectors.subtract(point,curve[degree]);newDist=Vectors.square(v);if(newDist<dist){dist=newDist;t=1.0;}
return{location:t,distance:dist};};var _nearestPointOnCurve=function(point,curve){var td=_distanceFromCurve(point,curve);return{point:_bezier(curve,curve.length-1,td.location,null,null),location:td.location};};var _convertToBezier=function(point,curve){var degree=curve.length-1,higherDegree=(2*degree)-1,c=[],d=[],cdTable=[],w=[],z=[[1.0,0.6,0.3,0.1],[0.4,0.6,0.6,0.4],[0.1,0.3,0.6,1.0]];for(var i=0;i<=degree;i++)c[i]=Vectors.subtract(curve[i],point);for(var i=0;i<=degree-1;i++){d[i]=Vectors.subtract(curve[i+1],curve[i]);d[i]=Vectors.scale(d[i],3.0);}
for(var row=0;row<=degree-1;row++){for(var column=0;column<=degree;column++){if(!cdTable[row])cdTable[row]=[];cdTable[row][column]=Vectors.dotProduct(d[row],c[column]);}}
for(i=0;i<=higherDegree;i++){if(!w[i])w[i]=[];w[i].y=0.0;w[i].x=parseFloat(i)/higherDegree;}
var n=degree,m=degree-1;for(var k=0;k<=n+m;k++){var lb=Math.max(0,k-m),ub=Math.min(k,n);for(i=lb;i<=ub;i++){j=k-i;w[i+j].y+=cdTable[j][i]*z[j][i];}}
return w;};var _findRoots=function(w,degree,t,depth){var left=[],right=[],left_count,right_count,left_t=[],right_t=[];switch(_getCrossingCount(w,degree)){case 0:{return 0;}
case 1:{if(depth>=maxRecursion){t[0]=(w[0].x+w[degree].x)/2.0;return 1;}
if(_isFlatEnough(w,degree)){t[0]=_computeXIntercept(w,degree);return 1;}
break;}}
_bezier(w,degree,0.5,left,right);left_count=_findRoots(left,degree,left_t,depth+1);right_count=_findRoots(right,degree,right_t,depth+1);for(var i=0;i<left_count;i++)t[i]=left_t[i];for(var i=0;i<right_count;i++)t[i+left_count]=right_t[i];return(left_count+right_count);};var _getCrossingCount=function(curve,degree){var n_crossings=0,sign,old_sign;sign=old_sign=Math.sgn(curve[0].y);for(var i=1;i<=degree;i++){sign=Math.sgn(curve[i].y);if(sign!=old_sign)n_crossings++;old_sign=sign;}
return n_crossings;};var _isFlatEnough=function(curve,degree){var error,intercept_1,intercept_2,left_intercept,right_intercept,a,b,c,det,dInv,a1,b1,c1,a2,b2,c2;a=curve[0].y-curve[degree].y;b=curve[degree].x-curve[0].x;c=curve[0].x*curve[degree].y-curve[degree].x*curve[0].y;var max_distance_above=max_distance_below=0.0;for(var i=1;i<degree;i++){var value=a*curve[i].x+b*curve[i].y+c;if(value>max_distance_above)
max_distance_above=value;else if(value<max_distance_below)
max_distance_below=value;}
a1=0.0;b1=1.0;c1=0.0;a2=a;b2=b;c2=c-max_distance_above;det=a1*b2-a2*b1;dInv=1.0/det;intercept_1=(b1*c2-b2*c1)*dInv;a2=a;b2=b;c2=c-max_distance_below;det=a1*b2-a2*b1;dInv=1.0/det;intercept_2=(b1*c2-b2*c1)*dInv;left_intercept=Math.min(intercept_1,intercept_2);right_intercept=Math.max(intercept_1,intercept_2);error=right_intercept-left_intercept;return(error<flatnessTolerance)?1:0;};var _computeXIntercept=function(curve,degree){var XLK=1.0,YLK=0.0,XNM=curve[degree].x-curve[0].x,YNM=curve[degree].y-curve[0].y,XMK=curve[0].x-0.0,YMK=curve[0].y-0.0,det=XNM*YLK-YNM*XLK,detInv=1.0/det,S=(XNM*YMK-YNM*XMK)*detInv;return 0.0+XLK*S;};var _bezier=function(curve,degree,t,left,right){var temp=[[]];for(var j=0;j<=degree;j++)temp[0][j]=curve[j];for(var i=1;i<=degree;i++){for(var j=0;j<=degree-i;j++){if(!temp[i])temp[i]=[];if(!temp[i][j])temp[i][j]={};temp[i][j].x=(1.0-t)*temp[i-1][j].x+t*temp[i-1][j+1].x;temp[i][j].y=(1.0-t)*temp[i-1][j].y+t*temp[i-1][j+1].y;}}
if(left!=null)
for(j=0;j<=degree;j++)left[j]=temp[j][0];if(right!=null)
for(j=0;j<=degree;j++)right[j]=temp[degree-j][j];return(temp[degree][0]);};var _curveFunctionCache={};var _getCurveFunctions=function(order){var fns=_curveFunctionCache[order];if(!fns){fns=[];var f_term=function(){return function(t){return Math.pow(t,order);};},l_term=function(){return function(t){return Math.pow((1-t),order);};},c_term=function(c){return function(t){return c;};},t_term=function(){return function(t){return t;};},one_minus_t_term=function(){return function(t){return 1-t;};},_termFunc=function(terms){return function(t){var p=1;for(var i=0;i<terms.length;i++)p=p*terms[i](t);return p;};};fns.push(new f_term());for(var i=1;i<order;i++){var terms=[new c_term(order)];for(var j=0;j<(order-i);j++)terms.push(new t_term());for(var j=0;j<i;j++)terms.push(new one_minus_t_term());fns.push(new _termFunc(terms));}
fns.push(new l_term());_curveFunctionCache[order]=fns;}
return fns;};var _pointOnPath=function(curve,location){var cc=_getCurveFunctions(curve.length-1),_x=0,_y=0;for(var i=0;i<curve.length;i++){_x=_x+(curve[i].x*cc[i](location));_y=_y+(curve[i].y*cc[i](location));}
return{x:_x,y:_y};};var _dist=function(p1,p2){return Math.sqrt(Math.pow(p1.x-p2.x,2)+Math.pow(p1.y-p2.y,2));};var _isPoint=function(curve){return curve[0].x==curve[1].x&&curve[0].y==curve[1].y;};var _pointAlongPath=function(curve,location,distance){if(_isPoint(curve)){return{point:curve[0],location:location};}
var prev=_pointOnPath(curve,location),tally=0,curLoc=location,direction=distance>0?1:-1,cur=null;while(tally<Math.abs(distance)){curLoc+=(0.005*direction);cur=_pointOnPath(curve,curLoc);tally+=_dist(cur,prev);prev=cur;}
return{point:cur,location:curLoc};};var _length=function(curve){if(_isPoint(curve))return 0;var prev=_pointOnPath(curve,0),tally=0,curLoc=0,direction=1,cur=null;while(curLoc<1){curLoc+=(0.005*direction);cur=_pointOnPath(curve,curLoc);tally+=_dist(cur,prev);prev=cur;}
return tally;};var _pointAlongPathFrom=function(curve,location,distance){return _pointAlongPath(curve,location,distance).point;};var _locationAlongPathFrom=function(curve,location,distance){return _pointAlongPath(curve,location,distance).location;};var _gradientAtPoint=function(curve,location){var p1=_pointOnPath(curve,location),p2=_pointOnPath(curve.slice(0,curve.length-1),location),dy=p2.y-p1.y,dx=p2.x-p1.x;return dy==0?Infinity:Math.atan(dy/dx);};var _gradientAtPointAlongPathFrom=function(curve,location,distance){var p=_pointAlongPath(curve,location,distance);if(p.location>1)p.location=1;if(p.location<0)p.location=0;return _gradientAtPoint(curve,p.location);};var _perpendicularToPathAt=function(curve,location,length,distance){distance=distance==null?0:distance;var p=_pointAlongPath(curve,location,distance),m=_gradientAtPoint(curve,p.location),_theta2=Math.atan(-1/m),y=length/2*Math.sin(_theta2),x=length/2*Math.cos(_theta2);return[{x:p.point.x+x,y:p.point.y+y},{x:p.point.x-x,y:p.point.y-y}];};this.jsBezier={distanceFromCurve:_distanceFromCurve,gradientAtPoint:_gradientAtPoint,gradientAtPointAlongCurveFrom:_gradientAtPointAlongPathFrom,nearestPointOnCurve:_nearestPointOnCurve,pointOnCurve:_pointOnPath,pointAlongCurveFrom:_pointAlongPathFrom,perpendicularToCurveAt:_perpendicularToPathAt,locationAlongCurveFrom:_locationAlongPathFrom,getLength:_length};}).call(this);;(function(){"use strict";var Biltong=this.Biltong={};var _isa=function(a){return Object.prototype.toString.call(a)==="[object Array]";},_pointHelper=function(p1,p2,fn){p1=_isa(p1)?p1:[p1.x,p1.y];p2=_isa(p2)?p2:[p2.x,p2.y];return fn(p1,p2);},_gradient=Biltong.gradient=function(p1,p2){return _pointHelper(p1,p2,function(_p1,_p2){if(_p2[0]==_p1[0])
return _p2[1]>_p1[1]?Infinity:-Infinity;else if(_p2[1]==_p1[1])
return _p2[0]>_p1[0]?0:-0;else
return(_p2[1]-_p1[1])/(_p2[0]-_p1[0]);});},_normal=Biltong.normal=function(p1,p2){return-1/_gradient(p1,p2);},_lineLength=Biltong.lineLength=function(p1,p2){return _pointHelper(p1,p2,function(_p1,_p2){return Math.sqrt(Math.pow(_p2[1]-_p1[1],2)+Math.pow(_p2[0]-_p1[0],2));});},_quadrant=Biltong.quadrant=function(p1,p2){return _pointHelper(p1,p2,function(_p1,_p2){if(_p2[0]>_p1[0]){return(_p2[1]>_p1[1])?2:1;}
else if(_p2[0]==_p1[0]){return _p2[1]>_p1[1]?2:1;}
else{return(_p2[1]>_p1[1])?3:4;}});},_theta=Biltong.theta=function(p1,p2){return _pointHelper(p1,p2,function(_p1,_p2){var m=_gradient(_p1,_p2),t=Math.atan(m),s=_quadrant(_p1,_p2);if((s==4||s==3))t+=Math.PI;if(t<0)t+=(2*Math.PI);return t;});},_intersects=Biltong.intersects=function(r1,r2){var x1=r1.x,x2=r1.x+r1.w,y1=r1.y,y2=r1.y+r1.h,a1=r2.x,a2=r2.x+r2.w,b1=r2.y,b2=r2.y+r2.h;return((x1<=a1&&a1<=x2)&&(y1<=b1&&b1<=y2))||((x1<=a2&&a2<=x2)&&(y1<=b1&&b1<=y2))||((x1<=a1&&a1<=x2)&&(y1<=b2&&b2<=y2))||((x1<=a2&&a1<=x2)&&(y1<=b2&&b2<=y2))||((a1<=x1&&x1<=a2)&&(b1<=y1&&y1<=b2))||((a1<=x2&&x2<=a2)&&(b1<=y1&&y1<=b2))||((a1<=x1&&x1<=a2)&&(b1<=y2&&y2<=b2))||((a1<=x2&&x1<=a2)&&(b1<=y2&&y2<=b2));},_encloses=Biltong.encloses=function(r1,r2,allowSharedEdges){var x1=r1.x,x2=r1.x+r1.w,y1=r1.y,y2=r1.y+r1.h,a1=r2.x,a2=r2.x+r2.w,b1=r2.y,b2=r2.y+r2.h,c=function(v1,v2,v3,v4){return allowSharedEdges?v1<=v2&&v3>=v4:v1<v2&&v3>v4;};return c(x1,a1,x2,a2)&&c(y1,b1,y2,b2);},_segmentMultipliers=[null,[1,-1],[1,1],[-1,1],[-1,-1]],_inverseSegmentMultipliers=[null,[-1,-1],[-1,1],[1,1],[1,-1]],_pointOnLine=Biltong.pointOnLine=function(fromPoint,toPoint,distance){var m=_gradient(fromPoint,toPoint),s=_quadrant(fromPoint,toPoint),segmentMultiplier=distance>0?_segmentMultipliers[s]:_inverseSegmentMultipliers[s],theta=Math.atan(m),y=Math.abs(distance*Math.sin(theta))*segmentMultiplier[1],x=Math.abs(distance*Math.cos(theta))*segmentMultiplier[0];return{x:fromPoint.x+x,y:fromPoint.y+y};},_perpendicularLineTo=Biltong.perpendicularLineTo=function(fromPoint,toPoint,length){var m=_gradient(fromPoint,toPoint),theta2=Math.atan(-1/m),y=length/2*Math.sin(theta2),x=length/2*Math.cos(theta2);return[{x:toPoint.x+x,y:toPoint.y+y},{x:toPoint.x-x,y:toPoint.y-y}];};}).call(this);;(function(){"use strict";var Sniff={android:navigator.userAgent.toLowerCase().indexOf("android")>-1};var matchesSelector=function(el,selector,ctx){ctx=ctx||el.parentNode;var possibles=ctx.querySelectorAll(selector);for(var i=0;i<possibles.length;i++){if(possibles[i]===el){return true;}}
return false;},_gel=function(el){return typeof el=="string"?document.getElementById(el):el;},_t=function(e){return e.srcElement||e.target;},_d=function(l,fn){for(var i=0,j=l.length;i<j;i++){if(l[i]==fn)break;}
if(i<l.length)l.splice(i,1);},guid=1,_store=function(obj,event,fn){var g=guid++;obj.__ta=obj.__ta||{};obj.__ta[event]=obj.__ta[event]||{};obj.__ta[event][g]=fn;fn.__tauid=g;return g;},_unstore=function(obj,event,fn){obj.__ta&&obj.__ta[event]&&delete obj.__ta[event][fn.__tauid];if(fn.__taExtra){for(var i=0;i<fn.__taExtra.length;i++){_unbind(obj,fn.__taExtra[i][0],fn.__taExtra[i][1]);}
fn.__taExtra.length=0;}
fn.__taUnstore&&fn.__taUnstore();},_curryChildFilter=function(children,obj,fn,evt){if(children==null)return fn;else{var c=children.split(","),_fn=function(e){_fn.__tauid=fn.__tauid;var t=_t(e);for(var i=0;i<c.length;i++){if(matchesSelector(t,c[i],obj)){fn.apply(t,arguments);}}};registerExtraFunction(fn,evt,_fn);return _fn;}},registerExtraFunction=function(fn,evt,newFn){fn.__taExtra=fn.__taExtra||[];fn.__taExtra.push([evt,newFn]);},DefaultHandler=function(obj,evt,fn,children){if(isTouchDevice&&touchMap[evt]){var tfn=_curryChildFilter(children,obj,fn,touchMap[evt]);_bind(obj,touchMap[evt],tfn,fn);}
if(evt==="focus"&&obj.getAttribute("tabindex")==null){obj.setAttribute("tabindex","1");}
_bind(obj,evt,_curryChildFilter(children,obj,fn,evt),fn);},SmartClickHandler=function(obj,evt,fn,children){if(obj.__taSmartClicks==null){var down=function(e){obj.__tad=_pageLocation(e);},up=function(e){obj.__tau=_pageLocation(e);},click=function(e){if(obj.__tad&&obj.__tau&&obj.__tad[0]===obj.__tau[0]&&obj.__tad[1]===obj.__tau[1]){for(var i=0;i<obj.__taSmartClicks.length;i++)
obj.__taSmartClicks[i].apply(_t(e),[e]);}};DefaultHandler(obj,"mousedown",down,children);DefaultHandler(obj,"mouseup",up,children);DefaultHandler(obj,"click",click,children);obj.__taSmartClicks=[];}
obj.__taSmartClicks.push(fn);fn.__taUnstore=function(){_d(obj.__taSmartClicks,fn);};},_tapProfiles={"tap":{touches:1,taps:1},"dbltap":{touches:1,taps:2},"contextmenu":{touches:2,taps:1}},TapHandler=function(clickThreshold,dblClickThreshold){return function(obj,evt,fn,children){if(evt=="contextmenu"&&isMouseDevice)
DefaultHandler(obj,evt,fn,children);else{if(obj.__taTapHandler==null){var tt=obj.__taTapHandler={tap:[],dbltap:[],contextmenu:[],down:false,taps:0,downSelectors:[]};var down=function(e){var target=e.srcElement||e.target;for(var i=0;i<tt.downSelectors.length;i++){if(tt.downSelectors[i]==null||matchesSelector(target,tt.downSelectors[i],obj)){tt.down=true;setTimeout(clearSingle,clickThreshold);setTimeout(clearDouble,dblClickThreshold);break;}}},up=function(e){if(tt.down){var target=e.srcElement||e.target;tt.taps++;var tc=_touchCount(e);for(var eventId in _tapProfiles){var p=_tapProfiles[eventId];if(p.touches===tc&&(p.taps===1||p.taps===tt.taps)){for(var i=0;i<tt[eventId].length;i++){if(tt[eventId][i][1]==null||matchesSelector(target,tt[eventId][i][1],obj))
tt[eventId][i][0].apply(_t(e),[e]);}}}}},clearSingle=function(){tt.down=false;},clearDouble=function(){tt.taps=0;};DefaultHandler(obj,"mousedown",down);DefaultHandler(obj,"mouseup",up);}
obj.__taTapHandler.downSelectors.push(children);obj.__taTapHandler[evt].push([fn,children]);fn.__taUnstore=function(){_d(obj.__taTapHandler[evt],fn);};}};},meeHelper=function(type,evt,obj,target){for(var i in obj.__tamee[type]){obj.__tamee[type][i].apply(target,[evt]);}},MouseEnterExitHandler=function(){var activeElements=[];return function(obj,evt,fn,children){if(!obj.__tamee){obj.__tamee={over:false,mouseenter:[],mouseexit:[]};var over=function(e){var t=_t(e);if((children==null&&(t==obj&&!obj.__tamee.over))||(matchesSelector(t,children,obj)&&(t.__tamee==null||!t.__tamee.over))){meeHelper("mouseenter",e,obj,t);t.__tamee=t.__tamee||{};t.__tamee.over=true;activeElements.push(t);}},out=function(e){var t=_t(e);for(var i=0;i<activeElements.length;i++){if(t==activeElements[i]&&!matchesSelector((e.relatedTarget||e.toElement),"*",t)){t.__tamee.over=false;activeElements.splice(i,1);meeHelper("mouseexit",e,obj,t);}}};_bind(obj,"mouseover",_curryChildFilter(children,obj,over,"mouseover"),over);_bind(obj,"mouseout",_curryChildFilter(children,obj,out,"mouseout"),out);}
fn.__taUnstore=function(){delete obj.__tamee[evt][fn.__tauid];};_store(obj,evt,fn);obj.__tamee[evt][fn.__tauid]=fn;};},isTouchDevice="ontouchstart"in document.documentElement,isMouseDevice="onmousedown"in document.documentElement,touchMap={"mousedown":"touchstart","mouseup":"touchend","mousemove":"touchmove"},touchstart="touchstart",touchend="touchend",touchmove="touchmove",iev=(function(){var rv=-1;if(navigator.appName=='Microsoft Internet Explorer'){var ua=navigator.userAgent,re=new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");if(re.exec(ua)!=null)
rv=parseFloat(RegExp.$1);}
return rv;})(),isIELT9=iev>-1&&iev<9,_genLoc=function(e,prefix){if(e==null)return[0,0];var ts=_touches(e),t=_getTouch(ts,0);return[t[prefix+"X"],t[prefix+"Y"]];},_pageLocation=function(e){if(e==null)return[0,0];if(isIELT9){return[e.clientX+document.documentElement.scrollLeft,e.clientY+document.documentElement.scrollTop];}
else{return _genLoc(e,"page");}},_screenLocation=function(e){return _genLoc(e,"screen");},_clientLocation=function(e){return _genLoc(e,"client");},_getTouch=function(touches,idx){return touches.item?touches.item(idx):touches[idx];},_touches=function(e){return e.touches&&e.touches.length>0?e.touches:e.changedTouches&&e.changedTouches.length>0?e.changedTouches:e.targetTouches&&e.targetTouches.length>0?e.targetTouches:[e];},_touchCount=function(e){return _touches(e).length;},_bind=function(obj,type,fn,originalFn){_store(obj,type,fn);originalFn.__tauid=fn.__tauid;if(obj.addEventListener)
obj.addEventListener(type,fn,false);else if(obj.attachEvent){var key=type+fn.__tauid;obj["e"+key]=fn;obj[key]=function(){obj["e"+key]&&obj["e"+key](window.event);};obj.attachEvent("on"+type,obj[key]);}},_unbind=function(obj,type,fn){if(fn==null)return;_each(obj,function(){var _el=_gel(this);_unstore(_el,type,fn);if(fn.__tauid!=null){if(_el.removeEventListener){_el.removeEventListener(type,fn,false);if(isTouchDevice&&touchMap[type])_el.removeEventListener(touchMap[type],fn,false);}
else if(this.detachEvent){var key=type+fn.__tauid;_el[key]&&_el.detachEvent("on"+type,_el[key]);_el[key]=null;_el["e"+key]=null;}}
if(fn.__taTouchProxy){_unbind(obj,fn.__taTouchProxy[1],fn.__taTouchProxy[0]);}});},_devNull=function(){},_each=function(obj,fn){if(obj==null)return;obj=(typeof Window!=="undefined"&&(typeof obj.top!=="unknown"&&obj==obj.top))?[obj]:(typeof obj!=="string")&&(obj.tagName==null&&obj.length!=null)?obj:typeof obj==="string"?document.querySelectorAll(obj):[obj];for(var i=0;i<obj.length;i++)
fn.apply(obj[i]);};this.Mottle=function(params){params=params||{};var clickThreshold=params.clickThreshold||150,dblClickThreshold=params.dblClickThreshold||350,mouseEnterExitHandler=new MouseEnterExitHandler(),tapHandler=new TapHandler(clickThreshold,dblClickThreshold),_smartClicks=params.smartClicks,_doBind=function(obj,evt,fn,children){if(fn==null)return;_each(obj,function(){var _el=_gel(this);if(_smartClicks&&evt==="click")
SmartClickHandler(_el,evt,fn,children);else if(evt==="tap"||evt==="dbltap"||evt==="contextmenu"){tapHandler(_el,evt,fn,children);}
else if(evt==="mouseenter"||evt=="mouseexit")
mouseEnterExitHandler(_el,evt,fn,children);else
DefaultHandler(_el,evt,fn,children);});};this.remove=function(el){_each(el,function(){var _el=_gel(this);if(_el.__ta){for(var evt in _el.__ta){for(var h in _el.__ta[evt]){_unbind(_el,evt,_el.__ta[evt][h]);}}}
_el.parentNode&&_el.parentNode.removeChild(_el);});return this;};this.on=function(el,event,children,fn){var _el=arguments[0],_c=arguments.length==4?arguments[2]:null,_e=arguments[1],_f=arguments[arguments.length-1];_doBind(_el,_e,_f,_c);return this;};this.off=function(el,event,fn){_unbind(el,event,fn);return this;};this.trigger=function(el,event,originalEvent,payload){var originalIsMouse=isMouseDevice&&(typeof MouseEvent==="undefined"||originalEvent==null||originalEvent.constructor===MouseEvent);var eventToBind=(isTouchDevice&&!isMouseDevice&&touchMap[event])?touchMap[event]:event,bindingAMouseEvent=!(isTouchDevice&&!isMouseDevice&&touchMap[event]);var pl=_pageLocation(originalEvent),sl=_screenLocation(originalEvent),cl=_clientLocation(originalEvent);_each(el,function(){var _el=_gel(this),evt;originalEvent=originalEvent||{screenX:sl[0],screenY:sl[1],clientX:cl[0],clientY:cl[1]};var _decorate=function(_evt){if(payload)_evt.payload=payload;};var eventGenerators={"TouchEvent":function(evt){var touch=document.createTouch(window,_el,0,pl[0],pl[1],sl[0],sl[1],cl[0],cl[1],0,0,0,0);var touches=document.createTouchList(touch);var targetTouches=document.createTouchList(touch);var changedTouches=document.createTouchList(touch);evt.initTouchEvent(eventToBind,true,true,window,null,sl[0],sl[1],cl[0],cl[1],false,false,false,false,touches,targetTouches,changedTouches,1,0);},"MouseEvents":function(evt){evt.initMouseEvent(eventToBind,true,true,window,0,sl[0],sl[1],cl[0],cl[1],false,false,false,false,1,_el);if(Sniff.android){var t=document.createTouch(window,_el,0,pl[0],pl[1],sl[0],sl[1],cl[0],cl[1],0,0,0,0);evt.touches=evt.targetTouches=evt.changedTouches=document.createTouchList(t);}}};if(document.createEvent){var ite=!bindingAMouseEvent&&!originalIsMouse&&(isTouchDevice&&touchMap[event]&&!Sniff.android),evtName=ite?"TouchEvent":"MouseEvents";evt=document.createEvent(evtName);eventGenerators[evtName](evt);_decorate(evt);_el.dispatchEvent(evt);}
else if(document.createEventObject){evt=document.createEventObject();evt.eventType=evt.eventName=eventToBind;evt.screenX=sl[0];evt.screenY=sl[1];evt.clientX=cl[0];evt.clientY=cl[1];_decorate(evt);_el.fireEvent('on'+eventToBind,evt);}});return this;}};Mottle.consume=function(e,doNotPreventDefault){if(e.stopPropagation)
e.stopPropagation();else
e.returnValue=false;if(!doNotPreventDefault&&e.preventDefault)
e.preventDefault();};Mottle.pageLocation=_pageLocation;Mottle.setForceTouchEvents=function(value){isTouchDevice=value;};Mottle.setForceMouseEvents=function(value){isMouseDevice=value;};}).call(this);;(function(){"use strict";var getOffsetRect=function(elem){var box=elem.getBoundingClientRect();var body=document.body;var docElem=document.documentElement;var scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop;var scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft;var clientTop=docElem.clientTop||body.clientTop||0;var clientLeft=docElem.clientLeft||body.clientLeft||0;var top=box.top+scrollTop-clientTop;var left=box.left+scrollLeft-clientLeft;return{top:Math.round(top),left:Math.round(left)};};var matchesSelector=function(el,selector,ctx){ctx=ctx||el.parentNode;var possibles=ctx.querySelectorAll(selector);for(var i=0;i<possibles.length;i++){if(possibles[i]===el)
return true;}
return false;};var iev=(function(){var rv=-1;if(navigator.appName=='Microsoft Internet Explorer'){var ua=navigator.userAgent,re=new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");if(re.exec(ua)!=null)
rv=parseFloat(RegExp.$1);}
return rv;})(),DEFAULT_GRID_X=50,DEFAULT_GRID_Y=50,isIELT9=iev>-1&&iev<9,_pl=function(e){if(isIELT9){return[e.clientX+document.documentElement.scrollLeft,e.clientY+document.documentElement.scrollTop];}
else{var ts=_touches(e),t=_getTouch(ts,0);return[t.pageX,t.pageY];}},_getTouch=function(touches,idx){return touches.item?touches.item(idx):touches[idx];},_touches=function(e){return e.touches&&e.touches.length>0?e.touches:e.changedTouches&&e.changedTouches.length>0?e.changedTouches:e.targetTouches&&e.targetTouches.length>0?e.targetTouches:[e];},_classes={draggable:"katavorio-draggable",droppable:"katavorio-droppable",drag:"katavorio-drag",selected:"katavorio-drag-selected",active:"katavorio-drag-active",hover:"katavorio-drag-hover",noSelect:"katavorio-drag-no-select"},_defaultScope="katavorio-drag-scope",_events=["stop","start","drag","drop","over","out"],_devNull=function(){},_true=function(){return true;},_foreach=function(l,fn,from){for(var i=0;i<l.length;i++){if(l[i]!=from)
fn(l[i]);}},_setDroppablesActive=function(dd,val,andHover,drag){_foreach(dd,function(e){e.setActive(val);if(val)e.updatePosition();if(andHover)e.setHover(drag,val);});},_each=function(obj,fn){if(obj==null)return;obj=(typeof obj!=="string")&&(obj.tagName==null&&obj.length!=null)?obj:[obj];for(var i=0;i<obj.length;i++)
fn.apply(obj[i],[obj[i]]);},_consume=function(e){if(e.stopPropagation){e.stopPropagation();e.preventDefault();}
else{e.returnValue=false;}},_defaultInputFilterSelector="input,textarea,select,button,option",_inputFilter=function(e,el,_katavorio){var t=e.srcElement||e.target;return!matchesSelector(t,_katavorio.getInputFilterSelector(),el);};var Super=function(el,params,css,scope){this.params=params||{};this.el=el;this.params.addClass(this.el,this._class);this.uuid=_uuid();var enabled=true;this.setEnabled=function(e){enabled=e;};this.isEnabled=function(){return enabled;};this.toggleEnabled=function(){enabled=!enabled;};this.setScope=function(scopes){this.scopes=scopes?scopes.split(/\s+/):[scope];};this.addScope=function(scopes){var m={};_each(this.scopes,function(s){m[s]=true;});_each(scopes?scopes.split(/\s+/):[],function(s){m[s]=true;});this.scopes=[];for(var i in m)this.scopes.push(i);};this.removeScope=function(scopes){var m={};_each(this.scopes,function(s){m[s]=true;});_each(scopes?scopes.split(/\s+/):[],function(s){delete m[s];});this.scopes=[];for(var i in m)this.scopes.push(i);};this.toggleScope=function(scopes){var m={};_each(this.scopes,function(s){m[s]=true;});_each(scopes?scopes.split(/\s+/):[],function(s){if(m[s])delete m[s];else m[s]=true;});this.scopes=[];for(var i in m)this.scopes.push(i);};this.setScope(params.scope);this.k=params.katavorio;return params.katavorio;};var Drag=function(el,params,css,scope){this._class=css.draggable;var k=Super.apply(this,arguments);this.rightButtonCanDrag=this.params.rightButtonCanDrag;var downAt=[0,0],posAtDown=null,moving=false,consumeStartEvent=this.params.consumeStartEvent!==false,dragEl=this.el,clone=this.params.clone,scroll=this.params.scroll,_multipleDrop=params.multipleDrop!==false;var snapThreshold=params.snapThreshold||5,_snap=function(pos,x,y,thresholdX,thresholdY){thresholdX=thresholdX||snapThreshold;thresholdY=thresholdY||snapThreshold;var _dx=Math.floor(pos[0]/x),_dxl=x*_dx,_dxt=_dxl+x,_x=Math.abs(pos[0]-_dxl)<=thresholdX?_dxl:Math.abs(_dxt-pos[0])<=thresholdX?_dxt:pos[0];var _dy=Math.floor(pos[1]/y),_dyl=y*_dy,_dyt=_dyl+y,_y=Math.abs(pos[1]-_dyl)<=thresholdY?_dyl:Math.abs(_dyt-pos[1])<=thresholdY?_dyt:pos[1];return[_x,_y];};this.toGrid=function(pos){if(this.params.grid==null){return pos;}
else{return _snap(pos,this.params.grid[0],this.params.grid[1]);}};this.snap=function(x,y){if(dragEl==null)return;x=x||(this.params.grid?this.params.grid[0]:DEFAULT_GRID_X);y=y||(this.params.grid?this.params.grid[1]:DEFAULT_GRID_Y);var p=this.params.getPosition(dragEl);this.params.setPosition(dragEl,_snap(p,x,y,x,y));};this.constrain=typeof this.params.constrain==="function"?this.params.constrain:(this.params.constrain||this.params.containment)?function(pos){return[Math.max(0,Math.min(constrainRect.w-this.size[0],pos[0])),Math.max(0,Math.min(constrainRect.h-this.size[1],pos[1]))];}:function(pos){return pos;};var _assignId=function(obj){if(typeof obj=="function"){obj._katavorioId=_uuid();return obj._katavorioId;}else{return obj;}},_filters={},_testFilter=function(e){for(var key in _filters){var f=_filters[key];var rv=f[0](e);if(f[1])rv=!rv;if(!rv)return false;}
return true;},_setFilter=this.setFilter=function(f,_exclude){if(f){var key=_assignId(f);_filters[key]=[function(e){var t=e.srcElement||e.target,m;if(typeof f==="string"){m=matchesSelector(t,f,el);}
else if(typeof f==="function"){m=f(e,el);}
return m;},_exclude!==false];}},_addFilter=this.addFilter=_setFilter,_removeFilter=this.removeFilter=function(f){var key=typeof f=="function"?f._katavorioId:f;delete _filters[key];};this.clearAllFilters=function(){_filters={};};this.canDrag=this.params.canDrag||_true;var constrainRect,matchingDroppables=[],intersectingDroppables=[];this.downListener=function(e){var isNotRightClick=this.rightButtonCanDrag||(e.which!==3&&e.button!==2);if(isNotRightClick&&this.isEnabled()&&this.canDrag()){var _f=_testFilter(e)&&_inputFilter(e,this.el,this.k);if(_f){if(!clone)
dragEl=this.el;else{dragEl=this.el.cloneNode(true);dragEl.setAttribute("id",null);dragEl.style.position="absolute";var b=getOffsetRect(this.el);dragEl.style.left=b.left+"px";dragEl.style.top=b.top+"px";document.body.appendChild(dragEl);}
consumeStartEvent&&_consume(e);downAt=_pl(e);this.params.bind(document,"mousemove",this.moveListener);this.params.bind(document,"mouseup",this.upListener);k.markSelection(this);this.params.addClass(document.body,css.noSelect);}
else if(this.params.consumeFilteredEvents){_consume(e);}}}.bind(this);this.moveListener=function(e){if(downAt){if(!moving){var _continue=_dispatch("start",{el:this.el,pos:posAtDown,e:e,drag:this});if(_continue!==false){if(!downAt)return;this.mark(true);moving=true;}}
if(downAt){intersectingDroppables.length=0;var pos=_pl(e),dx=pos[0]-downAt[0],dy=pos[1]-downAt[1],z=this.params.ignoreZoom?1:k.getZoom();dx/=z;dy/=z;this.moveBy(dx,dy,e);k.updateSelection(dx,dy,this);}}}.bind(this);this.upListener=function(e){if(downAt){downAt=null;this.params.unbind(document,"mousemove",this.moveListener);this.params.unbind(document,"mouseup",this.upListener);this.params.removeClass(document.body,css.noSelect);this.unmark(e);k.unmarkSelection(this,e);this.stop(e);k.notifySelectionDragStop(this,e);moving=false;if(clone){dragEl&&dragEl.parentNode&&dragEl.parentNode.removeChild(dragEl);dragEl=null;}}}.bind(this);this.getFilters=function(){return _filters;};this.abort=function(){if(downAt!=null)
this.upListener();};this.getDragElement=function(){return dragEl||this.el;};var listeners={"start":[],"drag":[],"stop":[],"over":[],"out":[]};if(params.events.start)listeners.start.push(params.events.start);if(params.events.stop)listeners.stop.push(params.events.stop);if(params.events.drag)listeners.drag.push(params.events.drag);this.on=function(evt,fn){if(listeners[evt])listeners[evt].push(fn);};var _dispatch=function(evt,value){if(listeners[evt]){for(var i=0;i<listeners[evt].length;i++){try{listeners[evt][i](value);}
catch(e){}}}};this.notifyStart=function(e){_dispatch("start",{el:this.el,pos:this.params.getPosition(dragEl),e:e,drag:this});};this.stop=function(e,force){if(force||moving){var positions=[],sel=k.getSelection(),dPos=this.params.getPosition(dragEl);if(sel.length>1){for(var i=0;i<sel.length;i++){var p=this.params.getPosition(sel[i].el);positions.push([sel[i].el,{left:p[0],top:p[1]},sel[i]]);}}
else{positions.push([dragEl,{left:dPos[0],top:dPos[1]},this]);}
_dispatch("stop",{el:dragEl,pos:dPos,e:e,drag:this,selection:positions});}};this.mark=function(andNotify){posAtDown=this.params.getPosition(dragEl);this.size=this.params.getSize(dragEl);matchingDroppables=k.getMatchingDroppables(this);_setDroppablesActive(matchingDroppables,true,false,this);this.params.addClass(dragEl,this.params.dragClass||css.drag);if(this.params.constrain||this.params.containment){var cs=this.params.getSize(dragEl.parentNode);constrainRect={w:cs[0],h:cs[1]};}
if(andNotify){k.notifySelectionDragStart(this);}};this.unmark=function(e){_setDroppablesActive(matchingDroppables,false,true,this);this.params.removeClass(dragEl,this.params.dragClass||css.drag);matchingDroppables.length=0;for(var i=0;i<intersectingDroppables.length;i++){var retVal=intersectingDroppables[i].drop(this,e);if(retVal===true)break;}};this.moveBy=function(dx,dy,e){intersectingDroppables.length=0;var cPos=this.constrain(this.toGrid(([posAtDown[0]+dx,posAtDown[1]+dy])),dragEl),rect={x:cPos[0],y:cPos[1],w:this.size[0],h:this.size[1]};this.params.setPosition(dragEl,cPos);for(var i=0;i<matchingDroppables.length;i++){var r2={x:matchingDroppables[i].position[0],y:matchingDroppables[i].position[1],w:matchingDroppables[i].size[0],h:matchingDroppables[i].size[1]};if(this.params.intersects(rect,r2)&&matchingDroppables[i].canDrop(this)){intersectingDroppables.push(matchingDroppables[i]);matchingDroppables[i].setHover(this,true,e);}
else if(matchingDroppables[i].isHover()){matchingDroppables[i].setHover(this,false,e);}}
_dispatch("drag",{el:this.el,pos:cPos,e:e,drag:this});};this.destroy=function(){this.params.unbind(this.el,"mousedown",this.downListener);this.params.unbind(document,"mousemove",this.moveListener);this.params.unbind(document,"mouseup",this.upListener);this.downListener=null;this.upListener=null;this.moveListener=null;};this.params.bind(this.el,"mousedown",this.downListener);if(this.params.handle)
_setFilter(this.params.handle,false);else
_setFilter(this.params.filter,this.params.filterExclude);};var Drop=function(el,params,css,scope){this._class=css.droppable;this.params=params||{};this._activeClass=params.activeClass||css.active;this._hoverClass=params.hoverClass||css.hover;Super.apply(this,arguments);var hover=false;this.setActive=function(val){this.params[val?"addClass":"removeClass"](this.el,this._activeClass);};this.updatePosition=function(){this.position=this.params.getPosition(this.el);this.size=this.params.getSize(this.el);};this.canDrop=this.params.canDrop||function(drag){return true;};this.isHover=function(){return hover;};this.setHover=function(drag,val,e){if(val||this.el._katavorioDragHover==null||this.el._katavorioDragHover==drag.el._katavorio){this.params[val?"addClass":"removeClass"](this.el,this._hoverClass);this.el._katavorioDragHover=val?drag.el._katavorio:null;if(hover!==val)
this.params.events[val?"over":"out"]({el:this.el,e:e,drag:drag,drop:this});hover=val;}};this.drop=function(drag,event){return this.params.events["drop"]({drag:drag,e:event,drop:this});};this.destroy=function(){this._class=null;this._activeClass=null;this._hoverClass=null;hover=null;};};var _uuid=function(){return('xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);}));};var _gel=function(el){if(el==null)return null;el=typeof el==="string"?document.getElementById(el):el;if(el==null)return null;el._katavorio=el._katavorio||_uuid();return el;};this.Katavorio=function(katavorioParams){var _selection=[],_selectionMap={};this._dragsByScope={};this._dropsByScope={};var _zoom=1,_reg=function(obj,map){for(var i=0;i<obj.scopes.length;i++){map[obj.scopes[i]]=map[obj.scopes[i]]||[];map[obj.scopes[i]].push(obj);}},_unreg=function(obj,map){var c=0;for(var i=0;i<obj.scopes.length;i++){if(map[obj.scopes[i]]){var idx=katavorioParams.indexOf(map[obj.scopes[i]],obj);if(idx!=-1){map[obj.scopes[i]].splice(idx,1);c++;}}}
return c>0;},_getMatchingDroppables=this.getMatchingDroppables=function(drag){var dd=[],_m={};for(var i=0;i<drag.scopes.length;i++){var _dd=this._dropsByScope[drag.scopes[i]];if(_dd){for(var j=0;j<_dd.length;j++){if(_dd[j].canDrop(drag)&&!_m[_dd[j].uuid]&&_dd[j].el!==drag.el){_m[_dd[j].uuid]=true;dd.push(_dd[j]);}}}}
return dd;},_prepareParams=function(p){p=p||{};var _p={events:{}};for(var i in katavorioParams)_p[i]=katavorioParams[i];for(var i in p)_p[i]=p[i];for(var i=0;i<_events.length;i++){_p.events[_events[i]]=p[_events[i]]||_devNull;}
_p.katavorio=this;return _p;}.bind(this),_mistletoe=function(existingDrag,params){for(var i=0;i<_events.length;i++){if(params[_events[i]]){existingDrag.on(_events[i],params[_events[i]]);}}}.bind(this),_css={},overrideCss=katavorioParams.css||{},_scope=katavorioParams.scope||_defaultScope;for(var i in _classes)_css[i]=_classes[i];for(var i in overrideCss)_css[i]=overrideCss[i];var inputFilterSelector=katavorioParams.inputFilterSelector||_defaultInputFilterSelector;this.getInputFilterSelector=function(){return inputFilterSelector;};this.setInputFilterSelector=function(selector){inputFilterSelector=selector;return this;};this.draggable=function(el,params){var o=[];_each(el,function(_el){_el=_gel(_el);if(_el!=null){if(_el._katavorioDrag==null){var p=_prepareParams(params);_el._katavorioDrag=new Drag(_el,p,_css,_scope);_reg(_el._katavorioDrag,this._dragsByScope);o.push(_el._katavorioDrag);katavorioParams.addClass(_el,_css.draggable);}
else{_mistletoe(_el._katavorioDrag,params);}}}.bind(this));return o;};this.droppable=function(el,params){var o=[];_each(el,function(_el){_el=_gel(_el);if(_el!=null){_el._katavorioDrop=new Drop(_el,_prepareParams(params),_css,_scope);_reg(_el._katavorioDrop,this._dropsByScope);o.push(_el._katavorioDrop);katavorioParams.addClass(_el,_css.droppable);}}.bind(this));return o;};this.select=function(el){_each(el,function(){var _el=_gel(this);if(_el&&_el._katavorioDrag){if(!_selectionMap[_el._katavorio]){_selection.push(_el._katavorioDrag);_selectionMap[_el._katavorio]=[_el,_selection.length-1];katavorioParams.addClass(_el,_css.selected);}}});return this;};this.deselect=function(el){_each(el,function(){var _el=_gel(this);if(_el&&_el._katavorio){var e=_selectionMap[_el._katavorio];if(e){var _s=[];for(var i=0;i<_selection.length;i++)
if(_selection[i].el!==_el)_s.push(_selection[i]);_selection=_s;delete _selectionMap[_el._katavorio];katavorioParams.removeClass(_el,_css.selected);}}});return this;};this.deselectAll=function(){for(var i in _selectionMap){var d=_selectionMap[i];katavorioParams.removeClass(d[0],_css.selected);}
_selection.length=0;_selectionMap={};};this.markSelection=function(drag){_foreach(_selection,function(e){e.mark();},drag);};this.unmarkSelection=function(drag,event){_foreach(_selection,function(e){e.unmark(event);},drag);};this.getSelection=function(){return _selection.slice(0);};this.updateSelection=function(dx,dy,drag){_foreach(_selection,function(e){e.moveBy(dx,dy);},drag);};this.notifySelectionDragStop=function(drag,evt){_foreach(_selection,function(e){e.stop(evt,true);},drag);};this.notifySelectionDragStart=function(drag,evt){_foreach(_selection,function(e){e.notifyStart(evt);},drag);};this.setZoom=function(z){_zoom=z;};this.getZoom=function(){return _zoom;};var _scopeManip=function(kObj,scopes,map,fn){if(kObj!=null){_unreg(kObj,map);kObj[fn](scopes);_reg(kObj,map);}};_each(["set","add","remove","toggle"],function(v){this[v+"Scope"]=function(el,scopes){_scopeManip(el._katavorioDrag,scopes,this._dragsByScope,v+"Scope");_scopeManip(el._katavorioDrop,scopes,this._dropsByScope,v+"Scope");}.bind(this);this[v+"DragScope"]=function(el,scopes){_scopeManip(el._katavorioDrag,scopes,this._dragsByScope,v+"Scope");}.bind(this);this[v+"DropScope"]=function(el,scopes){_scopeManip(el._katavorioDrop,scopes,this._dropsByScope,v+"Scope");}.bind(this);}.bind(this));this.snapToGrid=function(x,y){for(var s in this._dragsByScope){_foreach(this._dragsByScope[s],function(d){d.snap(x,y);});}};this.getDragsForScope=function(s){return this._dragsByScope[s];};this.getDropsForScope=function(s){return this._dropsByScope[s];};var _destroy=function(el,type,map){el=_gel(el);if(el[type]){if(_unreg(el[type],map))
el[type].destroy();el[type]=null;}};this.elementRemoved=function(el){this.destroyDraggable(el);this.destroyDroppable(el);};this.destroyDraggable=function(el){_destroy(el,"_katavorioDrag",this._dragsByScope);};this.destroyDroppable=function(el){_destroy(el,"_katavorioDrop",this._dropsByScope);};this.reset=function(){this._dragsByScope={};this._dropsByScope={};_selection=[];_selectionMap={};};};}).call(this);;(function(){var _isa=function(a){return Object.prototype.toString.call(a)==="[object Array]";},_isnum=function(n){return Object.prototype.toString.call(n)==="[object Number]";},_iss=function(s){return typeof s==="string";},_isb=function(s){return typeof s==="boolean";},_isnull=function(s){return s==null;},_iso=function(o){return o==null?false:Object.prototype.toString.call(o)==="[object Object]";},_isd=function(o){return Object.prototype.toString.call(o)==="[object Date]";},_isf=function(o){return Object.prototype.toString.call(o)==="[object Function]";},_ise=function(o){for(var i in o){if(o.hasOwnProperty(i))return false;}
return true;};var root=this;var exports=root.jsPlumbUtil={isArray:_isa,isString:_iss,isBoolean:_isb,isNull:_isnull,isObject:_iso,isDate:_isd,isFunction:_isf,isEmpty:_ise,isNumber:_isnum,clone:function(a){if(_iss(a))return""+a;else if(_isb(a))return!!a;else if(_isd(a))return new Date(a.getTime());else if(_isf(a))return a;else if(_isa(a)){var b=[];for(var i=0;i<a.length;i++)
b.push(this.clone(a[i]));return b;}
else if(_iso(a)){var c={};for(var j in a)
c[j]=this.clone(a[j]);return c;}
else return a;},merge:function(a,b,collations){var cMap={},ar,i;collations=collations||[];for(i=0;i<collations.length;i++)
cMap[collations[i]]=true;var c=this.clone(a);for(i in b){if(c[i]==null){c[i]=b[i];}
else if(_iss(b[i])||_isb(b[i])){if(!cMap[i]){c[i]=b[i];}
else{ar=[];ar.push.apply(ar,_isa(c[i])?c[i]:[c[i]]);ar.push.apply(ar,_isa(b[i])?b[i]:[b[i]]);c[i]=ar;}}
else{if(_isa(b[i])){ar=[];if(_isa(c[i]))ar.push.apply(ar,c[i]);ar.push.apply(ar,b[i]);c[i]=ar;}
else if(_iso(b[i])){if(!_iso(c[i]))
c[i]={};for(var j in b[i]){c[i][j]=b[i][j];}}}}
return c;},replace:function(inObj,path,value){if(inObj==null)return;var q=inObj,t=q;path.replace(/([^\.])+/g,function(term,lc,pos,str){var array=term.match(/([^\[0-9]+){1}(\[)([0-9+])/),last=pos+term.length>=str.length,_getArray=function(){return t[array[1]]||(function(){t[array[1]]=[];return t[array[1]];})();};if(last){if(array)
_getArray()[array[3]]=value;else
t[term]=value;}
else{if(array){var a=_getArray();t=a[array[3]]||(function(){a[array[3]]={};return a[array[3]];})();}
else
t=t[term]||(function(){t[term]={};return t[term];})();}});return inObj;},functionChain:function(successValue,failValue,fns){for(var i=0;i<fns.length;i++){var o=fns[i][0][fns[i][1]].apply(fns[i][0],fns[i][2]);if(o===failValue){return o;}}
return successValue;},populate:function(model,values){var getValue=function(fromString){var matches=fromString.match(/(\${.*?})/g);if(matches!=null){for(var i=0;i<matches.length;i++){var val=values[matches[i].substring(2,matches[i].length-1)]||"";if(val!=null){fromString=fromString.replace(matches[i],val);}}}
return fromString;},_one=function(d){if(d!=null){if(_iss(d)){return getValue(d);}
else if(_isa(d)){var r=[];for(var i=0;i<d.length;i++)
r.push(_one(d[i]));return r;}
else if(_iso(d)){var s={};for(var j in d){s[j]=_one(d[j]);}
return s;}
else{return d;}}};return _one(model);},findWithFunction:function(a,f){if(a)
for(var i=0;i<a.length;i++)if(f(a[i]))return i;return-1;},indexOf:function(l,v){return l.indexOf?l.indexOf(v):exports.findWithFunction(l,function(_v){return _v==v;});},removeWithFunction:function(a,f){var idx=exports.findWithFunction(a,f);if(idx>-1)a.splice(idx,1);return idx!=-1;},remove:function(l,v){var idx=exports.indexOf(l,v);if(idx>-1)l.splice(idx,1);return idx!=-1;},addWithFunction:function(list,item,hashFunction){if(exports.findWithFunction(list,hashFunction)==-1)list.push(item);},addToList:function(map,key,value,insertAtStart){var l=map[key];if(l==null){l=[];map[key]=l;}
l[insertAtStart?"unshift":"push"](value);return l;},extend:function(child,parent,_protoFn){var i;parent=_isa(parent)?parent:[parent];for(i=0;i<parent.length;i++){for(var j in parent[i].prototype){if(parent[i].prototype.hasOwnProperty(j)){child.prototype[j]=parent[i].prototype[j];}}}
var _makeFn=function(name,protoFn){return function(){for(i=0;i<parent.length;i++){if(parent[i].prototype[name])
parent[i].prototype[name].apply(this,arguments);}
return protoFn.apply(this,arguments);};};var _oneSet=function(fns){for(var k in fns){child.prototype[k]=_makeFn(k,fns[k]);}};if(arguments.length>2){for(i=2;i<arguments.length;i++)
_oneSet(arguments[i]);}
return child;},uuid:function(){return('xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);}));},logEnabled:true,log:function(){if(exports.logEnabled&&typeof console!="undefined"){try{var msg=arguments[arguments.length-1];console.log(msg);}
catch(e){}}},wrap:function(wrappedFunction,newFunction,returnOnThisValue){wrappedFunction=wrappedFunction||function(){};newFunction=newFunction||function(){};return function(){var r=null;try{r=newFunction.apply(this,arguments);}catch(e){exports.log("jsPlumb function failed : "+e);}
if(returnOnThisValue==null||(r!==returnOnThisValue)){try{r=wrappedFunction.apply(this,arguments);}catch(e){exports.log("wrapped function failed : "+e);}}
return r;};}};exports.EventGenerator=function(){var _listeners={},eventsSuspended=false,eventsToDieOn={"ready":true};this.bind=function(event,listener,insertAtStart){var _one=function(evt){exports.addToList(_listeners,evt,listener,insertAtStart);listener.__jsPlumb=listener.__jsPlumb||{};listener.__jsPlumb[jsPlumbUtil.uuid()]=evt;};if(typeof event==="string")_one(event);else if(event.length!=null){for(var i=0;i<event.length;i++){_one(event[i]);}}
return this;};this.fire=function(event,value,originalEvent){if(!eventsSuspended&&_listeners[event]){var l=_listeners[event].length,i=0,_gone=false,ret=null;if(!this.shouldFireEvent||this.shouldFireEvent(event,value,originalEvent)){while(!_gone&&i<l&&ret!==false){if(eventsToDieOn[event])
_listeners[event][i].apply(this,[value,originalEvent]);else{try{ret=_listeners[event][i].apply(this,[value,originalEvent]);}catch(e){exports.log("jsPlumb: fire failed for event "+event+" : "+e);}}
i++;if(_listeners==null||_listeners[event]==null)
_gone=true;}}}
return this;};this.unbind=function(eventOrListener,listener){if(arguments.length===0){_listeners={};}
else if(arguments.length===1){if(typeof eventOrListener==="string")
delete _listeners[eventOrListener];else if(eventOrListener.__jsPlumb){var evt;for(var i in eventOrListener.__jsPlumb){evt=eventOrListener.__jsPlumb[i];exports.remove(_listeners[evt]||[],eventOrListener);}}}
else if(arguments.length===2){exports.remove(_listeners[eventOrListener]||[],listener);}
return this;};this.getListener=function(forEvent){return _listeners[forEvent];};this.setSuspendEvents=function(val){eventsSuspended=val;};this.isSuspendEvents=function(){return eventsSuspended;};this.silently=function(fn){this.setSuspendEvents(true);try{fn();}
catch(e){jsPlumbUtil.log("Cannot execute silent function "+e);}
this.setSuspendEvents(false);};this.cleanupListeners=function(){for(var i in _listeners){_listeners[i]=null;}};};exports.EventGenerator.prototype={cleanup:function(){this.cleanupListeners();}};if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};}}).call(this);;(function(){"use strict";var root=this;var exports=root.jsPlumbUtil;exports.ieVersion=/MSIE\s([\d.]+)/.test(navigator.userAgent)?(new Number(RegExp.$1)):-1;exports.oldIE=exports.ieVersion>-1&&exports.ieVersion<9;exports.matchesSelector=function(el,selector,ctx){ctx=ctx||el.parentNode;var possibles=ctx.querySelectorAll(selector);for(var i=0;i<possibles.length;i++){if(possibles[i]===el)
return true;}
return false;};exports.consume=function(e,doNotPreventDefault){if(e.stopPropagation)
e.stopPropagation();else
e.returnValue=false;if(!doNotPreventDefault&&e.preventDefault)
e.preventDefault();};exports.sizeElement=function(el,x,y,w,h){if(el){el.style.height=h+"px";el.height=h;el.style.width=w+"px";el.width=w;el.style.left=x+"px";el.style.top=y+"px";}};}).call(this);(function(){"use strict";var root=this;var connectorTypes=[],rendererTypes;var _ju=root.jsPlumbUtil,_getOffset=function(el,_instance,relativeToRoot){return _instance.getOffset(el,relativeToRoot);},_timestamp=function(){return""+(new Date()).getTime();},_updateHoverStyle=function(component){if(component._jsPlumb.paintStyle&&component._jsPlumb.hoverPaintStyle){var mergedHoverStyle={};jsPlumb.extend(mergedHoverStyle,component._jsPlumb.paintStyle);jsPlumb.extend(mergedHoverStyle,component._jsPlumb.hoverPaintStyle);delete component._jsPlumb.hoverPaintStyle;if(mergedHoverStyle.gradient&&component._jsPlumb.paintStyle.fillStyle)
delete mergedHoverStyle.gradient;component._jsPlumb.hoverPaintStyle=mergedHoverStyle;}},events=["tap","dbltap","click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu"],eventFilters={"mouseout":"mouseleave","mouseexit":"mouseleave"},_updateAttachedElements=function(component,state,timestamp,sourceElement){var affectedElements=component.getAttachedElements();if(affectedElements){for(var i=0,j=affectedElements.length;i<j;i++){if(!sourceElement||sourceElement!=affectedElements[i])
affectedElements[i].setHover(state,true,timestamp);}}},_splitType=function(t){return t==null?null:t.split(" ");},_mapType=function(map,obj,typeId){for(var i in obj)
map[i]=typeId;},_applyTypes=function(component,params,doNotRepaint){if(component.getDefaultType){var td=component.getTypeDescriptor(),map={};var defType=component.getDefaultType();var o=_ju.merge({},defType);_mapType(map,defType,"__default");for(var i=0,j=component._jsPlumb.types.length;i<j;i++){var tid=component._jsPlumb.types[i];if(tid!=="__default"){var _t=component._jsPlumb.instance.getType(tid,td);if(_t!=null){o=_ju.merge(o,_t,["cssClass"]);_mapType(map,_t,tid);}}}
if(params){o=_ju.populate(o,params);}
component.applyType(o,doNotRepaint,map);if(!doNotRepaint)component.repaint();}},jsPlumbUIComponent=window.jsPlumbUIComponent=function(params){jsPlumbUtil.EventGenerator.apply(this,arguments);var self=this,a=arguments,idPrefix=self.idPrefix,id=idPrefix+(new Date()).getTime();this._jsPlumb={instance:params._jsPlumb,parameters:params.parameters||{},paintStyle:null,hoverPaintStyle:null,paintStyleInUse:null,hover:false,beforeDetach:params.beforeDetach,beforeDrop:params.beforeDrop,overlayPlacements:[],hoverClass:params.hoverClass||params._jsPlumb.Defaults.HoverClass,types:[],typeCache:{}};this.cacheTypeItem=function(key,item,typeId){this._jsPlumb.typeCache[typeId]=this._jsPlumb.typeCache[typeId]||{};this._jsPlumb.typeCache[typeId][key]=item;};this.getCachedTypeItem=function(key,typeId){return this._jsPlumb.typeCache[typeId]?this._jsPlumb.typeCache[typeId][key]:null;};this.getId=function(){return id;};var o=params.overlays||[],oo={};if(this.defaultOverlayKeys){for(var i=0;i<this.defaultOverlayKeys.length;i++)
Array.prototype.push.apply(o,this._jsPlumb.instance.Defaults[this.defaultOverlayKeys[i]]||[]);for(i=0;i<o.length;i++){var fo=jsPlumb.convertToFullOverlaySpec(o[i]);oo[fo[1].id]=fo;}}
var _defaultType={overlays:oo,parameters:params.parameters||{},scope:params.scope||this._jsPlumb.instance.getDefaultScope()};this.getDefaultType=function(){return _defaultType;};this.appendToDefaultType=function(obj){for(var i in obj)_defaultType[i]=obj[i];};if(params.events){for(i in params.events)
self.bind(i,params.events[i]);}
this.clone=function(){var o={};this.constructor.apply(o,a);return o;}.bind(this);this.isDetachAllowed=function(connection){var r=true;if(this._jsPlumb.beforeDetach){try{r=this._jsPlumb.beforeDetach(connection);}
catch(e){_ju.log("jsPlumb: beforeDetach callback failed",e);}}
return r;};this.isDropAllowed=function(sourceId,targetId,scope,connection,dropEndpoint,source,target){var r=this._jsPlumb.instance.checkCondition("beforeDrop",{sourceId:sourceId,targetId:targetId,scope:scope,connection:connection,dropEndpoint:dropEndpoint,source:source,target:target});if(this._jsPlumb.beforeDrop){try{r=this._jsPlumb.beforeDrop({sourceId:sourceId,targetId:targetId,scope:scope,connection:connection,dropEndpoint:dropEndpoint,source:source,target:target});}
catch(e){_ju.log("jsPlumb: beforeDrop callback failed",e);}}
return r;};var boundListeners=[],bindAListener=function(obj,type,fn){boundListeners.push([obj,type,fn]);obj.bind(type,fn);},domListeners=[];this.setListenerComponent=function(c){for(var i=0;i<domListeners.length;i++)
domListeners[i][3]=c;};};var _removeTypeCssHelper=function(component,typeIndex){var typeId=component._jsPlumb.types[typeIndex],type=component._jsPlumb.instance.getType(typeId,component.getTypeDescriptor());if(type!=null){if(type.cssClass&&component.canvas)
component._jsPlumb.instance.removeClass(component.canvas,type.cssClass);}};jsPlumbUtil.extend(jsPlumbUIComponent,jsPlumbUtil.EventGenerator,{getParameter:function(name){return this._jsPlumb.parameters[name];},setParameter:function(name,value){this._jsPlumb.parameters[name]=value;},getParameters:function(){return this._jsPlumb.parameters;},setParameters:function(p){this._jsPlumb.parameters=p;},getClass:function(){return jsPlumb.getClass(this.canvas);},hasClass:function(clazz){return jsPlumb.hasClass(this.canvas,clazz);},addClass:function(clazz){jsPlumb.addClass(this.canvas,clazz);},removeClass:function(clazz){jsPlumb.removeClass(this.canvas,clazz);},updateClasses:function(classesToAdd,classesToRemove){jsPlumb.updateClasses(this.canvas,classesToAdd,classesToRemove);},setType:function(typeId,params,doNotRepaint){this.clearTypes();this._jsPlumb.types=_splitType(typeId)||[];_applyTypes(this,params,doNotRepaint);},getType:function(){return this._jsPlumb.types;},reapplyTypes:function(params,doNotRepaint){_applyTypes(this,params,doNotRepaint);},hasType:function(typeId){return jsPlumbUtil.indexOf(this._jsPlumb.types,typeId)!=-1;},addType:function(typeId,params,doNotRepaint){var t=_splitType(typeId),_cont=false;if(t!=null){for(var i=0,j=t.length;i<j;i++){if(!this.hasType(t[i])){this._jsPlumb.types.push(t[i]);_cont=true;}}
if(_cont)_applyTypes(this,params,doNotRepaint);}},removeType:function(typeId,doNotRepaint){var t=_splitType(typeId),_cont=false,_one=function(tt){var idx=_ju.indexOf(this._jsPlumb.types,tt);if(idx!=-1){_removeTypeCssHelper(this,idx);this._jsPlumb.types.splice(idx,1);return true;}
return false;}.bind(this);if(t!=null){for(var i=0,j=t.length;i<j;i++){_cont=_one(t[i])||_cont;}
if(_cont)_applyTypes(this,null,doNotRepaint);}},clearTypes:function(doNotRepaint){var i=this._jsPlumb.types.length;for(var j=0;j<i;j++){_removeTypeCssHelper(this,0);this._jsPlumb.types.splice(0,1);}
_applyTypes(this,{},doNotRepaint);},toggleType:function(typeId,params,doNotRepaint){var t=_splitType(typeId);if(t!=null){for(var i=0,j=t.length;i<j;i++){var idx=jsPlumbUtil.indexOf(this._jsPlumb.types,t[i]);if(idx!=-1){_removeTypeCssHelper(this,idx);this._jsPlumb.types.splice(idx,1);}
else
this._jsPlumb.types.push(t[i]);}
_applyTypes(this,params,doNotRepaint);}},applyType:function(t,doNotRepaint){this.setPaintStyle(t.paintStyle,doNotRepaint);this.setHoverPaintStyle(t.hoverPaintStyle,doNotRepaint);if(t.parameters){for(var i in t.parameters)
this.setParameter(i,t.parameters[i]);}
this._jsPlumb.paintStyleInUse=this.getPaintStyle();},setPaintStyle:function(style,doNotRepaint){this._jsPlumb.paintStyle=style;this._jsPlumb.paintStyleInUse=this._jsPlumb.paintStyle;_updateHoverStyle(this);if(!doNotRepaint)this.repaint();},getPaintStyle:function(){return this._jsPlumb.paintStyle;},setHoverPaintStyle:function(style,doNotRepaint){this._jsPlumb.hoverPaintStyle=style;_updateHoverStyle(this);if(!doNotRepaint)this.repaint();},getHoverPaintStyle:function(){return this._jsPlumb.hoverPaintStyle;},destroy:function(force){if(force||this.typeId==null){this.cleanupListeners();this.clone=null;this._jsPlumb=null;}},isHover:function(){return this._jsPlumb.hover;},setHover:function(hover,ignoreAttachedElements,timestamp){if(this._jsPlumb&&!this._jsPlumb.instance.currentlyDragging&&!this._jsPlumb.instance.isHoverSuspended()){this._jsPlumb.hover=hover;if(this.canvas!=null){if(this._jsPlumb.instance.hoverClass!=null){var method=hover?"addClass":"removeClass";this._jsPlumb.instance[method](this.canvas,this._jsPlumb.instance.hoverClass);}
if(this._jsPlumb.hoverClass!=null){this._jsPlumb.instance[method](this.canvas,this._jsPlumb.hoverClass);}}
if(this._jsPlumb.hoverPaintStyle!=null){this._jsPlumb.paintStyleInUse=hover?this._jsPlumb.hoverPaintStyle:this._jsPlumb.paintStyle;if(!this._jsPlumb.instance.isSuspendDrawing()){timestamp=timestamp||_timestamp();this.repaint({timestamp:timestamp,recalc:false});}}
if(this.getAttachedElements&&!ignoreAttachedElements)
_updateAttachedElements(this,hover,_timestamp(),this);}}});var _jsPlumbInstanceIndex=0,getInstanceIndex=function(){var i=_jsPlumbInstanceIndex+1;_jsPlumbInstanceIndex++;return i;};var jsPlumbInstance=window.jsPlumbInstance=function(_defaults){this.Defaults={Anchor:"Bottom",Anchors:[null,null],ConnectionsDetachable:true,ConnectionOverlays:[],Connector:"Bezier",Container:null,DoNotThrowErrors:false,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fillStyle:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},LogEnabled:false,Overlays:[],MaxConnections:1,PaintStyle:{lineWidth:4,strokeStyle:"#456"},ReattachConnections:false,RenderMode:"svg",Scope:"jsPlumb_DefaultScope"};if(_defaults)jsPlumb.extend(this.Defaults,_defaults);this.logEnabled=this.Defaults.LogEnabled;this._connectionTypes={};this._endpointTypes={};jsPlumbUtil.EventGenerator.apply(this);var _currentInstance=this,_instanceIndex=getInstanceIndex(),_bb=_currentInstance.bind,_initialDefaults={},_zoom=1,_info=function(el){if(el==null)return null;else if(el.nodeType==3||el.nodeType==8){return{el:el,text:true};}
else{var _el=_currentInstance.getElement(el);return{el:_el,id:(jsPlumbUtil.isString(el)&&_el==null)?el:_getId(_el)};}};this.getInstanceIndex=function(){return _instanceIndex;};this.setZoom=function(z,repaintEverything){if(!jsPlumbUtil.oldIE){_zoom=z;_currentInstance.fire("zoom",_zoom);if(repaintEverything)_currentInstance.repaintEverything();}
return!jsPlumbUtil.oldIE;};this.getZoom=function(){return _zoom;};for(var i in this.Defaults)
_initialDefaults[i]=this.Defaults[i];var _container,_containerDelegations=[];this.unbindContainer=function(){if(_container!=null&&_containerDelegations.length>0){for(var i=0;i<_containerDelegations.length;i++){_currentInstance.off(_container,_containerDelegations[i][0],_containerDelegations[i][1]);}}};this.setContainer=function(c){this.unbindContainer();c=this.getElement(c);this.select().each(function(conn){conn.moveParent(c);});this.selectEndpoints().each(function(ep){ep.moveParent(c);});var previousContainer=_container;_container=c;_containerDelegations.length=0;var _oneDelegateHandler=function(id,e){var t=e.srcElement||e.target,jp=(t&&t.parentNode?t.parentNode._jsPlumb:null)||(t?t._jsPlumb:null)||(t&&t.parentNode&&t.parentNode.parentNode?t.parentNode.parentNode._jsPlumb:null);if(jp){jp.fire(id,jp,e);_currentInstance.fire(id,jp.component||jp,e);}};var _addOneDelegate=function(eventId,selector,fn){_containerDelegations.push([eventId,fn]);_currentInstance.on(_container,eventId,selector,fn);};var _oneDelegate=function(id){_addOneDelegate(id,"._jsPlumb_connector > *",function(e){_oneDelegateHandler(id,e);});_addOneDelegate(id,"._jsPlumb_endpoint, ._jsPlumb_endpoint > *, ._jsPlumb_endpoint svg *",function(e){_oneDelegateHandler(id,e);});_addOneDelegate(id,"._jsPlumb_overlay, ._jsPlumb_overlay *",function(e){_oneDelegateHandler(id,e);});};for(var i=0;i<events.length;i++)
_oneDelegate(events[i]);for(var elId in managedElements){var el=managedElements[elId].el;if(el.parentNode===previousContainer){previousContainer.removeChild(el);_container.appendChild(el);}}};this.getContainer=function(){return _container;};this.bind=function(event,fn){if("ready"===event&&initialized)fn();else _bb.apply(_currentInstance,[event,fn]);};_currentInstance.importDefaults=function(d){for(var i in d){_currentInstance.Defaults[i]=d[i];}
if(d.Container)
_currentInstance.setContainer(d.Container);return _currentInstance;};_currentInstance.restoreDefaults=function(){_currentInstance.Defaults=jsPlumb.extend({},_initialDefaults);return _currentInstance;};var log=null,initialized=false,connections=[],endpointsByElement={},endpointsByUUID={},managedElements={},offsets={},offsetTimestamps={},draggableStates={},connectionBeingDragged=false,sizes=[],_suspendDrawing=false,_suspendedAt=null,DEFAULT_SCOPE=this.Defaults.Scope,renderMode=null,_curIdStamp=1,_idstamp=function(){return""+_curIdStamp++;},_appendElement=function(el,parent){if(_container)
_container.appendChild(el);else if(!parent)
this.appendToRoot(el);else
this.getElement(parent).appendChild(el);}.bind(this),_draw=function(element,ui,timestamp,clearEdits){if(!jsPlumb.headless&&!_suspendDrawing){var id=_getId(element),repaintEls=_currentInstance.getDragManager().getElementsForDraggable(id);if(timestamp==null)timestamp=_timestamp();var o=_updateOffset({elId:id,offset:ui,recalc:false,timestamp:timestamp});if(repaintEls){for(var i in repaintEls){_updateOffset({elId:repaintEls[i].id,offset:{left:o.o.left+repaintEls[i].offset.left,top:o.o.top+repaintEls[i].offset.top},recalc:false,timestamp:timestamp});}}
_currentInstance.anchorManager.redraw(id,ui,timestamp,null,clearEdits);if(repaintEls){for(var j in repaintEls){_currentInstance.anchorManager.redraw(repaintEls[j].id,ui,timestamp,repaintEls[j].offset,clearEdits,true);}}}},_getEndpoint=function(uuid){return endpointsByUUID[uuid];},_initDraggableIfNecessary=function(element,isDraggable,dragOptions,id){if(!jsPlumb.headless){var _draggable=isDraggable==null?false:isDraggable;if(_draggable){if(jsPlumb.isDragSupported(element,_currentInstance)){var options=dragOptions||_currentInstance.Defaults.DragOptions;options=jsPlumb.extend({},options);if(!jsPlumb.isAlreadyDraggable(element,_currentInstance)){var dragEvent=jsPlumb.dragEvents.drag,stopEvent=jsPlumb.dragEvents.stop,startEvent=jsPlumb.dragEvents.start,_del=_currentInstance.getElement(element),_ancestor=_currentInstance.getDragManager().getDragAncestor(_del),_noOffset={left:0,top:0},_ancestorOffset=_noOffset,_started=false;_manage(id,element);options[startEvent]=_ju.wrap(options[startEvent],function(){_ancestorOffset=_ancestor!=null?_currentInstance.getOffset(_ancestor):_noOffset;_currentInstance.setHoverSuspended(true);_currentInstance.select({source:element}).addClass(_currentInstance.elementDraggingClass+" "+_currentInstance.sourceElementDraggingClass,true);_currentInstance.select({target:element}).addClass(_currentInstance.elementDraggingClass+" "+_currentInstance.targetElementDraggingClass,true);_currentInstance.setConnectionBeingDragged(true);if(options.canDrag)return dragOptions.canDrag();},false);options[dragEvent]=_ju.wrap(options[dragEvent],function(){var ui=_currentInstance.getUIPosition(arguments,_currentInstance.getZoom());ui.left+=_ancestorOffset.left;ui.top+=_ancestorOffset.top;_draw(element,ui,null,true);if(_started)_currentInstance.addClass(element,"jsPlumb_dragged");_started=true;});options[stopEvent]=_ju.wrap(options[stopEvent],function(){var elements=[];if(arguments.length==1&&arguments[0].selection&&arguments[0].selection.length>0){elements=arguments[0].selection;}
else{elements=[[element,_currentInstance.getUIPosition(arguments,_currentInstance.getZoom(),true)]];}
var _one=function(_e){_draw(_e[0],_e[1]);_currentInstance.removeClass(_e[0],"jsPlumb_dragged");_currentInstance.select({source:_e[0]}).removeClass(_currentInstance.elementDraggingClass+" "+_currentInstance.sourceElementDraggingClass,true);_currentInstance.select({target:_e[0]}).removeClass(_currentInstance.elementDraggingClass+" "+_currentInstance.targetElementDraggingClass,true);_currentInstance.getDragManager().dragEnded(_e[0]);};for(var i=0;i<elements.length;i++)
_one(elements[i]);_started=false;_currentInstance.setHoverSuspended(false);_currentInstance.setConnectionBeingDragged(false);});var elId=_getId(element);draggableStates[elId]=true;var draggable=draggableStates[elId];options.disabled=draggable==null?false:!draggable;_currentInstance.initDraggable(element,options);_currentInstance.getDragManager().register(element);}
else{if(dragOptions.force){_currentInstance.initDraggable(element,options);}}}}}},_scopeMatch=function(e1,e2){var s1=e1.scope.split(/\s/),s2=e2.scope.split(/\s/);for(var i=0;i<s1.length;i++)
for(var j=0;j<s2.length;j++)
if(s2[j]==s1[i])return true;return false;},_prepareConnectionParams=function(params,referenceParams){var _p=jsPlumb.extend({},params);if(referenceParams)jsPlumb.extend(_p,referenceParams);if(_p.source){if(_p.source.endpoint)
_p.sourceEndpoint=_p.source;else
_p.source=_currentInstance.getElement(_p.source);}
if(_p.target){if(_p.target.endpoint)
_p.targetEndpoint=_p.target;else
_p.target=_currentInstance.getElement(_p.target);}
if(params.uuids){_p.sourceEndpoint=_getEndpoint(params.uuids[0]);_p.targetEndpoint=_getEndpoint(params.uuids[1]);}
if(_p.sourceEndpoint&&_p.sourceEndpoint.isFull()){_ju.log(_currentInstance,"could not add connection; source endpoint is full");return;}
if(_p.targetEndpoint&&_p.targetEndpoint.isFull()){_ju.log(_currentInstance,"could not add connection; target endpoint is full");return;}
if(!_p.type&&_p.sourceEndpoint)
_p.type=_p.sourceEndpoint.connectionType;if(_p.sourceEndpoint&&_p.sourceEndpoint.connectorOverlays){_p.overlays=_p.overlays||[];for(var i=0,j=_p.sourceEndpoint.connectorOverlays.length;i<j;i++){_p.overlays.push(_p.sourceEndpoint.connectorOverlays[i]);}}
if(!_p["pointer-events"]&&_p.sourceEndpoint&&_p.sourceEndpoint.connectorPointerEvents)
_p["pointer-events"]=_p.sourceEndpoint.connectorPointerEvents;var _mergeOverrides=function(def,values){var m=jsPlumb.extend({},def);for(var i in values){if(values[i])m[i]=values[i];}
return m;};var _addEndpoint=function(el,def,idx){return _currentInstance.addEndpoint(el,_mergeOverrides(def,{anchor:_p.anchors?_p.anchors[idx]:_p.anchor,endpoint:_p.endpoints?_p.endpoints[idx]:_p.endpoint,paintStyle:_p.endpointStyles?_p.endpointStyles[idx]:_p.endpointStyle,hoverPaintStyle:_p.endpointHoverStyles?_p.endpointHoverStyles[idx]:_p.endpointHoverStyle}));};var _oneElementDef=function(type,idx,defs){if(_p[type]&&!_p[type].endpoint&&!_p[type+"Endpoint"]&&!_p.newConnection){var tid=_getId(_p[type]),tep=defs[tid];if(tep){if(!tep.enabled)return false;var newEndpoint=tep.endpoint!=null&&tep.endpoint._jsPlumb?tep.endpoint:_addEndpoint(_p[type],tep.def,idx);if(newEndpoint.isFull())return false;_p[type+"Endpoint"]=newEndpoint;newEndpoint._doNotDeleteOnDetach=false;newEndpoint._deleteOnDetach=true;if(tep.uniqueEndpoint){if(!tep.endpoint){tep.endpoint=newEndpoint;newEndpoint._deleteOnDetach=false;newEndpoint._doNotDeleteOnDetach=true;}
else
newEndpoint.finalEndpoint=tep.endpoint;}}}};if(_oneElementDef("source",0,this.sourceEndpointDefinitions)===false)return;if(_oneElementDef("target",1,this.targetEndpointDefinitions)===false)return;if(_p.sourceEndpoint&&_p.targetEndpoint)
if(!_scopeMatch(_p.sourceEndpoint,_p.targetEndpoint))_p=null;return _p;}.bind(_currentInstance),_newConnection=function(params){var connectionFunc=_currentInstance.Defaults.ConnectionType||_currentInstance.getDefaultConnectionType();params._jsPlumb=_currentInstance;params.newConnection=_newConnection;params.newEndpoint=_newEndpoint;params.endpointsByUUID=endpointsByUUID;params.endpointsByElement=endpointsByElement;params.finaliseConnection=_finaliseConnection;params.id="con_"+_idstamp();var con=new connectionFunc(params);if(con.isDetachable()){con.endpoints[0].initDraggable("_jsPlumbSource");con.endpoints[1].initDraggable("_jsPlumbTarget");}
return con;},_finaliseConnection=_currentInstance.finaliseConnection=function(jpc,params,originalEvent,doInformAnchorManager){params=params||{};if(!jpc.suspendedEndpoint)
connections.push(jpc);jpc.endpoints[0].isTemporarySource=false;if(jpc.suspendedEndpoint==null||doInformAnchorManager)
_currentInstance.anchorManager.newConnection(jpc);_draw(jpc.source);if(!params.doNotFireConnectionEvent&&params.fireEvent!==false){var eventArgs={connection:jpc,source:jpc.source,target:jpc.target,sourceId:jpc.sourceId,targetId:jpc.targetId,sourceEndpoint:jpc.endpoints[0],targetEndpoint:jpc.endpoints[1]};_currentInstance.fire("connection",eventArgs,originalEvent);}},_newEndpoint=function(params,id){var endpointFunc=_currentInstance.Defaults.EndpointType||jsPlumb.Endpoint;var _p=jsPlumb.extend({},params);_p._jsPlumb=_currentInstance;_p.newConnection=_newConnection;_p.newEndpoint=_newEndpoint;_p.endpointsByUUID=endpointsByUUID;_p.endpointsByElement=endpointsByElement;_p.fireDetachEvent=fireDetachEvent;_p.elementId=id||_getId(_p.source);var ep=new endpointFunc(_p);ep.id="ep_"+_idstamp();_manage(_p.elementId,_p.source);if(!jsPlumb.headless)
_currentInstance.getDragManager().endpointAdded(_p.source,id);return ep;},_operation=function(elId,func,endpointFunc){var endpoints=endpointsByElement[elId];if(endpoints&&endpoints.length){for(var i=0,ii=endpoints.length;i<ii;i++){for(var j=0,jj=endpoints[i].connections.length;j<jj;j++){var retVal=func(endpoints[i].connections[j]);if(retVal)return;}
if(endpointFunc)endpointFunc(endpoints[i]);}}},_setDraggable=function(element,draggable){return jsPlumb.each(element,function(el){if(_currentInstance.isDragSupported(el)){draggableStates[_currentInstance.getAttribute(el,"id")]=draggable;_currentInstance.setElementDraggable(el,draggable);}});},_setVisible=function(el,state,alsoChangeEndpoints){state=state==="block";var endpointFunc=null;if(alsoChangeEndpoints){if(state)endpointFunc=function(ep){ep.setVisible(true,true,true);};else endpointFunc=function(ep){ep.setVisible(false,true,true);};}
var info=_info(el);_operation(info.id,function(jpc){if(state&&alsoChangeEndpoints){var oidx=jpc.sourceId===info.id?1:0;if(jpc.endpoints[oidx].isVisible())jpc.setVisible(true);}
else
jpc.setVisible(state);},endpointFunc);},_toggleDraggable=function(el){return jsPlumb.each(el,function(el){var elId=_currentInstance.getAttribute(el,"id");var state=draggableStates[elId]==null?false:draggableStates[elId];state=!state;draggableStates[elId]=state;_currentInstance.setDraggable(el,state);return state;}.bind(this));},_toggleVisible=function(elId,changeEndpoints){var endpointFunc=null;if(changeEndpoints){endpointFunc=function(ep){var state=ep.isVisible();ep.setVisible(!state);};}
_operation(elId,function(jpc){var state=jpc.isVisible();jpc.setVisible(!state);},endpointFunc);},_getCachedData=function(elId){var o=offsets[elId];if(!o)
return _updateOffset({elId:elId});else
return{o:o,s:sizes[elId]};},_getId=function(element,uuid,doNotCreateIfNotFound){if(jsPlumbUtil.isString(element))return element;if(element==null)return null;var id=_currentInstance.getAttribute(element,"id");if(!id||id==="undefined"){if(arguments.length==2&&arguments[1]!==undefined)
id=uuid;else if(arguments.length==1||(arguments.length==3&&!arguments[2]))
id="jsPlumb_"+_instanceIndex+"_"+_idstamp();if(!doNotCreateIfNotFound)_currentInstance.setAttribute(element,"id",id);}
return id;};this.setConnectionBeingDragged=function(v){connectionBeingDragged=v;};this.isConnectionBeingDragged=function(){return connectionBeingDragged;};this.getManagedElements=function(){return managedElements;};this.connectorClass="_jsPlumb_connector";this.connectorOutlineClass="_jsPlumb_connector_outline";this.connectedClass="_jsPlumb_connected";this.hoverClass="_jsPlumb_hover";this.endpointClass="_jsPlumb_endpoint";this.endpointConnectedClass="_jsPlumb_endpoint_connected";this.endpointFullClass="_jsPlumb_endpoint_full";this.endpointDropAllowedClass="_jsPlumb_endpoint_drop_allowed";this.endpointDropForbiddenClass="_jsPlumb_endpoint_drop_forbidden";this.overlayClass="_jsPlumb_overlay";this.draggingClass="_jsPlumb_dragging";this.elementDraggingClass="_jsPlumb_element_dragging";this.sourceElementDraggingClass="_jsPlumb_source_element_dragging";this.targetElementDraggingClass="_jsPlumb_target_element_dragging";this.endpointAnchorClassPrefix="_jsPlumb_endpoint_anchor";this.hoverSourceClass="_jsPlumb_source_hover";this.hoverTargetClass="_jsPlumb_target_hover";this.dragSelectClass="_jsPlumb_drag_select";this.Anchors={};this.Connectors={"svg":{},"vml":{}};this.Endpoints={"svg":{},"vml":{}};this.Overlays={"svg":{},"vml":{}};this.ConnectorRenderers={};this.SVG="svg";this.VML="vml";this.addEndpoint=function(el,params,referenceParams){referenceParams=referenceParams||{};var p=jsPlumb.extend({},referenceParams);jsPlumb.extend(p,params);p.endpoint=p.endpoint||_currentInstance.Defaults.Endpoint;p.paintStyle=p.paintStyle||_currentInstance.Defaults.EndpointStyle;var results=[],inputs=(_ju.isArray(el)||(el.length!=null&&!_ju.isString(el)))?el:[el];for(var i=0,j=inputs.length;i<j;i++){p.source=_currentInstance.getElement(inputs[i]);_ensureContainer(p.source);var id=_getId(p.source),e=_newEndpoint(p,id);var myOffset=_manage(id,p.source).info.o;_ju.addToList(endpointsByElement,id,e);if(!_suspendDrawing){e.paint({anchorLoc:e.anchor.compute({xy:[myOffset.left,myOffset.top],wh:sizes[id],element:e,timestamp:_suspendedAt}),timestamp:_suspendedAt});}
results.push(e);e._doNotDeleteOnDetach=true;}
return results.length==1?results[0]:results;};this.addEndpoints=function(el,endpoints,referenceParams){var results=[];for(var i=0,j=endpoints.length;i<j;i++){var e=_currentInstance.addEndpoint(el,endpoints[i],referenceParams);if(_ju.isArray(e))
Array.prototype.push.apply(results,e);else results.push(e);}
return results;};this.animate=function(el,properties,options){if(!this.animationSupported)return false;options=options||{};var del=_currentInstance.getElement(el),id=_getId(del),stepFunction=jsPlumb.animEvents.step,completeFunction=jsPlumb.animEvents.complete;options[stepFunction]=_ju.wrap(options[stepFunction],function(){_currentInstance.revalidate(id);});options[completeFunction]=_ju.wrap(options[completeFunction],function(){_currentInstance.revalidate(id);});_currentInstance.doAnimate(del,properties,options);};this.checkCondition=function(conditionName,args){var l=_currentInstance.getListener(conditionName),r=true;if(l&&l.length>0){var values=Array.prototype.slice.call(arguments,1);try{for(var i=0,j=l.length;i<j;i++){r=r&&l[i].apply(l[i],values);}}
catch(e){_ju.log(_currentInstance,"cannot check condition ["+conditionName+"]"+e);}}
return r;};this.connect=function(params,referenceParams){var _p=_prepareConnectionParams(params,referenceParams),jpc;if(_p){if(_p.source==null&&_p.sourceEndpoint==null){jsPlumbUtil.log("Cannot establish connection - source does not exist");return;}
if(_p.target==null&&_p.targetEndpoint==null){jsPlumbUtil.log("Cannot establish connection - target does not exist");return;}
_ensureContainer(_p.source);jpc=_newConnection(_p);_finaliseConnection(jpc,_p);}
return jpc;};var stTypes=[{el:"source",elId:"sourceId",epDefs:"sourceEndpointDefinitions"},{el:"target",elId:"targetId",epDefs:"targetEndpointDefinitions"}];var _set=function(c,el,idx,doNotRepaint){var ep,_st=stTypes[idx],cId=c[_st.elId],cEl=c[_st.el],sid,sep,oldEndpoint=c.endpoints[idx];var evtParams={index:idx,originalSourceId:idx===0?cId:c.sourceId,newSourceId:c.sourceId,originalTargetId:idx==1?cId:c.targetId,newTargetId:c.targetId,connection:c};if(el.constructor==jsPlumb.Endpoint){ep=el;ep.addConnection(c);}
else{sid=_getId(el);sep=this[_st.epDefs][sid];if(sid===c[_st.elId])
ep=null;else if(sep){if(!sep.enabled)return;ep=sep.endpoint!=null&&sep.endpoint._jsPlumb?sep.endpoint:this.addEndpoint(el,sep.def);if(sep.uniqueEndpoint)sep.endpoint=ep;ep._doNotDeleteOnDetach=false;ep._deleteOnDetach=true;ep.addConnection(c);}
else{ep=c.makeEndpoint(idx===0,el,sid);ep._doNotDeleteOnDetach=false;ep._deleteOnDetach=true;}}
if(ep!=null){oldEndpoint.detachFromConnection(c);c.endpoints[idx]=ep;c[_st.el]=ep.element;c[_st.elId]=ep.elementId;evtParams[idx===0?"newSourceId":"newTargetId"]=ep.elementId;fireMoveEvent(evtParams);if(!doNotRepaint)
c.repaint();}
return evtParams;}.bind(this);this.setSource=function(connection,el,doNotRepaint){var p=_set(connection,el,0,doNotRepaint);this.anchorManager.sourceChanged(p.originalSourceId,p.newSourceId,connection);};this.setTarget=function(connection,el,doNotRepaint){var p=_set(connection,el,1,doNotRepaint);this.anchorManager.updateOtherEndpoint(p.originalSourceId,p.originalTargetId,p.newTargetId,connection);};this.deleteEndpoint=function(object,dontUpdateHover){var endpoint=(typeof object==="string")?endpointsByUUID[object]:object;if(endpoint){_currentInstance.deleteObject({endpoint:endpoint,dontUpdateHover:dontUpdateHover});}
return _currentInstance;};this.deleteEveryEndpoint=function(){var _is=_currentInstance.setSuspendDrawing(true);for(var id in endpointsByElement){var endpoints=endpointsByElement[id];if(endpoints&&endpoints.length){for(var i=0,j=endpoints.length;i<j;i++){_currentInstance.deleteEndpoint(endpoints[i],true);}}}
endpointsByElement={};managedElements={};endpointsByUUID={};offsets={};offsetTimestamps={};_currentInstance.anchorManager.reset();_currentInstance.getDragManager().reset();if(!_is)_currentInstance.setSuspendDrawing(false);return _currentInstance;};var fireDetachEvent=function(jpc,doFireEvent,originalEvent){var connType=_currentInstance.Defaults.ConnectionType||_currentInstance.getDefaultConnectionType(),argIsConnection=jpc.constructor==connType,params=argIsConnection?{connection:jpc,source:jpc.source,target:jpc.target,sourceId:jpc.sourceId,targetId:jpc.targetId,sourceEndpoint:jpc.endpoints[0],targetEndpoint:jpc.endpoints[1]}:jpc;if(doFireEvent)
_currentInstance.fire("connectionDetached",params,originalEvent);_currentInstance.anchorManager.connectionDetached(params);};var fireMoveEvent=_currentInstance.fireMoveEvent=function(params,evt){_currentInstance.fire("connectionMoved",params,evt);};this.unregisterEndpoint=function(endpoint){if(endpoint._jsPlumb.uuid)endpointsByUUID[endpoint._jsPlumb.uuid]=null;_currentInstance.anchorManager.deleteEndpoint(endpoint);for(var e in endpointsByElement){var endpoints=endpointsByElement[e];if(endpoints){var newEndpoints=[];for(var i=0,j=endpoints.length;i<j;i++)
if(endpoints[i]!=endpoint)newEndpoints.push(endpoints[i]);endpointsByElement[e]=newEndpoints;}
if(endpointsByElement[e].length<1){delete endpointsByElement[e];}}};this.detach=function(){if(arguments.length===0)return;var connType=_currentInstance.Defaults.ConnectionType||_currentInstance.getDefaultConnectionType(),firstArgIsConnection=arguments[0].constructor==connType,params=arguments.length==2?firstArgIsConnection?(arguments[1]||{}):arguments[0]:arguments[0],fireEvent=(params.fireEvent!==false),forceDetach=params.forceDetach,conn=firstArgIsConnection?arguments[0]:params.connection;if(conn){if(forceDetach||jsPlumbUtil.functionChain(true,false,[[conn.endpoints[0],"isDetachAllowed",[conn]],[conn.endpoints[1],"isDetachAllowed",[conn]],[conn,"isDetachAllowed",[conn]],[_currentInstance,"checkCondition",["beforeDetach",conn]]])){conn.endpoints[0].detach(conn,false,true,fireEvent);}}
else{var _p=jsPlumb.extend({},params);if(_p.uuids){_getEndpoint(_p.uuids[0]).detachFrom(_getEndpoint(_p.uuids[1]),fireEvent);}else if(_p.sourceEndpoint&&_p.targetEndpoint){_p.sourceEndpoint.detachFrom(_p.targetEndpoint);}else{var sourceId=_getId(_currentInstance.getElement(_p.source)),targetId=_getId(_currentInstance.getElement(_p.target));_operation(sourceId,function(jpc){if((jpc.sourceId==sourceId&&jpc.targetId==targetId)||(jpc.targetId==sourceId&&jpc.sourceId==targetId)){if(_currentInstance.checkCondition("beforeDetach",jpc)){jpc.endpoints[0].detach(jpc,false,true,fireEvent);}}});}}};this.detachAllConnections=function(el,params){params=params||{};el=_currentInstance.getElement(el);var id=_getId(el),endpoints=endpointsByElement[id];if(endpoints&&endpoints.length){for(var i=0,j=endpoints.length;i<j;i++){endpoints[i].detachAll(params.fireEvent!==false,params.forceDetach);}}
return _currentInstance;};this.detachEveryConnection=function(params){params=params||{};_currentInstance.batch(function(){for(var id in endpointsByElement){var endpoints=endpointsByElement[id];if(endpoints&&endpoints.length){for(var i=0,j=endpoints.length;i<j;i++){endpoints[i].detachAll(params.fireEvent!==false,params.forceDetach);}}}
connections.length=0;});return _currentInstance;};this.deleteObject=function(params){var result={endpoints:{},connections:{},endpointCount:0,connectionCount:0},fireEvent=params.fireEvent!==false,deleteAttachedObjects=params.deleteAttachedObjects!==false;var unravelConnection=function(connection){if(connection!=null&&result.connections[connection.id]==null){if(!params.dontUpdateHover&&connection._jsPlumb!=null)connection.setHover(false);result.connections[connection.id]=connection;result.connectionCount++;if(deleteAttachedObjects){for(var j=0;j<connection.endpoints.length;j++){if(connection.endpoints[j]._deleteOnDetach)
unravelEndpoint(connection.endpoints[j]);}}}};var unravelEndpoint=function(endpoint){if(endpoint!=null&&result.endpoints[endpoint.id]==null){if(!params.dontUpdateHover&&endpoint._jsPlumb!=null)endpoint.setHover(false);result.endpoints[endpoint.id]=endpoint;result.endpointCount++;if(deleteAttachedObjects){for(var i=0;i<endpoint.connections.length;i++){var c=endpoint.connections[i];unravelConnection(c);}}}};if(params.connection)
unravelConnection(params.connection);else unravelEndpoint(params.endpoint);for(var i in result.connections){var c=result.connections[i];if(c._jsPlumb){jsPlumbUtil.removeWithFunction(connections,function(_c){return c.id==_c.id;});fireDetachEvent(c,fireEvent,params.originalEvent);c.endpoints[0].detachFromConnection(c);c.endpoints[1].detachFromConnection(c);c.cleanup(true);c.destroy(true);}}
for(var j in result.endpoints){var e=result.endpoints[j];if(e._jsPlumb){_currentInstance.unregisterEndpoint(e);e.cleanup(true);e.destroy(true);}}
return result;};this.draggable=function(el,options){var i,j,info;if(typeof el=='object'&&el.length){for(i=0,j=el.length;i<j;i++){info=_info(el[i]);if(info.el)_initDraggableIfNecessary(info.el,true,options,info.id);}}
else{info=_info(el);if(info.el)_initDraggableIfNecessary(info.el,true,options,info.id);}
return _currentInstance;};var _setOperation=function(list,func,args,selector){for(var i=0,j=list.length;i<j;i++){list[i][func].apply(list[i],args);}
return selector(list);},_getOperation=function(list,func,args){var out=[];for(var i=0,j=list.length;i<j;i++){out.push([list[i][func].apply(list[i],args),list[i]]);}
return out;},setter=function(list,func,selector){return function(){return _setOperation(list,func,arguments,selector);};},getter=function(list,func){return function(){return _getOperation(list,func,arguments);};},prepareList=function(input,doNotGetIds){var r=[];if(input){if(typeof input=='string'){if(input==="*")return input;r.push(input);}
else{if(doNotGetIds)r=input;else{if(input.length){for(var i=0,j=input.length;i<j;i++)
r.push(_info(input[i]).id);}
else
r.push(_info(input).id);}}}
return r;},filterList=function(list,value,missingIsFalse){if(list==="*")return true;return list.length>0?jsPlumbUtil.indexOf(list,value)!=-1:!missingIsFalse;};this.getConnections=function(options,flat){if(!options){options={};}else if(options.constructor==String){options={"scope":options};}
var scope=options.scope||_currentInstance.getDefaultScope(),scopes=prepareList(scope,true),sources=prepareList(options.source),targets=prepareList(options.target),results=(!flat&&scopes.length>1)?{}:[],_addOne=function(scope,obj){if(!flat&&scopes.length>1){var ss=results[scope];if(ss==null){ss=results[scope]=[];}
ss.push(obj);}else results.push(obj);};for(var j=0,jj=connections.length;j<jj;j++){var c=connections[j];if(filterList(scopes,c.scope)&&filterList(sources,c.sourceId)&&filterList(targets,c.targetId))
_addOne(c.scope,c);}
return results;};var _curryEach=function(list,executor){return function(f){for(var i=0,ii=list.length;i<ii;i++){f(list[i]);}
return executor(list);};},_curryGet=function(list){return function(idx){return list[idx];};};var _makeCommonSelectHandler=function(list,executor){var out={length:list.length,each:_curryEach(list,executor),get:_curryGet(list)},setters=["setHover","removeAllOverlays","setLabel","addClass","addOverlay","removeOverlay","removeOverlays","showOverlay","hideOverlay","showOverlays","hideOverlays","setPaintStyle","setHoverPaintStyle","setSuspendEvents","setParameter","setParameters","setVisible","repaint","addType","toggleType","removeType","removeClass","setType","bind","unbind"],getters=["getLabel","getOverlay","isHover","getParameter","getParameters","getPaintStyle","getHoverPaintStyle","isVisible","hasType","getType","isSuspendEvents"],i,ii;for(i=0,ii=setters.length;i<ii;i++)
out[setters[i]]=setter(list,setters[i],executor);for(i=0,ii=getters.length;i<ii;i++)
out[getters[i]]=getter(list,getters[i]);return out;};var _makeConnectionSelectHandler=function(list){var common=_makeCommonSelectHandler(list,_makeConnectionSelectHandler);return jsPlumb.extend(common,{setDetachable:setter(list,"setDetachable",_makeConnectionSelectHandler),setReattach:setter(list,"setReattach",_makeConnectionSelectHandler),setConnector:setter(list,"setConnector",_makeConnectionSelectHandler),detach:function(){for(var i=0,ii=list.length;i<ii;i++)
_currentInstance.detach(list[i]);},isDetachable:getter(list,"isDetachable"),isReattach:getter(list,"isReattach")});};var _makeEndpointSelectHandler=function(list){var common=_makeCommonSelectHandler(list,_makeEndpointSelectHandler);return jsPlumb.extend(common,{setEnabled:setter(list,"setEnabled",_makeEndpointSelectHandler),setAnchor:setter(list,"setAnchor",_makeEndpointSelectHandler),isEnabled:getter(list,"isEnabled"),detachAll:function(){for(var i=0,ii=list.length;i<ii;i++)
list[i].detachAll();},"remove":function(){for(var i=0,ii=list.length;i<ii;i++)
_currentInstance.deleteObject({endpoint:list[i]});}});};this.select=function(params){params=params||{};params.scope=params.scope||"*";return _makeConnectionSelectHandler(params.connections||_currentInstance.getConnections(params,true));};this.selectEndpoints=function(params){params=params||{};params.scope=params.scope||"*";var noElementFilters=!params.element&&!params.source&&!params.target,elements=noElementFilters?"*":prepareList(params.element),sources=noElementFilters?"*":prepareList(params.source),targets=noElementFilters?"*":prepareList(params.target),scopes=prepareList(params.scope,true);var ep=[];for(var el in endpointsByElement){var either=filterList(elements,el,true),source=filterList(sources,el,true),sourceMatchExact=sources!="*",target=filterList(targets,el,true),targetMatchExact=targets!="*";if(either||source||target){inner:for(var i=0,ii=endpointsByElement[el].length;i<ii;i++){var _ep=endpointsByElement[el][i];if(filterList(scopes,_ep.scope,true)){var noMatchSource=(sourceMatchExact&&sources.length>0&&!_ep.isSource),noMatchTarget=(targetMatchExact&&targets.length>0&&!_ep.isTarget);if(noMatchSource||noMatchTarget)
continue inner;ep.push(_ep);}}}}
return _makeEndpointSelectHandler(ep);};this.getAllConnections=function(){return connections;};this.getDefaultScope=function(){return DEFAULT_SCOPE;};this.getEndpoint=_getEndpoint;this.getEndpoints=function(el){return endpointsByElement[_info(el).id];};this.getDefaultEndpointType=function(){return jsPlumb.Endpoint;};this.getDefaultConnectionType=function(){return jsPlumb.Connection;};this.getId=_getId;this.appendElement=_appendElement;var _hoverSuspended=false;this.isHoverSuspended=function(){return _hoverSuspended;};this.setHoverSuspended=function(s){_hoverSuspended=s;};this.hide=function(el,changeEndpoints){_setVisible(el,"none",changeEndpoints);return _currentInstance;};this.idstamp=_idstamp;this.connectorsInitialized=false;this.registerConnectorType=function(connector,name){connectorTypes.push([connector,name]);};var _ensureContainer=function(candidate){if(!_container&&candidate){var can=_currentInstance.getElement(candidate);if(can.offsetParent)_currentInstance.setContainer(can.offsetParent);}};var _getContainerFromDefaults=function(){if(_currentInstance.Defaults.Container)
_currentInstance.setContainer(_currentInstance.Defaults.Container);};var _manage=_currentInstance.manage=function(id,element,transient){if(!managedElements[id]){managedElements[id]={el:element,endpoints:[],connections:[]};managedElements[id].info=_updateOffset({elId:id,timestamp:_suspendedAt});if(!transient){_currentInstance.fire("manageElement",{id:id,info:managedElements[id].info,el:element});}}
return managedElements[id];};var _unmanage=function(id){if(managedElements[id]){delete managedElements[id];_currentInstance.fire("unmanageElement",id);}};var _updateOffset=this.updateOffset=function(params){var timestamp=params.timestamp,recalc=params.recalc,offset=params.offset,elId=params.elId,s;if(_suspendDrawing&&!timestamp)timestamp=_suspendedAt;if(!recalc){if(timestamp&&timestamp===offsetTimestamps[elId]){return{o:params.offset||offsets[elId],s:sizes[elId]};}}
if(recalc||(!offset&&offsets[elId]==null)){s=managedElements[elId]?managedElements[elId].el:null;if(s!=null){sizes[elId]=_currentInstance.getSize(s);offsets[elId]=_currentInstance.getOffset(s);offsetTimestamps[elId]=timestamp;}}else{offsets[elId]=offset||offsets[elId];if(sizes[elId]==null){s=managedElements[elId].el;if(s!=null)sizes[elId]=_currentInstance.getSize(s);}
offsetTimestamps[elId]=timestamp;}
if(offsets[elId]&&!offsets[elId].right){offsets[elId].right=offsets[elId].left+sizes[elId][0];offsets[elId].bottom=offsets[elId].top+sizes[elId][1];offsets[elId].width=sizes[elId][0];offsets[elId].height=sizes[elId][1];offsets[elId].centerx=offsets[elId].left+(offsets[elId].width/2);offsets[elId].centery=offsets[elId].top+(offsets[elId].height/2);}
return{o:offsets[elId],s:sizes[elId]};};this.init=function(){rendererTypes=jsPlumb.getRenderModes();var _oneType=function(renderer,name,fn){jsPlumb.Connectors[renderer][name]=function(){fn.apply(this,arguments);jsPlumb.ConnectorRenderers[renderer].apply(this,arguments);};jsPlumbUtil.extend(jsPlumb.Connectors[renderer][name],[fn,jsPlumb.ConnectorRenderers[renderer]]);};if(!jsPlumb.connectorsInitialized){for(var i=0;i<connectorTypes.length;i++){for(var j=0;j<rendererTypes.length;j++){_oneType(rendererTypes[j],connectorTypes[i][1],connectorTypes[i][0]);}}
jsPlumb.connectorsInitialized=true;}
if(!initialized){_getContainerFromDefaults();_currentInstance.anchorManager=new jsPlumb.AnchorManager({jsPlumbInstance:_currentInstance});_currentInstance.setRenderMode(_currentInstance.Defaults.RenderMode);initialized=true;_currentInstance.fire("ready",_currentInstance);}}.bind(this);this.log=log;this.jsPlumbUIComponent=jsPlumbUIComponent;this.makeAnchor=function(){var pp,_a=function(t,p){if(jsPlumb.Anchors[t])return new jsPlumb.Anchors[t](p);if(!_currentInstance.Defaults.DoNotThrowErrors)
throw{msg:"jsPlumb: unknown anchor type '"+t+"'"};};if(arguments.length===0)return null;var specimen=arguments[0],elementId=arguments[1],jsPlumbInstance=arguments[2],newAnchor=null;if(specimen.compute&&specimen.getOrientation)return specimen;else if(typeof specimen=="string"){newAnchor=_a(arguments[0],{elementId:elementId,jsPlumbInstance:_currentInstance});}
else if(_ju.isArray(specimen)){if(_ju.isArray(specimen[0])||_ju.isString(specimen[0])){if(specimen.length==2&&_ju.isObject(specimen[1])){if(_ju.isString(specimen[0])){pp=jsPlumb.extend({elementId:elementId,jsPlumbInstance:_currentInstance},specimen[1]);newAnchor=_a(specimen[0],pp);}
else{pp=jsPlumb.extend({elementId:elementId,jsPlumbInstance:_currentInstance,anchors:specimen[0]},specimen[1]);newAnchor=new jsPlumb.DynamicAnchor(pp);}}
else
newAnchor=new jsPlumb.DynamicAnchor({anchors:specimen,selector:null,elementId:elementId,jsPlumbInstance:_currentInstance});}
else{var anchorParams={x:specimen[0],y:specimen[1],orientation:(specimen.length>=4)?[specimen[2],specimen[3]]:[0,0],offsets:(specimen.length>=6)?[specimen[4],specimen[5]]:[0,0],elementId:elementId,jsPlumbInstance:_currentInstance,cssClass:specimen.length==7?specimen[6]:null};newAnchor=new jsPlumb.Anchor(anchorParams);newAnchor.clone=function(){return new jsPlumb.Anchor(anchorParams);};}}
if(!newAnchor.id)newAnchor.id="anchor_"+_idstamp();return newAnchor;};this.makeAnchors=function(types,elementId,jsPlumbInstance){var r=[];for(var i=0,ii=types.length;i<ii;i++){if(typeof types[i]=="string")
r.push(jsPlumb.Anchors[types[i]]({elementId:elementId,jsPlumbInstance:jsPlumbInstance}));else if(_ju.isArray(types[i]))
r.push(_currentInstance.makeAnchor(types[i],elementId,jsPlumbInstance));}
return r;};this.makeDynamicAnchor=function(anchors,anchorSelector){return new jsPlumb.DynamicAnchor({anchors:anchors,selector:anchorSelector,elementId:null,jsPlumbInstance:_currentInstance});};this.targetEndpointDefinitions={};var _setEndpointPaintStylesAndAnchor=function(ep,epIndex,_instance){ep.paintStyle=ep.paintStyle||_instance.Defaults.EndpointStyles[epIndex]||_instance.Defaults.EndpointStyle;ep.hoverPaintStyle=ep.hoverPaintStyle||_instance.Defaults.EndpointHoverStyles[epIndex]||_instance.Defaults.EndpointHoverStyle;ep.anchor=ep.anchor||_instance.Defaults.Anchors[epIndex]||_instance.Defaults.Anchor;ep.endpoint=ep.endpoint||_instance.Defaults.Endpoints[epIndex]||_instance.Defaults.Endpoint;};this.sourceEndpointDefinitions={};var selectorFilter=function(evt,_el,selector,_instance,negate){var t=evt.target||evt.srcElement,ok=false,sel=_instance.getSelector(_el,selector);for(var j=0;j<sel.length;j++){if(sel[j]==t){ok=true;break;}}
return negate?!ok:ok;};var _makeElementDropHandler=function(elInfo,p,dropOptions,isSource,isTarget){var proxyComponent=new jsPlumbUIComponent(p);var _drop=p._jsPlumb.EndpointDropHandler({jsPlumb:_currentInstance,enabled:function(){return elInfo.def.enabled;},isFull:function(){var targetCount=_currentInstance.select({target:elInfo.id}).length;return elInfo.def.maxConnections>0&&targetCount>=elInfo.def.maxConnections;},element:elInfo.el,elementId:elInfo.id,isSource:isSource,isTarget:isTarget,addClass:function(clazz){_currentInstance.addClass(elInfo.el,clazz);},removeClass:function(clazz){_currentInstance.removeClass(elInfo.el,clazz);},onDrop:function(jpc){var source=jpc.endpoints[0];source.anchor.locked=false;},isDropAllowed:function(){return proxyComponent.isDropAllowed.apply(proxyComponent,arguments);},isRedrop:function(jpc){return(jpc.suspendedElement!=null&&jpc.suspendedEndpoint!=null&&jpc.suspendedEndpoint.element===elInfo.el);},getEndpoint:function(jpc){var newEndpoint=elInfo.def.endpoint;if(newEndpoint==null||newEndpoint._jsPlumb==null){newEndpoint=_currentInstance.addEndpoint(elInfo.el,p);newEndpoint._mtNew=true;}
if(p.uniqueEndpoint)elInfo.def.endpoint=newEndpoint;newEndpoint._doNotDeleteOnDetach=false;newEndpoint._deleteOnDetach=true;if(jpc.isDetachable())
newEndpoint.initDraggable();if(newEndpoint.anchor.positionFinder!=null){var dropPosition=_currentInstance.getUIPosition(arguments,_currentInstance.getZoom()),elPosition=_currentInstance.getOffset(elInfo.el),elSize=_currentInstance.getSize(elInfo.el),ap=newEndpoint.anchor.positionFinder(dropPosition,elPosition,elSize,newEndpoint.anchor.constructorParams);newEndpoint.anchor.x=ap[0];newEndpoint.anchor.y=ap[1];}
return newEndpoint;},maybeCleanup:function(ep){if(ep._mtNew&&ep.connections.length===0){_currentInstance.deleteObject({endpoint:ep});}
else
delete ep._mtNew;}});var dropEvent=jsPlumb.dragEvents.drop;dropOptions.scope=dropOptions.scope||(p.scope||_currentInstance.Defaults.Scope);dropOptions[dropEvent]=_ju.wrap(dropOptions[dropEvent],_drop,true);if(isTarget){dropOptions[jsPlumb.dragEvents.over]=function(){return true;};}
if(p.allowLoopback===false){dropOptions.canDrop=function(_drag){var de=_drag.getDragElement()._jsPlumbRelatedElement;return de!=elInfo.el;};}
_currentInstance.initDroppable(elInfo.el,dropOptions,"internal");return _drop;};this.makeTarget=function(el,params,referenceParams){var p=jsPlumb.extend({_jsPlumb:this},referenceParams);jsPlumb.extend(p,params);_setEndpointPaintStylesAndAnchor(p,1,this);var deleteEndpointsOnDetach=!(p.deleteEndpointsOnDetach===false),maxConnections=p.maxConnections||-1,_doOne=function(el){var elInfo=_info(el),elid=elInfo.id,dropOptions=jsPlumb.extend({},p.dropOptions||{});_ensureContainer(elid);var _def={def:p,uniqueEndpoint:p.uniqueEndpoint,maxConnections:maxConnections,enabled:true};elInfo.def=_def;this.targetEndpointDefinitions[elid]=_def;_makeElementDropHandler(elInfo,p,dropOptions,p.isSource===true,true);}.bind(this);var inputs=el.length&&el.constructor!=String?el:[el];for(var i=0,ii=inputs.length;i<ii;i++){_doOne(inputs[i]);}
return this;};this.unmakeTarget=function(el,doNotClearArrays){var info=_info(el);jsPlumb.destroyDroppable(info.el);if(!doNotClearArrays){delete this.targetEndpointDefinitions[info.id];}
return this;};this.makeSource=function(el,params,referenceParams){var p=jsPlumb.extend({_jsPlumb:this},referenceParams);jsPlumb.extend(p,params);_setEndpointPaintStylesAndAnchor(p,0,this);var maxConnections=p.maxConnections||1,onMaxConnections=p.onMaxConnections,_doOne=function(elInfo){var elid=elInfo.id,_del=this.getElement(elInfo.el);_ensureContainer(elid);var _def={def:p,uniqueEndpoint:p.uniqueEndpoint,maxConnections:maxConnections,enabled:true};this.sourceEndpointDefinitions[elid]=_def;elInfo.def=_def;var stopEvent=jsPlumb.dragEvents.stop,dragEvent=jsPlumb.dragEvents.drag,dragOptions=jsPlumb.extend({},p.dragOptions||{}),existingDrag=dragOptions.drag,existingStop=dragOptions.stop,ep=null,endpointAddedButNoDragYet=false;dragOptions.scope=dragOptions.scope||p.scope;dragOptions[dragEvent]=_ju.wrap(dragOptions[dragEvent],function(){if(existingDrag)existingDrag.apply(this,arguments);endpointAddedButNoDragYet=false;});dragOptions[stopEvent]=_ju.wrap(dragOptions[stopEvent],function(){if(existingStop)existingStop.apply(this,arguments);this.currentlyDragging=false;if(ep._jsPlumb!=null){var anchorDef=p.anchor||this.Defaults.Anchor,oldAnchor=ep.anchor,oldConnection=ep.connections[0],newAnchor=this.makeAnchor(anchorDef,elid,this),_el=ep.element;if(newAnchor.positionFinder!=null){var elPosition=_currentInstance.getOffset(_el),elSize=this.getSize(_el),dropPosition={left:elPosition.left+(oldAnchor.x*elSize[0]),top:elPosition.top+(oldAnchor.y*elSize[1])},ap=newAnchor.positionFinder(dropPosition,elPosition,elSize,newAnchor.constructorParams);newAnchor.x=ap[0];newAnchor.y=ap[1];}
ep.setAnchor(newAnchor,true);ep.repaint();this.repaint(ep.elementId);if(oldConnection!=null)this.repaint(oldConnection.targetId);}}.bind(this));var mouseDownListener=function(e){var evt=this.getOriginalEvent(e);if(e.which===3||e.button===2)return;var def=this.sourceEndpointDefinitions[elid];if(!def.enabled)return;elid=this.getId(this.getElement(elInfo.el));if(p.filter){var r=jsPlumbUtil.isString(p.filter)?selectorFilter(evt,elInfo.el,p.filter,this,p.filterExclude):p.filter(evt,elInfo.el);if(r===false)return;}
var sourceCount=this.select({source:elid}).length;if(def.maxConnections>=0&&(def.uniqueEndpoint&&sourceCount>=def.maxConnections)){if(onMaxConnections){onMaxConnections({element:elInfo.el,maxConnections:maxConnections},e);}
return false;}
var elxy=jsPlumb.getPositionOnElement(evt,_del,_zoom);var tempEndpointParams={};jsPlumb.extend(tempEndpointParams,p);tempEndpointParams.isTemporarySource=true;tempEndpointParams.anchor=[elxy[0],elxy[1],0,0];tempEndpointParams.dragOptions=dragOptions;ep=this.addEndpoint(elid,tempEndpointParams);endpointAddedButNoDragYet=true;ep._doNotDeleteOnDetach=false;ep._deleteOnDetach=true;if(def.uniqueEndpoint){if(!def.endpoint){def.endpoint=ep;ep._deleteOnDetach=false;ep._doNotDeleteOnDetach=true;}
else
ep.finalEndpoint=def.endpoint;}
var _delTempEndpoint=function(){_currentInstance.off(ep.canvas,"mouseup",_delTempEndpoint);_currentInstance.off(elInfo.el,"mouseup",_delTempEndpoint);if(endpointAddedButNoDragYet){endpointAddedButNoDragYet=false;_currentInstance.deleteEndpoint(ep);}};_currentInstance.on(ep.canvas,"mouseup",_delTempEndpoint);_currentInstance.on(elInfo.el,"mouseup",_delTempEndpoint);_currentInstance.trigger(ep.canvas,"mousedown",e);jsPlumbUtil.consume(e);}.bind(this);this.on(elInfo.el,"mousedown",mouseDownListener);_def.trigger=mouseDownListener;if(p.filter&&(jsPlumbUtil.isString(p.filter)||jsPlumbUtil.isFunction(p.filter))){_currentInstance.setDragFilter(elInfo.el,p.filter);}
var dropOptions=jsPlumb.extend({},p.dropOptions||{});_makeElementDropHandler(elInfo,p,dropOptions,true,p.isTarget===true);}.bind(this);var inputs=el.length&&el.constructor!=String?el:[el];for(var i=0,ii=inputs.length;i<ii;i++){_doOne(_info(inputs[i]));}
return this;};this.unmakeSource=function(el,doNotClearArrays){var info=_info(el),mouseDownListener=this.sourceEndpointDefinitions[info.id].trigger;if(mouseDownListener)
_currentInstance.off(info.el,"mousedown",mouseDownListener);if(!doNotClearArrays){delete this.sourceEndpointDefinitions[info.id];}
return this;};this.unmakeEverySource=function(){for(var i in this.sourceEndpointDefinitions)
_currentInstance.unmakeSource(i,true);this.sourceEndpointDefinitions={};return this;};var _getScope=function(el,types){types=jsPlumbUtil.isArray(types)?types:[types];var id=_getId(el);for(var i=0;i<types.length;i++){var def=this[types[i]][id];if(def)return def.def.scope||this.Defaults.Scope;}}.bind(this);var _setScope=function(el,scope,types){types=jsPlumbUtil.isArray(types)?types:[types];var id=_getId(el);for(var i=0;i<types.length;i++){var def=this[types[i]][id];if(def){def.def.scope=scope;if(this.scopeChange!=null)this.scopeChange(el,id,endpointsByElement[id],scope,types[i]);}}}.bind(this);this.getScope=function(el,scope){return _getScope(el,["sourceEndpointDefinitions","targetEndpointDefinitions"]);};this.getSourceScope=function(el){return _getScope(el,"sourceEndpointDefinitions");};this.getTargetScope=function(el){return _getScope(el,"targetEndpointDefinitions");};this.setScope=function(el,scope){_setScope(el,scope,["sourceEndpointDefinitions","targetEndpointDefinitions"]);};this.setSourceScope=function(el,scope){_setScope(el,scope,"sourceEndpointDefinitions");};this.setTargetScope=function(el,scope){_setScope(el,scope,"targetEndpointDefinitions");};this.unmakeEveryTarget=function(){for(var i in this.targetEndpointDefinitions)
_currentInstance.unmakeTarget(i,true);this.targetEndpointDefinitions={};return this;};var _setEnabled=function(type,el,state,toggle){var a=type=="source"?this.sourceEndpointDefinitions:this.targetEndpointDefinitions;if(_ju.isString(el))a[el].enabled=toggle?!a[el].enabled:state;else if(el.length){for(var i=0,ii=el.length;i<ii;i++){var info=_info(el[i]);if(a[info.id])
a[info.id].enabled=toggle?!a[info.id].enabled:state;}}
else{var id=_info(el).id;a[id].enabled=toggle?!a[id].enabled:state;}
return this;}.bind(this);var _first=function(el,fn){if(_ju.isString(el)||!el.length)
return fn.apply(this,[el]);else if(el.length)
return fn.apply(this,[el[0]]);}.bind(this);this.toggleSourceEnabled=function(el){_setEnabled("source",el,null,true);return this.isSourceEnabled(el);};this.setSourceEnabled=function(el,state){return _setEnabled("source",el,state);};this.isSource=function(el){return _first(el,function(_el){return this.sourceEndpointDefinitions[_info(_el).id]!=null;}.bind(this));};this.isSourceEnabled=function(el){return _first(el,function(_el){var sep=this.sourceEndpointDefinitions[_info(_el).id];return sep&&sep.enabled===true;}.bind(this));};this.toggleTargetEnabled=function(el){_setEnabled("target",el,null,true);return this.isTargetEnabled(el);};this.isTarget=function(el){return _first(el,function(_el){return this.targetEndpointDefinitions[_info(_el).id]!=null;}.bind(this));};this.isTargetEnabled=function(el){return _first(el,function(_el){var tep=this.targetEndpointDefinitions[_info(_el).id];return tep&&tep.enabled===true;}.bind(this));};this.setTargetEnabled=function(el,state){return _setEnabled("target",el,state);};this.ready=function(fn){_currentInstance.bind("ready",fn);};var _elEach=function(el,fn){if(typeof el=='object'&&el.length)
for(var i=0,ii=el.length;i<ii;i++){fn(el[i]);}
else
fn(el);return _currentInstance;};this.repaint=function(el,ui,timestamp){return _elEach(el,function(_el){_draw(_el,ui,timestamp);});};this.revalidate=function(el,timestamp,isIdAlready){return _elEach(el,function(_el){var elId=isIdAlready?_el:_currentInstance.getId(_el);_currentInstance.updateOffset({elId:elId,recalc:true,timestamp:timestamp});_currentInstance.repaint(_el);});};this.repaintEverything=function(){var timestamp=_timestamp(),elId;for(elId in endpointsByElement){_currentInstance.updateOffset({elId:elId,recalc:true,timestamp:timestamp});}
for(elId in endpointsByElement){_draw(elId,null,timestamp);}
return this;};this.removeAllEndpoints=function(el,recurse,affectedElements){affectedElements=affectedElements||[];var _one=function(_el){var info=_info(_el),ebe=endpointsByElement[info.id],i,ii;if(ebe){affectedElements.push(info);for(i=0,ii=ebe.length;i<ii;i++)
_currentInstance.deleteEndpoint(ebe[i]);}
delete endpointsByElement[info.id];if(recurse){if(info.el&&info.el.nodeType!=3&&info.el.nodeType!=8){for(i=0,ii=info.el.childNodes.length;i<ii;i++){_one(info.el.childNodes[i]);}}}};_one(el);return this;};var _doRemove=function(info,affectedElements){_currentInstance.removeAllEndpoints(info.id,true,affectedElements);var _one=function(_info){_currentInstance.getDragManager().elementRemoved(_info.id);_currentInstance.anchorManager.clearFor(_info.id);_currentInstance.anchorManager.removeFloatingConnection(_info.id);delete _currentInstance.floatingConnections[_info.id];delete managedElements[_info.id];delete offsets[_info.id];if(_info.el){_currentInstance.removeElement(_info.el);_info.el._jsPlumb=null;}};for(var ae=1;ae<affectedElements.length;ae++){_one(affectedElements[ae]);}
_one(info);};this.remove=function(el,doNotRepaint){var info=_info(el),affectedElements=[];if(info.text){info.el.parentNode.removeChild(info.el);}
else if(info.id){_currentInstance.batch(function(){_doRemove(info,affectedElements);},doNotRepaint===false);}
return _currentInstance;};this.empty=function(el,doNotRepaint){var affectedElements=[];var _one=function(el,dontRemoveFocus){var info=_info(el);if(info.text){info.el.parentNode.removeChild(info.el);}
else if(info.el){while(info.el.childNodes.length>0){_one(info.el.childNodes[0]);}
if(!dontRemoveFocus)_doRemove(info,affectedElements);}};_currentInstance.batch(function(){_one(el,true);},doNotRepaint===false);return _currentInstance;};this.reset=function(){_currentInstance.silently(function(){_currentInstance.deleteEveryEndpoint();_currentInstance.unbind();this.targetEndpointDefinitions={};this.sourceEndpointDefinitions={};connections.length=0;if(this.doReset)this.doReset();}.bind(this));};var _clearObject=function(obj){if(obj.canvas&&obj.canvas.parentNode)
obj.canvas.parentNode.removeChild(obj.canvas);obj.cleanup();obj.destroy();};this.clear=function(){_currentInstance.select().each(_clearObject);_currentInstance.selectEndpoints().each(_clearObject);endpointsByElement={};endpointsByUUID={};};this.setDefaultScope=function(scope){DEFAULT_SCOPE=scope;return _currentInstance;};this.setDraggable=_setDraggable;this.setId=function(el,newId,doNotSetAttribute){var id;if(jsPlumbUtil.isString(el)){id=el;}
else{el=this.getElement(el);id=this.getId(el);}
var sConns=this.getConnections({source:id,scope:'*'},true),tConns=this.getConnections({target:id,scope:'*'},true);newId=""+newId;if(!doNotSetAttribute){el=this.getElement(id);this.setAttribute(el,"id",newId);}
else
el=this.getElement(newId);endpointsByElement[newId]=endpointsByElement[id]||[];for(var i=0,ii=endpointsByElement[newId].length;i<ii;i++){endpointsByElement[newId][i].setElementId(newId);endpointsByElement[newId][i].setReferenceElement(el);}
delete endpointsByElement[id];this.sourceEndpointDefinitions[newId]=this.sourceEndpointDefinitions[id];delete this.sourceEndpointDefinitions[id];this.targetEndpointDefinitions[newId]=this.targetEndpointDefinitions[id];delete this.targetEndpointDefinitions[id];this.anchorManager.changeId(id,newId);this.getDragManager().changeId(id,newId);managedElements[newId]=managedElements[id];delete managedElements[id];var _conns=function(list,epIdx,type){for(var i=0,ii=list.length;i<ii;i++){list[i].endpoints[epIdx].setElementId(newId);list[i].endpoints[epIdx].setReferenceElement(el);list[i][type+"Id"]=newId;list[i][type]=el;}};_conns(sConns,0,"source");_conns(tConns,1,"target");this.repaint(newId);};this.setDebugLog=function(debugLog){log=debugLog;};this.setSuspendDrawing=function(val,repaintAfterwards){var curVal=_suspendDrawing;_suspendDrawing=val;if(val)_suspendedAt=new Date().getTime();else _suspendedAt=null;if(repaintAfterwards)this.repaintEverything();return curVal;};this.isSuspendDrawing=function(){return _suspendDrawing;};this.getSuspendedAt=function(){return _suspendedAt;};this.batch=function(fn,doNotRepaintAfterwards){var _wasSuspended=this.isSuspendDrawing();if(!_wasSuspended)
this.setSuspendDrawing(true);try{fn();}
catch(e){_ju.log("Function run while suspended failed",e);}
if(!_wasSuspended)
this.setSuspendDrawing(false,!doNotRepaintAfterwards);};this.doWhileSuspended=this.batch;this.getCachedData=_getCachedData;this.timestamp=_timestamp;this.setRenderMode=function(mode){if(mode!==jsPlumb.SVG&&mode!==jsPlumb.VML)throw new TypeError("Render mode ["+mode+"] not supported");renderMode=this.trySetRenderMode(mode);return renderMode;};this.getRenderMode=function(){return renderMode;};this.show=function(el,changeEndpoints){_setVisible(el,"block",changeEndpoints);return _currentInstance;};this.toggleVisible=_toggleVisible;this.toggleDraggable=_toggleDraggable;this.addListener=this.bind;};jsPlumbUtil.extend(jsPlumbInstance,jsPlumbUtil.EventGenerator,{setAttribute:function(el,a,v){this.setAttribute(el,a,v);},getAttribute:function(el,a){return this.getAttribute(jsPlumb.getElement(el),a);},convertToFullOverlaySpec:function(spec){if(jsPlumbUtil.isString(spec)){spec=[spec,{}];}
spec[1].id=spec[1].id||jsPlumbUtil.uuid();return spec;},registerConnectionType:function(id,type){this._connectionTypes[id]=jsPlumb.extend({},type);if(type.overlays){var to={};for(var i=0;i<type.overlays.length;i++){var fo=this.convertToFullOverlaySpec(type.overlays[i]);to[fo[1].id]=fo;}
this._connectionTypes[id].overlays=to;}},registerConnectionTypes:function(types){for(var i in types)
this.registerConnectionType(i,types[i]);},registerEndpointType:function(id,type){this._endpointTypes[id]=jsPlumb.extend({},type);},registerEndpointTypes:function(types){for(var i in types)
this._endpointTypes[i]=jsPlumb.extend({},types[i]);},getType:function(id,typeDescriptor){return typeDescriptor==="connection"?this._connectionTypes[id]:this._endpointTypes[id];},setIdChanged:function(oldId,newId){this.setId(oldId,newId,true);},setParent:function(el,newParent){var _dom=this.getElement(el),_id=this.getId(_dom),_pdom=this.getElement(newParent),_pid=this.getId(_pdom);_dom.parentNode.removeChild(_dom);_pdom.appendChild(_dom);this.getDragManager().setParent(_dom,_id,_pdom,_pid);},extend:function(o1,o2,names){var i;if(names){for(i=0;i<names.length;i++)
o1[names[i]]=o2[names[i]];}
else
for(i in o2)o1[i]=o2[i];return o1;},floatingConnections:{},getFloatingAnchorIndex:function(jpc){return jpc.endpoints[0].isFloating()?0:1;}});var jsPlumb=new jsPlumbInstance();if(typeof window!='undefined')window.jsPlumb=jsPlumb;jsPlumb.getInstance=function(_defaults){var j=new jsPlumbInstance(_defaults);j.init();return j;};jsPlumb.each=function(spec,fn){if(spec==null)return;if(typeof spec==="string")
fn(jsPlumb.getElement(spec));else if(spec.length!=null){for(var i=0;i<spec.length;i++)
fn(jsPlumb.getElement(spec[i]));}
else
fn(spec);};if(typeof define==="function"){define("jsplumb",[],function(){return jsPlumb;});define("jsplumbinstance",[],function(){return jsPlumb.getInstance();});}
if(typeof exports!=='undefined'){exports.jsPlumb=jsPlumb;}}).call(this);;(function(){var root=this,_ju=root.jsPlumbUtil;var svgAvailable=!!window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),vmlAvailable=function(){if(vmlAvailable.vml===undefined){var a=document.body.appendChild(document.createElement('div'));a.innerHTML='<v:shape id="vml_flag1" adj="1" />';var b=a.firstChild;if(b!=null&&b.style!=null){b.style.behavior="url(#default#VML)";vmlAvailable.vml=b?typeof b.adj=="object":true;}
else
vmlAvailable.vml=false;a.parentNode.removeChild(a);}
return vmlAvailable.vml;},iev=(function(){var rv=-1;if(navigator.appName=='Microsoft Internet Explorer'){var ua=navigator.userAgent,re=new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");if(re.exec(ua)!=null)
rv=parseFloat(RegExp.$1);}
return rv;})(),isIELT9=iev>-1&&iev<9,_genLoc=function(e,prefix){if(e==null)return[0,0];var ts=_touches(e),t=_getTouch(ts,0);return[t[prefix+"X"],t[prefix+"Y"]];},_pageLocation=function(e){if(e==null)return[0,0];if(isIELT9){return[e.clientX+document.documentElement.scrollLeft,e.clientY+document.documentElement.scrollTop];}
else{return _genLoc(e,"page");}},_screenLocation=function(e){return _genLoc(e,"screen");},_clientLocation=function(e){return _genLoc(e,"client");},_getTouch=function(touches,idx){return touches.item?touches.item(idx):touches[idx];},_touches=function(e){return e.touches&&e.touches.length>0?e.touches:e.changedTouches&&e.changedTouches.length>0?e.changedTouches:e.targetTouches&&e.targetTouches.length>0?e.targetTouches:[e];};var DragManager=function(_currentInstance){var _draggables={},_dlist=[],_delements={},_elementsWithEndpoints={},_draggablesForElements={};this.register=function(el){var id=_currentInstance.getId(el),parentOffset=_currentInstance.getOffset(el);if(!_draggables[id]){_draggables[id]=el;_dlist.push(el);_delements[id]={};}
var _oneLevel=function(p){if(p){for(var i=0;i<p.childNodes.length;i++){if(p.childNodes[i].nodeType!=3&&p.childNodes[i].nodeType!=8){var cEl=jsPlumb.getElement(p.childNodes[i]),cid=_currentInstance.getId(p.childNodes[i],null,true);if(cid&&_elementsWithEndpoints[cid]&&_elementsWithEndpoints[cid]>0){var cOff=_currentInstance.getOffset(cEl);_delements[id][cid]={id:cid,offset:{left:cOff.left-parentOffset.left,top:cOff.top-parentOffset.top}};_draggablesForElements[cid]=id;}
_oneLevel(p.childNodes[i]);}}}};_oneLevel(el);};this.updateOffsets=function(elId){if(elId!=null){var domEl=jsPlumb.getElement(elId),id=_currentInstance.getId(domEl),children=_delements[id],parentOffset=_currentInstance.getOffset(domEl);if(children){for(var i in children){if(children.hasOwnProperty(i)){var cel=jsPlumb.getElement(i),cOff=_currentInstance.getOffset(cel);_delements[id][i]={id:i,offset:{left:cOff.left-parentOffset.left,top:cOff.top-parentOffset.top}};_draggablesForElements[i]=id;}}}}};this.endpointAdded=function(el,id){id=id||_currentInstance.getId(el);var b=document.body,p=el.parentNode;_elementsWithEndpoints[id]=_elementsWithEndpoints[id]?_elementsWithEndpoints[id]+1:1;while(p!=null&&p!=b){var pid=_currentInstance.getId(p,null,true);if(pid&&_draggables[pid]){var pLoc=_currentInstance.getOffset(p);if(_delements[pid][id]==null){var cLoc=_currentInstance.getOffset(el);_delements[pid][id]={id:id,offset:{left:cLoc.left-pLoc.left,top:cLoc.top-pLoc.top}};_draggablesForElements[id]=pid;}
break;}
p=p.parentNode;}};this.endpointDeleted=function(endpoint){if(_elementsWithEndpoints[endpoint.elementId]){_elementsWithEndpoints[endpoint.elementId]--;if(_elementsWithEndpoints[endpoint.elementId]<=0){for(var i in _delements){if(_delements.hasOwnProperty(i)&&_delements[i]){delete _delements[i][endpoint.elementId];delete _draggablesForElements[endpoint.elementId];}}}}};this.changeId=function(oldId,newId){_delements[newId]=_delements[oldId];_delements[oldId]={};_draggablesForElements[newId]=_draggablesForElements[oldId];_draggablesForElements[oldId]=null;};this.getElementsForDraggable=function(id){return _delements[id];};this.elementRemoved=function(elementId){var elId=_draggablesForElements[elementId];if(elId){delete _delements[elId][elementId];delete _draggablesForElements[elementId];}};this.reset=function(){_draggables={};_dlist=[];_delements={};_elementsWithEndpoints={};};this.dragEnded=function(el){var id=_currentInstance.getId(el),ancestor=_draggablesForElements[id];if(ancestor)this.updateOffsets(ancestor);};this.setParent=function(el,elId,p,pId){var current=_draggablesForElements[elId];if(current){if(!_delements[pId])
_delements[pId]={};_delements[pId][elId]=_delements[current][elId];delete _delements[current][elId];var pLoc=_currentInstance.getOffset(p),cLoc=_currentInstance.getOffset(el);_delements[pId][elId].offset={left:cLoc.left-pLoc.left,top:cLoc.top-pLoc.top};_draggablesForElements[elId]=pId;}};this.getDragAncestor=function(el){var de=jsPlumb.getElement(el),id=_currentInstance.getId(de),aid=_draggablesForElements[id];if(aid)
return jsPlumb.getElement(aid);else
return null;};};var trim=function(str){return str==null?null:(str.replace(/^\s\s*/,'').replace(/\s\s*$/,''));},_setClassName=function(el,cn){cn=trim(cn);if(typeof el.className.baseVal!="undefined")
el.className.baseVal=cn;else
el.className=cn;},_getClassName=function(el){return(typeof el.className.baseVal=="undefined")?el.className:el.className.baseVal;},_classManip=function(el,classesToAdd,classesToRemove){classesToAdd=classesToAdd==null?[]:jsPlumbUtil.isArray(classesToAdd)?classesToAdd:classesToAdd.split(/\s+/);classesToRemove=classesToRemove==null?[]:jsPlumbUtil.isArray(classesToRemove)?classesToRemove:classesToRemove.split(/\s+/);var className=_getClassName(el),curClasses=className.split(/\s+/);var _oneSet=function(add,classes){for(var i=0;i<classes.length;i++){if(add){if(jsPlumbUtil.indexOf(curClasses,classes[i])==-1)
curClasses.push(classes[i]);}
else{var idx=jsPlumbUtil.indexOf(curClasses,classes[i]);if(idx!=-1)
curClasses.splice(idx,1);}}};_oneSet(true,classesToAdd);_oneSet(false,classesToRemove);_setClassName(el,curClasses.join(" "));};jsPlumb.extend(jsPlumbInstance.prototype,{headless:false,pageLocation:_pageLocation,screenLocation:_screenLocation,clientLocation:_clientLocation,getDragManager:function(){if(this.dragManager==null)
this.dragManager=new DragManager(this);return this.dragManager;},recalculateOffsets:function(elId){this.getDragManager().updateOffsets(elId);},createElement:function(tag,style,clazz,atts){return this.createElementNS(null,tag,style,clazz,atts);},createElementNS:function(ns,tag,style,clazz,atts){var e=ns==null?document.createElement(tag):document.createElementNS(ns,tag);var i;style=style||{};for(i in style)
e.style[i]=style[i];if(clazz)
e.className=clazz;atts=atts||{};for(i in atts)
e.setAttribute(i,""+atts[i]);return e;},getAttribute:function(el,attName){return el.getAttribute!=null?el.getAttribute(attName):null;},setAttribute:function(el,a,v){if(el.setAttribute!=null)el.setAttribute(a,v);},setAttributes:function(el,atts){for(var i in atts)
if(atts.hasOwnProperty(i))el.setAttribute(i,atts[i]);},appendToRoot:function(node){document.body.appendChild(node);},getRenderModes:function(){return["svg","vml"];},isRenderModeAvailable:function(m){return{"svg":svgAvailable,"vml":vmlAvailable()}[m];},trySetRenderMode:function(mode){var renderMode;if(mode){mode=mode.toLowerCase();var svgAvailable=this.isRenderModeAvailable("svg"),vmlAvailable=this.isRenderModeAvailable("vml");if(mode==="svg"){if(svgAvailable)renderMode="svg";else if(vmlAvailable)renderMode="vml";}
else if(vmlAvailable)renderMode="vml";}
return renderMode;},getClass:_getClassName,addClass:function(el,clazz){jsPlumb.each(el,function(e){_classManip(e,clazz);});},hasClass:function(el,clazz){el=jsPlumb.getElement(el);if(el.classList)return el.classList.contains(clazz);else{return _getClassName(el).indexOf(clazz)!=-1;}},removeClass:function(el,clazz){jsPlumb.each(el,function(e){_classManip(e,null,clazz);});},updateClasses:function(el,toAdd,toRemove){jsPlumb.each(el,function(e){_classManip(e,toAdd,toRemove);});},setClass:function(el,clazz){jsPlumb.each(el,function(e){_setClassName(e,clazz);});},setPosition:function(el,p){el.style.left=p.left+"px";el.style.top=p.top+"px";},getPosition:function(el){var _one=function(prop){var v=el.style[prop];return v?v.substring(0,v.length-2):0;};return{left:_one("left"),top:_one("top")};},getStyle:function(el,prop){if(typeof window.getComputedStyle!=='undefined'){return getComputedStyle(el,null).getPropertyValue(prop);}else{return el.currentStyle[prop];}},getSelector:function(ctx,spec){var sel=null;if(arguments.length==1){sel=ctx.nodeType!=null?ctx:document.querySelectorAll(ctx);}
else
sel=ctx.querySelectorAll(spec);return sel;},getOffset:function(el,relativeToRoot){el=jsPlumb.getElement(el);var container=this.getContainer();var out={left:el.offsetLeft,top:el.offsetTop},op=(relativeToRoot||(container!=null&&(el!=container&&el.offsetParent!=container)))?el.offsetParent:null,_maybeAdjustScroll=function(offsetParent){if(offsetParent!=null&&offsetParent!==document.body&&(offsetParent.scrollTop>0||offsetParent.scrollLeft>0)){out.left-=offsetParent.scrollLeft;out.top-=offsetParent.scrollTop;}}.bind(this);while(op!=null){out.left+=op.offsetLeft;out.top+=op.offsetTop;_maybeAdjustScroll(op);op=relativeToRoot?op.offsetParent:op.offsetParent==container?null:op.offsetParent;}
if(container!=null&&!relativeToRoot&&(container.scrollTop>0||container.scrollLeft>0)){var pp=el.offsetParent!=null?this.getStyle(el.offsetParent,"position"):"static",p=this.getStyle(el,"position");if(p!=="absolute"&&p!=="fixed"&&pp!=="absolute"&&pp!="fixed"){out.left-=container.scrollLeft;out.top-=container.scrollTop;}}
return out;},getPositionOnElement:function(evt,el,zoom){var box=typeof el.getBoundingClientRect!=="undefined"?el.getBoundingClientRect():{left:0,top:0,width:0,height:0},body=document.body,docElem=document.documentElement,scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop,scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,pst=0,psl=0,top=box.top+scrollTop-clientTop+(pst*zoom),left=box.left+scrollLeft-clientLeft+(psl*zoom),cl=jsPlumb.pageLocation(evt),w=box.width||(el.offsetWidth*zoom),h=box.height||(el.offsetHeight*zoom),x=(cl[0]-left)/w,y=(cl[1]-top)/h;return[x,y];},getAbsolutePosition:function(el){var _one=function(s){var ss=el.style[s];if(ss)return parseFloat(ss.substring(0,ss.length-2));};return[_one("left"),_one("top")];},setAbsolutePosition:function(el,xy,animateFrom,animateOptions){if(animateFrom){this.animate(el,{left:"+="+(xy[0]-animateFrom[0]),top:"+="+(xy[1]-animateFrom[1])},animateOptions);}
else{el.style.left=xy[0]+"px";el.style.top=xy[1]+"px";}},getSize:function(el){return[el.offsetWidth,el.offsetHeight];},getWidth:function(el){return el.offsetWidth;},getHeight:function(el){return el.offsetHeight;}});}).call(this);;(function(){"use strict";var root=this,_jp=root.jsPlumb,_ju=root.jsPlumbUtil;var _internalLabelOverlayId="__label",_makeLabelOverlay=function(component,params){var _params={cssClass:params.cssClass,labelStyle:component.labelStyle,id:_internalLabelOverlayId,component:component,_jsPlumb:component._jsPlumb.instance},mergedParams=jsPlumb.extend(_params,params);return new _jp.Overlays[component._jsPlumb.instance.getRenderMode()].Label(mergedParams);},_processOverlay=function(component,o){var _newOverlay=null;if(_ju.isArray(o)){var type=o[0],p=_jp.extend({component:component,_jsPlumb:component._jsPlumb.instance},o[1]);if(o.length==3)_jp.extend(p,o[2]);_newOverlay=new _jp.Overlays[component._jsPlumb.instance.getRenderMode()][type](p);}else if(o.constructor==String){_newOverlay=new _jp.Overlays[component._jsPlumb.instance.getRenderMode()][o]({component:component,_jsPlumb:component._jsPlumb.instance});}else{_newOverlay=o;}
_newOverlay.id=_newOverlay.id||_ju.uuid();component.cacheTypeItem("overlay",_newOverlay,_newOverlay.id);component._jsPlumb.overlays[_newOverlay.id]=_newOverlay;return _newOverlay;};_jp.OverlayCapableJsPlumbUIComponent=function(params){jsPlumbUIComponent.apply(this,arguments);this._jsPlumb.overlays={};this._jsPlumb.overlayPositions={};if(params.label){this.getDefaultType().overlays[_internalLabelOverlayId]=["Label",{label:params.label,location:params.labelLocation||this.defaultLabelLocation||0.5,labelStyle:params.labelStyle||this._jsPlumb.instance.Defaults.LabelStyle,id:_internalLabelOverlayId}];}
this.setListenerComponent=function(c){if(this._jsPlumb){for(var i in this._jsPlumb.overlays)
this._jsPlumb.overlays[i].setListenerComponent(c);}};};_jp.OverlayCapableJsPlumbUIComponent.applyType=function(component,t){if(t.overlays){var keep={},i;for(i in t.overlays){var existing=component._jsPlumb.overlays[t.overlays[i][1].id];if(existing){existing.updateFrom(t.overlays[i][1]);keep[t.overlays[i][1].id]=true;}
else{var c=component.getCachedTypeItem("overlay",t.overlays[i][1].id);if(c!=null){c.reattach(component._jsPlumb.instance);c.updateFrom(t.overlays[i][1]);component._jsPlumb.overlays[c.id]=c;}
else{c=component.addOverlay(t.overlays[i],true);}
keep[c.id]=true;}}
for(i in component._jsPlumb.overlays){if(keep[component._jsPlumb.overlays[i].id]==null)
component.removeOverlay(component._jsPlumb.overlays[i].id);}}};_ju.extend(_jp.OverlayCapableJsPlumbUIComponent,jsPlumbUIComponent,{setHover:function(hover,ignoreAttachedElements){if(this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()){for(var i in this._jsPlumb.overlays){this._jsPlumb.overlays[i][hover?"addClass":"removeClass"](this._jsPlumb.instance.hoverClass);}}},addOverlay:function(overlay,doNotRepaint){var o=_processOverlay(this,overlay);if(!doNotRepaint)this.repaint();return o;},getOverlay:function(id){return this._jsPlumb.overlays[id];},getOverlays:function(){return this._jsPlumb.overlays;},hideOverlay:function(id){var o=this.getOverlay(id);if(o)o.hide();},hideOverlays:function(){for(var i in this._jsPlumb.overlays)
this._jsPlumb.overlays[i].hide();},showOverlay:function(id){var o=this.getOverlay(id);if(o)o.show();},showOverlays:function(){for(var i in this._jsPlumb.overlays)
this._jsPlumb.overlays[i].show();},removeAllOverlays:function(doNotRepaint){for(var i in this._jsPlumb.overlays){if(this._jsPlumb.overlays[i].cleanup)this._jsPlumb.overlays[i].cleanup();}
this._jsPlumb.overlays={};this._jsPlumb.overlayPositions=null;if(!doNotRepaint)
this.repaint();},removeOverlay:function(overlayId){var o=this._jsPlumb.overlays[overlayId];if(o){if(o.cleanup)o.cleanup();delete this._jsPlumb.overlays[overlayId];if(this._jsPlumb.overlayPositions)
delete this._jsPlumb.overlayPositions[overlayId];}},removeOverlays:function(){for(var i=0,j=arguments.length;i<j;i++)
this.removeOverlay(arguments[i]);},moveParent:function(newParent){if(this.bgCanvas){this.bgCanvas.parentNode.removeChild(this.bgCanvas);newParent.appendChild(this.bgCanvas);}
if(this.canvas&&this.canvas.parentNode){this.canvas.parentNode.removeChild(this.canvas);newParent.appendChild(this.canvas);for(var i in this._jsPlumb.overlays){if(this._jsPlumb.overlays[i].isAppendedAtTopLevel){var el=this._jsPlumb.overlays[i].getElement();el.parentNode.removeChild(el);newParent.appendChild(el);}}}},getLabel:function(){var lo=this.getOverlay(_internalLabelOverlayId);return lo!=null?lo.getLabel():null;},getLabelOverlay:function(){return this.getOverlay(_internalLabelOverlayId);},setLabel:function(l){var lo=this.getOverlay(_internalLabelOverlayId);if(!lo){var params=l.constructor==String||l.constructor==Function?{label:l}:l;lo=_makeLabelOverlay(this,params);this._jsPlumb.overlays[_internalLabelOverlayId]=lo;}
else{if(l.constructor==String||l.constructor==Function)lo.setLabel(l);else{if(l.label)lo.setLabel(l.label);if(l.location)lo.setLocation(l.location);}}
if(!this._jsPlumb.instance.isSuspendDrawing())
this.repaint();},cleanup:function(force){for(var i in this._jsPlumb.overlays){this._jsPlumb.overlays[i].cleanup(force);this._jsPlumb.overlays[i].destroy(force);}
if(force){this._jsPlumb.overlays={};this._jsPlumb.overlayPositions=null;}},setVisible:function(v){this[v?"showOverlays":"hideOverlays"]();},setAbsoluteOverlayPosition:function(overlay,xy){this._jsPlumb.overlayPositions[overlay.id]=xy;},getAbsoluteOverlayPosition:function(overlay){return this._jsPlumb.overlayPositions?this._jsPlumb.overlayPositions[overlay.id]:null;}});}).call(this);(function(){"use strict";var root=this,_jp=root.jsPlumb,_ju=root.jsPlumbUtil;var _makeConnectionDragHandler=function(placeholder,_jsPlumb){var stopped=false;return{drag:function(){if(stopped){stopped=false;return true;}
var _ui=_jp.getUIPosition(arguments,_jsPlumb.getZoom());if(placeholder.element){jsPlumb.setPosition(placeholder.element,_ui);_jsPlumb.repaint(placeholder.element,_ui);}},stopDrag:function(){stopped=true;}};};var _makeDraggablePlaceholder=function(placeholder,_jsPlumb){var n=jsPlumb.createElement("div",{position:"absolute"});_jsPlumb.appendElement(n);var id=_jsPlumb.getId(n);_jsPlumb.manage(id,n,true);placeholder.id=id;placeholder.element=n;};var _makeFloatingEndpoint=function(paintStyle,referenceAnchor,endpoint,referenceCanvas,sourceElement,_jsPlumb,_newEndpoint,scope){var floatingAnchor=new _jp.FloatingAnchor({reference:referenceAnchor,referenceCanvas:referenceCanvas,jsPlumbInstance:_jsPlumb});return _newEndpoint({paintStyle:paintStyle,endpoint:endpoint,anchor:floatingAnchor,source:sourceElement,scope:scope});};var typeParameters=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"];var findConnectionToUseForDynamicAnchor=function(ep,elementWithPrecedence){var idx=0;if(elementWithPrecedence!=null){for(var i=0;i<ep.connections.length;i++){if(ep.connections[i].sourceId==elementWithPrecedence||ep.connections[i].targetId==elementWithPrecedence){idx=i;break;}}}
return ep.connections[idx];};var findConnectionIndex=function(conn,ep){return _ju.findWithFunction(ep.connections,function(c){return c.id==conn.id;});};_jp.Endpoint=function(params){var _jsPlumb=params._jsPlumb,_newConnection=params.newConnection,_newEndpoint=params.newEndpoint;this.idPrefix="_jsplumb_e_";this.defaultLabelLocation=[0.5,0.5];this.defaultOverlayKeys=["Overlays","EndpointOverlays"];_jp.OverlayCapableJsPlumbUIComponent.apply(this,arguments);this.appendToDefaultType({connectionType:params.connectionType,maxConnections:params.maxConnections==null?this._jsPlumb.instance.Defaults.MaxConnections:params.maxConnections,paintStyle:params.endpointStyle||params.paintStyle||params.style||this._jsPlumb.instance.Defaults.EndpointStyle||_jp.Defaults.EndpointStyle,hoverPaintStyle:params.endpointHoverStyle||params.hoverPaintStyle||this._jsPlumb.instance.Defaults.EndpointHoverStyle||_jp.Defaults.EndpointHoverStyle,connectorStyle:params.connectorStyle,connectorHoverStyle:params.connectorHoverStyle,connectorClass:params.connectorClass,connectorHoverClass:params.connectorHoverClass,connectorOverlays:params.connectorOverlays,connector:params.connector,connectorTooltip:params.connectorTooltip});this._jsPlumb.enabled=!(params.enabled===false);this._jsPlumb.visible=true;this.element=_jp.getElement(params.source);this._jsPlumb.uuid=params.uuid;this._jsPlumb.floatingEndpoint=null;var inPlaceCopy=null;if(this._jsPlumb.uuid)params.endpointsByUUID[this._jsPlumb.uuid]=this;this.elementId=params.elementId;this._jsPlumb.connectionCost=params.connectionCost;this._jsPlumb.connectionsDirected=params.connectionsDirected;this._jsPlumb.currentAnchorClass="";this._jsPlumb.events={};var _updateAnchorClass=function(){var oldAnchorClass=_jsPlumb.endpointAnchorClassPrefix+"_"+this._jsPlumb.currentAnchorClass;this._jsPlumb.currentAnchorClass=this.anchor.getCssClass();var anchorClass=_jsPlumb.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"_"+this._jsPlumb.currentAnchorClass:"");this.removeClass(oldAnchorClass);this.addClass(anchorClass);jsPlumb.updateClasses(this.element,anchorClass,oldAnchorClass);}.bind(this);this.prepareAnchor=function(anchorParams){var a=this._jsPlumb.instance.makeAnchor(anchorParams,this.elementId,_jsPlumb);a.bind("anchorChanged",function(currentAnchor){this.fire("anchorChanged",{endpoint:this,anchor:currentAnchor});_updateAnchorClass();}.bind(this));return a;};this.setPreparedAnchor=function(anchor,doNotRepaint){this._jsPlumb.instance.continuousAnchorFactory.clear(this.elementId);this.anchor=anchor;_updateAnchorClass();if(!doNotRepaint)
this._jsPlumb.instance.repaint(this.elementId);return this;};this.setAnchor=function(anchorParams,doNotRepaint){var a=this.prepareAnchor(anchorParams);this.setPreparedAnchor(a,doNotRepaint);return this;};var internalHover=function(state){if(this.connections.length>0){for(var i=0;i<this.connections.length;i++)
this.connections[i].setHover(state,false);}
else
this.setHover(state);}.bind(this);this.bind("mouseover",function(){internalHover(true);});this.bind("mouseout",function(){internalHover(false);});if(!params._transient)
this._jsPlumb.instance.anchorManager.add(this,this.elementId);this.prepareEndpoint=function(ep,typeId){var _e=function(t,p){var rm=_jsPlumb.getRenderMode();if(_jp.Endpoints[rm][t])return new _jp.Endpoints[rm][t](p);if(!_jsPlumb.Defaults.DoNotThrowErrors)
throw{msg:"jsPlumb: unknown endpoint type '"+t+"'"};};var endpointArgs={_jsPlumb:this._jsPlumb.instance,cssClass:params.cssClass,container:params.container,tooltip:params.tooltip,connectorTooltip:params.connectorTooltip,endpoint:this};var endpoint;if(_ju.isString(ep))
endpoint=_e(ep,endpointArgs);else if(_ju.isArray(ep)){endpointArgs=_ju.merge(ep[1],endpointArgs);endpoint=_e(ep[0],endpointArgs);}
else{endpoint=ep.clone();}
endpoint.clone=function(){if(_ju.isString(ep))
return _e(ep,endpointArgs);else if(_ju.isArray(ep)){endpointArgs=_ju.merge(ep[1],endpointArgs);return _e(ep[0],endpointArgs);}}.bind(this);endpoint.typeId=typeId;return endpoint;};this.setEndpoint=function(ep,doNotRepaint){var _ep=this.prepareEndpoint(ep);this.setPreparedEndpoint(_ep,true);};this.setPreparedEndpoint=function(ep,doNotRepaint){if(this.endpoint!=null){this.endpoint.cleanup();this.endpoint.destroy();}
this.endpoint=ep;this.type=this.endpoint.type;this.canvas=this.endpoint.canvas;};_jp.extend(this,params,typeParameters);this.isSource=params.isSource||false;this.isTemporarySource=params.isTemporarySource||false;this.isTarget=params.isTarget||false;this.connections=params.connections||[];this.connectorPointerEvents=params["connector-pointer-events"];this.scope=params.scope||_jsPlumb.getDefaultScope();this.timestamp=null;this.reattachConnections=params.reattach||_jsPlumb.Defaults.ReattachConnections;this.connectionsDetachable=_jsPlumb.Defaults.ConnectionsDetachable;if(params.connectionsDetachable===false||params.detachable===false)
this.connectionsDetachable=false;this.dragAllowedWhenFull=params.dragAllowedWhenFull!==false;if(params.onMaxConnections)
this.bind("maxConnections",params.onMaxConnections);this.addConnection=function(connection){this.connections.push(connection);this[(this.connections.length>0?"add":"remove")+"Class"](_jsPlumb.endpointConnectedClass);this[(this.isFull()?"add":"remove")+"Class"](_jsPlumb.endpointFullClass);};this.detachFromConnection=function(connection,idx,doNotCleanup){idx=idx==null?findConnectionIndex(connection,this):idx;if(idx>=0){this.connections.splice(idx,1);this[(this.connections.length>0?"add":"remove")+"Class"](_jsPlumb.endpointConnectedClass);this[(this.isFull()?"add":"remove")+"Class"](_jsPlumb.endpointFullClass);}
if(!doNotCleanup&&this._deleteOnDetach&&this.connections.length===0){_jsPlumb.deleteObject({endpoint:this,fireEvent:false,deleteAttachedObjects:false});}};this.detach=function(connection,ignoreTarget,forceDetach,fireEvent,originalEvent,endpointBeingDeleted,connectionIndex){var idx=connectionIndex==null?findConnectionIndex(connection,this):connectionIndex,actuallyDetached=false;fireEvent=(fireEvent!==false);if(idx>=0){if(forceDetach||connection._forceDetach||(connection.isDetachable()&&connection.isDetachAllowed(connection)&&this.isDetachAllowed(connection)&&_jsPlumb.checkCondition("beforeDetach",connection,endpointBeingDeleted))){_jsPlumb.deleteObject({connection:connection,fireEvent:(!ignoreTarget&&fireEvent),originalEvent:originalEvent,deleteAttachedObjects:false});actuallyDetached=true;}}
return actuallyDetached;};this.detachAll=function(fireEvent,forceDetach){var unaffectedConns=[];while(this.connections.length>0){var actuallyDetached=this.detach(this.connections[0],false,forceDetach===true,fireEvent!==false,null,this,0);if(!actuallyDetached){unaffectedConns.push(this.connections[0]);this.connections.splice(0,1);}}
this.connections=unaffectedConns;return this;};this.detachFrom=function(targetEndpoint,fireEvent,originalEvent){var c=[];for(var i=0;i<this.connections.length;i++){if(this.connections[i].endpoints[1]==targetEndpoint||this.connections[i].endpoints[0]==targetEndpoint){c.push(this.connections[i]);}}
for(var j=0;j<c.length;j++){this.detach(c[j],false,true,fireEvent,originalEvent);}
return this;};this.getElement=function(){return this.element;};this.setElement=function(el){var parentId=this._jsPlumb.instance.getId(el),curId=this.elementId;_ju.removeWithFunction(params.endpointsByElement[this.elementId],function(e){return e.id==this.id;}.bind(this));this.element=jsPlumb.getElement(el);this.elementId=_jsPlumb.getId(this.element);_jsPlumb.anchorManager.rehomeEndpoint(this,curId,this.element);_jsPlumb.dragManager.endpointAdded(this.element);_ju.addToList(params.endpointsByElement,parentId,this);return this;};this.makeInPlaceCopy=function(){var loc=this.anchor.getCurrentLocation({element:this}),o=this.anchor.getOrientation(this),acc=this.anchor.getCssClass(),inPlaceAnchor={bind:function(){},compute:function(){return[loc[0],loc[1]];},getCurrentLocation:function(){return[loc[0],loc[1]];},getOrientation:function(){return o;},getCssClass:function(){return acc;}};return _newEndpoint({dropOptions:params.dropOptions,anchor:inPlaceAnchor,source:this.element,paintStyle:this.getPaintStyle(),endpoint:params.hideOnDrag?"Blank":this.endpoint,_transient:true,scope:this.scope,reference:this});};this.connectorSelector=function(){var candidate=this.connections[0];if(candidate)return candidate;else{return(this.connections.length<this._jsPlumb.maxConnections)||this._jsPlumb.maxConnections==-1?null:candidate;}};this.setStyle=this.setPaintStyle;this.paint=function(params){params=params||{};var timestamp=params.timestamp,recalc=!(params.recalc===false);if(!timestamp||this.timestamp!==timestamp){var info=_jsPlumb.updateOffset({elId:this.elementId,timestamp:timestamp});var xy=params.offset?params.offset.o:info.o;if(xy!=null){var ap=params.anchorPoint,connectorPaintStyle=params.connectorPaintStyle;if(ap==null){var wh=params.dimensions||info.s,anchorParams={xy:[xy.left,xy.top],wh:wh,element:this,timestamp:timestamp};if(recalc&&this.anchor.isDynamic&&this.connections.length>0){var c=findConnectionToUseForDynamicAnchor(this,params.elementWithPrecedence),oIdx=c.endpoints[0]==this?1:0,oId=oIdx===0?c.sourceId:c.targetId,oInfo=_jsPlumb.getCachedData(oId),oOffset=oInfo.o,oWH=oInfo.s;anchorParams.txy=[oOffset.left,oOffset.top];anchorParams.twh=oWH;anchorParams.tElement=c.endpoints[oIdx];}
ap=this.anchor.compute(anchorParams);}
this.endpoint.compute(ap,this.anchor.getOrientation(this),this._jsPlumb.paintStyleInUse,connectorPaintStyle||this.paintStyleInUse);this.endpoint.paint(this._jsPlumb.paintStyleInUse,this.anchor);this.timestamp=timestamp;for(var i in this._jsPlumb.overlays){if(this._jsPlumb.overlays.hasOwnProperty(i)){var o=this._jsPlumb.overlays[i];if(o.isVisible()){this._jsPlumb.overlayPlacements[i]=o.draw(this.endpoint,this._jsPlumb.paintStyleInUse);o.paint(this._jsPlumb.overlayPlacements[i]);}}}}}};this.getTypeDescriptor=function(){return"endpoint";};this.isVisible=function(){return this._jsPlumb.visible;};this.repaint=this.paint;var draggingInitialised=false;this.initDraggable=function(){if(!draggingInitialised&&_jp.isDragSupported(this.element)){var placeholderInfo={id:null,element:null},jpc=null,existingJpc=false,existingJpcParams=null,_dragHandler=_makeConnectionDragHandler(placeholderInfo,_jsPlumb),dragOptions=params.dragOptions||{},defaultOpts={},startEvent=_jp.dragEvents.start,stopEvent=_jp.dragEvents.stop,dragEvent=_jp.dragEvents.drag;var start=function(){jpc=this.connectorSelector();var _continue=true;if(!this.isEnabled())_continue=false;if(jpc==null&&!this.isSource&&!this.isTemporarySource)_continue=false;if(this.isSource&&this.isFull()&&!(jpc!=null&&this.dragAllowedWhenFull))_continue=false;if(jpc!=null&&!jpc.isDetachable(this))_continue=false;var beforeDrag=_jsPlumb.checkCondition(jpc==null?"beforeDrag":"beforeStartDetach",{endpoint:this,source:this.element,sourceId:this.elementId,connection:jpc});if(beforeDrag===false)_continue=false;if(_continue===false){if(_jsPlumb.stopDrag)_jsPlumb.stopDrag(this.canvas);_dragHandler.stopDrag();return false;}
for(var i=0;i<this.connections.length;i++)
this.connections[i].setHover(false);this.addClass("endpointDrag");_jsPlumb.setConnectionBeingDragged(true);if(jpc&&!this.isFull()&&this.isSource)jpc=null;_jsPlumb.updateOffset({elId:this.elementId});inPlaceCopy=this.makeInPlaceCopy();inPlaceCopy.addClass(_jsPlumb.draggingClass);inPlaceCopy.referenceEndpoint=this;inPlaceCopy.paint();_makeDraggablePlaceholder(placeholderInfo,_jsPlumb);var ipco=this._jsPlumb.instance.getOffset(inPlaceCopy.canvas),canvasElement=this.canvas;jsPlumb.setPosition(placeholderInfo.element,ipco);if(this.parentAnchor)this.anchor=_jsPlumb.makeAnchor(this.parentAnchor,this.elementId,_jsPlumb);_jsPlumb.setAttributes(this.canvas,{"dragId":placeholderInfo.id,"elId":this.elementId});this._jsPlumb.floatingEndpoint=_makeFloatingEndpoint(this.getPaintStyle(),this.anchor,this.endpoint,this.canvas,placeholderInfo.element,_jsPlumb,_newEndpoint,this.scope);this.canvas.style.visibility="hidden";if(jpc==null){this.anchor.locked=true;this.setHover(false,false);jpc=_newConnection({sourceEndpoint:this,targetEndpoint:this._jsPlumb.floatingEndpoint,source:this.endpointWillMoveTo||this.element,target:placeholderInfo.element,anchors:[this.anchor,this._jsPlumb.floatingEndpoint.anchor],paintStyle:params.connectorStyle,hoverPaintStyle:params.connectorHoverStyle,connector:params.connector,overlays:params.connectorOverlays,type:this.connectionType,cssClass:this.connectorClass,hoverClass:this.connectorHoverClass,data:beforeDrag});jpc.addClass(_jsPlumb.draggingClass);this._jsPlumb.floatingEndpoint.addClass(_jsPlumb.draggingClass);_jsPlumb.fire("connectionDrag",jpc);}else{existingJpc=true;jpc.setHover(false);var anchorIdx=jpc.endpoints[0].id==this.id?0:1;this.detachFromConnection(jpc,null,true);var dragScope=_jsPlumb.getDragScope(canvasElement);_jsPlumb.setAttribute(this.canvas,"originalScope",dragScope);var dropScope=_jsPlumb.getDropScope(canvasElement);_jsPlumb.setDragScope(canvasElement,dropScope);_jsPlumb.fire("connectionDrag",jpc);if(anchorIdx===0){existingJpcParams=[jpc.source,jpc.sourceId,canvasElement,dragScope];jpc.source=placeholderInfo.element;jpc.sourceId=placeholderInfo.id;}else{existingJpcParams=[jpc.target,jpc.targetId,canvasElement,dragScope];jpc.target=placeholderInfo.element;jpc.targetId=placeholderInfo.id;}
jpc.endpoints[anchorIdx===0?1:0].anchor.locked=true;jpc.suspendedEndpoint=jpc.endpoints[anchorIdx];jpc.suspendedElement=jpc.endpoints[anchorIdx].getElement();jpc.suspendedElementId=jpc.endpoints[anchorIdx].elementId;jpc.suspendedElementType=anchorIdx===0?"source":"target";jpc.suspendedEndpoint.setHover(false);this._jsPlumb.floatingEndpoint.referenceEndpoint=jpc.suspendedEndpoint;jpc.endpoints[anchorIdx]=this._jsPlumb.floatingEndpoint;jpc.addClass(_jsPlumb.draggingClass);this._jsPlumb.floatingEndpoint.addClass(_jsPlumb.draggingClass);}
_jsPlumb.floatingConnections[placeholderInfo.id]=jpc;_jsPlumb.anchorManager.addFloatingConnection(placeholderInfo.id,jpc);_ju.addToList(params.endpointsByElement,placeholderInfo.id,this._jsPlumb.floatingEndpoint);_jsPlumb.currentlyDragging=true;}.bind(this);var stop=function(){_jsPlumb.setConnectionBeingDragged(false);if(jpc&&jpc.endpoints!=null){var originalEvent=_jsPlumb.getDropEvent(arguments);var idx=_jsPlumb.getFloatingAnchorIndex(jpc);jpc.endpoints[idx===0?1:0].anchor.locked=false;jpc.removeClass(_jsPlumb.draggingClass);if(this._jsPlumb&&(jpc.deleteConnectionNow||jpc.endpoints[idx]==this._jsPlumb.floatingEndpoint)){if(existingJpc&&jpc.suspendedEndpoint){if(idx===0){jpc.source=existingJpcParams[0];jpc.sourceId=existingJpcParams[1];}else{jpc.target=existingJpcParams[0];jpc.targetId=existingJpcParams[1];}
var fe=this._jsPlumb.floatingEndpoint;_jsPlumb.setDragScope(existingJpcParams[2],existingJpcParams[3]);jpc.endpoints[idx]=jpc.suspendedEndpoint;if(jpc.isReattach()||jpc._forceReattach||jpc._forceDetach||!jpc.endpoints[idx===0?1:0].detach(jpc,false,false,true,originalEvent,true)){jpc.setHover(false);jpc._forceDetach=null;jpc._forceReattach=null;this._jsPlumb.floatingEndpoint.detachFromConnection(jpc);jpc.suspendedEndpoint.addConnection(jpc);_jsPlumb.repaint(existingJpcParams[1]);}
else
_jsPlumb.deleteObject({endpoint:fe});}}
if(this.deleteAfterDragStop){_jsPlumb.deleteObject({endpoint:this});}
else{if(this._jsPlumb){this.paint({recalc:false});}}
_jsPlumb.fire("connectionDragStop",jpc,originalEvent);_jsPlumb.currentlyDragging=false;jpc=null;}
if(placeholderInfo&&placeholderInfo.element){_jsPlumb.remove(placeholderInfo.element,false);}
if(inPlaceCopy){_jsPlumb.deleteObject({endpoint:inPlaceCopy});}
if(this._jsPlumb){this.canvas.style.visibility="visible";this.anchor.locked=false;this._jsPlumb.floatingEndpoint=null;}}.bind(this);dragOptions=_jp.extend(defaultOpts,dragOptions);dragOptions.scope=this.scope||dragOptions.scope;dragOptions[startEvent]=_ju.wrap(dragOptions[startEvent],start,false);dragOptions[dragEvent]=_ju.wrap(dragOptions[dragEvent],_dragHandler.drag);dragOptions[stopEvent]=_ju.wrap(dragOptions[stopEvent],stop);dragOptions.multipleDrop=false;dragOptions.canDrag=function(){return this.isSource||this.isTemporarySource||this.connections.length>0;}.bind(this);_jsPlumb.initDraggable(this.canvas,dragOptions,"internal");this.canvas._jsPlumbRelatedElement=this.element;draggingInitialised=true;}};var ep=params.endpoint||this._jsPlumb.instance.Defaults.Endpoint||_jp.Defaults.Endpoint;this.setEndpoint(ep,true);var anchorParamsToUse=params.anchor?params.anchor:params.anchors?params.anchors:(_jsPlumb.Defaults.Anchor||"Top");this.setAnchor(anchorParamsToUse,true);var type=["default",(params.type||"")].join(" ");this.addType(type,params.data,true);this.canvas=this.endpoint.canvas;this.canvas._jsPlumb=this;this.initDraggable();var _initDropTarget=function(canvas,isTransient,endpoint,referenceEndpoint){if(_jp.isDropSupported(this.element)){var dropOptions=params.dropOptions||_jsPlumb.Defaults.DropOptions||_jp.Defaults.DropOptions;dropOptions=_jp.extend({},dropOptions);dropOptions.scope=dropOptions.scope||this.scope;var dropEvent=_jp.dragEvents.drop,overEvent=_jp.dragEvents.over,outEvent=_jp.dragEvents.out,_ep=this,drop=_jsPlumb.EndpointDropHandler({getEndpoint:function(){return _ep;},jsPlumb:_jsPlumb,enabled:function(){return endpoint!=null?endpoint.isEnabled():true;},isFull:function(){return endpoint.isFull();},element:this.element,elementId:this.elementId,isSource:this.isSource,isTarget:this.isTarget,addClass:function(clazz){_ep.addClass(clazz);},removeClass:function(clazz){_ep.removeClass(clazz);},isDropAllowed:function(){return _ep.isDropAllowed.apply(_ep,arguments);},reference:referenceEndpoint,isRedrop:function(jpc,dhParams){return jpc.suspendedEndpoint&&dhParams.reference&&(jpc.suspendedEndpoint.id===dhParams.reference.id);}});dropOptions[dropEvent]=_ju.wrap(dropOptions[dropEvent],drop,true);dropOptions[overEvent]=_ju.wrap(dropOptions[overEvent],function(){var draggable=_jp.getDragObject(arguments),id=_jsPlumb.getAttribute(_jp.getElement(draggable),"dragId"),_jpc=_jsPlumb.floatingConnections[id];if(_jpc!=null){var idx=_jsPlumb.getFloatingAnchorIndex(_jpc);var _cont=(this.isTarget&&idx!==0)||(_jpc.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id==_jpc.suspendedEndpoint.id);if(_cont){var bb=_jsPlumb.checkCondition("checkDropAllowed",{sourceEndpoint:_jpc.endpoints[idx],targetEndpoint:this,connection:_jpc});this[(bb?"add":"remove")+"Class"](_jsPlumb.endpointDropAllowedClass);this[(bb?"remove":"add")+"Class"](_jsPlumb.endpointDropForbiddenClass);_jpc.endpoints[idx].anchor.over(this.anchor,this);}}}.bind(this));dropOptions[outEvent]=_ju.wrap(dropOptions[outEvent],function(){var draggable=_jp.getDragObject(arguments),id=draggable==null?null:_jsPlumb.getAttribute(_jp.getElement(draggable),"dragId"),_jpc=id?_jsPlumb.floatingConnections[id]:null;if(_jpc!=null){var idx=_jsPlumb.getFloatingAnchorIndex(_jpc);var _cont=(this.isTarget&&idx!==0)||(_jpc.suspendedEndpoint&&this.referenceEndpoint&&this.referenceEndpoint.id==_jpc.suspendedEndpoint.id);if(_cont){this.removeClass(_jsPlumb.endpointDropAllowedClass);this.removeClass(_jsPlumb.endpointDropForbiddenClass);_jpc.endpoints[idx].anchor.out();}}}.bind(this));_jsPlumb.initDroppable(canvas,dropOptions,"internal",isTransient);}}.bind(this);if(!this.anchor.isFloating)
_initDropTarget(this.canvas,!(params._transient||this.anchor.isFloating),this,params.reference);return this;};_ju.extend(_jp.Endpoint,_jp.OverlayCapableJsPlumbUIComponent,{setVisible:function(v,doNotChangeConnections,doNotNotifyOtherEndpoint){this._jsPlumb.visible=v;if(this.canvas)this.canvas.style.display=v?"block":"none";this[v?"showOverlays":"hideOverlays"]();if(!doNotChangeConnections){for(var i=0;i<this.connections.length;i++){this.connections[i].setVisible(v);if(!doNotNotifyOtherEndpoint){var oIdx=this===this.connections[i].endpoints[0]?1:0;if(this.connections[i].endpoints[oIdx].connections.length==1)this.connections[i].endpoints[oIdx].setVisible(v,true,true);}}}},getAttachedElements:function(){return this.connections;},applyType:function(t,doNotRepaint){this.setPaintStyle(t.endpointStyle||t.paintStyle,doNotRepaint);this.setHoverPaintStyle(t.endpointHoverStyle||t.hoverPaintStyle,doNotRepaint);if(t.maxConnections!=null)this._jsPlumb.maxConnections=t.maxConnections;if(t.scope)this.scope=t.scope;_jp.extend(this,t,typeParameters);if(t.cssClass!=null&&this.canvas)this._jsPlumb.instance.addClass(this.canvas,t.cssClass);_jp.OverlayCapableJsPlumbUIComponent.applyType(this,t);},isEnabled:function(){return this._jsPlumb.enabled;},setEnabled:function(e){this._jsPlumb.enabled=e;},cleanup:function(){var anchorClass=this._jsPlumb.instance.endpointAnchorClassPrefix+(this._jsPlumb.currentAnchorClass?"_"+this._jsPlumb.currentAnchorClass:"");jsPlumb.removeClass(this.element,anchorClass);this.anchor=null;this.endpoint.cleanup(true);this.endpoint.destroy();this.endpoint=null;this._jsPlumb.instance.destroyDraggable(this.canvas,"internal");this._jsPlumb.instance.destroyDroppable(this.canvas,"internal");},setHover:function(h){if(this.endpoint&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged())
this.endpoint.setHover(h);},isFull:function(){return this._jsPlumb.maxConnections===0?true:!(this.isFloating()||this._jsPlumb.maxConnections<0||this.connections.length<this._jsPlumb.maxConnections);},isFloating:function(){return this.anchor!=null&&this.anchor.isFloating;},isConnectedTo:function(endpoint){var found=false;if(endpoint){for(var i=0;i<this.connections.length;i++){if(this.connections[i].endpoints[1]==endpoint||this.connections[i].endpoints[0]==endpoint){found=true;break;}}}
return found;},getConnectionCost:function(){return this._jsPlumb.connectionCost;},setConnectionCost:function(c){this._jsPlumb.connectionCost=c;},areConnectionsDirected:function(){return this._jsPlumb.connectionsDirected;},setConnectionsDirected:function(b){this._jsPlumb.connectionsDirected=b;},setElementId:function(_elId){this.elementId=_elId;this.anchor.elementId=_elId;},setReferenceElement:function(_el){this.element=_jp.getElement(_el);},setDragAllowedWhenFull:function(allowed){this.dragAllowedWhenFull=allowed;},equals:function(endpoint){return this.anchor.equals(endpoint.anchor);},getUuid:function(){return this._jsPlumb.uuid;},computeAnchor:function(params){return this.anchor.compute(params);}});root.jsPlumbInstance.prototype.EndpointDropHandler=function(dhParams){return function(e){var _jsPlumb=dhParams.jsPlumb;dhParams.removeClass(_jsPlumb.endpointDropAllowedClass);dhParams.removeClass(_jsPlumb.endpointDropForbiddenClass);var originalEvent=_jsPlumb.getDropEvent(arguments),draggable=_jsPlumb.getDragObject(arguments),id=_jsPlumb.getAttribute(draggable,"dragId"),elId=_jsPlumb.getAttribute(draggable,"elId"),scope=_jsPlumb.getAttribute(draggable,"originalScope"),jpc=_jsPlumb.floatingConnections[id];if(jpc==null)return;if(jpc.suspendedEndpoint&&jpc.suspendedEndpoint._jsPlumb==null)return;var _ep=dhParams.getEndpoint(jpc);if(_ep==null)return;if(dhParams.isRedrop(jpc,dhParams)){jpc._forceReattach=true;jpc.setHover(false);if(dhParams.maybeCleanup)dhParams.maybeCleanup(_ep);return;}
var idx=_jsPlumb.getFloatingAnchorIndex(jpc);if((idx===0&&!dhParams.isSource)||(idx===1&&!dhParams.isTarget)){if(dhParams.maybeCleanup)dhParams.maybeCleanup(_ep);return;}
if(dhParams.onDrop)dhParams.onDrop(jpc);if(scope)_jsPlumb.setDragScope(draggable,scope);var isFull=dhParams.isFull(e);if(isFull){_ep.fire("maxConnections",{endpoint:this,connection:jpc,maxConnections:_ep._jsPlumb.maxConnections},originalEvent);}
if(!isFull&&!(idx===0&&!dhParams.isSource)&&!(idx==1&&!dhParams.isTarget)&&dhParams.enabled()){var _doContinue=true;if(idx===0){jpc.source=dhParams.element;jpc.sourceId=dhParams.elementId;}else{jpc.target=dhParams.element;jpc.targetId=dhParams.elementId;}
if(jpc.suspendedEndpoint&&jpc.suspendedEndpoint._jsPlumb&&jpc.suspendedEndpoint.id!=_ep.id){if(!jpc.isDetachAllowed(jpc)||!jpc.endpoints[idx].isDetachAllowed(jpc)||!jpc.suspendedEndpoint.isDetachAllowed(jpc)||!_jsPlumb.checkCondition("beforeDetach",jpc))
_doContinue=false;}
var continueFunction=function(optionalData){jpc.endpoints[idx].detachFromConnection(jpc);if(jpc.suspendedEndpoint)jpc.suspendedEndpoint.detachFromConnection(jpc);jpc.endpoints[idx]=_ep;_ep.addConnection(jpc);var params=_ep.getParameters();for(var aParam in params)
jpc.setParameter(aParam,params[aParam]);if(!jpc.suspendedEndpoint){if(params.draggable)
_jsPlumb.initDraggable(this.element,dragOptions,"internal",_jsPlumb);}
else{var suspendedElementId=jpc.suspendedEndpoint.elementId;_jsPlumb.fireMoveEvent({index:idx,originalSourceId:idx===0?suspendedElementId:jpc.sourceId,newSourceId:idx===0?_ep.elementId:jpc.sourceId,originalTargetId:idx==1?suspendedElementId:jpc.targetId,newTargetId:idx==1?_ep.elementId:jpc.targetId,originalSourceEndpoint:idx===0?jpc.suspendedEndpoint:jpc.endpoints[0],newSourceEndpoint:idx===0?_ep:jpc.endpoints[0],originalTargetEndpoint:idx==1?jpc.suspendedEndpoint:jpc.endpoints[1],newTargetEndpoint:idx==1?_ep:jpc.endpoints[1],connection:jpc},originalEvent);}
if(idx==1)
_jsPlumb.anchorManager.updateOtherEndpoint(jpc.sourceId,jpc.suspendedElementId,jpc.targetId,jpc);else
_jsPlumb.anchorManager.sourceChanged(jpc.suspendedEndpoint.elementId,jpc.sourceId,jpc);if(jpc.endpoints[0].finalEndpoint){var _toDelete=jpc.endpoints[0];_toDelete.detachFromConnection(jpc);jpc.endpoints[0]=jpc.endpoints[0].finalEndpoint;jpc.endpoints[0].addConnection(jpc);}
if(jsPlumbUtil.isObject(optionalData)){jpc.mergeData(optionalData);}
_jsPlumb.finaliseConnection(jpc,null,originalEvent);jpc.setHover(false);}.bind(this);var dontContinueFunction=function(){if(jpc.suspendedEndpoint){jpc.endpoints[idx]=jpc.suspendedEndpoint;jpc.setHover(false);jpc._forceDetach=true;if(idx===0){jpc.source=jpc.suspendedEndpoint.element;jpc.sourceId=jpc.suspendedEndpoint.elementId;}else{jpc.target=jpc.suspendedEndpoint.element;jpc.targetId=jpc.suspendedEndpoint.elementId;}
jpc.suspendedEndpoint.addConnection(jpc);_jsPlumb.repaint(jpc.sourceId);jpc._forceDetach=false;}};_doContinue=_doContinue&&dhParams.isDropAllowed(jpc.sourceId,jpc.targetId,jpc.scope,jpc,_ep);if(_doContinue){continueFunction(_doContinue);return true;}
else{dontContinueFunction();}}
if(dhParams.maybeCleanup)dhParams.maybeCleanup(_ep);_jsPlumb.currentlyDragging=false;};};}).call(this);;(function(){"use strict";var root=this,_jp=root.jsPlumb,_ju=root.jsPlumbUtil;var makeConnector=function(_jsPlumb,renderMode,connectorName,connectorArgs,forComponent){if(!_jsPlumb.Defaults.DoNotThrowErrors&&jsPlumb.Connectors[renderMode][connectorName]==null)
throw{msg:"jsPlumb: unknown connector type '"+connectorName+"'"};return new _jp.Connectors[renderMode][connectorName](connectorArgs,forComponent);},_makeAnchor=function(anchorParams,elementId,_jsPlumb){return(anchorParams)?_jsPlumb.makeAnchor(anchorParams,elementId,_jsPlumb):null;},_updateConnectedClass=function(conn,element,_jsPlumb,remove){if(element!=null){element._jsPlumbConnections=element._jsPlumbConnections||{};if(remove)
delete element._jsPlumbConnections[conn.id];else
element._jsPlumbConnections[conn.id]=true;if(_ju.isEmpty(element._jsPlumbConnections)){_jsPlumb.removeClass(element,_jsPlumb.connectedClass);}
else
_jsPlumb.addClass(element,_jsPlumb.connectedClass);}};_jp.Connection=function(params){var _newEndpoint=params.newEndpoint;this.id=params.id;this.connector=null;this.idPrefix="_jsplumb_c_";this.defaultLabelLocation=0.5;this.defaultOverlayKeys=["Overlays","ConnectionOverlays"];this.previousConnection=params.previousConnection;this.source=_jp.getElement(params.source);this.target=_jp.getElement(params.target);if(params.sourceEndpoint)this.source=params.sourceEndpoint.getElement();if(params.targetEndpoint)this.target=params.targetEndpoint.getElement();_jp.OverlayCapableJsPlumbUIComponent.apply(this,arguments);this.sourceId=this._jsPlumb.instance.getId(this.source);this.targetId=this._jsPlumb.instance.getId(this.target);this.scope=params.scope;this.endpoints=[];this.endpointStyles=[];var _jsPlumb=this._jsPlumb.instance;_jsPlumb.manage(this.sourceId,this.source);_jsPlumb.manage(this.targetId,this.target);this._jsPlumb.visible=true;this._jsPlumb.editable=params.editable===true;this._jsPlumb.params={cssClass:params.cssClass,container:params.container,"pointer-events":params["pointer-events"],editorParams:params.editorParams,overlays:params.overlays};this._jsPlumb.lastPaintedAt=null;this.bind("mouseover",function(){this.setHover(true);}.bind(this));this.bind("mouseout",function(){this.setHover(false);}.bind(this));this.makeEndpoint=function(isSource,el,elId,ep){elId=elId||this._jsPlumb.instance.getId(el);return this.prepareEndpoint(_jsPlumb,_newEndpoint,this,ep,isSource?0:1,params,el,elId);};var eS=this.makeEndpoint(true,this.source,this.sourceId,params.sourceEndpoint),eT=this.makeEndpoint(false,this.target,this.targetId,params.targetEndpoint);if(eS)_ju.addToList(params.endpointsByElement,this.sourceId,eS);if(eT)_ju.addToList(params.endpointsByElement,this.targetId,eT);if(!this.scope)this.scope=this.endpoints[0].scope;if(params.deleteEndpointsOnDetach!=null){this.endpoints[0]._deleteOnDetach=params.deleteEndpointsOnDetach;this.endpoints[1]._deleteOnDetach=params.deleteEndpointsOnDetach;}
else{if(!this.endpoints[0]._doNotDeleteOnDetach)this.endpoints[0]._deleteOnDetach=true;if(!this.endpoints[1]._doNotDeleteOnDetach)this.endpoints[1]._deleteOnDetach=true;}
var _detachable=_jsPlumb.Defaults.ConnectionsDetachable;if(params.detachable===false)_detachable=false;if(this.endpoints[0].connectionsDetachable===false)_detachable=false;if(this.endpoints[1].connectionsDetachable===false)_detachable=false;var _reattach=params.reattach||this.endpoints[0].reattachConnections||this.endpoints[1].reattachConnections||_jsPlumb.Defaults.ReattachConnections;this.appendToDefaultType({detachable:_detachable,rettach:_reattach,paintStyle:this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||params.paintStyle||_jsPlumb.Defaults.PaintStyle||jsPlumb.Defaults.PaintStyle,hoverPaintStyle:this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||params.hoverPaintStyle||_jsPlumb.Defaults.HoverPaintStyle||jsPlumb.Defaults.HoverPaintStyle});var _suspendedAt=_jsPlumb.getSuspendedAt();if(!_jsPlumb.isSuspendDrawing()){var myInfo=_jsPlumb.getCachedData(this.sourceId),myOffset=myInfo.o,myWH=myInfo.s,otherInfo=_jsPlumb.getCachedData(this.targetId),otherOffset=otherInfo.o,otherWH=otherInfo.s,initialTimestamp=_suspendedAt||_jsPlumb.timestamp(),anchorLoc=this.endpoints[0].anchor.compute({xy:[myOffset.left,myOffset.top],wh:myWH,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[otherOffset.left,otherOffset.top],twh:otherWH,tElement:this.endpoints[1],timestamp:initialTimestamp});this.endpoints[0].paint({anchorLoc:anchorLoc,timestamp:initialTimestamp});anchorLoc=this.endpoints[1].anchor.compute({xy:[otherOffset.left,otherOffset.top],wh:otherWH,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[myOffset.left,myOffset.top],twh:myWH,tElement:this.endpoints[0],timestamp:initialTimestamp});this.endpoints[1].paint({anchorLoc:anchorLoc,timestamp:initialTimestamp});}
this.getTypeDescriptor=function(){return"connection";};this.getAttachedElements=function(){return this.endpoints;};this.isDetachable=function(){return this._jsPlumb.detachable===true;};this.setDetachable=function(detachable){this._jsPlumb.detachable=detachable===true;};this.isReattach=function(){return this._jsPlumb.reattach===true||this.endpoints[0].reattachConnections===true||this.endpoints[1].reattachConnections===true;};this.setReattach=function(reattach){this._jsPlumb.reattach=reattach===true;};this._jsPlumb.cost=params.cost||this.endpoints[0].getConnectionCost();this._jsPlumb.directed=params.directed;if(params.directed==null)this._jsPlumb.directed=this.endpoints[0].areConnectionsDirected();var _p=jsPlumb.extend({},this.endpoints[1].getParameters());_jp.extend(_p,this.endpoints[0].getParameters());_jp.extend(_p,this.getParameters());this.setParameters(_p);this.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||params.connector||_jsPlumb.Defaults.Connector||_jp.Defaults.Connector,true);var data=params.data==null||!jsPlumbUtil.isObject(params.data)?{}:params.data;this.getData=function(){return data;};this.setData=function(d){data=d||{};};this.mergeData=function(d){data=jsPlumb.extend(data,d);};var _types=["default",params.type,this.endpoints[0].connectionType,this.endpoints[1].connectionType].join(" ");if(/[^\s]/.test(_types))
this.addType(_types,params.data,true);this.updateConnectedClass();};_ju.extend(_jp.Connection,_jp.OverlayCapableJsPlumbUIComponent,{applyType:function(t,doNotRepaint,typeMap){if(t.detachable!=null)this.setDetachable(t.detachable);if(t.reattach!=null)this.setReattach(t.reattach);if(t.scope)this.scope=t.scope;if(t.cssClass!=null&&this.canvas)this._jsPlumb.instance.addClass(this.canvas,t.cssClass);var _anchors=null;if(t.anchor){_anchors=this.getCachedTypeItem("anchors",typeMap.anchor);if(_anchors==null){_anchors=[this._jsPlumb.instance.makeAnchor(t.anchor),this._jsPlumb.instance.makeAnchor(t.anchor)];this.cacheTypeItem("anchors",_anchors,typeMap.anchor);}}
else if(t.anchors){_anchors=this.getCachedTypeItem("anchors",typeMap.anchors);if(_anchors==null){_anchors=[this._jsPlumb.instance.makeAnchor(t.anchors[0]),this._jsPlumb.instance.makeAnchor(t.anchors[1])];this.cacheTypeItem("anchors",_anchors,typeMap.anchors);}}
if(_anchors!=null){this.endpoints[0].anchor=_anchors[0];this.endpoints[1].anchor=_anchors[1];}
_jp.OverlayCapableJsPlumbUIComponent.applyType(this,t);},addClass:function(c,informEndpoints){if(informEndpoints){this.endpoints[0].addClass(c);this.endpoints[1].addClass(c);if(this.suspendedEndpoint)this.suspendedEndpoint.addClass(c);}
if(this.connector){this.connector.addClass(c);}},removeClass:function(c,informEndpoints){if(informEndpoints){this.endpoints[0].removeClass(c);this.endpoints[1].removeClass(c);if(this.suspendedEndpoint)this.suspendedEndpoint.removeClass(c);}
if(this.connector){this.connector.removeClass(c);}},isVisible:function(){return this._jsPlumb.visible;},setVisible:function(v){this._jsPlumb.visible=v;if(this.connector)
this.connector.setVisible(v);this.repaint();},cleanup:function(){this.updateConnectedClass(true);this.endpoints=null;this.source=null;this.target=null;if(this.connector!=null){this.connector.cleanup(true);this.connector.destroy(true);}
this.connector=null;},updateConnectedClass:function(remove){_updateConnectedClass(this,this.source,this._jsPlumb.instance,remove);_updateConnectedClass(this,this.target,this._jsPlumb.instance,remove);},setHover:function(state){if(this.connector&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()){this.connector.setHover(state);root.jsPlumb[state?"addClass":"removeClass"](this.source,this._jsPlumb.instance.hoverSourceClass);root.jsPlumb[state?"addClass":"removeClass"](this.target,this._jsPlumb.instance.hoverTargetClass);}},getUuids:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()];},getCost:function(){return this._jsPlumb.cost;},setCost:function(c){this._jsPlumb.cost=c;},isDirected:function(){return this._jsPlumb.directed===true;},getConnector:function(){return this.connector;},prepareConnector:function(connectorSpec,typeId){var connectorArgs={_jsPlumb:this._jsPlumb.instance,cssClass:this._jsPlumb.params.cssClass,container:this._jsPlumb.params.container,"pointer-events":this._jsPlumb.params["pointer-events"]},renderMode=this._jsPlumb.instance.getRenderMode(),connector;if(_ju.isString(connectorSpec))
connector=makeConnector(this._jsPlumb.instance,renderMode,connectorSpec,connectorArgs,this);else if(_ju.isArray(connectorSpec)){if(connectorSpec.length==1)
connector=makeConnector(this._jsPlumb.instance,renderMode,connectorSpec[0],connectorArgs,this);else
connector=makeConnector(this._jsPlumb.instance,renderMode,connectorSpec[0],_ju.merge(connectorSpec[1],connectorArgs),this);}
if(typeId!=null)connector.typeId=typeId;return connector;},setPreparedConnector:function(connector,doNotRepaint,doNotChangeListenerComponent,typeId){var previous,previousClasses="";if(this.connector!=null){previous=this.connector;previousClasses=previous.getClass();this.connector.cleanup();this.connector.destroy();}
this.connector=connector;if(typeId){this.cacheTypeItem("connector",connector,typeId);}
this.canvas=this.connector.canvas;this.bgCanvas=this.connector.bgCanvas;this.addClass(previousClasses);if(this.canvas)this.canvas._jsPlumb=this;if(this.bgCanvas)this.bgCanvas._jsPlumb=this;if(previous!=null){var o=this.getOverlays();for(var i=0;i<o.length;i++){if(o[i].transfer)o[i].transfer(this.connector);}}
if(!doNotChangeListenerComponent)this.setListenerComponent(this.connector);if(!doNotRepaint)this.repaint();},setConnector:function(connectorSpec,doNotRepaint,doNotChangeListenerComponent,typeId){var connector=this.prepareConnector(connectorSpec,typeId);this.setPreparedConnector(connector,doNotRepaint,doNotChangeListenerComponent,typeId);},paint:function(params){if(!this._jsPlumb.instance.isSuspendDrawing()&&this._jsPlumb.visible){params=params||{};var timestamp=params.timestamp,swap=false,tId=swap?this.sourceId:this.targetId,sId=swap?this.targetId:this.sourceId,tIdx=swap?0:1,sIdx=swap?1:0;if(timestamp==null||timestamp!=this._jsPlumb.lastPaintedAt){var sourceInfo=this._jsPlumb.instance.updateOffset({elId:sId}).o,targetInfo=this._jsPlumb.instance.updateOffset({elId:tId}).o,sE=this.endpoints[sIdx],tE=this.endpoints[tIdx];var sAnchorP=sE.anchor.getCurrentLocation({xy:[sourceInfo.left,sourceInfo.top],wh:[sourceInfo.width,sourceInfo.height],element:sE,timestamp:timestamp}),tAnchorP=tE.anchor.getCurrentLocation({xy:[targetInfo.left,targetInfo.top],wh:[targetInfo.width,targetInfo.height],element:tE,timestamp:timestamp});this.connector.resetBounds();this.connector.compute({sourcePos:sAnchorP,targetPos:tAnchorP,sourceEndpoint:this.endpoints[sIdx],targetEndpoint:this.endpoints[tIdx],lineWidth:this._jsPlumb.paintStyleInUse.lineWidth,sourceInfo:sourceInfo,targetInfo:targetInfo});var overlayExtents={minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};for(var i in this._jsPlumb.overlays){if(this._jsPlumb.overlays.hasOwnProperty(i)){var o=this._jsPlumb.overlays[i];if(o.isVisible()){this._jsPlumb.overlayPlacements[i]=o.draw(this.connector,this._jsPlumb.paintStyleInUse,this.getAbsoluteOverlayPosition(o));overlayExtents.minX=Math.min(overlayExtents.minX,this._jsPlumb.overlayPlacements[i].minX);overlayExtents.maxX=Math.max(overlayExtents.maxX,this._jsPlumb.overlayPlacements[i].maxX);overlayExtents.minY=Math.min(overlayExtents.minY,this._jsPlumb.overlayPlacements[i].minY);overlayExtents.maxY=Math.max(overlayExtents.maxY,this._jsPlumb.overlayPlacements[i].maxY);}}}
var lineWidth=parseFloat(this._jsPlumb.paintStyleInUse.lineWidth||1)/2,outlineWidth=parseFloat(this._jsPlumb.paintStyleInUse.lineWidth||0),extents={xmin:Math.min(this.connector.bounds.minX-(lineWidth+outlineWidth),overlayExtents.minX),ymin:Math.min(this.connector.bounds.minY-(lineWidth+outlineWidth),overlayExtents.minY),xmax:Math.max(this.connector.bounds.maxX+(lineWidth+outlineWidth),overlayExtents.maxX),ymax:Math.max(this.connector.bounds.maxY+(lineWidth+outlineWidth),overlayExtents.maxY)};this.connector.paint(this._jsPlumb.paintStyleInUse,null,extents);for(var j in this._jsPlumb.overlays){if(this._jsPlumb.overlays.hasOwnProperty(j)){var p=this._jsPlumb.overlays[j];if(p.isVisible()){p.paint(this._jsPlumb.overlayPlacements[j],extents);}}}}
this._jsPlumb.lastPaintedAt=timestamp;}},repaint:function(params){params=params||{};this.paint({elId:this.sourceId,recalc:!(params.recalc===false),timestamp:params.timestamp});},prepareEndpoint:function(_jsPlumb,_newEndpoint,conn,existing,index,params,element,elementId){var e;if(existing){conn.endpoints[index]=existing;existing.addConnection(conn);}else{if(!params.endpoints)params.endpoints=[null,null];var ep=params.endpoints[index]||params.endpoint||_jsPlumb.Defaults.Endpoints[index]||jsPlumb.Defaults.Endpoints[index]||_jsPlumb.Defaults.Endpoint||jsPlumb.Defaults.Endpoint;if(!params.endpointStyles)params.endpointStyles=[null,null];if(!params.endpointHoverStyles)params.endpointHoverStyles=[null,null];var es=params.endpointStyles[index]||params.endpointStyle||_jsPlumb.Defaults.EndpointStyles[index]||jsPlumb.Defaults.EndpointStyles[index]||_jsPlumb.Defaults.EndpointStyle||jsPlumb.Defaults.EndpointStyle;if(es.fillStyle==null&&params.paintStyle!=null)
es.fillStyle=params.paintStyle.strokeStyle;if(es.outlineColor==null&&params.paintStyle!=null)
es.outlineColor=params.paintStyle.outlineColor;if(es.outlineWidth==null&&params.paintStyle!=null)
es.outlineWidth=params.paintStyle.outlineWidth;var ehs=params.endpointHoverStyles[index]||params.endpointHoverStyle||_jsPlumb.Defaults.EndpointHoverStyles[index]||jsPlumb.Defaults.EndpointHoverStyles[index]||_jsPlumb.Defaults.EndpointHoverStyle||jsPlumb.Defaults.EndpointHoverStyle;if(params.hoverPaintStyle!=null){if(ehs==null)ehs={};if(ehs.fillStyle==null){ehs.fillStyle=params.hoverPaintStyle.strokeStyle;}}
var a=params.anchors?params.anchors[index]:params.anchor?params.anchor:_makeAnchor(_jsPlumb.Defaults.Anchors[index],elementId,_jsPlumb)||_makeAnchor(_jp.Defaults.Anchors[index],elementId,_jsPlumb)||_makeAnchor(_jsPlumb.Defaults.Anchor,elementId,_jsPlumb)||_makeAnchor(_jp.Defaults.Anchor,elementId,_jsPlumb),u=params.uuids?params.uuids[index]:null;e=_newEndpoint({paintStyle:es,hoverPaintStyle:ehs,endpoint:ep,connections:[conn],uuid:u,anchor:a,source:element,scope:params.scope,reattach:params.reattach||_jsPlumb.Defaults.ReattachConnections,detachable:params.detachable||_jsPlumb.Defaults.ConnectionsDetachable});conn.endpoints[index]=e;if(params.drawEndpoints===false)e.setVisible(false,true,true);}
return e;}});}).call(this);;(function(){"use strict";var root=this,_ju=root.jsPlumbUtil,_jp=root.jsPlumb;_jp.AnchorManager=function(params){var _amEndpoints={},continuousAnchorLocations={},userDefinedContinuousAnchorLocations={},continuousAnchorOrientations={},Orientation={HORIZONTAL:"horizontal",VERTICAL:"vertical",DIAGONAL:"diagonal",IDENTITY:"identity"},axes=["left","top","right","bottom"],connectionsByElementId={},self=this,anchorLists={},jsPlumbInstance=params.jsPlumbInstance,floatingConnections={},calculateOrientation=function(sourceId,targetId,sd,td,sourceAnchor,targetAnchor){if(sourceId===targetId)return{orientation:Orientation.IDENTITY,a:["top","top"]};var theta=Math.atan2((td.centery-sd.centery),(td.centerx-sd.centerx)),theta2=Math.atan2((sd.centery-td.centery),(sd.centerx-td.centerx));var candidates=[],midpoints={};(function(types,dim){for(var i=0;i<types.length;i++){midpoints[types[i]]={"left":[dim[i].left,dim[i].centery],"right":[dim[i].right,dim[i].centery],"top":[dim[i].centerx,dim[i].top],"bottom":[dim[i].centerx,dim[i].bottom]};}})(["source","target"],[sd,td]);for(var sf=0;sf<axes.length;sf++){for(var tf=0;tf<axes.length;tf++){if(sf!=tf){candidates.push({source:axes[sf],target:axes[tf],dist:Biltong.lineLength(midpoints.source[axes[sf]],midpoints.target[axes[tf]])});}}}
candidates.sort(function(a,b){return a.dist<b.dist?-1:a.dist>b.dist?1:0;});var sourceEdge=candidates[0].source,targetEdge=candidates[0].target;for(var i=0;i<candidates.length;i++){if(!sourceAnchor.isContinuous||sourceAnchor.isEdgeSupported(candidates[i].source))
sourceEdge=candidates[i].source;else
sourceEdge=null;if(!targetAnchor.isContinuous||targetAnchor.isEdgeSupported(candidates[i].target))
targetEdge=candidates[i].target;else{targetEdge=null;}
if(sourceEdge!=null&&targetEdge!=null)break;}
return{a:[sourceEdge,targetEdge],theta:theta,theta2:theta2};},placeAnchorsOnLine=function(desc,elementDimensions,elementPosition,connections,horizontal,otherMultiplier,reverse){var a=[],step=elementDimensions[horizontal?0:1]/(connections.length+1);for(var i=0;i<connections.length;i++){var val=(i+1)*step,other=otherMultiplier*elementDimensions[horizontal?1:0];if(reverse)
val=elementDimensions[horizontal?0:1]-val;var dx=(horizontal?val:other),x=elementPosition[0]+dx,xp=dx/elementDimensions[0],dy=(horizontal?other:val),y=elementPosition[1]+dy,yp=dy/elementDimensions[1];a.push([x,y,xp,yp,connections[i][1],connections[i][2]]);}
return a;},currySort=function(reverseAngles){return function(a,b){var r=true;if(reverseAngles){r=a[0][0]<b[0][0];}
else{r=a[0][0]>b[0][0];}
return r===false?-1:1;};},leftSort=function(a,b){var p1=a[0][0]<0?-Math.PI-a[0][0]:Math.PI-a[0][0],p2=b[0][0]<0?-Math.PI-b[0][0]:Math.PI-b[0][0];if(p1>p2)return 1;else return a[0][1]>b[0][1]?1:-1;},edgeSortFunctions={"top":function(a,b){return a[0]>b[0]?1:-1;},"right":currySort(true),"bottom":currySort(true),"left":leftSort},_sortHelper=function(_array,_fn){return _array.sort(_fn);},placeAnchors=function(elementId,_anchorLists){var cd=jsPlumbInstance.getCachedData(elementId),sS=cd.s,sO=cd.o,placeSomeAnchors=function(desc,elementDimensions,elementPosition,unsortedConnections,isHorizontal,otherMultiplier,orientation){if(unsortedConnections.length>0){var sc=_sortHelper(unsortedConnections,edgeSortFunctions[desc]),reverse=desc==="right"||desc==="top",anchors=placeAnchorsOnLine(desc,elementDimensions,elementPosition,sc,isHorizontal,otherMultiplier,reverse);var _setAnchorLocation=function(endpoint,anchorPos){continuousAnchorLocations[endpoint.id]=[anchorPos[0],anchorPos[1],anchorPos[2],anchorPos[3]];continuousAnchorOrientations[endpoint.id]=orientation;};for(var i=0;i<anchors.length;i++){var c=anchors[i][4],weAreSource=c.endpoints[0].elementId===elementId,weAreTarget=c.endpoints[1].elementId===elementId;if(weAreSource)
_setAnchorLocation(c.endpoints[0],anchors[i]);else if(weAreTarget)
_setAnchorLocation(c.endpoints[1],anchors[i]);}}};placeSomeAnchors("bottom",sS,[sO.left,sO.top],_anchorLists.bottom,true,1,[0,1]);placeSomeAnchors("top",sS,[sO.left,sO.top],_anchorLists.top,true,0,[0,-1]);placeSomeAnchors("left",sS,[sO.left,sO.top],_anchorLists.left,false,0,[-1,0]);placeSomeAnchors("right",sS,[sO.left,sO.top],_anchorLists.right,false,1,[1,0]);};this.reset=function(){_amEndpoints={};connectionsByElementId={};anchorLists={};};this.addFloatingConnection=function(key,conn){floatingConnections[key]=conn;};this.removeFloatingConnection=function(key){delete floatingConnections[key];};this.newConnection=function(conn){var sourceId=conn.sourceId,targetId=conn.targetId,ep=conn.endpoints,doRegisterTarget=true,registerConnection=function(otherIndex,otherEndpoint,otherAnchor,elId,c){if((sourceId==targetId)&&otherAnchor.isContinuous){conn._jsPlumb.instance.removeElement(ep[1].canvas);doRegisterTarget=false;}
_ju.addToList(connectionsByElementId,elId,[c,otherEndpoint,otherAnchor.constructor==_jp.DynamicAnchor]);};registerConnection(0,ep[0],ep[0].anchor,targetId,conn);if(doRegisterTarget)
registerConnection(1,ep[1],ep[1].anchor,sourceId,conn);};var removeEndpointFromAnchorLists=function(endpoint){(function(list,eId){if(list){var f=function(e){return e[4]==eId;};_ju.removeWithFunction(list.top,f);_ju.removeWithFunction(list.left,f);_ju.removeWithFunction(list.bottom,f);_ju.removeWithFunction(list.right,f);}})(anchorLists[endpoint.elementId],endpoint.id);};this.connectionDetached=function(connInfo){var connection=connInfo.connection||connInfo,sourceId=connInfo.sourceId,targetId=connInfo.targetId,ep=connection.endpoints,removeConnection=function(otherIndex,otherEndpoint,otherAnchor,elId,c){if(otherAnchor!=null&&otherAnchor.constructor==_jp.FloatingAnchor){}
else{_ju.removeWithFunction(connectionsByElementId[elId],function(_c){return _c[0].id==c.id;});}};removeConnection(1,ep[1],ep[1].anchor,sourceId,connection);removeConnection(0,ep[0],ep[0].anchor,targetId,connection);removeEndpointFromAnchorLists(connection.endpoints[0]);removeEndpointFromAnchorLists(connection.endpoints[1]);self.redraw(connection.sourceId);self.redraw(connection.targetId);};this.add=function(endpoint,elementId){_ju.addToList(_amEndpoints,elementId,endpoint);};this.changeId=function(oldId,newId){connectionsByElementId[newId]=connectionsByElementId[oldId];_amEndpoints[newId]=_amEndpoints[oldId];delete connectionsByElementId[oldId];delete _amEndpoints[oldId];};this.getConnectionsFor=function(elementId){return connectionsByElementId[elementId]||[];};this.getEndpointsFor=function(elementId){return _amEndpoints[elementId]||[];};this.deleteEndpoint=function(endpoint){_ju.removeWithFunction(_amEndpoints[endpoint.elementId],function(e){return e.id==endpoint.id;});removeEndpointFromAnchorLists(endpoint);};this.clearFor=function(elementId){delete _amEndpoints[elementId];_amEndpoints[elementId]=[];};var _updateAnchorList=function(lists,theta,order,conn,aBoolean,otherElId,idx,reverse,edgeId,elId,connsToPaint,endpointsToPaint){var exactIdx=-1,firstMatchingElIdx=-1,endpoint=conn.endpoints[idx],endpointId=endpoint.id,oIdx=[1,0][idx],values=[[theta,order],conn,aBoolean,otherElId,endpointId],listToAddTo=lists[edgeId],listToRemoveFrom=endpoint._continuousAnchorEdge?lists[endpoint._continuousAnchorEdge]:null,i,candidate;if(listToRemoveFrom){var rIdx=_ju.findWithFunction(listToRemoveFrom,function(e){return e[4]==endpointId;});if(rIdx!=-1){listToRemoveFrom.splice(rIdx,1);for(i=0;i<listToRemoveFrom.length;i++){candidate=listToRemoveFrom[i][1];_ju.addWithFunction(connsToPaint,candidate,function(c){return c.id==candidate.id;});_ju.addWithFunction(endpointsToPaint,listToRemoveFrom[i][1].endpoints[idx],function(e){return e.id==candidate.endpoints[idx].id;});_ju.addWithFunction(endpointsToPaint,listToRemoveFrom[i][1].endpoints[oIdx],function(e){return e.id==candidate.endpoints[oIdx].id;});}}}
for(i=0;i<listToAddTo.length;i++){candidate=listToAddTo[i][1];if(params.idx==1&&listToAddTo[i][3]===otherElId&&firstMatchingElIdx==-1)
firstMatchingElIdx=i;_ju.addWithFunction(connsToPaint,candidate,function(c){return c.id==candidate.id;});_ju.addWithFunction(endpointsToPaint,listToAddTo[i][1].endpoints[idx],function(e){return e.id==candidate.endpoints[idx].id;});_ju.addWithFunction(endpointsToPaint,listToAddTo[i][1].endpoints[oIdx],function(e){return e.id==candidate.endpoints[oIdx].id;});}
if(exactIdx!=-1){listToAddTo[exactIdx]=values;}
else{var insertIdx=reverse?firstMatchingElIdx!=-1?firstMatchingElIdx:0:listToAddTo.length;listToAddTo.splice(insertIdx,0,values);}
endpoint._continuousAnchorEdge=edgeId;};this.updateOtherEndpoint=function(elId,oldTargetId,newTargetId,connection){var sIndex=_ju.findWithFunction(connectionsByElementId[elId],function(i){return i[0].id===connection.id;}),tIndex=_ju.findWithFunction(connectionsByElementId[oldTargetId],function(i){return i[0].id===connection.id;});if(sIndex!=-1){connectionsByElementId[elId][sIndex][0]=connection;connectionsByElementId[elId][sIndex][1]=connection.endpoints[1];connectionsByElementId[elId][sIndex][2]=connection.endpoints[1].anchor.constructor==_jp.DynamicAnchor;}
if(tIndex>-1){connectionsByElementId[oldTargetId].splice(tIndex,1);_ju.addToList(connectionsByElementId,newTargetId,[connection,connection.endpoints[0],connection.endpoints[0].anchor.constructor==_jp.DynamicAnchor]);}
connection.updateConnectedClass();};this.sourceChanged=function(originalId,newId,connection){if(originalId!==newId){_ju.removeWithFunction(connectionsByElementId[originalId],function(info){return info[0].id===connection.id;});var tIdx=_ju.findWithFunction(connectionsByElementId[connection.targetId],function(i){return i[0].id===connection.id;});if(tIdx>-1){connectionsByElementId[connection.targetId][tIdx][0]=connection;connectionsByElementId[connection.targetId][tIdx][1]=connection.endpoints[0];connectionsByElementId[connection.targetId][tIdx][2]=connection.endpoints[0].anchor.constructor==_jp.DynamicAnchor;}
_ju.addToList(connectionsByElementId,newId,[connection,connection.endpoints[1],connection.endpoints[1].anchor.constructor==_jp.DynamicAnchor]);if(connection.endpoints[1].anchor.isContinuous){if(connection.source===connection.target){connection._jsPlumb.instance.removeElement(connection.endpoints[1].canvas);}
else{if(connection.endpoints[1].canvas.parentNode==null){connection._jsPlumb.instance.appendElement(connection.endpoints[1].canvas);}}}
connection.updateConnectedClass();}};this.rehomeEndpoint=function(ep,currentId,element){var eps=_amEndpoints[currentId]||[],elementId=jsPlumbInstance.getId(element);if(elementId!==currentId){var idx=_ju.indexOf(eps,ep);if(idx>-1){var _ep=eps.splice(idx,1)[0];self.add(_ep,elementId);}}
for(var i=0;i<ep.connections.length;i++){if(ep.connections[i].sourceId==currentId){ep.connections[i].sourceId=ep.elementId;ep.connections[i].source=ep.element;self.sourceChanged(currentId,ep.elementId,ep.connections[i]);}
else if(ep.connections[i].targetId==currentId){ep.connections[i].targetId=ep.elementId;ep.connections[i].target=ep.element;self.updateOtherEndpoint(ep.connections[i].sourceId,currentId,ep.elementId,ep.connections[i]);}}};this.redraw=function(elementId,ui,timestamp,offsetToUI,clearEdits,doNotRecalcEndpoint){if(!jsPlumbInstance.isSuspendDrawing()){var ep=_amEndpoints[elementId]||[],endpointConnections=connectionsByElementId[elementId]||[],connectionsToPaint=[],endpointsToPaint=[],anchorsToUpdate=[];timestamp=timestamp||jsPlumbInstance.timestamp();offsetToUI=offsetToUI||{left:0,top:0};if(ui){ui={left:ui.left+offsetToUI.left,top:ui.top+offsetToUI.top};}
var myOffset=jsPlumbInstance.updateOffset({elId:elementId,offset:ui,recalc:false,timestamp:timestamp}),orientationCache={};for(var i=0;i<endpointConnections.length;i++){var conn=endpointConnections[i][0],sourceId=conn.sourceId,targetId=conn.targetId,sourceContinuous=conn.endpoints[0].anchor.isContinuous,targetContinuous=conn.endpoints[1].anchor.isContinuous;if(sourceContinuous||targetContinuous){var oKey=sourceId+"_"+targetId,o=orientationCache[oKey],oIdx=conn.sourceId==elementId?1:0;if(sourceContinuous&&!anchorLists[sourceId])anchorLists[sourceId]={top:[],right:[],bottom:[],left:[]};if(targetContinuous&&!anchorLists[targetId])anchorLists[targetId]={top:[],right:[],bottom:[],left:[]};if(elementId!=targetId)jsPlumbInstance.updateOffset({elId:targetId,timestamp:timestamp});if(elementId!=sourceId)jsPlumbInstance.updateOffset({elId:sourceId,timestamp:timestamp});var td=jsPlumbInstance.getCachedData(targetId),sd=jsPlumbInstance.getCachedData(sourceId);if(targetId==sourceId&&(sourceContinuous||targetContinuous)){_updateAnchorList(anchorLists[sourceId],-Math.PI/2,0,conn,false,targetId,0,false,"top",sourceId,connectionsToPaint,endpointsToPaint);}
else{if(!o){o=calculateOrientation(sourceId,targetId,sd.o,td.o,conn.endpoints[0].anchor,conn.endpoints[1].anchor);orientationCache[oKey]=o;}
if(sourceContinuous)_updateAnchorList(anchorLists[sourceId],o.theta,0,conn,false,targetId,0,false,o.a[0],sourceId,connectionsToPaint,endpointsToPaint);if(targetContinuous)_updateAnchorList(anchorLists[targetId],o.theta2,-1,conn,true,sourceId,1,true,o.a[1],targetId,connectionsToPaint,endpointsToPaint);}
if(sourceContinuous)_ju.addWithFunction(anchorsToUpdate,sourceId,function(a){return a===sourceId;});if(targetContinuous)_ju.addWithFunction(anchorsToUpdate,targetId,function(a){return a===targetId;});_ju.addWithFunction(connectionsToPaint,conn,function(c){return c.id==conn.id;});if((sourceContinuous&&oIdx===0)||(targetContinuous&&oIdx===1))
_ju.addWithFunction(endpointsToPaint,conn.endpoints[oIdx],function(e){return e.id==conn.endpoints[oIdx].id;});}}
for(i=0;i<ep.length;i++){if(ep[i].connections.length===0&&ep[i].anchor.isContinuous){if(!anchorLists[elementId])anchorLists[elementId]={top:[],right:[],bottom:[],left:[]};_updateAnchorList(anchorLists[elementId],-Math.PI/2,0,{endpoints:[ep[i],ep[i]],paint:function(){}},false,elementId,0,false,ep[i].anchor.getDefaultFace(),elementId,connectionsToPaint,endpointsToPaint);_ju.addWithFunction(anchorsToUpdate,elementId,function(a){return a===elementId;});}}
for(i=0;i<anchorsToUpdate.length;i++){placeAnchors(anchorsToUpdate[i],anchorLists[anchorsToUpdate[i]]);}
for(i=0;i<ep.length;i++){ep[i].paint({timestamp:timestamp,offset:myOffset,dimensions:myOffset.s,recalc:doNotRecalcEndpoint!==true});}
for(i=0;i<endpointsToPaint.length;i++){var cd=jsPlumbInstance.getCachedData(endpointsToPaint[i].elementId);endpointsToPaint[i].paint({timestamp:timestamp,offset:cd,dimensions:cd.s});}
for(i=0;i<endpointConnections.length;i++){var otherEndpoint=endpointConnections[i][1];if(otherEndpoint.anchor.constructor==_jp.DynamicAnchor){otherEndpoint.paint({elementWithPrecedence:elementId,timestamp:timestamp});_ju.addWithFunction(connectionsToPaint,endpointConnections[i][0],function(c){return c.id==endpointConnections[i][0].id;});for(var k=0;k<otherEndpoint.connections.length;k++){if(otherEndpoint.connections[k]!==endpointConnections[i][0])
_ju.addWithFunction(connectionsToPaint,otherEndpoint.connections[k],function(c){return c.id==otherEndpoint.connections[k].id;});}}else if(otherEndpoint.anchor.constructor==_jp.Anchor){_ju.addWithFunction(connectionsToPaint,endpointConnections[i][0],function(c){return c.id==endpointConnections[i][0].id;});}}
var fc=floatingConnections[elementId];if(fc)
fc.paint({timestamp:timestamp,recalc:false,elId:elementId});for(i=0;i<connectionsToPaint.length;i++){connectionsToPaint[i].paint({elId:elementId,timestamp:timestamp,recalc:false,clearEdits:clearEdits});}}};var ContinuousAnchor=function(anchorParams){_ju.EventGenerator.apply(this);this.type="Continuous";this.isDynamic=true;this.isContinuous=true;var faces=anchorParams.faces||["top","right","bottom","left"],clockwise=!(anchorParams.clockwise===false),availableFaces={},opposites={"top":"bottom","right":"left","left":"right","bottom":"top"},clockwiseOptions={"top":"right","right":"bottom","left":"top","bottom":"left"},antiClockwiseOptions={"top":"left","right":"top","left":"bottom","bottom":"right"},secondBest=clockwise?clockwiseOptions:antiClockwiseOptions,lastChoice=clockwise?antiClockwiseOptions:clockwiseOptions,cssClass=anchorParams.cssClass||"";for(var i=0;i<faces.length;i++){availableFaces[faces[i]]=true;}
this.getDefaultFace=function(){return faces.length===0?"top":faces[0];};this.verifyEdge=function(edge){if(availableFaces[edge])return edge;else if(availableFaces[opposites[edge]])return opposites[edge];else if(availableFaces[secondBest[edge]])return secondBest[edge];else if(availableFaces[lastChoice[edge]])return lastChoice[edge];return edge;};this.isEdgeSupported=function(edge){return availableFaces[edge]===true;};this.compute=function(params){return userDefinedContinuousAnchorLocations[params.element.id]||continuousAnchorLocations[params.element.id]||[0,0];};this.getCurrentLocation=function(params){return userDefinedContinuousAnchorLocations[params.element.id]||continuousAnchorLocations[params.element.id]||[0,0];};this.getOrientation=function(endpoint){return continuousAnchorOrientations[endpoint.id]||[0,0];};this.clearUserDefinedLocation=function(){delete userDefinedContinuousAnchorLocations[anchorParams.elementId];};this.setUserDefinedLocation=function(loc){userDefinedContinuousAnchorLocations[anchorParams.elementId]=loc;};this.getCssClass=function(){return cssClass;};};jsPlumbInstance.continuousAnchorFactory={get:function(params){return new ContinuousAnchor(params);},clear:function(elementId){delete userDefinedContinuousAnchorLocations[elementId];delete continuousAnchorLocations[elementId];}};};_jp.Anchor=function(params){this.x=params.x||0;this.y=params.y||0;this.elementId=params.elementId;this.cssClass=params.cssClass||"";this.userDefinedLocation=null;this.orientation=params.orientation||[0,0];this.lastReturnValue=null;this.offsets=params.offsets||[0,0];this.timestamp=null;_ju.EventGenerator.apply(this);this.compute=function(params){var xy=params.xy,wh=params.wh,timestamp=params.timestamp;if(params.clearUserDefinedLocation)
this.userDefinedLocation=null;if(timestamp&&timestamp===self.timestamp)
return this.lastReturnValue;if(this.userDefinedLocation!=null){this.lastReturnValue=this.userDefinedLocation;}
else{this.lastReturnValue=[xy[0]+(this.x*wh[0])+this.offsets[0],xy[1]+(this.y*wh[1])+this.offsets[1]];}
this.timestamp=timestamp;return this.lastReturnValue;};this.getCurrentLocation=function(params){return(this.lastReturnValue==null||(params.timestamp!=null&&this.timestamp!=params.timestamp))?this.compute(params):this.lastReturnValue;};};_ju.extend(_jp.Anchor,_ju.EventGenerator,{equals:function(anchor){if(!anchor)return false;var ao=anchor.getOrientation(),o=this.getOrientation();return this.x==anchor.x&&this.y==anchor.y&&this.offsets[0]==anchor.offsets[0]&&this.offsets[1]==anchor.offsets[1]&&o[0]==ao[0]&&o[1]==ao[1];},getUserDefinedLocation:function(){return this.userDefinedLocation;},setUserDefinedLocation:function(l){this.userDefinedLocation=l;},clearUserDefinedLocation:function(){this.userDefinedLocation=null;},getOrientation:function(){return this.orientation;},getCssClass:function(){return this.cssClass;}});_jp.FloatingAnchor=function(params){_jp.Anchor.apply(this,arguments);var ref=params.reference,refCanvas=params.referenceCanvas,size=_jp.getSize(refCanvas),xDir=0,yDir=0,orientation=null,_lastResult=null;this.orientation=null;this.x=0;this.y=0;this.isFloating=true;this.compute=function(params){var xy=params.xy,result=[xy[0]+(size[0]/2),xy[1]+(size[1]/2)];_lastResult=result;return result;};this.getOrientation=function(_endpoint){if(orientation)return orientation;else{var o=ref.getOrientation(_endpoint);return[Math.abs(o[0])*xDir*-1,Math.abs(o[1])*yDir*-1];}};this.over=function(anchor,endpoint){orientation=anchor.getOrientation(endpoint);};this.out=function(){orientation=null;};this.getCurrentLocation=function(params){return _lastResult==null?this.compute(params):_lastResult;};};_ju.extend(_jp.FloatingAnchor,_jp.Anchor);var _convertAnchor=function(anchor,jsPlumbInstance,elementId){return anchor.constructor==_jp.Anchor?anchor:jsPlumbInstance.makeAnchor(anchor,elementId,jsPlumbInstance);};_jp.DynamicAnchor=function(params){_jp.Anchor.apply(this,arguments);this.isDynamic=true;this.anchors=[];this.elementId=params.elementId;this.jsPlumbInstance=params.jsPlumbInstance;for(var i=0;i<params.anchors.length;i++)
this.anchors[i]=_convertAnchor(params.anchors[i],this.jsPlumbInstance,this.elementId);this.getAnchors=function(){return this.anchors;};this.locked=false;var _curAnchor=this.anchors.length>0?this.anchors[0]:null,_lastAnchor=_curAnchor,self=this,_distance=function(anchor,cx,cy,xy,wh){var ax=xy[0]+(anchor.x*wh[0]),ay=xy[1]+(anchor.y*wh[1]),acx=xy[0]+(wh[0]/2),acy=xy[1]+(wh[1]/2);return(Math.sqrt(Math.pow(cx-ax,2)+Math.pow(cy-ay,2))+
Math.sqrt(Math.pow(acx-ax,2)+Math.pow(acy-ay,2)));},_anchorSelector=params.selector||function(xy,wh,txy,twh,anchors){var cx=txy[0]+(twh[0]/2),cy=txy[1]+(twh[1]/2);var minIdx=-1,minDist=Infinity;for(var i=0;i<anchors.length;i++){var d=_distance(anchors[i],cx,cy,xy,wh);if(d<minDist){minIdx=i+0;minDist=d;}}
return anchors[minIdx];};this.compute=function(params){var xy=params.xy,wh=params.wh,txy=params.txy,twh=params.twh;this.timestamp=params.timestamp;var udl=self.getUserDefinedLocation();if(udl!=null){return udl;}
if(this.locked||txy==null||twh==null)
return _curAnchor.compute(params);else
params.timestamp=null;_curAnchor=_anchorSelector(xy,wh,txy,twh,this.anchors);this.x=_curAnchor.x;this.y=_curAnchor.y;if(_curAnchor!=_lastAnchor)
this.fire("anchorChanged",_curAnchor);_lastAnchor=_curAnchor;return _curAnchor.compute(params);};this.getCurrentLocation=function(params){return this.getUserDefinedLocation()||(_curAnchor!=null?_curAnchor.getCurrentLocation(params):null);};this.getOrientation=function(_endpoint){return _curAnchor!=null?_curAnchor.getOrientation(_endpoint):[0,0];};this.over=function(anchor,endpoint){if(_curAnchor!=null)_curAnchor.over(anchor,endpoint);};this.out=function(){if(_curAnchor!=null)_curAnchor.out();};this.getCssClass=function(){return(_curAnchor&&_curAnchor.getCssClass())||"";};};_ju.extend(_jp.DynamicAnchor,_jp.Anchor);var _curryAnchor=function(x,y,ox,oy,type,fnInit){_jp.Anchors[type]=function(params){var a=params.jsPlumbInstance.makeAnchor([x,y,ox,oy,0,0],params.elementId,params.jsPlumbInstance);a.type=type;if(fnInit)fnInit(a,params);return a;};};_curryAnchor(0.5,0,0,-1,"TopCenter");_curryAnchor(0.5,1,0,1,"BottomCenter");_curryAnchor(0,0.5,-1,0,"LeftMiddle");_curryAnchor(1,0.5,1,0,"RightMiddle");_curryAnchor(0.5,0,0,-1,"Top");_curryAnchor(0.5,1,0,1,"Bottom");_curryAnchor(0,0.5,-1,0,"Left");_curryAnchor(1,0.5,1,0,"Right");_curryAnchor(0.5,0.5,0,0,"Center");_curryAnchor(1,0,0,-1,"TopRight");_curryAnchor(1,1,0,1,"BottomRight");_curryAnchor(0,0,0,-1,"TopLeft");_curryAnchor(0,1,0,1,"BottomLeft");_jp.Defaults.DynamicAnchors=function(params){return params.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],params.elementId,params.jsPlumbInstance);};_jp.Anchors.AutoDefault=function(params){var a=params.jsPlumbInstance.makeDynamicAnchor(_jp.Defaults.DynamicAnchors(params));a.type="AutoDefault";return a;};var _curryContinuousAnchor=function(type,faces){_jp.Anchors[type]=function(params){var a=params.jsPlumbInstance.makeAnchor(["Continuous",{faces:faces}],params.elementId,params.jsPlumbInstance);a.type=type;return a;};};_jp.Anchors.Continuous=function(params){return params.jsPlumbInstance.continuousAnchorFactory.get(params);};_curryContinuousAnchor("ContinuousLeft",["left"]);_curryContinuousAnchor("ContinuousTop",["top"]);_curryContinuousAnchor("ContinuousBottom",["bottom"]);_curryContinuousAnchor("ContinuousRight",["right"]);_curryAnchor(0,0,0,0,"Assign",function(anchor,params){var pf=params.position||"Fixed";anchor.positionFinder=pf.constructor==String?params.jsPlumbInstance.AnchorPositionFinders[pf]:pf;anchor.constructorParams=params;});jsPlumbInstance.prototype.AnchorPositionFinders={"Fixed":function(dp,ep,es){return[(dp.left-ep.left)/es[0],(dp.top-ep.top)/es[1]];},"Grid":function(dp,ep,es,params){var dx=dp.left-ep.left,dy=dp.top-ep.top,gx=es[0]/(params.grid[0]),gy=es[1]/(params.grid[1]),mx=Math.floor(dx/gx),my=Math.floor(dy/gy);return[((mx*gx)+(gx/2))/es[0],((my*gy)+(gy/2))/es[1]];}};_jp.Anchors.Perimeter=function(params){params=params||{};var anchorCount=params.anchorCount||60,shape=params.shape;if(!shape)throw new Error("no shape supplied to Perimeter Anchor type");var _circle=function(){var r=0.5,step=Math.PI*2/anchorCount,current=0,a=[];for(var i=0;i<anchorCount;i++){var x=r+(r*Math.sin(current)),y=r+(r*Math.cos(current));a.push([x,y,0,0]);current+=step;}
return a;},_path=function(segments){var anchorsPerFace=anchorCount/segments.length,a=[],_computeFace=function(x1,y1,x2,y2,fractionalLength){anchorsPerFace=anchorCount*fractionalLength;var dx=(x2-x1)/anchorsPerFace,dy=(y2-y1)/anchorsPerFace;for(var i=0;i<anchorsPerFace;i++){a.push([x1+(dx*i),y1+(dy*i),0,0]);}};for(var i=0;i<segments.length;i++)
_computeFace.apply(null,segments[i]);return a;},_shape=function(faces){var s=[];for(var i=0;i<faces.length;i++){s.push([faces[i][0],faces[i][1],faces[i][2],faces[i][3],1/faces.length]);}
return _path(s);},_rectangle=function(){return _shape([[0,0,1,0],[1,0,1,1],[1,1,0,1],[0,1,0,0]]);};var _shapes={"Circle":_circle,"Ellipse":_circle,"Diamond":function(){return _shape([[0.5,0,1,0.5],[1,0.5,0.5,1],[0.5,1,0,0.5],[0,0.5,0.5,0]]);},"Rectangle":_rectangle,"Square":_rectangle,"Triangle":function(){return _shape([[0.5,0,1,1],[1,1,0,1],[0,1,0.5,0]]);},"Path":function(params){var points=params.points,p=[],tl=0;for(var i=0;i<points.length-1;i++){var l=Math.sqrt(Math.pow(points[i][2]-points[i][0])+Math.pow(points[i][3]-points[i][1]));tl+=l;p.push([points[i][0],points[i][1],points[i+1][0],points[i+1][1],l]);}
for(var j=0;j<p.length;j++){p[j][4]=p[j][4]/tl;}
return _path(p);}},_rotate=function(points,amountInDegrees){var o=[],theta=amountInDegrees/180*Math.PI;for(var i=0;i<points.length;i++){var _x=points[i][0]-0.5,_y=points[i][1]-0.5;o.push([0.5+((_x*Math.cos(theta))-(_y*Math.sin(theta))),0.5+((_x*Math.sin(theta))+(_y*Math.cos(theta))),points[i][2],points[i][3]]);}
return o;};if(!_shapes[shape])throw new Error("Shape ["+shape+"] is unknown by Perimeter Anchor type");var da=_shapes[shape](params);if(params.rotation)da=_rotate(da,params.rotation);var a=params.jsPlumbInstance.makeDynamicAnchor(da);a.type="Perimeter";return a;};}).call(this);;(function(){"use strict";var root=this,_jp=root.jsPlumb,_ju=root.jsPlumbUtil,_jg=root.Biltong;_jp.Segments={AbstractSegment:function(params){this.params=params;this.findClosestPointOnPath=function(x,y){return{d:Infinity,x:null,y:null,l:null};};this.getBounds=function(){return{minX:Math.min(params.x1,params.x2),minY:Math.min(params.y1,params.y2),maxX:Math.max(params.x1,params.x2),maxY:Math.max(params.y1,params.y2)};};},Straight:function(params){var _super=_jp.Segments.AbstractSegment.apply(this,arguments),length,m,m2,x1,x2,y1,y2,_recalc=function(){length=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2));m=_jg.gradient({x:x1,y:y1},{x:x2,y:y2});m2=-1/m;};this.type="Straight";this.getLength=function(){return length;};this.getGradient=function(){return m;};this.getCoordinates=function(){return{x1:x1,y1:y1,x2:x2,y2:y2};};this.setCoordinates=function(coords){x1=coords.x1;y1=coords.y1;x2=coords.x2;y2=coords.y2;_recalc();};this.setCoordinates({x1:params.x1,y1:params.y1,x2:params.x2,y2:params.y2});this.getBounds=function(){return{minX:Math.min(x1,x2),minY:Math.min(y1,y2),maxX:Math.max(x1,x2),maxY:Math.max(y1,y2)};};this.pointOnPath=function(location,absolute){if(location===0&&!absolute)
return{x:x1,y:y1};else if(location==1&&!absolute)
return{x:x2,y:y2};else{var l=absolute?location>0?location:length+location:location*length;return _jg.pointOnLine({x:x1,y:y1},{x:x2,y:y2},l);}};this.gradientAtPoint=function(_){return m;};this.pointAlongPathFrom=function(location,distance,absolute){var p=this.pointOnPath(location,absolute),farAwayPoint=distance<=0?{x:x1,y:y1}:{x:x2,y:y2};if(distance<=0&&Math.abs(distance)>1)distance*=-1;return _jg.pointOnLine(p,farAwayPoint,distance);};var within=function(a,b,c){return c>=Math.min(a,b)&&c<=Math.max(a,b);};var closest=function(a,b,c){return Math.abs(c-a)<Math.abs(c-b)?a:b;};this.findClosestPointOnPath=function(x,y){var out={d:Infinity,x:null,y:null,l:null,x1:x1,x2:x2,y1:y1,y2:y2};if(m===0){out.y=y1;out.x=within(x1,x2,x)?x:closest(x1,x2,x);}
else if(m==Infinity||m==-Infinity){out.x=x1;out.y=within(y1,y2,y)?y:closest(y1,y2,y);}
else{var b=y1-(m*x1),b2=y-(m2*x),_x1=(b2-b)/(m-m2),_y1=(m*_x1)+b;out.x=within(x1,x2,_x1)?_x1:closest(x1,x2,_x1);out.y=within(y1,y2,_y1)?_y1:closest(y1,y2,_y1);}
var fractionInSegment=_jg.lineLength([out.x,out.y],[x1,y1]);out.d=_jg.lineLength([x,y],[out.x,out.y]);out.l=fractionInSegment/length;return out;};},Arc:function(params){var _super=_jp.Segments.AbstractSegment.apply(this,arguments),_calcAngle=function(_x,_y){return _jg.theta([params.cx,params.cy],[_x,_y]);},_calcAngleForLocation=function(segment,location){if(segment.anticlockwise){var sa=segment.startAngle<segment.endAngle?segment.startAngle+TWO_PI:segment.startAngle,s=Math.abs(sa-segment.endAngle);return sa-(s*location);}
else{var ea=segment.endAngle<segment.startAngle?segment.endAngle+TWO_PI:segment.endAngle,ss=Math.abs(ea-segment.startAngle);return segment.startAngle+(ss*location);}},TWO_PI=2*Math.PI;this.radius=params.r;this.anticlockwise=params.ac;this.type="Arc";if(params.startAngle&&params.endAngle){this.startAngle=params.startAngle;this.endAngle=params.endAngle;this.x1=params.cx+(this.radius*Math.cos(params.startAngle));this.y1=params.cy+(this.radius*Math.sin(params.startAngle));this.x2=params.cx+(this.radius*Math.cos(params.endAngle));this.y2=params.cy+(this.radius*Math.sin(params.endAngle));}
else{this.startAngle=_calcAngle(params.x1,params.y1);this.endAngle=_calcAngle(params.x2,params.y2);this.x1=params.x1;this.y1=params.y1;this.x2=params.x2;this.y2=params.y2;}
if(this.endAngle<0)this.endAngle+=TWO_PI;if(this.startAngle<0)this.startAngle+=TWO_PI;this.segment=_jg.quadrant([this.x1,this.y1],[this.x2,this.y2]);var ea=this.endAngle<this.startAngle?this.endAngle+TWO_PI:this.endAngle;this.sweep=Math.abs(ea-this.startAngle);if(this.anticlockwise)this.sweep=TWO_PI-this.sweep;var circumference=2*Math.PI*this.radius,frac=this.sweep/TWO_PI,length=circumference*frac;this.getLength=function(){return length;};this.getBounds=function(){return{minX:params.cx-params.r,maxX:params.cx+params.r,minY:params.cy-params.r,maxY:params.cy+params.r};};var VERY_SMALL_VALUE=0.0000000001,gentleRound=function(n){var f=Math.floor(n),r=Math.ceil(n);if(n-f<VERY_SMALL_VALUE)
return f;else if(r-n<VERY_SMALL_VALUE)
return r;return n;};this.pointOnPath=function(location,absolute){if(location===0){return{x:this.x1,y:this.y1,theta:this.startAngle};}
else if(location==1){return{x:this.x2,y:this.y2,theta:this.endAngle};}
if(absolute){location=location/length;}
var angle=_calcAngleForLocation(this,location),_x=params.cx+(params.r*Math.cos(angle)),_y=params.cy+(params.r*Math.sin(angle));return{x:gentleRound(_x),y:gentleRound(_y),theta:angle};};this.gradientAtPoint=function(location,absolute){var p=this.pointOnPath(location,absolute);var m=_jg.normal([params.cx,params.cy],[p.x,p.y]);if(!this.anticlockwise&&(m==Infinity||m==-Infinity))m*=-1;return m;};this.pointAlongPathFrom=function(location,distance,absolute){var p=this.pointOnPath(location,absolute),arcSpan=distance/circumference*2*Math.PI,dir=this.anticlockwise?-1:1,startAngle=p.theta+(dir*arcSpan),startX=params.cx+(this.radius*Math.cos(startAngle)),startY=params.cy+(this.radius*Math.sin(startAngle));return{x:startX,y:startY};};},Bezier:function(params){this.curve=[{x:params.x1,y:params.y1},{x:params.cp1x,y:params.cp1y},{x:params.cp2x,y:params.cp2y},{x:params.x2,y:params.y2}];var _super=_jp.Segments.AbstractSegment.apply(this,arguments);this.bounds={minX:Math.min(params.x1,params.x2,params.cp1x,params.cp2x),minY:Math.min(params.y1,params.y2,params.cp1y,params.cp2y),maxX:Math.max(params.x1,params.x2,params.cp1x,params.cp2x),maxY:Math.max(params.y1,params.y2,params.cp1y,params.cp2y)};this.type="Bezier";var _translateLocation=function(_curve,location,absolute){if(absolute)
location=root.jsBezier.locationAlongCurveFrom(_curve,location>0?0:1,location);return location;};this.pointOnPath=function(location,absolute){location=_translateLocation(this.curve,location,absolute);return root.jsBezier.pointOnCurve(this.curve,location);};this.gradientAtPoint=function(location,absolute){location=_translateLocation(this.curve,location,absolute);return root.jsBezier.gradientAtPoint(this.curve,location);};this.pointAlongPathFrom=function(location,distance,absolute){location=_translateLocation(this.curve,location,absolute);return root.jsBezier.pointAlongCurveFrom(this.curve,location,distance);};this.getLength=function(){return root.jsBezier.getLength(this.curve);};this.getBounds=function(){return this.bounds;};}};var AbstractComponent=function(){this.resetBounds=function(){this.bounds={minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};};this.resetBounds();};_jp.Connectors.AbstractConnector=function(params){AbstractComponent.apply(this,arguments);var segments=[],totalLength=0,segmentProportions=[],segmentProportionalLengths=[],stub=params.stub||0,sourceStub=_ju.isArray(stub)?stub[0]:stub,targetStub=_ju.isArray(stub)?stub[1]:stub,gap=params.gap||0,sourceGap=_ju.isArray(gap)?gap[0]:gap,targetGap=_ju.isArray(gap)?gap[1]:gap,userProvidedSegments=null,edited=false,paintInfo=null;this.getPath=function(){};this.setPath=function(path){};this.findSegmentForPoint=function(x,y){var out={d:Infinity,s:null,x:null,y:null,l:null};for(var i=0;i<segments.length;i++){var _s=segments[i].findClosestPointOnPath(x,y);if(_s.d<out.d){out.d=_s.d;out.l=_s.l;out.x=_s.x;out.y=_s.y;out.s=segments[i];out.x1=_s.x1;out.x2=_s.x2;out.y1=_s.y1;out.y2=_s.y2;out.index=i;}}
return out;};var _updateSegmentProportions=function(){var curLoc=0;for(var i=0;i<segments.length;i++){var sl=segments[i].getLength();segmentProportionalLengths[i]=sl/totalLength;segmentProportions[i]=[curLoc,(curLoc+=(sl/totalLength))];}},_findSegmentForLocation=function(location,absolute){if(absolute){location=location>0?location/totalLength:(totalLength+location)/totalLength;}
var idx=segmentProportions.length-1,inSegmentProportion=1;for(var i=0;i<segmentProportions.length;i++){if(segmentProportions[i][1]>=location){idx=i;inSegmentProportion=location==1?1:location===0?0:(location-segmentProportions[i][0])/segmentProportionalLengths[i];break;}}
return{segment:segments[idx],proportion:inSegmentProportion,index:idx};},_addSegment=function(conn,type,params){if(params.x1==params.x2&&params.y1==params.y2)return;var s=new _jp.Segments[type](params);segments.push(s);totalLength+=s.getLength();conn.updateBounds(s);},_clearSegments=function(){totalLength=segments.length=segmentProportions.length=segmentProportionalLengths.length=0;};this.setSegments=function(_segs){userProvidedSegments=[];totalLength=0;for(var i=0;i<_segs.length;i++){userProvidedSegments.push(_segs[i]);totalLength+=_segs[i].getLength();}};this.getLength=function(){return totalLength;};var _prepareCompute=function(params){this.lineWidth=params.lineWidth;var segment=_jg.quadrant(params.sourcePos,params.targetPos),swapX=params.targetPos[0]<params.sourcePos[0],swapY=params.targetPos[1]<params.sourcePos[1],lw=params.lineWidth||1,so=params.sourceEndpoint.anchor.getOrientation(params.sourceEndpoint),to=params.targetEndpoint.anchor.getOrientation(params.targetEndpoint),x=swapX?params.targetPos[0]:params.sourcePos[0],y=swapY?params.targetPos[1]:params.sourcePos[1],w=Math.abs(params.targetPos[0]-params.sourcePos[0]),h=Math.abs(params.targetPos[1]-params.sourcePos[1]);if(so[0]===0&&so[1]===0||to[0]===0&&to[1]===0){var index=w>h?0:1,oIndex=[1,0][index];so=[];to=[];so[index]=params.sourcePos[index]>params.targetPos[index]?-1:1;to[index]=params.sourcePos[index]>params.targetPos[index]?1:-1;so[oIndex]=0;to[oIndex]=0;}
var sx=swapX?w+(sourceGap*so[0]):sourceGap*so[0],sy=swapY?h+(sourceGap*so[1]):sourceGap*so[1],tx=swapX?targetGap*to[0]:w+(targetGap*to[0]),ty=swapY?targetGap*to[1]:h+(targetGap*to[1]),oProduct=((so[0]*to[0])+(so[1]*to[1]));var result={sx:sx,sy:sy,tx:tx,ty:ty,lw:lw,xSpan:Math.abs(tx-sx),ySpan:Math.abs(ty-sy),mx:(sx+tx)/2,my:(sy+ty)/2,so:so,to:to,x:x,y:y,w:w,h:h,segment:segment,startStubX:sx+(so[0]*sourceStub),startStubY:sy+(so[1]*sourceStub),endStubX:tx+(to[0]*targetStub),endStubY:ty+(to[1]*targetStub),isXGreaterThanStubTimes2:Math.abs(sx-tx)>(sourceStub+targetStub),isYGreaterThanStubTimes2:Math.abs(sy-ty)>(sourceStub+targetStub),opposite:oProduct==-1,perpendicular:oProduct===0,orthogonal:oProduct==1,sourceAxis:so[0]===0?"y":"x",points:[x,y,w,h,sx,sy,tx,ty]};result.anchorOrientation=result.opposite?"opposite":result.orthogonal?"orthogonal":"perpendicular";return result;};this.getSegments=function(){return segments;};this.updateBounds=function(segment){var segBounds=segment.getBounds();this.bounds.minX=Math.min(this.bounds.minX,segBounds.minX);this.bounds.maxX=Math.max(this.bounds.maxX,segBounds.maxX);this.bounds.minY=Math.min(this.bounds.minY,segBounds.minY);this.bounds.maxY=Math.max(this.bounds.maxY,segBounds.maxY);};var dumpSegmentsToConsole=function(){console.log("SEGMENTS:");for(var i=0;i<segments.length;i++){console.log(segments[i].type,segments[i].getLength(),segmentProportions[i]);}};this.pointOnPath=function(location,absolute){var seg=_findSegmentForLocation(location,absolute);return seg.segment&&seg.segment.pointOnPath(seg.proportion,false)||[0,0];};this.gradientAtPoint=function(location,absolute){var seg=_findSegmentForLocation(location,absolute);return seg.segment&&seg.segment.gradientAtPoint(seg.proportion,false)||0;};this.pointAlongPathFrom=function(location,distance,absolute){var seg=_findSegmentForLocation(location,absolute);return seg.segment&&seg.segment.pointAlongPathFrom(seg.proportion,distance,false)||[0,0];};this.compute=function(params){if(!edited)
paintInfo=_prepareCompute.call(this,params);_clearSegments();this._compute(paintInfo,params);this.x=paintInfo.points[0];this.y=paintInfo.points[1];this.w=paintInfo.points[2];this.h=paintInfo.points[3];this.segment=paintInfo.segment;_updateSegmentProportions();};return{addSegment:_addSegment,prepareCompute:_prepareCompute,sourceStub:sourceStub,targetStub:targetStub,maxStub:Math.max(sourceStub,targetStub),sourceGap:sourceGap,targetGap:targetGap,maxGap:Math.max(sourceGap,targetGap)};};_ju.extend(_jp.Connectors.AbstractConnector,AbstractComponent);var Straight=_jp.Connectors.Straight=function(){this.type="Straight";var _super=_jp.Connectors.AbstractConnector.apply(this,arguments);this._compute=function(paintInfo,_){_super.addSegment(this,"Straight",{x1:paintInfo.sx,y1:paintInfo.sy,x2:paintInfo.startStubX,y2:paintInfo.startStubY});_super.addSegment(this,"Straight",{x1:paintInfo.startStubX,y1:paintInfo.startStubY,x2:paintInfo.endStubX,y2:paintInfo.endStubY});_super.addSegment(this,"Straight",{x1:paintInfo.endStubX,y1:paintInfo.endStubY,x2:paintInfo.tx,y2:paintInfo.ty});};};_ju.extend(_jp.Connectors.Straight,_jp.Connectors.AbstractConnector);_jp.registerConnectorType(Straight,"Straight");_jp.Endpoints.AbstractEndpoint=function(params){AbstractComponent.apply(this,arguments);var compute=this.compute=function(anchorPoint,orientation,endpointStyle,connectorPaintStyle){var out=this._compute.apply(this,arguments);this.x=out[0];this.y=out[1];this.w=out[2];this.h=out[3];this.bounds.minX=this.x;this.bounds.minY=this.y;this.bounds.maxX=this.x+this.w;this.bounds.maxY=this.y+this.h;return out;};return{compute:compute,cssClass:params.cssClass};};_ju.extend(_jp.Endpoints.AbstractEndpoint,AbstractComponent);_jp.Endpoints.Dot=function(params){this.type="Dot";var _super=_jp.Endpoints.AbstractEndpoint.apply(this,arguments);params=params||{};this.radius=params.radius||10;this.defaultOffset=0.5*this.radius;this.defaultInnerRadius=this.radius/3;this._compute=function(anchorPoint,orientation,endpointStyle,connectorPaintStyle){this.radius=endpointStyle.radius||this.radius;var x=anchorPoint[0]-this.radius,y=anchorPoint[1]-this.radius,w=this.radius*2,h=this.radius*2;if(endpointStyle.strokeStyle){var lw=endpointStyle.lineWidth||1;x-=lw;y-=lw;w+=(lw*2);h+=(lw*2);}
return[x,y,w,h,this.radius];};};_ju.extend(_jp.Endpoints.Dot,_jp.Endpoints.AbstractEndpoint);_jp.Endpoints.Rectangle=function(params){this.type="Rectangle";var _super=_jp.Endpoints.AbstractEndpoint.apply(this,arguments);params=params||{};this.width=params.width||20;this.height=params.height||20;this._compute=function(anchorPoint,orientation,endpointStyle,connectorPaintStyle){var width=endpointStyle.width||this.width,height=endpointStyle.height||this.height,x=anchorPoint[0]-(width/2),y=anchorPoint[1]-(height/2);return[x,y,width,height];};};_ju.extend(_jp.Endpoints.Rectangle,_jp.Endpoints.AbstractEndpoint);var DOMElementEndpoint=function(params){_jp.jsPlumbUIComponent.apply(this,arguments);this._jsPlumb.displayElements=[];};_ju.extend(DOMElementEndpoint,_jp.jsPlumbUIComponent,{getDisplayElements:function(){return this._jsPlumb.displayElements;},appendDisplayElement:function(el){this._jsPlumb.displayElements.push(el);}});_jp.Endpoints.Image=function(params){this.type="Image";DOMElementEndpoint.apply(this,arguments);_jp.Endpoints.AbstractEndpoint.apply(this,arguments);var _onload=params.onload,src=params.src||params.url,clazz=params.cssClass?" "+params.cssClass:"";this._jsPlumb.img=new Image();this._jsPlumb.ready=false;this._jsPlumb.initialized=false;this._jsPlumb.deleted=false;this._jsPlumb.widthToUse=params.width;this._jsPlumb.heightToUse=params.height;this._jsPlumb.endpoint=params.endpoint;this._jsPlumb.img.onload=function(){if(this._jsPlumb!=null){this._jsPlumb.ready=true;this._jsPlumb.widthToUse=this._jsPlumb.widthToUse||this._jsPlumb.img.width;this._jsPlumb.heightToUse=this._jsPlumb.heightToUse||this._jsPlumb.img.height;if(_onload){_onload(this);}}}.bind(this);this._jsPlumb.endpoint.setImage=function(_img,onload){var s=_img.constructor==String?_img:_img.src;_onload=onload;this._jsPlumb.img.src=s;if(this.canvas!=null)
this.canvas.setAttribute("src",this._jsPlumb.img.src);}.bind(this);this._jsPlumb.endpoint.setImage(src,_onload);this._compute=function(anchorPoint,orientation,endpointStyle,connectorPaintStyle){this.anchorPoint=anchorPoint;if(this._jsPlumb.ready)return[anchorPoint[0]-this._jsPlumb.widthToUse/2,anchorPoint[1]-this._jsPlumb.heightToUse/2,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse];else return[0,0,0,0];};this.canvas=jsPlumb.createElement("img",{position:"absolute",margin:0,padding:0,outline:0},this._jsPlumb.instance.endpointClass+clazz);if(this._jsPlumb.widthToUse)this.canvas.setAttribute("width",this._jsPlumb.widthToUse);if(this._jsPlumb.heightToUse)this.canvas.setAttribute("height",this._jsPlumb.heightToUse);this._jsPlumb.instance.appendElement(this.canvas);this.actuallyPaint=function(d,style,anchor){if(!this._jsPlumb.deleted){if(!this._jsPlumb.initialized){this.canvas.setAttribute("src",this._jsPlumb.img.src);this.appendDisplayElement(this.canvas);this._jsPlumb.initialized=true;}
var x=this.anchorPoint[0]-(this._jsPlumb.widthToUse/2),y=this.anchorPoint[1]-(this._jsPlumb.heightToUse/2);_ju.sizeElement(this.canvas,x,y,this._jsPlumb.widthToUse,this._jsPlumb.heightToUse);}};this.paint=function(style,anchor){if(this._jsPlumb!=null){if(this._jsPlumb.ready){this.actuallyPaint(style,anchor);}
else{root.setTimeout(function(){this.paint(style,anchor);}.bind(this),200);}}};};_ju.extend(_jp.Endpoints.Image,[DOMElementEndpoint,_jp.Endpoints.AbstractEndpoint],{cleanup:function(force){if(force){this._jsPlumb.deleted=true;if(this.canvas)this.canvas.parentNode.removeChild(this.canvas);this.canvas=null;}}});_jp.Endpoints.Blank=function(params){var _super=_jp.Endpoints.AbstractEndpoint.apply(this,arguments);this.type="Blank";DOMElementEndpoint.apply(this,arguments);this._compute=function(anchorPoint,orientation,endpointStyle,connectorPaintStyle){return[anchorPoint[0],anchorPoint[1],10,0];};var clazz=params.cssClass?" "+params.cssClass:"";this.canvas=jsPlumb.createElement("div",{display:"block",width:"1px",height:"1px",background:"transparent",position:"absolute"},this._jsPlumb.instance.endpointClass+clazz);this._jsPlumb.instance.appendElement(this.canvas);this.paint=function(style,anchor){_ju.sizeElement(this.canvas,this.x,this.y,this.w,this.h);};};_ju.extend(_jp.Endpoints.Blank,[_jp.Endpoints.AbstractEndpoint,DOMElementEndpoint],{cleanup:function(){if(this.canvas&&this.canvas.parentNode){this.canvas.parentNode.removeChild(this.canvas);}}});_jp.Endpoints.Triangle=function(params){this.type="Triangle";_jp.Endpoints.AbstractEndpoint.apply(this,arguments);params=params||{};params.width=params.width||55;params.height=params.height||55;this.width=params.width;this.height=params.height;this._compute=function(anchorPoint,orientation,endpointStyle,connectorPaintStyle){var width=endpointStyle.width||self.width,height=endpointStyle.height||self.height,x=anchorPoint[0]-(width/2),y=anchorPoint[1]-(height/2);return[x,y,width,height];};};var AbstractOverlay=_jp.Overlays.AbstractOverlay=function(params){this.visible=true;this.isAppendedAtTopLevel=true;this.component=params.component;this.loc=params.location==null?0.5:params.location;this.endpointLoc=params.endpointLocation==null?[0.5,0.5]:params.endpointLocation;};AbstractOverlay.prototype={cleanup:function(force){if(force){this.component=null;this.canvas=null;this.endpointLoc=null;}},reattach:function(instance){},setVisible:function(val){this.visible=val;this.component.repaint();},isVisible:function(){return this.visible;},hide:function(){this.setVisible(false);},show:function(){this.setVisible(true);},incrementLocation:function(amount){this.loc+=amount;this.component.repaint();},setLocation:function(l){this.loc=l;this.component.repaint();},getLocation:function(){return this.loc;},updateFrom:function(){}};_jp.Overlays.Arrow=function(params){this.type="Arrow";AbstractOverlay.apply(this,arguments);this.isAppendedAtTopLevel=false;params=params||{};this.length=params.length||20;this.width=params.width||20;this.id=params.id;var direction=(params.direction||1)<0?-1:1,paintStyle=params.paintStyle||{lineWidth:1},foldback=params.foldback||0.623;this.computeMaxSize=function(){return self.width*1.5;};this.draw=function(component,currentConnectionPaintStyle){var hxy,mid,txy,tail,cxy;if(component.pointAlongPathFrom){if(_ju.isString(this.loc)||this.loc>1||this.loc<0){var l=parseInt(this.loc,10),fromLoc=this.loc<0?1:0;hxy=component.pointAlongPathFrom(fromLoc,l,false);mid=component.pointAlongPathFrom(fromLoc,l-(direction*this.length/2),false);txy=_jg.pointOnLine(hxy,mid,this.length);}
else if(this.loc==1){hxy=component.pointOnPath(this.loc);mid=component.pointAlongPathFrom(this.loc,-(this.length));txy=_jg.pointOnLine(hxy,mid,this.length);if(direction==-1){var _=txy;txy=hxy;hxy=_;}}
else if(this.loc===0){txy=component.pointOnPath(this.loc);mid=component.pointAlongPathFrom(this.loc,this.length);hxy=_jg.pointOnLine(txy,mid,this.length);if(direction==-1){var __=txy;txy=hxy;hxy=__;}}
else{hxy=component.pointAlongPathFrom(this.loc,direction*this.length/2);mid=component.pointOnPath(this.loc);txy=_jg.pointOnLine(hxy,mid,this.length);}
tail=_jg.perpendicularLineTo(hxy,txy,this.width);cxy=_jg.pointOnLine(hxy,txy,foldback*this.length);var d={hxy:hxy,tail:tail,cxy:cxy},strokeStyle=paintStyle.strokeStyle||currentConnectionPaintStyle.strokeStyle,fillStyle=paintStyle.fillStyle||currentConnectionPaintStyle.strokeStyle,lineWidth=paintStyle.lineWidth||currentConnectionPaintStyle.lineWidth;return{component:component,d:d,lineWidth:lineWidth,strokeStyle:strokeStyle,fillStyle:fillStyle,minX:Math.min(hxy.x,tail[0].x,tail[1].x),maxX:Math.max(hxy.x,tail[0].x,tail[1].x),minY:Math.min(hxy.y,tail[0].y,tail[1].y),maxY:Math.max(hxy.y,tail[0].y,tail[1].y)};}
else return{component:component,minX:0,maxX:0,minY:0,maxY:0};};};_ju.extend(_jp.Overlays.Arrow,AbstractOverlay,{updateFrom:function(d){this.length=d.length||this.length;this.width=d.width||this.width;this.direction=d.direction!=null?d.direction:this.direction;this.foldback=d.foldback||this.foldback;}});_jp.Overlays.PlainArrow=function(params){params=params||{};var p=_jp.extend(params,{foldback:1});_jp.Overlays.Arrow.call(this,p);this.type="PlainArrow";};_ju.extend(_jp.Overlays.PlainArrow,_jp.Overlays.Arrow);_jp.Overlays.Diamond=function(params){params=params||{};var l=params.length||40,p=jsPlumb.extend(params,{length:l/2,foldback:2});_jp.Overlays.Arrow.call(this,p);this.type="Diamond";};_ju.extend(_jp.Overlays.Diamond,_jp.Overlays.Arrow);var _getDimensions=function(component,forceRefresh){if(component._jsPlumb.cachedDimensions==null||forceRefresh)
component._jsPlumb.cachedDimensions=component.getDimensions();return component._jsPlumb.cachedDimensions;};var AbstractDOMOverlay=function(params){_jp.jsPlumbUIComponent.apply(this,arguments);AbstractOverlay.apply(this,arguments);var _f=this.fire;this.fire=function(){_f.apply(this,arguments);if(this.component)this.component.fire.apply(this.component,arguments);};this.detached=false;this.id=params.id;this._jsPlumb.div=null;this._jsPlumb.initialised=false;this._jsPlumb.component=params.component;this._jsPlumb.cachedDimensions=null;this._jsPlumb.create=params.create;this._jsPlumb.initiallyInvisible=params.visible===false;this.getElement=function(){if(this._jsPlumb.div==null){var div=this._jsPlumb.div=jsPlumb.getElement(this._jsPlumb.create(this._jsPlumb.component));div.style.position="absolute";div.className=this._jsPlumb.instance.overlayClass+" "+
(this.cssClass?this.cssClass:params.cssClass?params.cssClass:"");this._jsPlumb.instance.appendElement(div);this._jsPlumb.instance.getId(div);this.canvas=div;var ts="translate(-50%, -50%)";div.style.webkitTransform=ts;div.style.mozTransform=ts;div.style.msTransform=ts;div.style.oTransform=ts;div.style.transform=ts;div._jsPlumb=this;if(params.visible===false)
div.style.display="none";}
return this._jsPlumb.div;};this.draw=function(component,currentConnectionPaintStyle,absolutePosition){var td=_getDimensions(this);if(td!=null&&td.length==2){var cxy={x:0,y:0};if(absolutePosition){cxy={x:absolutePosition[0],y:absolutePosition[1]};}
else if(component.pointOnPath){var loc=this.loc,absolute=false;if(_ju.isString(this.loc)||this.loc<0||this.loc>1){loc=parseInt(this.loc,10);absolute=true;}
cxy=component.pointOnPath(loc,absolute);}
else{var locToUse=this.loc.constructor==Array?this.loc:this.endpointLoc;cxy={x:locToUse[0]*component.w,y:locToUse[1]*component.h};}
var minx=cxy.x-(td[0]/2),miny=cxy.y-(td[1]/2);return{component:component,d:{minx:minx,miny:miny,td:td,cxy:cxy},minX:minx,maxX:minx+td[0],minY:miny,maxY:miny+td[1]};}
else return{minX:0,maxX:0,minY:0,maxY:0};};};_ju.extend(AbstractDOMOverlay,[_jp.jsPlumbUIComponent,AbstractOverlay],{getDimensions:function(){return _ju.oldIE?_jp.getSize(this.getElement()):[1,1];},setVisible:function(state){if(this._jsPlumb.div){this._jsPlumb.div.style.display=state?"block":"none";if(state&&this._jsPlumb.initiallyInvisible){_getDimensions(this,true);this.component.repaint();this._jsPlumb.initiallyInvisible=false;}}},clearCachedDimensions:function(){this._jsPlumb.cachedDimensions=null;},cleanup:function(force){if(force){if(this._jsPlumb.div!=null){this._jsPlumb.div._jsPlumb=null;this._jsPlumb.instance.removeElement(this._jsPlumb.div);}}
else{if(this._jsPlumb&&this._jsPlumb.div&&this._jsPlumb.div.parentNode)
this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div);this.detached=true;}},reattach:function(instance){if(this._jsPlumb.div!=null)instance.getContainer().appendChild(this._jsPlumb.div);this.detached=false;},computeMaxSize:function(){var td=_getDimensions(this);return Math.max(td[0],td[1]);},paint:function(p,containerExtents){if(!this._jsPlumb.initialised){this.getElement();p.component.appendDisplayElement(this._jsPlumb.div);this._jsPlumb.initialised=true;if(this.detached)this._jsPlumb.div.parentNode.removeChild(this._jsPlumb.div);}
this._jsPlumb.div.style.left=(p.component.x+p.d.minx)+"px";this._jsPlumb.div.style.top=(p.component.y+p.d.miny)+"px";}});_jp.Overlays.Custom=function(params){this.type="Custom";AbstractDOMOverlay.apply(this,arguments);};_ju.extend(_jp.Overlays.Custom,AbstractDOMOverlay);_jp.Overlays.GuideLines=function(){var self=this;self.length=50;self.lineWidth=5;this.type="GuideLines";AbstractOverlay.apply(this,arguments);_jp.jsPlumbUIComponent.apply(this,arguments);this.draw=function(connector,currentConnectionPaintStyle){var head=connector.pointAlongPathFrom(self.loc,self.length/2),mid=connector.pointOnPath(self.loc),tail=_jg.pointOnLine(head,mid,self.length),tailLine=_jg.perpendicularLineTo(head,tail,40),headLine=_jg.perpendicularLineTo(tail,head,20);return{connector:connector,head:head,tail:tail,headLine:headLine,tailLine:tailLine,minX:Math.min(head.x,tail.x,headLine[0].x,headLine[1].x),minY:Math.min(head.y,tail.y,headLine[0].y,headLine[1].y),maxX:Math.max(head.x,tail.x,headLine[0].x,headLine[1].x),maxY:Math.max(head.y,tail.y,headLine[0].y,headLine[1].y)};};};_jp.Overlays.Label=function(params){this.labelStyle=params.labelStyle;var labelWidth=null,labelHeight=null,labelText=null,labelPadding=null;this.cssClass=this.labelStyle!=null?this.labelStyle.cssClass:null;var p=_jp.extend({create:function(){return jsPlumb.createElement("div");}},params);_jp.Overlays.Custom.call(this,p);this.type="Label";this.label=params.label||"";this.labelText=null;if(this.labelStyle){var el=this.getElement();this.labelStyle.font=this.labelStyle.font||"12px sans-serif";el.style.font=this.labelStyle.font;el.style.color=this.labelStyle.color||"black";if(this.labelStyle.fillStyle)el.style.background=this.labelStyle.fillStyle;if(this.labelStyle.borderWidth>0){var dStyle=this.labelStyle.borderStyle?this.labelStyle.borderStyle:"black";el.style.border=this.labelStyle.borderWidth+"px solid "+dStyle;}
if(this.labelStyle.padding)el.style.padding=this.labelStyle.padding;}};_ju.extend(_jp.Overlays.Label,_jp.Overlays.Custom,{cleanup:function(force){if(force){this.div=null;this.label=null;this.labelText=null;this.cssClass=null;this.labelStyle=null;}},getLabel:function(){return this.label;},setLabel:function(l){this.label=l;this.labelText=null;this.clearCachedDimensions();this.update();this.component.repaint();},getDimensions:function(){this.update();return AbstractDOMOverlay.prototype.getDimensions.apply(this,arguments);},update:function(){if(typeof this.label=="function"){var lt=this.label(this);this.getElement().innerHTML=lt.replace(/\r\n/g,"<br/>");}
else{if(this.labelText==null){this.labelText=this.label;this.getElement().innerHTML=this.labelText.replace(/\r\n/g,"<br/>");}}},updateFrom:function(d){if(d.label)this.setLabel(d.label);}});}).call(this);;(function(){"use strict";var root=this,_jp=root.jsPlumb;var _getEventManager=function(instance){var e=instance._mottle;if(!e){e=instance._mottle=new root.Mottle();}
return e;};_jp.extend(root.jsPlumbInstance.prototype,{getEventManager:function(){return _getEventManager(this);},on:function(el,event,callback){this.getEventManager().on.apply(this,arguments);return this;},off:function(el,event,callback){this.getEventManager().off.apply(this,arguments);return this;}});}).call(this);;(function(){"use strict";var root=this,_jp=root.jsPlumb,_ju=root.jsPlumbUtil;var Flowchart=function(params){this.type="Flowchart";params=params||{};params.stub=params.stub==null?30:params.stub;var segments,_super=_jp.Connectors.AbstractConnector.apply(this,arguments),midpoint=params.midpoint==null?0.5:params.midpoint,alwaysRespectStubs=params.alwaysRespectStubs===true,userSuppliedSegments=null,lastx=null,lasty=null,lastOrientation,cornerRadius=params.cornerRadius!=null?params.cornerRadius:0,sgn=function(n){return n<0?-1:n===0?0:1;},addSegment=function(segments,x,y,paintInfo){if(lastx==x&&lasty==y)return;var lx=lastx==null?paintInfo.sx:lastx,ly=lasty==null?paintInfo.sy:lasty,o=lx==x?"v":"h",sgnx=sgn(x-lx),sgny=sgn(y-ly);lastx=x;lasty=y;segments.push([lx,ly,x,y,o,sgnx,sgny]);},segLength=function(s){return Math.sqrt(Math.pow(s[0]-s[2],2)+Math.pow(s[1]-s[3],2));},_cloneArray=function(a){var _a=[];_a.push.apply(_a,a);return _a;},writeSegments=function(conn,segments,paintInfo){var current=null,next;for(var i=0;i<segments.length-1;i++){current=current||_cloneArray(segments[i]);next=_cloneArray(segments[i+1]);if(cornerRadius>0&&current[4]!=next[4]){var radiusToUse=Math.min(cornerRadius,segLength(current),segLength(next));current[2]-=current[5]*radiusToUse;current[3]-=current[6]*radiusToUse;next[0]+=next[5]*radiusToUse;next[1]+=next[6]*radiusToUse;var ac=(current[6]==next[5]&&next[5]==1)||((current[6]==next[5]&&next[5]===0)&&current[5]!=next[6])||(current[6]==next[5]&&next[5]==-1),sgny=next[1]>current[3]?1:-1,sgnx=next[0]>current[2]?1:-1,sgnEqual=sgny==sgnx,cx=(sgnEqual&&ac||(!sgnEqual&&!ac))?next[0]:current[2],cy=(sgnEqual&&ac||(!sgnEqual&&!ac))?current[3]:next[1];_super.addSegment(conn,"Straight",{x1:current[0],y1:current[1],x2:current[2],y2:current[3]});_super.addSegment(conn,"Arc",{r:radiusToUse,x1:current[2],y1:current[3],x2:next[0],y2:next[1],cx:cx,cy:cy,ac:ac});}
else{var dx=(current[2]==current[0])?0:(current[2]>current[0])?(paintInfo.lw/2):-(paintInfo.lw/2),dy=(current[3]==current[1])?0:(current[3]>current[1])?(paintInfo.lw/2):-(paintInfo.lw/2);_super.addSegment(conn,"Straight",{x1:current[0]-dx,y1:current[1]-dy,x2:current[2]+dx,y2:current[3]+dy});}
current=next;}
if(next!=null){_super.addSegment(conn,"Straight",{x1:next[0],y1:next[1],x2:next[2],y2:next[3]});}};this.setSegments=function(s){userSuppliedSegments=s;};this.isEditable=function(){return true;};this.getOriginalSegments=function(){return userSuppliedSegments||segments;};this._compute=function(paintInfo,params){if(params.clearEdits)
userSuppliedSegments=null;if(userSuppliedSegments!=null){writeSegments(this,userSuppliedSegments,paintInfo);return;}
segments=[];lastx=null;lasty=null;lastOrientation=null;var midx=paintInfo.startStubX+((paintInfo.endStubX-paintInfo.startStubX)*midpoint),midy=paintInfo.startStubY+((paintInfo.endStubY-paintInfo.startStubY)*midpoint);var orientations={x:[0,1],y:[1,0]},commonStubCalculator=function(){return[paintInfo.startStubX,paintInfo.startStubY,paintInfo.endStubX,paintInfo.endStubY];},stubCalculators={perpendicular:commonStubCalculator,orthogonal:commonStubCalculator,opposite:function(axis){var pi=paintInfo,idx=axis=="x"?0:1,areInProximity={"x":function(){return((pi.so[idx]==1&&(((pi.startStubX>pi.endStubX)&&(pi.tx>pi.startStubX))||((pi.sx>pi.endStubX)&&(pi.tx>pi.sx)))))||((pi.so[idx]==-1&&(((pi.startStubX<pi.endStubX)&&(pi.tx<pi.startStubX))||((pi.sx<pi.endStubX)&&(pi.tx<pi.sx)))));},"y":function(){return((pi.so[idx]==1&&(((pi.startStubY>pi.endStubY)&&(pi.ty>pi.startStubY))||((pi.sy>pi.endStubY)&&(pi.ty>pi.sy)))))||((pi.so[idx]==-1&&(((pi.startStubY<pi.endStubY)&&(pi.ty<pi.startStubY))||((pi.sy<pi.endStubY)&&(pi.ty<pi.sy)))));}};if(!alwaysRespectStubs&&areInProximity[axis]()){return{"x":[(paintInfo.sx+paintInfo.tx)/2,paintInfo.startStubY,(paintInfo.sx+paintInfo.tx)/2,paintInfo.endStubY],"y":[paintInfo.startStubX,(paintInfo.sy+paintInfo.ty)/2,paintInfo.endStubX,(paintInfo.sy+paintInfo.ty)/2]}[axis];}
else{return[paintInfo.startStubX,paintInfo.startStubY,paintInfo.endStubX,paintInfo.endStubY];}}},lineCalculators={perpendicular:function(axis){var pi=paintInfo,sis={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]},stubs={x:[[pi.startStubX,pi.endStubX],null,[pi.endStubX,pi.startStubX]],y:[[pi.startStubY,pi.endStubY],null,[pi.endStubY,pi.startStubY]]},midLines={x:[[midx,pi.startStubY],[midx,pi.endStubY]],y:[[pi.startStubX,midy],[pi.endStubX,midy]]},linesToEnd={x:[[pi.endStubX,pi.startStubY]],y:[[pi.startStubX,pi.endStubY]]},startToEnd={x:[[pi.startStubX,pi.endStubY],[pi.endStubX,pi.endStubY]],y:[[pi.endStubX,pi.startStubY],[pi.endStubX,pi.endStubY]]},startToMidToEnd={x:[[pi.startStubX,midy],[pi.endStubX,midy],[pi.endStubX,pi.endStubY]],y:[[midx,pi.startStubY],[midx,pi.endStubY],[pi.endStubX,pi.endStubY]]},otherStubs={x:[pi.startStubY,pi.endStubY],y:[pi.startStubX,pi.endStubX]},soIdx=orientations[axis][0],toIdx=orientations[axis][1],_so=pi.so[soIdx]+1,_to=pi.to[toIdx]+1,otherFlipped=(pi.to[toIdx]==-1&&(otherStubs[axis][1]<otherStubs[axis][0]))||(pi.to[toIdx]==1&&(otherStubs[axis][1]>otherStubs[axis][0])),stub1=stubs[axis][_so][0],stub2=stubs[axis][_so][1],segmentIndexes=sis[axis][_so][_to];if(pi.segment==segmentIndexes[3]||(pi.segment==segmentIndexes[2]&&otherFlipped)){return midLines[axis];}
else if(pi.segment==segmentIndexes[2]&&stub2<stub1){return linesToEnd[axis];}
else if((pi.segment==segmentIndexes[2]&&stub2>=stub1)||(pi.segment==segmentIndexes[1]&&!otherFlipped)){return startToMidToEnd[axis];}
else if(pi.segment==segmentIndexes[0]||(pi.segment==segmentIndexes[1]&&otherFlipped)){return startToEnd[axis];}},orthogonal:function(axis,startStub,otherStartStub,endStub,otherEndStub){var pi=paintInfo,extent={"x":pi.so[0]==-1?Math.min(startStub,endStub):Math.max(startStub,endStub),"y":pi.so[1]==-1?Math.min(startStub,endStub):Math.max(startStub,endStub)}[axis];return{"x":[[extent,otherStartStub],[extent,otherEndStub],[endStub,otherEndStub]],"y":[[otherStartStub,extent],[otherEndStub,extent],[otherEndStub,endStub]]}[axis];},opposite:function(axis,ss,oss,es){var pi=paintInfo,otherAxis={"x":"y","y":"x"}[axis],dim={"x":"height","y":"width"}[axis],comparator=pi["is"+axis.toUpperCase()+"GreaterThanStubTimes2"];if(params.sourceEndpoint.elementId==params.targetEndpoint.elementId){var _val=oss+((1-params.sourceEndpoint.anchor[otherAxis])*params.sourceInfo[dim])+_super.maxStub;return{"x":[[ss,_val],[es,_val]],"y":[[_val,ss],[_val,es]]}[axis];}
else if(!comparator||(pi.so[idx]==1&&ss>es)||(pi.so[idx]==-1&&ss<es)){return{"x":[[ss,midy],[es,midy]],"y":[[midx,ss],[midx,es]]}[axis];}
else if((pi.so[idx]==1&&ss<es)||(pi.so[idx]==-1&&ss>es)){return{"x":[[midx,pi.sy],[midx,pi.ty]],"y":[[pi.sx,midy],[pi.tx,midy]]}[axis];}}};var stubs=stubCalculators[paintInfo.anchorOrientation](paintInfo.sourceAxis),idx=paintInfo.sourceAxis=="x"?0:1,oidx=paintInfo.sourceAxis=="x"?1:0,ss=stubs[idx],oss=stubs[oidx],es=stubs[idx+2],oes=stubs[oidx+2];addSegment(segments,stubs[0],stubs[1],paintInfo);var p=lineCalculators[paintInfo.anchorOrientation](paintInfo.sourceAxis,ss,oss,es,oes);if(p){for(var i=0;i<p.length;i++){addSegment(segments,p[i][0],p[i][1],paintInfo);}}
addSegment(segments,stubs[2],stubs[3],paintInfo);addSegment(segments,paintInfo.tx,paintInfo.ty,paintInfo);writeSegments(this,segments,paintInfo);};this.getPath=function(){var _last=null,_lastAxis=null,s=[],segs=userSuppliedSegments||segments;for(var i=0;i<segs.length;i++){var seg=segs[i],axis=seg[4],axisIndex=(axis=="v"?3:2);if(_last!=null&&_lastAxis===axis){_last[axisIndex]=seg[axisIndex];}
else{if(seg[0]!=seg[2]||seg[1]!=seg[3]){s.push({start:[seg[0],seg[1]],end:[seg[2],seg[3]]});_last=seg;_lastAxis=seg[4];}}}
return s;};this.setPath=function(path){userSuppliedSegments=[];for(var i=0;i<path.length;i++){var lx=path[i].start[0],ly=path[i].start[1],x=path[i].end[0],y=path[i].end[1],o=lx==x?"v":"h",sgnx=sgn(x-lx),sgny=sgn(y-ly);userSuppliedSegments.push([lx,ly,x,y,o,sgnx,sgny]);}};};_ju.extend(Flowchart,_jp.Connectors.AbstractConnector);_jp.registerConnectorType(Flowchart,"Flowchart");}).call(this);;(function(){"use strict";var root=this,_jp=root.jsPlumb,_ju=root.jsPlumbUtil;var _segment=function(x1,y1,x2,y2){if(x1<=x2&&y2<=y1)return 1;else if(x1<=x2&&y1<=y2)return 2;else if(x2<=x1&&y2>=y1)return 3;return 4;},_findControlPoint=function(midx,midy,segment,sourceEdge,targetEdge,dx,dy,distance,proximityLimit){if(distance<=proximityLimit)return[midx,midy];if(segment===1){if(sourceEdge[3]<=0&&targetEdge[3]>=1)return[midx+(sourceEdge[2]<0.5?-1*dx:dx),midy];else if(sourceEdge[2]>=1&&targetEdge[2]<=0)return[midx,midy+(sourceEdge[3]<0.5?-1*dy:dy)];else return[midx+(-1*dx),midy+(-1*dy)];}
else if(segment===2){if(sourceEdge[3]>=1&&targetEdge[3]<=0)return[midx+(sourceEdge[2]<0.5?-1*dx:dx),midy];else if(sourceEdge[2]>=1&&targetEdge[2]<=0)return[midx,midy+(sourceEdge[3]<0.5?-1*dy:dy)];else return[midx+dx,midy+(-1*dy)];}
else if(segment===3){if(sourceEdge[3]>=1&&targetEdge[3]<=0)return[midx+(sourceEdge[2]<0.5?-1*dx:dx),midy];else if(sourceEdge[2]<=0&&targetEdge[2]>=1)return[midx,midy+(sourceEdge[3]<0.5?-1*dy:dy)];else return[midx+(-1*dx),midy+(-1*dy)];}
else if(segment===4){if(sourceEdge[3]<=0&&targetEdge[3]>=1)return[midx+(sourceEdge[2]<0.5?-1*dx:dx),midy];else if(sourceEdge[2]<=0&&targetEdge[2]>=1)return[midx,midy+(sourceEdge[3]<0.5?-1*dy:dy)];else return[midx+dx,midy+(-1*dy)];}};var StateMachine=function(params){params=params||{};this.type="StateMachine";var _super=_jp.Connectors.AbstractConnector.apply(this,arguments),curviness=params.curviness||10,margin=params.margin||5,proximityLimit=params.proximityLimit||80,clockwise=params.orientation&&params.orientation==="clockwise",loopbackRadius=params.loopbackRadius||25,showLoopback=params.showLoopback!==false;this._compute=function(paintInfo,params){var w=Math.abs(params.sourcePos[0]-params.targetPos[0]),h=Math.abs(params.sourcePos[1]-params.targetPos[1]);if(!showLoopback||(params.sourceEndpoint.elementId!==params.targetEndpoint.elementId)){var _sx=params.sourcePos[0]<params.targetPos[0]?0:w,_sy=params.sourcePos[1]<params.targetPos[1]?0:h,_tx=params.sourcePos[0]<params.targetPos[0]?w:0,_ty=params.sourcePos[1]<params.targetPos[1]?h:0;if(params.sourcePos[2]===0)_sx-=margin;if(params.sourcePos[2]===1)_sx+=margin;if(params.sourcePos[3]===0)_sy-=margin;if(params.sourcePos[3]===1)_sy+=margin;if(params.targetPos[2]===0)_tx-=margin;if(params.targetPos[2]===1)_tx+=margin;if(params.targetPos[3]===0)_ty-=margin;if(params.targetPos[3]===1)_ty+=margin;var _midx=(_sx+_tx)/2,_midy=(_sy+_ty)/2,segment=_segment(_sx,_sy,_tx,_ty),distance=Math.sqrt(Math.pow(_tx-_sx,2)+Math.pow(_ty-_sy,2)),_controlPoint=_findControlPoint(_midx,_midy,segment,params.sourcePos,params.targetPos,curviness,curviness,distance,proximityLimit);_super.addSegment(this,"Bezier",{x1:_tx,y1:_ty,x2:_sx,y2:_sy,cp1x:_controlPoint[0],cp1y:_controlPoint[1],cp2x:_controlPoint[0],cp2y:_controlPoint[1]});}
else{var x1=params.sourcePos[0],y1=params.sourcePos[1]-margin,cx=x1,cy=y1-loopbackRadius,_w=2*loopbackRadius,_h=2*loopbackRadius,_x=cx-loopbackRadius,_y=cy-loopbackRadius;paintInfo.points[0]=_x;paintInfo.points[1]=_y;paintInfo.points[2]=_w;paintInfo.points[3]=_h;_super.addSegment(this,"Arc",{loopback:true,x1:(x1-_x)+4,y1:y1-_y,startAngle:0,endAngle:2*Math.PI,r:loopbackRadius,ac:!clockwise,x2:(x1-_x)-4,y2:y1-_y,cx:cx-_x,cy:cy-_y});}};};_ju.extend(StateMachine,_jp.Connectors.AbstractConnector);_jp.registerConnectorType(StateMachine,"StateMachine");}).call(this);;(function(){"use strict";var root=this,_jp=root.jsPlumb,_ju=root.jsPlumbUtil;var Bezier=function(params){params=params||{};var _super=_jp.Connectors.AbstractConnector.apply(this,arguments),majorAnchor=params.curviness||150,minorAnchor=10;this.type="Bezier";this.getCurviness=function(){return majorAnchor;};this._findControlPoint=function(point,sourceAnchorPosition,targetAnchorPosition,sourceEndpoint,targetEndpoint,soo,too){var perpendicular=soo[0]!=too[0]||soo[1]==too[1],p=[];if(!perpendicular){if(soo[0]===0)
p.push(sourceAnchorPosition[0]<targetAnchorPosition[0]?point[0]+minorAnchor:point[0]-minorAnchor);else p.push(point[0]-(majorAnchor*soo[0]));if(soo[1]===0)
p.push(sourceAnchorPosition[1]<targetAnchorPosition[1]?point[1]+minorAnchor:point[1]-minorAnchor);else p.push(point[1]+(majorAnchor*too[1]));}
else{if(too[0]===0)
p.push(targetAnchorPosition[0]<sourceAnchorPosition[0]?point[0]+minorAnchor:point[0]-minorAnchor);else p.push(point[0]+(majorAnchor*too[0]));if(too[1]===0)
p.push(targetAnchorPosition[1]<sourceAnchorPosition[1]?point[1]+minorAnchor:point[1]-minorAnchor);else p.push(point[1]+(majorAnchor*soo[1]));}
return p;};this._compute=function(paintInfo,p){var sp=p.sourcePos,tp=p.targetPos,_w=Math.abs(sp[0]-tp[0]),_h=Math.abs(sp[1]-tp[1]),_sx=sp[0]<tp[0]?_w:0,_sy=sp[1]<tp[1]?_h:0,_tx=sp[0]<tp[0]?0:_w,_ty=sp[1]<tp[1]?0:_h,_CP=this._findControlPoint([_sx,_sy],sp,tp,p.sourceEndpoint,p.targetEndpoint,paintInfo.so,paintInfo.to),_CP2=this._findControlPoint([_tx,_ty],tp,sp,p.targetEndpoint,p.sourceEndpoint,paintInfo.to,paintInfo.so);_super.addSegment(this,"Bezier",{x1:_sx,y1:_sy,x2:_tx,y2:_ty,cp1x:_CP[0],cp1y:_CP[1],cp2x:_CP2[0],cp2y:_CP2[1]});};};_ju.extend(Bezier,_jp.Connectors.AbstractConnector);_jp.registerConnectorType(Bezier,"Bezier");}).call(this);;(function(){"use strict";var root=this,_jp=root.jsPlumb,_ju=root.jsPlumbUtil;var svgAttributeMap={"joinstyle":"stroke-linejoin","stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},STROKE_DASHARRAY="stroke-dasharray",DASHSTYLE="dashstyle",LINEAR_GRADIENT="linearGradient",RADIAL_GRADIENT="radialGradient",DEFS="defs",FILL="fill",STOP="stop",STROKE="stroke",STROKE_WIDTH="stroke-width",STYLE="style",NONE="none",JSPLUMB_GRADIENT="jsplumb_gradient_",LINE_WIDTH="lineWidth",ns={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml"},_attr=function(node,attributes){for(var i in attributes)
node.setAttribute(i,""+attributes[i]);},_node=function(name,attributes){attributes=attributes||{};attributes.version="1.1";attributes.xmlns=ns.xhtml;return jsPlumb.createElementNS(ns.svg,name,null,null,attributes);},_pos=function(d){return"position:absolute;left:"+d[0]+"px;top:"+d[1]+"px";},_clearGradient=function(parent){var els=parent.querySelectorAll(" defs,linearGradient,radialGradient");for(var i=0;i<els.length;i++)
els[i].parentNode.removeChild(els[i]);},_updateGradient=function(parent,node,style,dimensions,uiComponent){var id=JSPLUMB_GRADIENT+uiComponent._jsPlumb.instance.idstamp();_clearGradient(parent);var g;if(!style.gradient.offset)
g=_node(LINEAR_GRADIENT,{id:id,gradientUnits:"userSpaceOnUse"});else
g=_node(RADIAL_GRADIENT,{id:id});var defs=_node(DEFS);parent.appendChild(defs);defs.appendChild(g);for(var i=0;i<style.gradient.stops.length;i++){var styleToUse=uiComponent.segment==1||uiComponent.segment==2?i:style.gradient.stops.length-1-i,stopColor=style.gradient.stops[styleToUse][1],s=_node(STOP,{"offset":Math.floor(style.gradient.stops[i][0]*100)+"%","stop-color":stopColor});g.appendChild(s);}
var applyGradientTo=style.strokeStyle?STROKE:FILL;node.setAttribute(applyGradientTo,"url(#"+id+")");},_applyStyles=function(parent,node,style,dimensions,uiComponent){node.setAttribute(FILL,style.fillStyle?style.fillStyle:NONE);node.setAttribute(STROKE,style.strokeStyle?style.strokeStyle:NONE);if(style.gradient){_updateGradient(parent,node,style,dimensions,uiComponent);}
else{_clearGradient(parent);node.setAttribute(STYLE,"");}
if(style.lineWidth){node.setAttribute(STROKE_WIDTH,style.lineWidth);}
if(style[DASHSTYLE]&&style[LINE_WIDTH]&&!style[STROKE_DASHARRAY]){var sep=style[DASHSTYLE].indexOf(",")==-1?" ":",",parts=style[DASHSTYLE].split(sep),styleToUse="";parts.forEach(function(p){styleToUse+=(Math.floor(p*style.lineWidth)+sep);});node.setAttribute(STROKE_DASHARRAY,styleToUse);}
else if(style[STROKE_DASHARRAY]){node.setAttribute(STROKE_DASHARRAY,style[STROKE_DASHARRAY]);}
for(var i in svgAttributeMap){if(style[i]){node.setAttribute(svgAttributeMap[i],style[i]);}}},_appendAtIndex=function(svg,path,idx){if(svg.childNodes.length>idx){svg.insertBefore(path,svg.childNodes[idx]);}
else svg.appendChild(path);};_ju.svg={node:_node,attr:_attr,pos:_pos};var SvgComponent=function(params){var pointerEventsSpec=params.pointerEventsSpec||"all",renderer={};_jp.jsPlumbUIComponent.apply(this,params.originalArgs);this.canvas=null;this.path=null;this.svg=null;this.bgCanvas=null;var clazz=params.cssClass+" "+(params.originalArgs[0].cssClass||""),svgParams={"style":"","width":0,"height":0,"pointer-events":pointerEventsSpec,"position":"absolute"};this.svg=_node("svg",svgParams);if(params.useDivWrapper){this.canvas=jsPlumb.createElement("div",{position:"absolute"});_ju.sizeElement(this.canvas,0,0,1,1);this.canvas.className=clazz;}
else{_attr(this.svg,{"class":clazz});this.canvas=this.svg;}
params._jsPlumb.appendElement(this.canvas,params.originalArgs[0].parent);if(params.useDivWrapper)this.canvas.appendChild(this.svg);var displayElements=[this.canvas];this.getDisplayElements=function(){return displayElements;};this.appendDisplayElement=function(el){displayElements.push(el);};this.paint=function(style,anchor,extents){if(style!=null){var xy=[this.x,this.y],wh=[this.w,this.h],p;if(extents!=null){if(extents.xmin<0)xy[0]+=extents.xmin;if(extents.ymin<0)xy[1]+=extents.ymin;wh[0]=extents.xmax+((extents.xmin<0)?-extents.xmin:0);wh[1]=extents.ymax+((extents.ymin<0)?-extents.ymin:0);}
if(params.useDivWrapper){_ju.sizeElement(this.canvas,xy[0],xy[1],wh[0],wh[1]);xy[0]=0;xy[1]=0;p=_pos([0,0]);}
else
p=_pos([xy[0],xy[1]]);renderer.paint.apply(this,arguments);_attr(this.svg,{"style":p,"width":wh[0]||0,"height":wh[1]||0});}};return{renderer:renderer};};_ju.extend(SvgComponent,_jp.jsPlumbUIComponent,{cleanup:function(force){if(force||this.typeId==null){if(this.canvas)this.canvas._jsPlumb=null;if(this.svg)this.svg._jsPlumb=null;if(this.bgCanvas)this.bgCanvas._jsPlumb=null;if(this.canvas&&this.canvas.parentNode)
this.canvas.parentNode.removeChild(this.canvas);if(this.bgCanvas&&this.bgCanvas.parentNode)
this.canvas.parentNode.removeChild(this.canvas);this.svg=null;this.canvas=null;this.path=null;this.group=null;}
else{if(this.canvas&&this.canvas.parentNode)this.canvas.parentNode.removeChild(this.canvas);if(this.bgCanvas&&this.bgCanvas.parentNode)this.bgCanvas.parentNode.removeChild(this.bgCanvas);}},reattach:function(instance){var c=instance.getContainer();if(this.canvas&&this.canvas.parentNode==null)c.appendChild(this.canvas);if(this.bgCanvas&&this.bgCanvas.parentNode==null)c.appendChild(this.bgCanvas);},setVisible:function(v){if(this.canvas){this.canvas.style.display=v?"block":"none";}}});_jp.ConnectorRenderers.svg=function(params){var self=this,_super=SvgComponent.apply(this,[{cssClass:params._jsPlumb.connectorClass,originalArgs:arguments,pointerEventsSpec:"none",_jsPlumb:params._jsPlumb}]);_super.renderer.paint=function(style,anchor,extents){var segments=self.getSegments(),p="",offset=[0,0];if(extents.xmin<0)offset[0]=-extents.xmin;if(extents.ymin<0)offset[1]=-extents.ymin;if(segments.length>0){for(var i=0;i<segments.length;i++){p+=_jp.Segments.svg.SegmentRenderer.getPath(segments[i]);p+=" ";}
var a={d:p,transform:"translate("+offset[0]+","+offset[1]+")","pointer-events":params["pointer-events"]||"visibleStroke"},outlineStyle=null,d=[self.x,self.y,self.w,self.h];if(style.outlineColor){var outlineWidth=style.outlineWidth||1,outlineStrokeWidth=style.lineWidth+(2*outlineWidth);outlineStyle=_jp.extend({},style);delete outlineStyle.gradient;outlineStyle.strokeStyle=style.outlineColor;outlineStyle.lineWidth=outlineStrokeWidth;if(self.bgPath==null){self.bgPath=_node("path",a);_jp.addClass(self.bgPath,_jp.connectorOutlineClass);_appendAtIndex(self.svg,self.bgPath,0);}
else{_attr(self.bgPath,a);}
_applyStyles(self.svg,self.bgPath,outlineStyle,d,self);}
if(self.path==null){self.path=_node("path",a);_appendAtIndex(self.svg,self.path,style.outlineColor?1:0);}
else{_attr(self.path,a);}
_applyStyles(self.svg,self.path,style,d,self);}};};_ju.extend(_jp.ConnectorRenderers.svg,SvgComponent);_jp.Segments.svg={SegmentRenderer:{getPath:function(segment){return({"Straight":function(){var d=segment.getCoordinates();return"M "+d.x1+" "+d.y1+" L "+d.x2+" "+d.y2;},"Bezier":function(){var d=segment.params;return"M "+d.x1+" "+d.y1+" C "+d.cp1x+" "+d.cp1y+" "+d.cp2x+" "+d.cp2y+" "+d.x2+" "+d.y2;},"Arc":function(){var d=segment.params,laf=segment.sweep>Math.PI?1:0,sf=segment.anticlockwise?0:1;return"M"+segment.x1+" "+segment.y1+" A "+segment.radius+" "+d.r+" 0 "+laf+","+sf+" "+segment.x2+" "+segment.y2;}})[segment.type]();}}};var SvgEndpoint=_jp.SvgEndpoint=function(params){var _super=SvgComponent.apply(this,[{cssClass:params._jsPlumb.endpointClass,originalArgs:arguments,pointerEventsSpec:"all",useDivWrapper:true,_jsPlumb:params._jsPlumb}]);_super.renderer.paint=function(style){var s=_jp.extend({},style);if(s.outlineColor){s.strokeWidth=s.outlineWidth;s.strokeStyle=s.outlineColor;}
if(this.node==null){this.node=this.makeNode(s);this.svg.appendChild(this.node);}
else if(this.updateNode!=null){this.updateNode(this.node);}
_applyStyles(this.svg,this.node,s,[this.x,this.y,this.w,this.h],this);_pos(this.node,[this.x,this.y]);}.bind(this);};_ju.extend(SvgEndpoint,SvgComponent);_jp.Endpoints.svg.Dot=function(){_jp.Endpoints.Dot.apply(this,arguments);SvgEndpoint.apply(this,arguments);this.makeNode=function(style){return _node("circle",{"cx":this.w/2,"cy":this.h/2,"r":this.radius});};this.updateNode=function(node){_attr(node,{"cx":this.w/2,"cy":this.h/2,"r":this.radius});};};_ju.extend(_jp.Endpoints.svg.Dot,[_jp.Endpoints.Dot,SvgEndpoint]);_jp.Endpoints.svg.Rectangle=function(){_jp.Endpoints.Rectangle.apply(this,arguments);SvgEndpoint.apply(this,arguments);this.makeNode=function(style){return _node("rect",{"width":this.w,"height":this.h});};this.updateNode=function(node){_attr(node,{"width":this.w,"height":this.h});};};_ju.extend(_jp.Endpoints.svg.Rectangle,[_jp.Endpoints.Rectangle,SvgEndpoint]);_jp.Endpoints.svg.Image=_jp.Endpoints.Image;_jp.Endpoints.svg.Blank=_jp.Endpoints.Blank;_jp.Overlays.svg.Label=_jp.Overlays.Label;_jp.Overlays.svg.Custom=_jp.Overlays.Custom;var AbstractSvgArrowOverlay=function(superclass,originalArgs){superclass.apply(this,originalArgs);_jp.jsPlumbUIComponent.apply(this,originalArgs);this.isAppendedAtTopLevel=false;var self=this;this.path=null;this.paint=function(params,containerExtents){if(params.component.svg&&containerExtents){if(this.path==null){this.path=_node("path",{"pointer-events":"all"});params.component.svg.appendChild(this.path);this.canvas=params.component.svg;}
var clazz=originalArgs&&(originalArgs.length==1)?(originalArgs[0].cssClass||""):"",offset=[0,0];if(containerExtents.xmin<0)offset[0]=-containerExtents.xmin;if(containerExtents.ymin<0)offset[1]=-containerExtents.ymin;_attr(this.path,{"d":makePath(params.d),"class":clazz,stroke:params.strokeStyle?params.strokeStyle:null,fill:params.fillStyle?params.fillStyle:null,transform:"translate("+offset[0]+","+offset[1]+")"});}};var makePath=function(d){return(isNaN(d.cxy.x)||isNaN(d.cxy.y))?"":"M"+d.hxy.x+","+d.hxy.y+" L"+d.tail[0].x+","+d.tail[0].y+" L"+d.cxy.x+","+d.cxy.y+" L"+d.tail[1].x+","+d.tail[1].y+" L"+d.hxy.x+","+d.hxy.y;};this.transfer=function(target){if(target.canvas&&this.path&&this.path.parentNode){this.path.parentNode.removeChild(this.path);target.canvas.appendChild(this.path);}};};_ju.extend(AbstractSvgArrowOverlay,[_jp.jsPlumbUIComponent,_jp.Overlays.AbstractOverlay],{cleanup:function(force){if(this.path!=null){if(force)
this._jsPlumb.instance.removeElement(this.path);else
if(this.path.parentNode)
this.path.parentNode.removeChild(this.path);}},reattach:function(instance){if(this.path&&this.canvas&&this.path.parentNode==null)
this.canvas.appendChild(this.path);},setVisible:function(v){if(this.path!=null)(this.path.style.display=(v?"block":"none"));}});_jp.Overlays.svg.Arrow=function(){AbstractSvgArrowOverlay.apply(this,[_jp.Overlays.Arrow,arguments]);};_ju.extend(_jp.Overlays.svg.Arrow,[_jp.Overlays.Arrow,AbstractSvgArrowOverlay]);_jp.Overlays.svg.PlainArrow=function(){AbstractSvgArrowOverlay.apply(this,[_jp.Overlays.PlainArrow,arguments]);};_ju.extend(_jp.Overlays.svg.PlainArrow,[_jp.Overlays.PlainArrow,AbstractSvgArrowOverlay]);_jp.Overlays.svg.Diamond=function(){AbstractSvgArrowOverlay.apply(this,[_jp.Overlays.Diamond,arguments]);};_ju.extend(_jp.Overlays.svg.Diamond,[_jp.Overlays.Diamond,AbstractSvgArrowOverlay]);_jp.Overlays.svg.GuideLines=function(){var path=null,self=this,p1_1,p1_2;_jp.Overlays.GuideLines.apply(this,arguments);this.paint=function(params,containerExtents){if(path==null){path=_node("path");params.connector.svg.appendChild(path);self.attachListeners(path,params.connector);self.attachListeners(path,self);p1_1=_node("path");params.connector.svg.appendChild(p1_1);self.attachListeners(p1_1,params.connector);self.attachListeners(p1_1,self);p1_2=_node("path");params.connector.svg.appendChild(p1_2);self.attachListeners(p1_2,params.connector);self.attachListeners(p1_2,self);}
var offset=[0,0];if(containerExtents.xmin<0)offset[0]=-containerExtents.xmin;if(containerExtents.ymin<0)offset[1]=-containerExtents.ymin;_attr(path,{"d":makePath(params.head,params.tail),stroke:"red",fill:null,transform:"translate("+offset[0]+","+offset[1]+")"});_attr(p1_1,{"d":makePath(params.tailLine[0],params.tailLine[1]),stroke:"blue",fill:null,transform:"translate("+offset[0]+","+offset[1]+")"});_attr(p1_2,{"d":makePath(params.headLine[0],params.headLine[1]),stroke:"green",fill:null,transform:"translate("+offset[0]+","+offset[1]+")"});};var makePath=function(d1,d2){return"M "+d1.x+","+d1.y+" L"+d2.x+","+d2.y;};};_ju.extend(_jp.Overlays.svg.GuideLines,_jp.Overlays.GuideLines);}).call(this);;(function(){"use strict";var root=this,_jp=root.jsPlumb,_ju=root.jsPlumbUtil;var _convertStyle=function(s,ignoreAlpha){if("transparent"===s)return s;var o=s,pad=function(n){return n.length==1?"0"+n:n;},hex=function(k){return pad(Number(k).toString(16));},dec=function(d){return hex(parseInt(d*255,10));},pattern=/(rgb[a]?\()(.*)(\))/;if(s.match(pattern)){var parts=s.match(pattern)[2].split(",");o="#"+hex(parts[0])+hex(parts[1])+hex(parts[2]);if(!ignoreAlpha&&parts.length==4)
o=o+dec(parts[3]);}
return o;};var vmlAttributeMap={"stroke-linejoin":"joinstyle","joinstyle":"joinstyle","endcap":"endcap","miterlimit":"miterlimit"},jsPlumbStylesheet=null;if(document.createStyleSheet&&document.namespaces){var ruleClasses=[".jsplumb_vml","jsplumb\\:textbox","jsplumb\\:oval","jsplumb\\:rect","jsplumb\\:stroke","jsplumb\\:shape","jsplumb\\:group"],rule="behavior:url(#default#VML);position:absolute;";jsPlumbStylesheet=document.createStyleSheet();for(var i=0;i<ruleClasses.length;i++)
jsPlumbStylesheet.addRule(ruleClasses[i],rule);document.namespaces.add("jsplumb","urn:schemas-microsoft-com:vml");}
_jp.vml={};var scale=1000,_atts=function(o,atts){for(var i in atts){o[i]=atts[i];}},_node=function(name,d,atts,parent,_jsPlumb,deferToJsPlumbContainer){atts=atts||{};var o=document.createElement("jsplumb:"+name);if(deferToJsPlumbContainer)
_jsPlumb.appendElement(o,parent);else
parent.appendChild(o);o.className=(atts["class"]?atts["class"]+" ":"")+"jsplumb_vml";_pos(o,d);_atts(o,atts);return o;},_pos=function(o,d,zIndex){o.style.left=d[0]+"px";o.style.top=d[1]+"px";o.style.width=d[2]+"px";o.style.height=d[3]+"px";o.style.position="absolute";if(zIndex)
o.style.zIndex=zIndex;},_conv=_jp.vml.convertValue=function(v){return Math.floor(v*scale);},_maybeSetOpacity=function(styleToWrite,styleToCheck,type,component){if("transparent"===styleToCheck)
component.setOpacity(type,"0.0");else
component.setOpacity(type,"1.0");},_applyStyles=function(node,style,component,_jsPlumb){var styleToWrite={};if(style.strokeStyle){styleToWrite.stroked="true";var strokeColor=_convertStyle(style.strokeStyle,true);styleToWrite.strokecolor=strokeColor;_maybeSetOpacity(styleToWrite,strokeColor,"stroke",component);styleToWrite.strokeweight=style.lineWidth+"px";}
else styleToWrite.stroked="false";if(style.fillStyle){styleToWrite.filled="true";var fillColor=_convertStyle(style.fillStyle,true);styleToWrite.fillcolor=fillColor;_maybeSetOpacity(styleToWrite,fillColor,"fill",component);}
else styleToWrite.filled="false";if(style.dashstyle){if(component.strokeNode==null){component.strokeNode=_node("stroke",[0,0,0,0],{dashstyle:style.dashstyle},node,_jsPlumb);}
else
component.strokeNode.dashstyle=style.dashstyle;}
else if(style["stroke-dasharray"]&&style.lineWidth){var sep=style["stroke-dasharray"].indexOf(",")==-1?" ":",",parts=style["stroke-dasharray"].split(sep),styleToUse="";for(var i=0;i<parts.length;i++){styleToUse+=(Math.floor(parts[i]/style.lineWidth)+sep);}
if(component.strokeNode==null){component.strokeNode=_node("stroke",[0,0,0,0],{dashstyle:styleToUse},node,_jsPlumb);}
else
component.strokeNode.dashstyle=styleToUse;}
_atts(node,styleToWrite);},VmlComponent=function(){var self=this,renderer={};_jp.jsPlumbUIComponent.apply(this,arguments);this.opacityNodes={"stroke":null,"fill":null};this.initOpacityNodes=function(vml){self.opacityNodes.stroke=_node("stroke",[0,0,1,1],{opacity:"0.0"},vml,self._jsPlumb.instance);self.opacityNodes.fill=_node("fill",[0,0,1,1],{opacity:"0.0"},vml,self._jsPlumb.instance);};this.setOpacity=function(type,value){var node=self.opacityNodes[type];if(node)node.opacity=""+value;};var displayElements=[];this.getDisplayElements=function(){return displayElements;};this.appendDisplayElement=function(el,doNotAppendToCanvas){if(!doNotAppendToCanvas)self.canvas.parentNode.appendChild(el);displayElements.push(el);};};_ju.extend(VmlComponent,_jp.jsPlumbUIComponent,{cleanup:function(){if(this.bgCanvas)this.bgCanvas.parentNode.removeChild(this.bgCanvas);if(this.canvas)this.canvas.parentNode.removeChild(this.canvas);}});var VmlConnector=_jp.ConnectorRenderers.vml=function(params,component){this.strokeNode=null;this.canvas=null;VmlComponent.apply(this,arguments);var clazz=this._jsPlumb.instance.connectorClass+(params.cssClass?(" "+params.cssClass):"");this.paint=function(style){if(style!==null){this.w=Math.max(this.w,1);this.h=Math.max(this.h,1);var segments=this.getSegments(),p={"path":""},d=[this.x,this.y,this.w,this.h];for(var i=0;i<segments.length;i++){p.path+=_jp.Segments.vml.SegmentRenderer.getPath(segments[i]);p.path+=" ";}
if(style.outlineColor){var outlineWidth=style.outlineWidth||1,outlineStrokeWidth=style.lineWidth+(2*outlineWidth),outlineStyle={strokeStyle:_ju.convertStyle(style.outlineColor),lineWidth:outlineStrokeWidth};for(var aa in vmlAttributeMap)outlineStyle[aa]=style[aa];if(this.bgCanvas==null){p["class"]=clazz;p.coordsize=(d[2]*scale)+","+(d[3]*scale);this.bgCanvas=_node("shape",d,p,params.parent,this._jsPlumb.instance,true);_pos(this.bgCanvas,d);this.appendDisplayElement(this.bgCanvas,true);this.initOpacityNodes(this.bgCanvas,["stroke"]);this.bgCanvas._jsPlumb=component;}
else{p.coordsize=(d[2]*scale)+","+(d[3]*scale);_pos(this.bgCanvas,d);_atts(this.bgCanvas,p);}
_applyStyles(this.bgCanvas,outlineStyle,this);}
if(this.canvas==null){p["class"]=clazz;p.coordsize=(d[2]*scale)+","+(d[3]*scale);this.canvas=_node("shape",d,p,params.parent,this._jsPlumb.instance,true);this.appendDisplayElement(this.canvas,true);this.initOpacityNodes(this.canvas,["stroke"]);this.canvas._jsPlumb=component;}
else{p.coordsize=(d[2]*scale)+","+(d[3]*scale);_pos(this.canvas,d);_atts(this.canvas,p);}
_applyStyles(this.canvas,style,this,this._jsPlumb.instance);}};};_ju.extend(VmlConnector,VmlComponent,{setVisible:function(v){if(this.canvas){this.canvas.style.display=v?"block":"none";}
if(this.bgCanvas){this.bgCanvas.style.display=v?"block":"none";}}});var VmlEndpoint=_jp.VmlEndpoint=function(params){VmlComponent.apply(this,arguments);this._jsPlumb.vml=null;this.canvas=document.createElement("div");this.canvas.style.position="absolute";this._jsPlumb.clazz=this._jsPlumb.instance.endpointClass+(params.cssClass?(" "+params.cssClass):"");params._jsPlumb.appendElement(this.canvas,params.parent);this.paint=function(style,anchor){var p={},vml=this._jsPlumb.vml;_ju.sizeElement(this.canvas,this.x,this.y,this.w,this.h);if(this._jsPlumb.vml==null){p["class"]=this._jsPlumb.clazz;vml=this._jsPlumb.vml=this.getVml([0,0,this.w,this.h],p,anchor,this.canvas,this._jsPlumb.instance);this.appendDisplayElement(vml,true);this.appendDisplayElement(this.canvas,true);this.initOpacityNodes(vml,["fill"]);}
else{_pos(vml,[0,0,this.w,this.h]);_atts(vml,p);}
_applyStyles(vml,style,this);};};_ju.extend(VmlEndpoint,VmlComponent);_jp.Segments.vml={SegmentRenderer:{getPath:function(segment){return({"Straight":function(segment){var d=segment.params;return"m"+_conv(d.x1)+","+_conv(d.y1)+" l"+_conv(d.x2)+","+_conv(d.y2)+" e";},"Bezier":function(segment){var d=segment.params;return"m"+_conv(d.x1)+","+_conv(d.y1)+" c"+_conv(d.cp1x)+","+_conv(d.cp1y)+","+_conv(d.cp2x)+","+_conv(d.cp2y)+","+_conv(d.x2)+","+_conv(d.y2)+" e";},"Arc":function(segment){var d=segment.params,xmin=Math.min(d.x1,d.x2),xmax=Math.max(d.x1,d.x2),ymin=Math.min(d.y1,d.y2),ymax=Math.max(d.y1,d.y2),sf=segment.anticlockwise?1:0,pathType=(segment.anticlockwise?"at ":"wa "),makePosString=function(){if(d.loopback)
return"0,0,"+_conv(2*d.r)+","+_conv(2*d.r);var xy=[null,[function(){return[xmin,ymin];},function(){return[xmin-d.r,ymin-d.r];}],[function(){return[xmin-d.r,ymin];},function(){return[xmin,ymin-d.r];}],[function(){return[xmin-d.r,ymin-d.r];},function(){return[xmin,ymin];}],[function(){return[xmin,ymin-d.r];},function(){return[xmin-d.r,ymin];}]][segment.segment][sf]();return _conv(xy[0])+","+_conv(xy[1])+","+_conv(xy[0]+(2*d.r))+","+_conv(xy[1]+(2*d.r));};return pathType+" "+makePosString()+","+_conv(d.x1)+","+_conv(d.y1)+","+_conv(d.x2)+","+_conv(d.y2)+" e";}})[segment.type](segment);}}};_jp.Endpoints.vml.Dot=function(){_jp.Endpoints.Dot.apply(this,arguments);VmlEndpoint.apply(this,arguments);this.getVml=function(d,atts,anchor,parent,_jsPlumb){return _node("oval",d,atts,parent,_jsPlumb);};};_ju.extend(_jp.Endpoints.vml.Dot,VmlEndpoint);_jp.Endpoints.vml.Rectangle=function(){_jp.Endpoints.Rectangle.apply(this,arguments);VmlEndpoint.apply(this,arguments);this.getVml=function(d,atts,anchor,parent,_jsPlumb){return _node("rect",d,atts,parent,_jsPlumb);};};_ju.extend(_jp.Endpoints.vml.Rectangle,VmlEndpoint);_jp.Endpoints.vml.Image=_jp.Endpoints.Image;_jp.Endpoints.vml.Blank=_jp.Endpoints.Blank;_jp.Overlays.vml.Label=_jp.Overlays.Label;_jp.Overlays.vml.Custom=_jp.Overlays.Custom;var AbstractVmlArrowOverlay=function(superclass,originalArgs){superclass.apply(this,originalArgs);VmlComponent.apply(this,originalArgs);var self=this,path=null;this.canvas=null;this.isAppendedAtTopLevel=true;var getPath=function(d){return"m "+_conv(d.hxy.x)+","+_conv(d.hxy.y)+" l "+_conv(d.tail[0].x)+","+_conv(d.tail[0].y)+" "+_conv(d.cxy.x)+","+_conv(d.cxy.y)+" "+_conv(d.tail[1].x)+","+_conv(d.tail[1].y)+" x e";};this.paint=function(params,containerExtents){if(params.component.canvas&&containerExtents){var p={},d=params.d,connector=params.component;if(params.strokeStyle){p.stroked="true";p.strokecolor=_ju.convertStyle(params.strokeStyle,true);}
if(params.lineWidth)p.strokeweight=params.lineWidth+"px";if(params.fillStyle){p.filled="true";p.fillcolor=params.fillStyle;}
var xmin=Math.min(d.hxy.x,d.tail[0].x,d.tail[1].x,d.cxy.x),ymin=Math.min(d.hxy.y,d.tail[0].y,d.tail[1].y,d.cxy.y),xmax=Math.max(d.hxy.x,d.tail[0].x,d.tail[1].x,d.cxy.x),ymax=Math.max(d.hxy.y,d.tail[0].y,d.tail[1].y,d.cxy.y),w=Math.abs(xmax-xmin),h=Math.abs(ymax-ymin),dim=[xmin,ymin,w,h];p.path=getPath(d);p.coordsize=(connector.w*scale)+","+(connector.h*scale);dim[0]=connector.x;dim[1]=connector.y;dim[2]=connector.w;dim[3]=connector.h;if(self.canvas==null){var overlayClass=connector._jsPlumb.overlayClass||"";var clazz=originalArgs&&(originalArgs.length==1)?(originalArgs[0].cssClass||""):"";p["class"]=clazz+" "+overlayClass;self.canvas=_node("shape",dim,p,connector.canvas.parentNode,connector._jsPlumb.instance,true);connector.appendDisplayElement(self.canvas,true);}
else{_pos(self.canvas,dim);_atts(self.canvas,p);}}};this.cleanup=function(){if(this.canvas!=null)this._jsPlumb.instance.removeElement(this.canvas);};};_ju.extend(AbstractVmlArrowOverlay,[VmlComponent,_jp.Overlays.AbstractOverlay],{setVisible:function(state){this.canvas.style.display=state?"block":"none";}});_jp.Overlays.vml.Arrow=function(){AbstractVmlArrowOverlay.apply(this,[_jp.Overlays.Arrow,arguments]);};_ju.extend(_jp.Overlays.vml.Arrow,[_jp.Overlays.Arrow,AbstractVmlArrowOverlay]);_jp.Overlays.vml.PlainArrow=function(){AbstractVmlArrowOverlay.apply(this,[_jp.Overlays.PlainArrow,arguments]);};_ju.extend(_jp.Overlays.vml.PlainArrow,[_jp.Overlays.PlainArrow,AbstractVmlArrowOverlay]);_jp.Overlays.vml.Diamond=function(){AbstractVmlArrowOverlay.apply(this,[_jp.Overlays.Diamond,arguments]);};_ju.extend(_jp.Overlays.vml.Diamond,[_jp.Overlays.Diamond,AbstractVmlArrowOverlay]);}).call(this);;(function(){"use strict";var root=this,_jp=root.jsPlumb,_ju=root.jsPlumbUtil,_jk=root.Katavorio,_jg=root.Biltong;var _getDragManager=function(instance,category){category=category||"main";var key="_katavorio_"+category;var k=instance[key],e=instance.getEventManager();if(!k){k=new _jk({bind:e.on,unbind:e.off,getSize:jsPlumb.getSize,getPosition:function(el){var o=instance.getOffset(el);return[o.left,o.top];},setPosition:function(el,xy){el.style.left=xy[0]+"px";el.style.top=xy[1]+"px";},addClass:jsPlumb.addClass,removeClass:jsPlumb.removeClass,intersects:_jg.intersects,indexOf:_ju.indexOf,css:{noSelect:instance.dragSelectClass,droppable:"jsplumb-droppable",draggable:"jsplumb-draggable",drag:"jsplumb-drag",selected:"jsplumb-drag-selected",active:"jsplumb-drag-active",hover:"jsplumb-drag-hover"}});instance[key]=k;instance.bind("zoom",k.setZoom);}
return k;};var _animProps=function(o,p){var _one=function(pName){if(p[pName]!=null){if(_ju.isString(p[pName])){var m=p[pName].match(/-=/)?-1:1,v=p[pName].substring(2);return o[pName]+(m*v);}
else return p[pName];}
else
return o[pName];};return[_one("left"),_one("top")];};_jp.extend(root.jsPlumbInstance.prototype,{animationSupported:true,scopeChange:function(el,elId,endpoints,scope,types){},getElement:function(el){if(el==null)return null;el=typeof el==="string"?el:el.length!=null&&el.enctype==null?el[0]:el;return typeof el==="string"?document.getElementById(el):el;},removeElement:function(element){_getDragManager(this).elementRemoved(element);this.getEventManager().remove(element);},doAnimate:function(el,properties,options){options=options||{};var o=this.getOffset(el),ap=_animProps(o,properties),ldist=ap[0]-o.left,tdist=ap[1]-o.top,d=options.duration||250,step=15,steps=d/step,linc=(step/d)*ldist,tinc=(step/d)*tdist,idx=0,int=setInterval(function(){jsPlumb.setPosition(el,{left:o.left+(linc*(idx+1)),top:o.top+(tinc*(idx+1))});if(options.step!=null)options.step();idx++;if(idx>=steps){window.clearInterval(int);if(options.complete!=null)options.complete();}},step);},destroyDraggable:function(el,category){_getDragManager(this,category).destroyDraggable(el);},destroyDroppable:function(el,category){_getDragManager(this,category).destroyDroppable(el);},initDraggable:function(el,options,category){_getDragManager(this,category).draggable(el,options);},initDroppable:function(el,options,category){_getDragManager(this,category).droppable(el,options);},isAlreadyDraggable:function(el){return el._katavorioDrag!=null;},isDragSupported:function(el,options){return true;},isDropSupported:function(el,options){return true;},isElementDraggable:function(el){el=jsPlumb.getElement(el);return el._katavorioDrag&&el._katavorioDrag.isEnabled();},getDragObject:function(eventArgs){return eventArgs[0].drag.getDragElement();},getDragScope:function(el){return el._katavorioDrag&&el._katavorioDrag.scopes.join(" ")||"";},getDropEvent:function(args){return args[0].e;},getDropScope:function(el){return el._katavorioDrop&&el._katavorioDrop.scopes.join(" ")||"";},getUIPosition:function(eventArgs,zoom){return{left:eventArgs[0].pos[0],top:eventArgs[0].pos[1]};},setDragFilter:function(el,filter,_exclude){if(el._katavorioDrag){el._katavorioDrag.setFilter(filter,_exclude);}},setElementDraggable:function(el,draggable){el=jsPlumb.getElement(el);if(el._katavorioDrag)
el._katavorioDrag.setEnabled(draggable);},setDragScope:function(el,scope){if(el._katavorioDrag)
el._katavorioDrag.k.setDragScope(el,scope);},dragEvents:{'start':'start','stop':'stop','drag':'drag','step':'step','over':'over','out':'out','drop':'drop','complete':'complete'},animEvents:{'step':"step",'complete':'complete'},stopDrag:function(el){if(el._katavorioDrag)
el._katavorioDrag.abort();},addToDragSelection:function(spec){_getDragManager(this).select(spec);},removeFromDragSelection:function(spec){_getDragManager(this).deselect(spec);},clearDragSelection:function(){_getDragManager(this).deselectAll();},getOriginalEvent:function(e){return e;},trigger:function(el,event,originalEvent){this.getEventManager().trigger(el,event,originalEvent);},doReset:function(){for(var key in this){if(key.indexOf("_katavorio_")===0){this[key].reset();}}}});var ready=function(f){var _do=function(){if(/complete|loaded|interactive/.test(document.readyState)&&typeof(document.body)!="undefined"&&document.body!=null)
f();else
setTimeout(_do,9);};_do();};ready(_jp.init);}).call(this);

(function(){"use strict";var a,b=this;a="undefined"!=typeof exports?exports:b.Farahey={};var d=function(a,b,c){for(var d=0,e=a.length,f=-1,g=0;e>d;)if(f=parseInt((d+e)/2),g=c(a[f],b),0>g)d=f+1;else{if(!(g>0))return f;e=f}
return d},e="undefined"!=typeof jsPlumbGeom?jsPlumbGeom:Biltong,f=function(a,b,c){var e=d(a,b,c);a.splice(e,0,b)},g=function(a,b){var c=a,d={},f=function(a){if(!d[a[1]]){var c=b(a[2]);d[a[1]]={l:a[0][0],t:a[0][1],w:c[0],h:c[1],center:[a[0][0]+c[0]/2,a[0][1]+c[1]/2]}}
return d[a[1]]};this.setOrigin=function(a){c=a,d={}},this.compare=function(a,b){var d=e.lineLength(c,f(a).center),g=e.lineLength(c,f(b).center);return g>d?-1:d==g?0:1}},h=function(a,b,c,d){return a[b]<=d&&d<=a[b]+a[c]},i=[function(a,b){return a.x+a.w-b.x},function(a,b){return a.x-(b.x+b.w)}],j=[function(a,b){return a.y+a.h-b.y},function(a,b){return a.y-(b.y+b.h)}],k=[null,[i[0],j[1]],[i[0],j[0]],[i[1],j[0]],[i[1],j[1]]],l=function(a,b,c,d,e){isNaN(c)&&(c=0);var f,g,i,j=b.y+b.h,l=c==1/0||c==-(1/0)?b.x+b.w/2:(j-d)/c,m=Math.atan(c);return h(b,"x","w",l)?(f=k[e][1](a,b),g=f/Math.sin(m),i=g*Math.cos(m),{left:i,top:f}):(i=k[e][0](a,b),g=i/Math.cos(m),f=g*Math.sin(m),{left:i,top:f})},m=a.calculateSpacingAdjustment=function(a,b){var c=a.center||[a.x+a.w/2,a.y+a.h/2],d=b.center||[b.x+b.w/2,b.y+b.h/2],f=e.gradient(c,d),g=e.quadrant(c,d),h=f==1/0||f==-(1/0)||isNaN(f)?0:c[1]-f*c[0];return l(a,b,f,h,g)},n=a.paddedRectangle=function(a,b,c){return{x:a[0]-c[0],y:a[1]-c[1],w:b[0]+2*c[0],h:b[1]+2*c[1]}},o=function(a,b,c,d,f,g,h,i,j,k){g=g||[0,0],k=k||function(){};var l,o,p=n(g,[1,1],d),q=100,r=1,s=!0,t={},u=function(a,b,c,d){t[a]=!0,b[0]+=c,b[1]+=d},v=function(){for(var g=0;g<a.length;g++){var t=b[a[g][1]],w=a[g][1],x=(a[g][2],c[a[g][1]]),y=n(t,x,d);h(a[g][1])&&e.intersects(p,y)&&(l=m(p,y),o=f(a[g][1],t,l),u(w,t,o.left,o.top)),y=n(t,x,d);for(var z=0;z<a.length;z++)if(g!=z&&h(a[z][1])){var A=b[a[z][1]],B=c[a[z][1]],C=n(A,B,d);e.intersects(y,C)&&(s=!0,l=m(y,C),o=f(a[z][1],A,l),u(a[z][1],A,o.left,o.top))}}
i&&k(),s&&q>r&&(s=!1,r++,i?window.setTimeout(v,j):v())};return v(),t},p=function(a){if(null==a)return null;if("[object Array]"===Object.prototype.toString.call(a)){var b=[];return b.push.apply(b,a),b}
var c=[];for(var d in a)c.push(a[d]);return c};b.Magnetizer=function(a){var b,d,e,h,i,j=a.getPosition,k=a.getSize,l=a.getId,m=a.setPosition,n=a.padding||[20,20],q=a.constrain||function(a,b,c){return c},r=[],s={},t={},u=p(a.elements||[]),v=a.origin||[0,0],w=a.executeNow,x=(this.getOrigin=function(){return v},a.filter||function(a){return!0}),y=a.orderByDistanceFromOrigin,z=new g(v,k),A=a.updateOnStep,B=a.stepInterval||350,C=a.debug,D=function(){var a=document.createElement("div");a.style.position="absolute",a.style.width="10px",a.style.height="10px",a.style.backgroundColor="red",document.body.appendChild(a),i=a},E=function(a){y&&0!=r.length?f(r,a,z.compare):r.push(a)},F=function(){z.setOrigin(v),r=[],s={},t={},b=d=1/0,e=h=-(1/0);for(var a=0;a<u.length;a++){var c=j(u[a]),f=k(u[a]),g=l(u[a]);s[g]=[c.left,c.top],E([[c.left,c.top],g,u[a]]),t[g]=f,b=Math.min(b,c.left),d=Math.min(d,c.top),e=Math.max(e,c.left+f[0]),h=Math.max(h,c.top+f[1])}},G=function(){if(u.length>1){var a=o(r,s,t,n,q,v,x,A,B,H);H(a)}},H=function(a){for(var b=0;b<u.length;b++){var c=l(u[b]);a[c]&&m(u[b],{left:s[c][0],top:s[c][1]})}},I=function(a){null!=a&&(v=a,z.setOrigin(a))};this.execute=function(a){I(a),F(),G()},this.executeAtCenter=function(){F(),I([(b+e)/2,(d+h)/2]),G()},this.executeAtEvent=function(b){var c=a.container,d=a.getContainerPosition(c),e=b.pageX-d.left+c[0].scrollLeft,f=b.pageY-d.top+c[0].scrollTop;C&&(i.style.left=b.pageX+"px",i.style.top=b.pageY+"px"),this.execute([e,f])},this.setElements=function(a){u=p(a)},this.addElement=function(a){u.push(a)},this.removeElement=function(a){for(var b=-1,c=0;c<u.length;c++)if(u[c]==a){b=c;break}-1!=b&&u.splice(b,1)},this.setPadding=function(a){n=a},this.setConstrain=function(a){q=c},this.setFilter=function(a){x=a},C&&D(),w&&this.execute()}}).call(this),function(){var exports=this;Array.prototype.peek=function(){return this.length>0?this[this.length-1]:null};var ieVersion="undefined"!=typeof navigator&&/MSIE\s([\d.]+)/.test(navigator.userAgent)?new Number(RegExp.$1):-1,oldIE=ieVersion>-1&&9>ieVersion,CustomTag=function(a,b,c){var d=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=_extend({},a[d]);_extend(e.atts,b.atts),c.push(e)}
return c}.bind(this);this.template=c.template,this.getFunctionBody=function(b){var e=a.compile(d(a.parse(c.template),b),!1,!0,!0);return e}.bind(this),this.getFunctionEnd=function(){return";_els.pop();"},this.rendered=c.rendered||function(){}},_eachNotEmpty=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];null!=d&&0!=d.length&&b(c,d)}},_extend=function(a,b){for(var c in b)a[c]=b[c];return a},_data=function(a,b,c){if(null==a)return null;if("$data"===b||null==b)return a;var d=a,e=d,f=null;return b.replace(/([^\.])+/g,function(a,b,d,g){if(null==f){var h=a.match(/([^\[0-9]+){1}(\[)([0-9+])/),i=d+a.length>=g.length,j=function(){return e[h[1]]||function(){return e[h[1]]=[],e[h[1]]}()};if(i)if(h){var k=j(),l=h[3];null==c?f=k[l]:k[l]=c}else null==c?f=e[a]:e[a]=c;else if(h){var m=j();e=m[h[3]]||function(){return m[h[3]]={},m[h[3]]}()}else e=e[a]||function(){return e[a]={},e[a]}()}}),f},InBrowserTemplateResolver=function(a){var b=document.getElementById(a);return null!=b?b.innerHTML:null},_isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},_isObject=function(a){return"[object Object]"===Object.prototype.toString.call(a)},_flatten=function(a){for(var b=[],c=0;c<a.length;c++)_isArray(a[c])?b.push.apply(b,_flatten(a[c])):b[b.length]=a[c];return b},_map=function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c.push(b(a[d]));return _flatten(c)},_filter=function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)b(a[d])&&c.push(a[d]);return c},_trim=function(a){if(null==a)return a;for(var b=a.replace(/^\s\s*/,""),c=/\s/,d=b.length;c.test(b.charAt(--d)););return b.slice(0,d+1)},_addBinding=function(a,b,c,d,e){var f=_uuid(),g={w:b,e:[],u:f};e.bindings[f]=g;var h=function(){return null!=d?"try {  if("+d+") { out = out.replace(this.e[k][0], eval(this.e[k][1])); } else out=''; } catch(__) { out='';}":"try { out = out.replace(this.e[k][0], eval(this.e[k][1])); } catch(__) { out=out.replace(this.e[k][0], '');}"},i=function(){return null!=d?"var out='';try { with($data) { if ("+d+") out = this.w; else return null; }}catch(_){return null;}":"var out = this.w;"};g.reapply=new Function("$data",i()+"for (var k = 0; k < this.e.length; k++) { with($data) { "+h()+" }} return out;"),c.bindings[a]=g,b.replace(/\$\{([^\}]*)\}/g,function(a,b,c,d){g.e.push([a,b])})},_bindOneAtt=function(a,b,c,d,e){c.atts[a]=b,_addBinding(a,b,c,d,e)},_parseAtts=function(a,b){function c(a,c){var d=a.match(/([^=]+)=['"](.*)['"]/);return null==d&&null==c?e.atts[a]="":null==d?_bindOneAtt(a,"",e,c,b):_bindOneAtt(d[1],d[2],e,c,b),d}
for(var d=b.parseAttributes(a),e={el:_trim(d[0]),atts:{},bindings:{}},f=1;f<d.length;f++){var g=_trim(d[f]);if(null!=g&&g.length>0){var h=g.match(b.inlineIfRe);if(h)for(var i=h[2].split(b.attributesRe),j=0;j<i.length;j++){var k=_trim(i[j]);null!=k&&k.length>0&&c(k,h[1])}else c(g)}}
return e},_uuid=function(a){var b=a?"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx":"xxxxxxxx-xxxx-4xxx";return b.replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},_bind=function(a,b){var c=this.bindings[b];return null==c?"":c.reapply(a)},AbstractEntry=function(a,b){this.uuid=_uuid(),this.children=[],this.context=a.context,this.instance=b,b.entries[this.uuid]=this},ElementEntry=function(a,b){AbstractEntry.apply(this,arguments);var c=_parseAtts(a,b),d=c.el.split(":");this.tag=c.el,2==d.length&&(this.namespace=d[0]),this.atts=c.atts,this.bindings=c.bindings,this.type="element",this.compile=function(a,b){if(a.customTags[this.tag]){for(var c=a.customTags[this.tag].getFunctionBody(this),d=0;d<this.children.length;d++)this.children[d].precompile&&(c+=this.children[d].precompile(a)),c+=this.children[d].compile(a),this.children[d].postcompile&&(c+=this.children[d].postcompile(a));return c+="_le=_els.pop();_rotors.customTags['"+this.tag+"'].rendered(_le, _rotors);"}
var e="/* element entry "+this.uuid+" */;";if(this.remove!==!0){e+=a.getExecutionContent(this.tag,this.uuid,!1,this.namespace);for(var f in this.atts)if(this.atts.hasOwnProperty(f)){var g;g=null!=this.bindings[f]?"_rotors.bind(data[0], '"+this.bindings[f].u+"');":"'"+this.atts[f]+"'",e+="__a="+g+";if(__a!=null) e.setAttribute('"+f+"',__a || '');"}}
for(var h=0;h<this.children.length;h++)this.children[h].precompile&&(e+=this.children[h].precompile(a)),e+=this.children[h].compile(a),this.children[h].postcompile&&(e+=this.children[h].postcompile(a));return this.remove===!0||b||(e+="_le=_els.pop();"),e};var e=function(a,c){b.each(c.split(";"),function(b){var c=b.indexOf(":"),d=b.substring(0,c),e=b.substring(c+1);a.style[d]=e})};this.update=function(a,b){for(var c in this.atts)if(this.atts.hasOwnProperty(c)&&"class"!==c){var d;d=null!=this.bindings[c]?this.bindings[c].reapply(b):"'"+this.atts[c]+"'",null!=d&&("style"===c&&null!=a.style?e(a,d):a.setAttribute(c,d))}}},CommentEntry=function(a){this.uuid=_uuid(),this.comment=a,this.compile=function(){return""}},TextEntry=function(a,b){AbstractEntry.apply(this,arguments),this.value=a.value,this.type="text",this.bindings={};var c=function(){return"_rotors.bind(data[0], '"+this.bindings.__element.u+"', typeof $key !== 'undefined' ? $key : null, typeof $value !== 'undefined' ? $value : null)"}.bind(this);this.compile=function(a){return a.getExecutionContent(c(),this.uuid,!0)},this.update=function(a,b){a.nodeValue=this.bindings.__element.reapply(b)}},Fakement=function(){this.childNodes=[],this.appendChild=function(a){this.childNodes.push(a)}},FakeElement=function(a){Fakement.apply(this),this.tag=a;var b={};this.setAttribute=function(a,c){b[a]=c},this.getAttribute=function(a){return b[a]}},FakeTextNode=function(a){this.nodeValue=a},_getDefaultTemplateResolver=function(a){return a.isBrowser?InBrowserTemplateResolver:null},_wrapCache=function(a,b,c){return function(d){var e=c?null:a.cache[d];return null==e&&(e=b(d)),null==e&&(e=a.defaultTemplate),null!=e&&(a.cache[d]=e),e}},RotorsInstance=function(a){a=a||{},this.cache={},this.templateCache={},null!=a.defaultTemplate&&this.setDefaultTemplate(a.defaultTemplate)},_e=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};_e(RotorsInstance.prototype,{bindings:{},entries:{},executions:{},bind:_bind,defaultTemplate:"<div></div>",defaultCompiledTemplate:null,setDefaultTemplate:function(a){null!=a?(this.defaultTemplate=a,this.defaultCompiledTemplate=this.compile(this.parse(a))):this.clearDefaultTemplate()},clearDefaultTemplate:function(){this.defaultTemplate=null,this.defaultCompiledTemplate=null},clearCache:function(){this.cache={},this.templateCache={}},namespaceHandlers:{svg:function(a){return"e = document.createElementNS('http://www.w3.org/2000/svg', '"+a.split(":")[1]+"');e.setAttribute('version', '1.1');e.setAttribute('xmlns', 'http://www.w3.org/1999/xhtml');"}},each:function(a,b,c,d){var e;if(_isArray(a))for(e=0;e<a.length;e++)b(a[e],c,e,d);else for(e in a)a.hasOwnProperty(e)&&b({$key:e,$value:a[e]},c,e,d)},openRe:new RegExp("<([^/>]*?)>$|<([^/].*[^/])>$"),closeRe:new RegExp("^</([^>]+)>"),openCloseRe:new RegExp("<(.*)(/>$)"),tokenizerRe:/(<[^\^>]+\/>)|(<!--[\s\S]*?-->)|(<[\/a-zA-Z0-9\-:]+(?:\s*[a-zA-Z\-]+=\"[^\"]+\"|\s*[a-zA-Z\-]+='[^']+'|\s*[a-zA-Z\-]|\s*\{\{.*\}\})*>)/,commentRe:/<!--[\s\S]*?-->/,attributesRe:/([a-zA-Z0-9\-_]+="[^"]*")|(\{\{if [^(?:\}\})]+\}\}.*\{\{\/if\}\})/,inlineIfRe:/\{\{if ([^\}]+)\}\}(.*)\{\{\/if\}\}/,singleExpressionRe:/^[\s]*\$\{([^\}]*)\}[\s]*$/,parseAttributes:function(a){return null==a?a:this.filterEmpty(a.replace("/>",">").split(/^<|>$/)[1].split(this.attributesRe))},map:_map,flatten:_flatten,filter:_filter,data:_data,camelize:function(a){return a},dataExperiment:function(inObj,path,value){if(null==inObj)return null;if("$data"===path||null==path)return inObj;var h;with(inObj)if(null!=value){var v="string"==typeof value?'"'+value+'"':value;eval(path+"="+v)}else eval("h="+path);return h},uuid:_uuid,filterEmpty:function(a){return _filter(a,function(a){return null!=a&&_trim(a).length>0})},isBrowser:function(){return"undefined"!=typeof document}(),isOldIE:function(){return oldIE},createFragment:function(){return this.isBrowser?this.isOldIE()?document.createElement("div"):document.createDocumentFragment():new Fakement},createTextNode:function(a){return this.isBrowser?document.createTextNode(a):new FakeTextNode(a)},createElement:function(a){return this.isBrowser?document.createElement(a):new FakeElement(a)},customElements:{"r-each":{parse:function(a,b,c,d){a.context=a.atts["in"],a.type="each"},compile:function(a){var b=function(){var b="function(item, _rotorsLoopId, _rotorsLoopIndex, _rotorsLoopContext) { ";b+="data.unshift(item);$value=item;$key=_rotorsLoopIndex;";for(var c=0;c<this.children.length;c++)b+=this.children[c].compile(a),b+=";_rotors.popExecutionTrace(_eid, '"+this.uuid+"');";return b+="data.splice(0,1);",b+="}"}.bind(this),c="_rotors.traceExecution(null, _eid, '"+this.uuid+"');",d=this.context?';data.unshift(_rotors.data(data[0], "'+this.context+'"));':"",e="_rotors.each(data[0], "+b()+",'"+this.uuid+"', '"+this.context+"');",f=this.context?";data.splice(0, 1);":"";return c+d+e+f}},"r-if":{parse:function(a,b,c,d){a.test=a.atts.test},compile:function(a){var b,c="",d="",e=this.happyFlowChildren||this.children;for(b=0;b<e.length;b++)c+=e[b].compile(a)+";";if(null!=this.happyFlowChildren){for(d="else {",b=0;b<this.children.length;b++)d+=this.children[b].compile(a)+";";d+="}"}
return";with (data[0]) { if("+this.test+") { "+c+" }"+d+"}"}},"r-else":{remove:!0,parse:function(a,b,c,d,e){var f=e.peek();null!=f&&"r-if"===f.tag&&(f.happyFlowChildren=f.children,f.children=[])},compile:function(a){}},"r-for":{parse:function(a,b,c,d,e){a.loop=a.atts.loop},compile:function(a){var b="";b+="var __limit; with(data[0]){__limit=("+this.loop+");}",b+="for(var $index=0;$index<__limit;$index++){data[0].$index=$index;";for(var c=0;c<this.children.length;c++)b+=this.children[c].compile(a)+";";return b+="}delete data[0].$index;"}},"r-tmpl":{remove:!0,parse:function(a,b,c,d){a.type="template",a.context=a.atts.context,a.templateId=a.atts.id;var e=c(a.templateId),f=d.parse(e,c);d.debug("nested ast",f),a.children=f},precompile:function(a){return this.context?';data.unshift(_rotors.data(data[0], "'+this.context+'"));':""},postcompile:function(a){return this.context?";data.splice(0, 1);":""}}},customTags:{},registerTag:function(a,b){this.customTags[a]=new CustomTag(this,a,b)},debugEnabled:!1,debug:function(){this.debugEnabled&&console.log.apply(console,arguments)},maybeDebug:function(){this.debugEnabled&&arguments[0]&&console.log.apply(console,arguments)},parse:function(a,b){b=_wrapCache(this,b||_getDefaultTemplateResolver(this),null);var c=[],d=[],e=this,f=function(a,b){var c=a.match(b);return null==c?!1:c},g=function(){return c.length>0?c[c.length-1]:null},h=function(a){var b=g();return null!=b&&b.tag==a},i=function(a,b){c.length>0&&g().children.push(a),b?0==c.length&&d.push(a):c.push(a)},j=function(a){i(a,!0)},k=function(){var a=c.pop();return 0==c.length&&d.push(a),a},l=function(a,b,d,e){var f=new ElementEntry(a,e),g=e.customElements[f.tag];return g&&(g.parse(f,b,d,e,c),g.compile&&(f.compile=g.compile),f.precompile=g.precompile,f.postcompile=g.postcompile,f.custom=!0,f.remove=g.remove,e.debug("  element is a custom element"),e.maybeDebug(f.remove,"  element's root should not appear in output")),f},m=[{re:e.commentRe,handler:function(a,b,c,d){d.debug("comment",a,b),i(new CommentEntry(a),!0)}},{re:e.openRe,handler:function(a,b,c,d){d.debug("open element",a,b);var e=l(a,b,c,d);i(e,e.remove)}},{re:e.closeRe,handler:function(a,b,c,d){d.debug("close element",a,b);var e=d.customElements[b[1]];if(null==e||!e.remove){if(!h(b[1]))throw new TypeError("Unbalanced closing tag '"+b[1]+"'; opening tag was '"+k().tag+"'");k()}}},{re:e.openCloseRe,handler:function(a,b,c,d){d.debug("open and close element",a,b);var e=l(a,b,c,d);i(e,!0)}},{re:/.*/,handler:function(a,b,c,d){var e=_trim(a);if(null!=e&&e.length>0){d.debug("text node",a);var f=new TextEntry({value:e},d);j(f),_addBinding("__element",e,f,null,d)}}}];return _eachNotEmpty(_trim(a).split(this.tokenizerRe),function(a,c){for(var d=0;d<m.length;d++){c=_trim(c);var e=f(c,m[d].re);if(e){m[d].handler(c,e,b,this);break}}}.bind(this)),d},compile:function(a,b,c,d){for(var e="data=[data||{}];var frag=_rotors.createFragment(),_els=[],e,_le,__a,$value,$key,_eid = _rotors.newExecutionContext();_els.push(frag);",f="return frag;",g=[],h=0;h<a.length;h++){var i="";a[h].precompile&&(i+=a[h].precompile(this)),i+=a[h].compile(this,d),a[h].postcompile&&(i+=a[h].postcompile(this)),g.push(i)}
var j=g.join("");if(this.debug("function body :",j),c)return j;var k=new Function("data,_rotors",e+g.join("")+f),l=this;return b?k:function(a){return k.apply(this,[a,l])}},newExecutionContext:function(){var a=this.uuid();return this.executions[a]={current:{children:[]}},a},traceExecution:function(a,b,c,d){var e={el:a,children:[],id:c,index:d};this.executions[b].current.children.push(e);var f=c+(null!=d?"-"+d:"");this.executions[b][f]=e,this.executions[b].current=e},popExecutionTrace:function(a,b){this.executions[a].current=this.executions[a][b]},getExecutionContent:function(a,b,c,d,e){var f=null!=d?this.namespaceHandlers[d](a):c?"e=_rotors.createTextNode("+a+");":"e=_rotors.createElement('"+a+"');";return f+"_els.peek().appendChild(e);"+(c?"":"_els.push(e);")+"e._rotors=_rotors.entries['"+b+"'];e._rotorsEid=_eid;if(typeof _rotorsLoopId !== 'undefined') {e._rotorsLoopId=_rotorsLoopId;e._rotorsLoopIndex=_rotorsLoopIndex;e._rotorsLoopContext=_rotorsLoopContext;}_rotors.traceExecution(e, _eid, '"+b+"', typeof _rotorsLoopIndex != 'undefined' ? _rotorsLoopIndex : null);"},updaters:{},onUpdate:function(a,b){if(null!=a._rotors){var c=a._rotors.instance;a._RotorsUpdate=a._RotorsUpdate||_uuid(),c.updaters[a._RotorsUpdate]=c.updaters[a._RotorsUpdate]||[],c.updaters[a._RotorsUpdate].push(b)}},update:function(a,b){var c,d,e,f=[],g=a._rotorsEid;if(null!=g&&null!=a._rotors){e=a._rotors.instance,c=e.executions[g];var h=a._rotorsLoopIndex,i=a._rotors.uuid+(null!=h?"-"+h:"");d=c[i];var j=function(a,b,c){null!=a&&(a._rotors.update(a,b),a._RotorsUpdate&&e.updaters[a._RotorsUpdate]&&f.push([a,e.updaters[a._RotorsUpdate],b]));for(var d=0;d<c.children.length;d++){var g=e.entries[c.children[d].id],h="each"===e.entries[c.id].type,i=h&&null!=c.children[d].el&&null!=c.children[d].el._rotorsLoopIndex?b[c.children[d].el._rotorsLoopIndex]:e.data(b,g.context);j(c.children[d].el,i,c.children[d])}};j(a,b,d);for(var k=0;k<f.length;k++)for(var l=f[k],m=0;m<l[1].length;m++)try{l[1][m](l[0],l[2])}catch(n){}}},template:function(a,b,c,d){var e,f=d?null:this.templateCache[a];if(null!=f)return e=f(b),this.isOldIE()?e.childNodes[0]:e;c=_wrapCache(this,c||_getDefaultTemplateResolver(this),d);var g=c(a);if(null!=g){var h=this.parse(g,c),i=this.compile(h);return this.templateCache[a]=i,e=i(b),this.isOldIE()?e.childNodes[0]:e}
return this.createFragment()},precompileTemplate:function(a,b){var c=this.parse(a,b||_getDefaultTemplateResolver(this));return this.compile(c,!0)},precompileTemplates:function(a,b){var c=function(c){var d=a[c];return d||(b||_getDefaultTemplateResolver(this))(c)},d={};for(var e in a)d[e]=this.precompileTemplate(a[e],c);return d},importTemplate:function(a,b){var c=this;b="string"==typeof b?Function("data","_rotors",b):b,this.templateCache[a]=function(a){return b.apply(c,[a,c])}},importTemplates:function(a){for(var b in a)this.importTemplate(b,a[b])},importBindings:function(a){this.bindings=this.bindings||{};for(var b in a){var c=a[b];this.bindings[b]={e:c.e,u:c.u,w:c.w,reapply:Function("$data",c.reapply)}}}});var newInstance=function(a){return new RotorsInstance(a)},exportBindings=function(a){var b={};for(var c in a.bindings){var d=a.bindings[c];b[c]={e:d.e,u:d.u,w:d.w,reapply:String(d.reapply).replace(/^function\s*\S+\s*\([^)]*\)\s*\{|\}$/g,"")}}
return b},precompile=function(a,b){b=b||"rotors";var c,d=(exports.Rotors||exports).newInstance(),e={},f=new RegExp("<script type=['\"]"+b+"['\"] id=['\"]([^'\"]+)['\"]>((.*\n)*?)</script>","g");c=a.replace(f,function(a,b,c){return e[b]=c,""});var g=[{},null,c];for(var h in e)g[0][h]=String(d.precompileTemplate(e[h],function(a){return e[a]})).replace(/^function\s*\S+\s*\([^)]*\)\s*\{|\}$/g,"");return g[1]=exportBindings(d),g};"undefined"!=typeof document?(exports.Rotors={newInstance:newInstance,precompile:precompile},exports.RotorsInstance=RotorsInstance):(exports.newInstance=newInstance,exports.instanceClass=RotorsInstance,exports.precompile=precompile)}.call(this),function(){var a=this;a.jsPlumbToolkitUtil=a.jsPlumbToolkitUtil||{};var b=a.jsPlumbToolkitUtil,c=function(a,b){return function(){return a.apply(b,arguments)}};b.requestAnimationFrame=c(a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b,c){a.setTimeout(b,10)},a);b.ajax=function(a){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),c=a.type||"GET";if(b){var d="json"===a.dataType?function(a){return JSON.parse(a)}:function(a){return a};b.open(c,a.url,!0),b.onreadystatechange=function(){4==b.readyState&&("2"===(""+b.status)[0]?a.success(d(b.responseText)):a.error&&a.error(b.responseText,b.status))},b.send(a.data?JSON.stringify(a.data):null)}else a.error&&a.error("ajax not supported")},b.debounce=function(a,b){b=b||150;var c=null;return function(){window.clearTimeout(c),c=window.setTimeout(a,b)}},b.xml={setNodeText:function(a,b){a.text=b;try{a.textContent=b}catch(c){}},getNodeText:function(a){return null!=a?a.text||a.textContent:""},getChild:function(a,b){for(var c=null,d=0;d<a.childNodes.length;d++)if(1==a.childNodes[d].nodeType&&a.childNodes[d].nodeName==b){c=a.childNodes[d];break}
return c},getChildren:function(a,b){for(var c=[],d=0;d<a.childNodes.length;d++)1==a.childNodes[d].nodeType&&a.childNodes[d].nodeName==b&&c.push(a.childNodes[d]);return c},xmlToString:function(a){try{return(new XMLSerializer).serializeToString(a).replace(/\s*xmlns=\"http\:\/\/www.w3.org\/1999\/xhtml\"/g,"")}catch(b){try{return a.xml}catch(c){throw new Error("Cannot serialize XML "+c)}}
return!1},createElement:function(a,b,c){var d;try{d=new ActiveXObject("Microsoft.XMLDOM").createNode(1,a,"")}catch(e){d=document.createElement(a)}
if(c&&jsPlumbToolkitUtil.xml.setNodeText(d,c),b)for(var f in b)d.setAttribute(f,b[f]);return d}}}.call(this),function(){"use strict";var a=this;a.jsPlumbToolkitUtil=a.jsPlumbToolkitUtil||{};var b=a.jsPlumbToolkitUtil,c=a.jsPlumbUtil;b.fastTrim=function(a){for(var b=a.replace(/^\s\s*/,""),c=/\s/,d=b.length;c.test(b.charAt(--d)););return b.slice(0,d+1)},b.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},b.populate=function(a,b){var d=function(a){var c=a.match(/(\${.*?})/g);if(null!=c)for(var d=0;d<c.length;d++){var e=b[c[d].substring(2,c[d].length-1)];e&&(a=a.replace(c[d],e))}
return a},e=function(a){if(null!=a){if(c.isString(a))return d(a);if(c.isArray(a)){for(var b=[],f=0;f<a.length;f++)b.push(e(a[f]));return b}
if(c.isObject(a)){var b={};for(var f in a)b[f]=e(a[f]);return b}
return a}};return e(a)},b.mergeWithParents=function(a,b,c){c=c||"parent";var d=function(a){return a?b[a]:null},e=function(a){return a?d(a[c]):null},f=function(a,b){if(null==a)return b;var c=jsPlumbUtil.merge(a,b);return f(e(a),c)},g=function(a){if(null==a)return{};if("string"==typeof a)return d(a);if(a.length){for(var b,c=!1,e=0;!c&&e<a.length;)b=g(a[e]),b?c=!0:e++;return b}},h=g(a);return h?f(e(h),h):{}}}.call(this),function(){var a={nodeTraverseStart:"startNodeTraversal",nodeTraverseEnd:"endNodeTraversal",start:"startOverlayAnimation",end:"endOverlayAnimation"},b={nodeTraversing:"jtk-animate-node-traversing",edgeTraversing:"jtk-animate-edge-traversing",nodeTraversable:"jtk-animate-node-traversable",edgeTraversable:"jtk-animate-edge-traversable"};jsPlumb.Connection.prototype.animateOverlay=function(c,d){var e=this,f=new jsPlumbUtil.EventGenerator,g=e.getConnector().getLength();d=d||{};var h,i,j,k=jsPlumbUtil.uuid(),l=d.forwards!==!1,m=d.rate||30,n=d.dwell||250,o=d.speed||100,p=g/o*1e3,q=p/m,r=1/q*(l?1:-1),s=d.isFinal!==!1,t=l?0:1,u=function(){return l?x>=1:0>=x},v=l?e.source:e.target,w=l?e.target:e.source,x=t,y=function(){x+=r,u()?C():(i.loc=x,e.repaint())};if("string"==typeof c)j=[c,{location:t,id:k}];else{var z=jsPlumb.extend({},c[1]);z.location=t,z.id=k,j=[c[0],z]}
var A=function(){f.fire(a.start,e),i=e.addOverlay(j),h=window.setInterval(y,m)},B=function(){f.fire(a.nodeTraverseStart,{connection:e,element:v}),jsPlumb.addClass(v,b.nodeTraversing),e.addClass(b.edgeTraversing),window.setTimeout(function(){jsPlumb.removeClass(v,b.nodeTraversing),f.fire(a.nodeTraverseEnd,{connection:e,element:v}),A()},n)},C=function(){e.removeOverlay(k),window.clearInterval(h),s?(jsPlumb.addClass(w,b.nodeTraversing),window.setTimeout(function(){jsPlumb.removeClass(w,b.nodeTraversing),e.removeClass(b.edgeTraversing),f.fire(a.end,e)},n)):(e.removeClass(b.edgeTraversing),f.fire(a.end,e))};return d.previous?d.previous.bind(a.end,B):B(),f}}(),function(){"use strict";var a=this,b=["node","port","edge"],c=["Refreshed","Added","Removed","Updated","Moved"];a.jsPlumbToolkitUtil.AutoSaver=function(a,d,e,f){for(var g=function(){a.save({url:d,success:e,error:f})},h=0;h<b.length;h++)for(var i=0;i<c.length;i++)a.bind(b[h]+c[i],g)},a.jsPlumbToolkitUtil.CatchAllEventHandler=function(a){for(var d=function(){a.fire("dataUpdated")},e=0;e<b.length;e++)for(var f=0;f<c.length;f++)a.bind(b[e]+c[f],d)}}.call(this),function(){var a=this,b=a.jsPlumbToolkitUtil,c=b,d=jsPlumbUtil;c.Selection=function(a){jsPlumbUtil.EventGenerator.apply(this,arguments);var b,e=a.toolkit,f=[],g=[],h=Math.Infinity,i=Math.Infinity,j=a.generator,k={},l=this,m=a.onClear||function(){},n=function(a){return"Edge"===a.objectType?g:f},o=function(a){var d=[],e=n(a),f="Edge"===a.objectType?i:h;if(e.length>=f){if(b===c.Selection.DISCARD_NEW)return!1;d=e.splice(0,1),p(d[0],"Removed"),delete k[d[0].getFullId()]}
return e.push(a),p(a,"Added"),d},p=function(a,b){var c=a.objectType.toLowerCase()+b,d={Node:{data:a.data,node:a},Port:{data:a.data,node:a.node,port:a},Edge:{data:a.data,edge:a}};l.fire(c,d[a.objectType])};this.getModel=e.getModel,this.setSuspendGraph=e.setSuspendGraph,this.getNodeId=e.getNodeId,this.getEdgeId=e.getEdgeId,this.getPortId=e.getPortId,this.getNodeType=e.getNodeType,this.getEdgeType=e.getEdgeType,this.getPortType=e.getPortType,this.getObjectInfo=e.getObjectInfo,this.isDebugEnabled=e.isDebugEnabled;var q=function(a,b){if(!k[a.getFullId()]){var c=o(a);return c===!1?[[],[]]:(k[a.getFullId()]=a,b&&b(a,!0),[[a],c])}
return[[],[]]},r=function(a,b){var c=d.removeWithFunction(n(a),function(b){return b.id==a.id});return c&&p(a,"Removed"),delete k[a.getFullId()],b&&b(a,!1),[[],[]]},s=function(a,b){return k[a.getFullId()]?r(a,b):q(a,b)},t=function(a,b,c){var d=[],f=[];if(null==a)return d;var g=function(a){var h;if(jsPlumbUtil.isString(a)){if(h=e.getNode(a)||e.getEdge(a),null!=h){var i=b(h,c);d.push.apply(d,i[0]),f.push.apply(f,i[1])}}else if(a.eachNode&&a.eachEdge)a.eachNode(function(a,b){g(b)}),a.eachEdge(function(a,b){g(b)});else if(a.each)a.each(function(a,b){g(b.vertex||b)});else if(null!=a.length)for(var j=0;j<a.length;j++)g(a[j],c);else{var i=b(a,c);d.push.apply(d,i[0]),f.push.apply(f,i[1])}};return g(a),[d,f]}.bind(this);e.bind("nodeRemoved",function(a){r(a.node)}),e.bind("portRemoved",function(a){r(a.port)}),e.bind("edgeRemoved",function(a){r(a.edge)}),e.bind("edgeTarget",function(a){k[a.edge.getFullId()]&&l.fire("edgeTarget",a)}),e.bind("edgeSource",function(a){k[a.edge.getFullId()]&&l.fire("edgeSource",a)}),e.bind("nodeUpdated",function(a){k[a.node.getFullId()]&&l.fire("nodeUpdated",a)}),e.bind("edgeUpdated",function(a){k[a.edge.getFullId()]&&l.fire("edgeUpdated",a)}),e.bind("portUpdated",function(a){k[a.port.getFullId()]&&l.fire("portUpdated",a)}),this.remove=function(a,b){return t(a,r,b)},this.append=function(a,b){return t(a,q,b)},this.toggle=function(a,b){return t(a,s,b)},this.setMaxNodes=function(a){h=a},this.setMaxEdges=function(a){i=a},this.setCapacityPolicy=function(a){b=a},this.clear=function(a){f.length=0,g.length=0,k={},a||m(this)},this.reload=function(){if(null!=j){this.clear(),this.fire("dataLoadStart"),j(this,e);for(var a=0;a<f.length;a++)l.fire("nodeAdded",f[a]);for(var a=0;a<edges.length;a++)l.fire("edgeAdded",g[a]);this.fire("dataLoadEnd")}},this.each=function(a,b){for(var c="Edge"!=b?f:g,d=0;d<c.length;d++)try{a(d,c[d])}catch(e){jsPlumbUtil.log("Selection iterator function failed",e)}},this.eachNode=this.each,this.eachEdge=function(a){this.each(a,"Edge")},this.getNodeCount=function(){return f.length},this.getNodeAt=function(a){return f[a]},this.getNodes=function(){return f},this.getNode=e.getNode,this.getAllEdgesFor=function(a){for(var b=a.getAllEdges(),c=[],d=0;d<b.length;d++)null!=k[b[d].getId()]&&c.push(b[d]);return c},this.getEdgeCount=function(){return g.length},this.get=this.getNodeAt=function(a){return f[a]},this.getEdge=function(a){return g[a]},this.setCapacityPolicy(c.Selection.DISCARD_EXISTING)},c.Selection.DISCARD_EXISTING="discardExisting",c.Selection.DISCARD_NEW="discardNew"}.call(this),function(){"use strict";var a=this,b=a.jsPlumbGraph={};b.version="0.1",b.name="jsPlumbGraph";var c=function(a,b){var c={};this.setAttribute=function(a,b){c[a]=b},this.getAttribute=function(a){return c[a]};var d=b.getType(a||{});this.getType=function(){return d},this.setType=function(a){d=a},this.graph=b},d=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},e=function(a,b,c){if(null==a)return d();if("string"==typeof a)return a;var e=b||c.getIdFunction();return e(a)||d()},f=function(a){return"string"==typeof a?{id:a}:a},g=b.Vertex=b.Node=function(a,d,g){var i=this;c.apply(this,[a,g]),this.objectType="Node",this.id=e(a,d,g),this.data=f(a),this.getFullId=function(){return this.id};var j=[],k=0,l=0,m=[],n=[],o={};this.getEdges=function(a){if(null==a||null==a.filter)return j;for(var b=[],c=0;c<j.length;c++)a.filter(j[c])&&b.push(j[c]);return b},this.getSourceEdges=function(){return this.getEdges({filter:function(a){return a.source==this}.bind(this)})},this.getTargetEdges=function(){return this.getEdges({filter:function(a){return a.target==this}.bind(this)})},this.addEdge=function(a){j.push(a),a.source!==i&&a.isDirected()||l++,a.target!==i&&a.isDirected()||k++},this.deleteEdge=function(a){for(var b=-1,c=0;c<j.length;c++)if(j[c].getId()===a.getId()){b=c;break}
return b>-1?(j.splice(b,1),a.source!==i&&a.isDirected()||l--,a.target!==i&&a.isDirected()||k--,!0):!1},this.getAllEdges=function(a){for(var b=this.getEdges(a).slice(0),c=0;c<m.length;c++)b.push.apply(b,m[c].getEdges(a));return b},this.addGraph=function(a){return a="string"==typeof a?new b.Graph({id:a}):a,n.push(a),a.id||(a.id=""+n.length),a},this.getGraph=function(a){for(var b=0;b<n.length;b++)if(n[b].id===a)return n[b]},this.getIndegreeCentrality=function(){for(var a=0,b=0;b<m.length;b++)a+=m[b].getIndegreeCentrality();return k+a},this.getOutdegreeCentrality=function(){for(var a=0,b=0;b<m.length;b++)a+=m[b].getOutdegreeCentrality();return l+a},this.getPorts=function(){return m},this.addPort=function(a,b){var c=e(a,b,g),d=i.getPort(c);return null==d&&(d=new h(a,b,i),m.push(d),o[d.id]=d),d},this.setPort=function(a,b){var c=i.getPort(a);return c||(c=i.addPort({id:a})),c.data=b,c.setType(this.graph.getType(b)),c},this.getPort=function(a){return o[a]};var p=function(a){return a.constructor==jsPlumbGraph.Port?a.id:a};this.removePort=function(a){if(a){for(var b=p(a),c=-1,d=!1,e=0;e<m.length;e++)if(m[e].id===b){c=e;break}-1!=c&&(m.splice(c,1),d=!0),delete o[b]}
return d};var q=0,r={};this.setDefaultInternalCost=function(a){q=a},this.getInternalEdge=function(a,b){var c=p(a),d=p(b),e={source:o[c],target:o[d],cost:1/0};if(e.source&&e.target){var f=r[c+"-"+d]||{cost:q,directed:!1};for(var g in f)e[g]=f[g]}
return e},this.setInternalEdge=function(a,b,c,d){var e=p(a),f=p(b);return r[e+"-"+f]={cost:c||q,directed:d},this.getInternalEdge(a,b)},this.inspect=function(){for(var a="{ id:"+this.id+", edges:[\n",b=0;b<j.length;b++)a+=j[b].inspect()+"\n";return a+="]}"}},h=b.Port=function(a,b,c){g.apply(this,[a,b,c.graph]),this.objectType="Port",this.getNode=function(){return c},this.getFullId=function(){return c.id+this.graph.getPortSeparator()+this.id},this.isChildOf=function(a){return c==a},this.getPorts=this.addPort=this.deletePort=this.getPort=null},i=b.Edge=function(a){c.call(this,a.data,a.graph),this.source=a.source,this.target=a.target,this.objectType="Edge";var b=this,d=a.cost||1,e=!(a.directed===!1),f=a.id,g=null;this.data=a.data||{},this.getCost=function(){return d},this.setCost=function(a){d=a},this.getId=this.getFullId=function(){return null===f?b.source.id+"_"+b.target.id:f},this.setId=function(a){f=a},this.isDirected=function(){return e},this.setDirected=function(a){e=a},this.inspect=function(){return null!=f?"{ id:"+f+", connectionId:"+g+", cost:"+d+", directed:"+e+", source:"+b.source.id+", target:"+b.target.id+"}":void 0}},j=(b.Graph=function(a){a=a||{},this.vertices=[],this.edges=[],this.id=a.id;var c={},d=0,f={},h=0,j=!(a.defaultDirected===!1),k=a.defaultCost||1,n=this,o=a.idFunction||function(a){return a.id},p=a.typeFunction||function(a){return a.type||"default"},q=a.enableSubgraphs===!0,r=a.portSeparator||".";this.setIdFunction=function(a){o=a},this.getIdFunction=function(){return o},this.setTypeFunction=function(a){p=a},this.getType=function(a){return p(a)},this.setEnableSubgraphs=function(a){q=a},this.setPortSeparator=function(a){r=a},this.getPortSeparator=function(){return r};var s=function(a,d){if(null==a)return null;if("string"!=typeof a){if(a.constructor==b.Port||a.constructor==b.Node)return a;var e=a;if(a=o(a),"string"!=typeof a)return e}
var f=q?a.split("/"):[a],g=function(a){if(c[a])return c[a];var b=a.split(r),e=b[0],f=c[e];if(2===b.length&&null!=f){var g=f.getPort(b[1]);return null==g&&d&&(g=f.addPort(b[1])),g}
return f};if(1==f.length)return g(f[0]);if(f.length>1&&f%2==0)throw"Subgraph path format error.";for(var h=null,i=null,j=0;j<f.length-1;j+=2)h=g(f[j]),i=h.getGraph(f[j+1]);return i.getVertex(f[f.length-1])};this.clear=function(){n.vertices.splice(0,n.vertices.length),d=0,h=0,c={},f={}},this.getVertices=this.getNodes=function(){return n.vertices},this.getVertexCount=this.getNodeCount=function(){return n.vertices.length},this.getVertexAt=this.getNodeAt=function(a){return n.vertices[a]},this.getEdgeCount=function(){return h},this.addEdge=function(a,b){var c=null==a.directed?j===!0:!(a.directed===!1),d=a.cost||k,g=e(a.data,b,this),l=s(a.source,!0),m=s(a.target,!0);if(null==l||null==l.objectType)throw new TypeError("Unknown source node ["+a.source+"]");if(null==m||null==m.objectType)throw new TypeError("Unknown target node ["+a.target+"]");var n=new i({source:l,target:m,cost:d,directed:c,data:a.data||{},id:g,graph:this});return n.source.addEdge(n),n.target.addEdge(n),f[g]=n,h++,n},this.addVertex=this.addNode=function(a,b){var e=new g(a,b||o,this);return c[e.id]?null:(this.vertices.push(e),c[e.id]=e,e._id=d++,e)},this.addVertices=this.addNodes=function(a,b){for(var c=0;c<a.length;c++)this.addVertex(a[c],b||o)},this.deleteVertex=this.deleteNode=function(a){var b=s(a);if(b){for(var e=-1,f=0;f<n.vertices.length;f++)if(n.vertices[f].id===b.id){e=f;break}
e>-1&&n.vertices.splice(e,1);for(var g=b.getEdges(),i=0;i<g.length;i++)n.deleteEdge(g[i]);if(h-=g.length,b.getPorts)for(var j=b.getPorts(),k=0;k<j.length;k++)n.deleteVertex(j[k]);delete c[b.id],d--}},this.deleteEdge=function(a){if(a=this.getEdge(a),null!=a){var b=s(a.source);b&&b.deleteEdge(a)&&h--;var c=s(a.target);c&&c.deleteEdge(a),delete f[a.getId()]}},this.getEdge=function(a){if(null!=a){if("string"!=typeof a){if(a.constructor==b.Edge)return a;var c=a;if(a=o(a),"string"!=typeof a)return c}
return f[a]}},this.getEdges=function(a){a=a||{};var b,c=a.source,d=a.target,e=a.filter||function(){return!0},g=function(a){return!(null!=c&&a.source==j!==c||null!=d&&a.target==j!==d)},h=[],i=function(a){e(a)&&g(a)&&h.push(a)};if(a.node){var j=s(a.node),k=j.getAllEdges();for(b=0;b<k.length;b++)i(k[b])}else for(b in f)i(f[b]);return h},this.findPath=function(a,b,c,d,e){return a=s(a),b=s(b),m.compute({graph:n,source:a,target:b,strict:!(c===!1),nodeFilter:d,edgeFilter:e})},this.getDistance=function(a,b,c){var d=this.findPath(a,b,c);return d.pathDistance},this.getVertex=this.getNode=s,this.setTarget=function(a,b){if(b=s(b),null==b)return{success:!1};var c=a.target;return a.target.deleteEdge(a),a.target=b,b.addEdge(a),{old:c,edge:a,"new":b,success:!0}},this.setSource=function(a,b){if(b=s(b),null==b)return{success:!1};var c=a.source;return a.source.deleteEdge(a),a.source=b,b.addEdge(a),{old:c,edge:a,"new":b,success:!0}},this.printPath=function(a,b){a=s(a),b=s(b);for(var c=this.findPath(a,b).path,d="["+a.id+" - "+b.id+"] : ",e=0;e<c.length;e++)d=d+"{ vertex:"+c[e].vertex.id+", cost:"+c[e].cost+", edge: "+(c[e].edge&&c[e].edge.getId())+" } ";return d},this.getDiameter=function(a){for(var b=0,c=0;c<n.vertices.length;c++)for(var d=0;d<n.vertices.length;d++)if(d!=c){var e=m.compute({graph:n,source:n.vertices[c],target:n.vertices[d]});if(null==e.path||0==e.path.length){if(!a)return 1/0}else b=Math.max(b,e.pathDistance)}
return b},this.diameter=this.getDiameter,this.getCentrality=function(a){return a=s(a),(a.getIndegreeCentrality()+a.getOutdegreeCentrality())/(n.getVertexCount()-1)},this.getDegreeCentrality=this.getCentrality,this.getIndegreeCentrality=function(a){return a=s(a),a.getIndegreeCentrality()/(n.getVertexCount()-1)},this.getOutdegreeCentrality=function(a){return a=s(a),a.getOutdegreeCentrality()/(n.getVertexCount()-1)},this.getCloseness=function(a){return 1/n.getFarness(a)},this.getFarness=function(a){a=s(a);var b=m.compute({graph:n,source:a,target:a,processAll:!0}),c=0;for(var d in b.dist)c+=b.dist[d];return c/(n.getVertexCount()-1)},this.getBetweenness=function(a){var b=n.getVertexCount(),c=(b-1)*(b-2)/2,d=0,e=0,f=function(a,b,c,d,e){var g=c.parents[a][b];if(0==g.length){var h=d.slice();h.unshift(a),e.push(h)}else for(var i=0;i<g.length;i++)if(-1==d.indexOf(g[i][0].id)){var h=d.slice();h.unshift(g[i][0].id),f(a,g[i][0].id,c,h,e)}};a=s(a);var g=l.compute({graph:n,focus:a});for(var h in g.paths)for(var i in g.paths[h])if(h!=i){var j=[],k=0;f(h,i,g,[i],j);for(var m=0;m<j.length;m++){var o=j[m].indexOf(a.id);o>0&&o<j[m].length-1&&k++}
d+=k/j.length,e+=k}
return d/c},this.inspect=function(){for(var a="",b=0;b<n.vertices.length;b++)a+=n.vertices[b].inspect()+"\n";return a},this.serialize=function(){for(var a={nodes:[],edges:[],ports:[]},b=0;b<n.vertices.length;b++){var c=n.vertices[b];a.nodes.push(c.data);for(var d=c.getAllEdges(),e=c.getPorts(),f=0;f<d.length;f++)if(d[f].source==c||"Port"===d[f].source.objectType&&d[f].source.getNode()==c){var g={source:d[f].source.getFullId(),target:d[f].target.getFullId()};d[f].data&&(g.data=d[f].data),a.edges.push(g)}
for(var h=0;h<e.length;h++){var i={};for(var j in e[h].data)i[j]=e[h].data[j];i.id=e[h].getFullId(),a.ports.push(i)}}
return a}},function(a,b,c,d,e){for(var f=-1,g=null,h=1/0,i=0;i<a.length;i++)if(!b[i]){var j=e(a[i]);h>j&&(h=j,f=i,g=a[i])}
return{node:g,index:f}}),k=function(a,b,c,d,e,f){for(var g=[],h=d,i=e(h);null!=b[i];)g.splice(0,0,{vertex:h,cost:a[i],edge:c[i]}),h=b[i],i=e(h);return g.splice(0,0,{vertex:h,cost:0,edge:null}),g},l={getPath:function(a,b,c,d){if(a[c.id][d.id]==1/0)return null;var e=b[c.id][d.id];return null==e?" ":l.getPath(a,b,c,e)+" "+e.id+" "+l.getPath(a,b,e,d)},getPaths:function(a,b,c,d,e){if(a[c.id][d.id]==1/0)return null;var f=b[c.id][d.id];return 0==f.length?" ":l.getPaths(a,b,c,f[0])+" "+f[0].id+" "+l.getPaths(a,b,f[0],d)},compute:function(a){var b,c,d,e=a.graph,f=e.getVertexCount(),g={},h={};for(b=0;f>b;b++){var i=e.getVertexAt(b);for(g[i.id]||(g[i.id]={}),h[i.id]||(h[i.id]={}),g[i.id][i.id]=0,c=0;f>c;c++)if(b!=c){var j=e.getVertexAt(c);g[i.id][j.id]||(g[i.id][j.id]=1/0),h[i.id][j.id]||(h[i.id][j.id]=[])}
var k=i.getEdges();for(d=0;d<k.length;d++)k[d].source==i?g[i.id][k[d].target.id]=k[d].getCost():(g[k[d].source.id]||(g[k[d].source.id]={},h[k[d].source.id]={}),g[i.id][k[d].source.id]=k[d].getCost())}
for(d=0;f>d;d++)for(b=0;f>b;b++)for(c=0;f>c;c++)if(b!=c&&c!=d&&b!=d){var l=e.getVertexAt(b).id,m=e.getVertexAt(c).id,n=e.getVertexAt(d).id;g[l][n]+g[n][m]<=g[l][m]&&g[l][n]+g[n][m]!=1/0&&(g[l][m]=g[l][n]+g[n][m],h[l][m]||(h[l][m]=[]),h[l][m].unshift([e.getVertexAt(d),g[l][m]]))}
return{paths:g,parents:h}}},m={compute:function(a){for(var b=a.graph,c=a.source,d=a.target,e=a.nodeFilter,f=a.edgeFilter,g={},h={},i={},l={dist:g,previous:h,edges:i,path:[]},m=a.processAll,n={},o={},p=!(a.strict===!1),q=function(a){return a.getFullId?a.getFullId():a.id},r=[],s=function(a){var b=o[a.getFullId()];return n[b.v.id]},t=function(a,b){var c,d;if("Port"===a.objectType){for(g[a.getFullId()]=b,c=s(a),d=0;d<c.length;d++)c[d].p!=a&&(g[c[d].p.getFullId()]=b+a.getNode().getInternalEdge(a,c[d].p).cost);p||(g[a.getNode().id]=b)}else for(g[a.id]=b,c=n[a.id],d=0;d<c.length;d++)g[c[d].p.getFullId()]=b},u=function(a){return e&&!e(a)?1/0:g[q(a)]},v=function(a,b,c){if("Port"===a.objectType){for(var d=s(a),e=0;e<d.length;e++)h[d[e].p.getFullId()]=c.node;p||(h[a.getNode().id]=c.node)}
h[b]=c.node},w=function(a,b,c){if("Port"===a.objectType){for(var d=s(a),e=0;e<d.length;e++)i[d[e].p.getFullId()]=c;p||(i[a.getNode().id]=c)}
i[b]=c},x=0;x<b.vertices.length;x++){var y=b.vertices[x],z=y.getPorts();r.push(y);var A={v:y,i:r.length-1};n[y.id]=[],t(y,1/0);for(var B=0;B<z.length;B++)r.push(z[B]),o[z[B].getFullId()]=A,n[y.id].push({p:z[B],i:r.length-1}),t(z[B],1/0)}
if(null==c&&(c=b.getVertex(a.sourceId)),null==d&&(d=b.getVertex(a.targetId)),null==c||null==d)return l;var C=c,D=d;c.getNode&&(C=c.getNode()),d.getNode&&(D=d.getNode()),t(c,0);for(var E=new Array(b.vertices.length),F=0,G=function(a,b,c,d){for(var e=0;e<b.length;e++){var f=b[e];if(c(f)){var g=d(f),h=g.tp||g.tn,i=q(h),j=u(a.node)+f.getCost(),k=u(h);k>j&&(t(h,j),v(h,i,a),w(h,i,f))}}};F<r.length;){var H=j(r,E,g,q,u),I=H.node?q(H.node):null;if(!H.node||u(H.node)==1/0)break;if(d&&(I==q(d)||!p&&H.node.isChildOf&&H.node.isChildOf(d))&&(l.path=k(g,h,i,d,q),l.pathDistance=l.path[l.path.length-1].cost,!m))break;E[H.index]=!0,F+=1,G(H,H.node.getAllEdges(),function(a){return f&&!f(a)?!1:!a.isDirected()||H.node==a.source||!p&&a.source.isChildOf&&a.source.isChildOf(H.node)},function(a){var b=a.source.getNode?a.source.getNode():a.source,c=a.source.getNode?a.source:null,d=a.target.getNode?a.target.getNode():a.target,e=a.target.getNode?a.target:null;return a.source==H.node||!p&&a.source.isChildOf&&a.source.isChildOf(H.node)?{tn:d,tp:e}:{tn:b,tp:c}})}
return l}}}.call(this),function(){"use strict";var a=this,b=jsPlumbUtil,c=jsPlumbToolkitUtil,d=function(a){return a.id},e=function(a){return a.type||"default"};a.jsPlumbToolkitInstance=function(f){f=f||{};var g=f.idFunction||d,h=f.typeFunction||e,i=f.edgeIdFunction||g,j=f.edgeTypeFunction||h,k=f.portIdFunction||g,l=f.portTypeFunction||h,m=f.portExtractor,n=this,o=!1,p=!1,q=f.model||{},r=function(a,d,e){d=null!=d&&b.isObject(d)?d:{},d=b.clone(d),d.id=d.id||c.uuid(),d.type=d.type||a,e(d)},s=f.nodeFactory||r,t=f.edgeFactory||r,u=f.portFactory||r,v=f.autoSave&&f.saveUrl,w=f.saveUrl,x=f.onAutoSaveSuccess||function(){},y=f.onAutoSaveError||function(){},z=f.doNotUpdateOriginalData===!0,A={portSeparator:f.portSeparator,defaultCost:f.defaultCost,defaultDirected:f.defaultDirected,enableSubgraphs:f.enableSubgraphs};b.EventGenerator.apply(this,arguments);var B=new jsPlumbGraph.Graph(A);v&&new c.AutoSaver(this,w,x,y),new c.CatchAllEventHandler(this),this.getNodeFactory=function(){return s},this.getEdgeFactory=function(){return t},this.getPortFactory=function(){return u},this.setNodeFactory=function(a){s=a},this.setEdgeFactory=function(a){t=a},this.setPortFactory=function(a){u=a},this.setDebugEnabled=function(a){p=a},this.isDebugEnabled=function(){return p},this.getModel=function(){return q||{}};var C,D=function(){return null==C&&(C=new jsPlumbToolkit.Model(q||{})),C},E=function(a,b){if(null==q)return!0;var c=this.getType(a),d=this.getType(b),e=D(),f=a.getNode?a.getNode():a,g=b.getNode?b.getNode():b,h="Node"==a.objectType?e.getNodeDefinition(c):e.getPortDefinition(c),i="Node"==b.objectType?e.getNodeDefinition(d):e.getPortDefinition(d),j=this.getNodeType(f),k=this.getNodeType(g),l=e.getNodeDefinition(j),m=e.getNodeDefinition(k);return null!=h.maxConnections&&a.getEdges().length>=h.maxConnections?!1:null!=i.maxConnections&&b.getEdges().length>=i.maxConnections?!1:a==b?!(l.allowLoopback===!1||h.allowLoopback===!1||i.allowLoopback===!1||m.allowLoopback===!1):f==g?!(l.allowNodeLoopback===!1||h.allowNodeLoopback===!1||i.allowNodeLoopback===!1||m.allowNodeLoopback===!1):!0}.bind(this);this.beforeConnect=f.beforeConnect||E,this.beforeMoveConnection=f.beforeMoveConnection||E,this.beforeStartConnect=f.beforeStartConnect||function(a,b){return{}},this.beforeDetach=f.beforeDetach||function(a,b,c){return!0},this.beforeStartDetach=f.beforeStartDetach||function(a,b){return!0},this.setSuspendGraph=function(a){o=a},this.setDoNotUpdateOriginalData=function(a){z=a},this.getTypeFunction=function(){return h},this.connect=function(a){a=a||{};var b;if(!o){var c=B.getVertex(a.source),d=B.getVertex(a.target),e=a.cost,f=a.directed;if(!c){if(a.doNotCreateMissingNodes)return;c=B.addVertex(a.source),n.fire("nodeAdded",{data:{},node:c})}
if(!d){if(a.doNotCreateMissingNodes)return;d=B.addVertex(a.target),n.fire("nodeAdded",{data:{},node:d})}
var g=this.beforeConnect(c,d);g!==!1&&(b=B.addEdge({source:c,target:d,cost:e,directed:f,data:a.data}),n.fire("edgeAdded",{edge:b}))}
return b},this.clear=function(){return B.clear(),this.fire("graphCleared"),this},this.getGraph=function(){return B},this.getNodeCount=function(){return B.getVertexCount()},this.getNodeAt=function(a){return B.getVertexAt(a)},this.getNodes=function(){return B.getVertices()},this.eachNode=function(a){for(var b=0,c=B.getVertexCount();c>b;b++)a(b,B.getVertexAt(b))},this.eachEdge=function(a){for(var b=B.getEdges(),c=0,d=b.length;d>c;c++)a(c,b[c])},this.getEdgeCount=function(){return B.getEdgeCount()},this.getNodeId=function(a){return b.isObject(a)?g(a):a},this.getNodeType=function(a){return h(a)||"default"},this.getEdgeId=function(a){return b.isObject(a)?i(a):a},this.getEdgeType=function(a){return j(a)||"default"},this.getPortId=function(a){return b.isObject(a)?k(a):a},this.getPortType=function(a){return l(a)||"default"},this.getType=function(a){var b="Node"===a.objectType?h:"Port"===a.objectType?l:j;return b(a.data)||"default"},this.addNode=function(b,d,e){var f=g(b);null==f&&"string"!=typeof b&&(b.id=c.uuid());var h=B.addNode(b,g);if(null!=h){if(null!=m){var i=m(h.data,h);if(null!=i)for(var j=0;j<i.length;j++)h.addPort(i[j])}
return K||z||a.jsPlumbToolkitIO.manage("addNode",I,J,b,g||B.getIdFunction(),n),e||n.fire("nodeAdded",{data:b,node:h,eventInfo:d}),h}
return B.getNode(f)},this.addNodes=function(a){for(var b=0;b<a.length;b++)n.addNode.apply(n,[a[b]]);return n},this.getNode=function(a){return B.getVertex(a)},this.getEdge=function(a){return B.getEdge(a)},this.exists=function(a){for(var b=0;b<arguments.length;b++)if(null==B.getVertex(arguments[b]))return!1;return!0},this.removeNode=function(b,c){b=b.constructor==jsPlumbGraph.Vertex||b.constructor==jsPlumbGraph.Port?b:B.getVertex(b);for(var d=b.getAllEdges()||[],e=0;e<d.length;e++)n.removeEdge(d[e]);return B.deleteVertex(b.id),K||z||a.jsPlumbToolkitIO.manage("removeNode",I,J,b.data,g||B.getIdFunction(),n),c||n.fire("nodeRemoved",{node:b,nodeId:b.id,edges:d}),n},this.addEdge=function(b,c,d){var e=B.addEdge(b,i);return K||z||a.jsPlumbToolkitIO.manage("addEdge",I,J,e,i||B.getIdFunction(),n),d||n.fire("edgeAdded",{edge:e,source:c},null),e},this.removeEdge=function(b,c){return b=B.getEdge(b),null!=b&&(B.deleteEdge(b),K||z||a.jsPlumbToolkitIO.manage("removeEdge",I,J,b.data,i||B.getIdFunction(),n),n.fire("edgeRemoved",{edge:b,source:c},null)),n},this.edgeMoved=function(a,b,c){var d=(a[0===c?"source":"target"],0==c?"setSource":"setTarget");return this[d](a,b)},this.setTarget=function(a,b,c){var d=B.setTarget.apply(B,arguments);return d.success===!1||c||n.fire("edgeTarget",d),d},this.setSource=function(a,b,c){var d=B.setSource.apply(B,arguments);return d.success===!1||c||n.fire("edgeSource",d),d},this.addNewPort=function(b,c,d,e){b=B.getVertex(b),u({node:b,type:c},d,function(c){var d=k(c),f=b.addPort(d);f.data=c,K||z||a.jsPlumbToolkitIO.manage("addPort",I,J,{node:b,port:f},k||B.getIdFunction(),n),e||n.fire("portAdded",{node:b,data:c,port:f},null)})},this.addPort=function(b,c,d){var e=b.addPort(c,k);return K||z||a.jsPlumbToolkitIO.manage("addPort",I,J,{node:b,port:e},k||B.getIdFunction(),n),d||n.fire("portAdded",{node:b,data:c,port:e},null),e},this.removePort=function(a,b,c){var d=!1;a=a.constructor==jsPlumbGraph.Vertex||a.constructor==jsPlumbGraph.Port?a:B.getVertex(a);var e=a.getPort(b);if(e){var f=e.getAllEdges();if(d=a.removePort(e),d&&!c){n.fire("portRemoved",{node:a,port:e,edges:f},null);for(var g=0;g<f.length;g++)n.removeEdge(f[g])}}
return d},this.remove=function(a){if(null!=a){var b=n.getObjectInfo(a);n.setSuspendRendering(!0);try{if(!b.obj||"Node"!=b.type&&"Edge"!=b.type){for(;a.getNodeCount()>0;)n.removeNode(a.get(0));for(;a.getEdgeCount()>0;)n.removeEdge(a.getEdge(0))}else n["remove"+b.type](b.obj)}finally{n.setSuspendRendering(!1,!0)}}},this.setSuspendRendering=function(a,b){for(var c in S)S[c].setSuspendRendering(a,b)},this.batch=function(a){n.setSuspendRendering(!0);try{a()}catch(b){jsPlumbUtil.log("Error in transaction "+b)}finally{n.setSuspendRendering(!1,!0)}};var F=function(a,c,d,e,f){var g=B.getNode(a);if(g&&g.objectType){if(c)for(var h in c)b.replace(g.data,h,c[h]);n.fire(d,e(g),null)}}.bind(this);this.updateNode=function(a,b){F(a,b,"nodeUpdated",function(a){return{node:a}})},this.updatePort=function(a,b){F(a,b,"portUpdated",function(a){return{port:a,node:a.getNode()}})},this.updateEdge=function(a,c){var d=B.getEdge(a);if(d){if(c)for(var e in c)null==d.data[e]?d.data[e]=c[e]:b.replace(d.data,e,c[e]);n.fire("edgeUpdated",{edge:d},null)}},this.update=function(a,c){return b.isString(a)&&(a=this.getNode(a)),a&&a.objectType&&this["update"+a.objectType](a,c),a},this.getPath=function(b){return new a.jsPlumbToolkit.Path(this,b)};var G=this.findGraphObject=function(a){return null==a?null:"*"===a?B:a.constructor==jsPlumbGraph.Vertex||a.constructor==jsPlumbGraph.Port?a:b.isString(a)||b.isObject(a)?B.getVertex(a):null},H=function(a,b,c){var d=[],e={},f=function(a){e[a.getId()]||(d.push(a),e[a.getId()]=!0)},g=function(d,e,g,h){if(null!=d)for(var i=d[b]({filter:a.filter}),j=0;j<i.length;j++){var k=e&&d==B||i[j].source==d||c&&i[j].source.constructor==jsPlumbGraph.Port&&i[j].source.getNode()==d,l=g&&d==B||i[j].target==d||c&&i[j].target.constructor==jsPlumbGraph.Port&&i[j].target.getNode()==d;(e&&k||g&&l||h&&(k||l))&&f(i[j])}};return g(G(a.source),!0,!1,!1),g(G(a.target),!1,!0,!1),g(G(a.element),!1,!1,!0),d};this.getEdges=function(a){return H(a,"getEdges",!1)},this.getAllEdges=function(a){return H(a,"getAllEdges",!0)},this.getAllEdgesFor=function(a,b){return a.getAllEdges({filter:b})};var I,J,K,L=function(b,d,e){b=b||{};var f=b.type||"json",g=b.data,h=b.url,i=b.jsonp,j=b.onload,k=b.parameters||{},l=b.error||function(){};if(null==g&&null==h)throw new TypeError("You must supply either data or url to load.");var m=function(b){I=b,J=f,K=!0,n.fire(d),a.jsPlumbToolkitIO.parse(f,b,n,k),R(e),j&&j(n,b),n.fire("graphChanged")};if(g)m(g);else if(h){if(i){var o=-1===h.indexOf("?")?"?":"&";h=h+o+"callback=?"}
var p="json"===f?f:b.dataType;c.ajax({url:h,success:m,dataType:p,error:l})}
return n};this.load=function(a){return L(a,"dataLoadStart","dataLoadEnd")},this.append=function(a){return L(a,"dataAppendStart","dataAppendEnd")},this.save=function(a){a=a||{};var b=this.exportData(a);return c.ajax({url:a.url,type:"POST",data:b,success:a.success,error:a.error}),n},this.exportData=function(b){return b=b||{},a.jsPlumbToolkitIO.exportData(b.type||"json",n,b.parameters)};var M=function(a){return new c.Selection({toolkit:n,onClear:a||function(){}})},N=M(function(a){n.fire("selectionCleared",{selection:a})});f.maxSelectedNodes&&N.setMaxNodes(f.maxSelectedNodes),f.maxSelectedEdges&&N.setMaxEdges(f.maxSelectedEdges),f.selectionCapacityPolicy&&N.setCapacityPolicy(f.selectionCapacityPolicy);var O=function(a,b,c,d){return b||c.clear(!0),c.append(a,function(a){d&&n.fire("select",{append:b,obj:a,selection:c})})};this.setSelection=function(a){O(a,!1,N,!0)},this.select=function(a,b){var c=M(),d=O(a,!0,c);if(b)for(var e=0;e<d[0].length;e++){var f=d[0][e];if("Node"==f.objectType||"Port"==f.objectType)for(var g=f.getAllEdges(),h=0;h<g.length;h++)c.append(g[h])}
return c};var P=function(a,b,c,d){for(var e=a.getAllEdges(),f=0,g=e.length;g>f;f++)if(e[f].source===a||e[f].getNode&&e[f].getNode()===a){var h=e[f].target,i=h.getFullId();d[i]||(b.append(h),c&&b.append(e[f]),d[i]=!0,P(h,b,c,d))}};this.selectDescendants=function(a,b,c){var d=n.getObjectInfo(a),e=M();if(d.obj&&"Node"===d.obj.objectType){b&&O(d.obj,!0,e);var f={};f[d.obj.getFullId()]=!0,P(d.obj,e,c,f)}
return e},this.filter=function(a,b){var c="function"==typeof a?a:function(c){var d=c.data,e=!1;for(var f in a){var g=a[f]===d[f];if(!g&&!b)return!1;e=e||g}
return e},d=M();return this.eachNode(function(a,b){c(b)&&d.append(b);for(var e=b.getPorts(),f=0;f<e.length;f++)c(e[f])&&d.append(e[f])}),this.eachEdge(function(a,b){c(b)&&d.append(b)}),d},this.addToSelection=function(a){var b=this.getObjectInfo(a);if(b){var c=O(b.obj,!0,N,!0);Q("deselect",c[1]),Q("select",c[0])}};var Q=function(a,b){for(var c=0;c<b.length;c++)n.fire(a,{obj:b[c],selection:N})};this.toggleSelection=function(a){var b=this.getObjectInfo(a);if(b){var c=[],d=N.toggle(b.obj,function(a,b){b||c.push(a)});Q("deselect",d[1]),Q("deselect",c),Q("select",d[0])}},this.removeFromSelection=function(a){var b=this.getObjectInfo(a);b&&N.remove(b.obj,function(a){n.fire("deselect",{obj:a,selection:N})})},this.addPathToSelection=function(a){this.addToSelection(this.getPath(a))},this.selectAll=function(){throw new TypeError("not implemented")},this.clearSelection=N.clear,this.getSelection=function(){return N},this.setMaxSelectedNodes=function(a){N.setMaxNodes(a)},this.setMaxSelectedEdges=function(a){N.setMaxEdges(a)},this.setSelectionCapacityPolicy=function(a){N.setCapacityPolicy(a)};var R=function(a){n.setSuspendGraph(!0),n.fire(a),n.setSuspendGraph(!1),K=!1},S={};if(this.render=function(b,c){var d=jsPlumb.extend({},c||{});jsPlumb.extend(d,b),d.toolkit=n,null!=b.selection&&(b.selection.constructor===jsPlumbToolkitUtil.Selection?d.toolkit=b.selection:d.toolkit=new jsPlumbToolkitUtil.Selection({generator:b.selection,toolkit:n}));var e=d.type||a.jsPlumbToolkit.DefaultRendererType,f=new a.jsPlumbToolkit.Renderers[e](d),g=d.id||jsPlumbUtil.uuid();return S[g]=f,f.id=g,f},this.getRenderer=function(a){return S[a]},this.getRenderers=function(){return S},this.getObjectInfo=function(a,b){var c={els:{},obj:null,type:null,id:null,el:null},d=function(a){return null!=a?a.jtk?a:d(a.parentNode):void 0},e=function(a){var b={};for(var c in S)b[c]=[S[c],S[c].getRenderedElement(a)];return b};if(null!=a){if(a.eachNode&&a.eachEdge)return{obj:a};if(jsPlumbUtil.isArray(a))return{obj:a};var f=jsPlumb.getElement(a);if(null!=f&&f.jtk)c.el=f,c.obj=f.jtk.port||f.jtk.node;else if(null!=a.tagName){var g=d(f);null!=g&&(c.el=g,c.obj=g.jtk.port||g.jtk.node)}else{if("string"==typeof a&&(a=this.getNode(a)),null==a)return c;c.obj=a,null!=b&&(c.el=b(a))}
null==b&&(c.els=e(c.obj)),null!=c.obj&&(c.id=c.obj.id,c.type=c.obj.objectType)}
return c},f.data){var T=f.dataType||"json";n.load({data:f.data,type:T})}},b.extend(a.jsPlumbToolkitInstance,b.EventGenerator),a.jsPlumbToolkit=new a.jsPlumbToolkitInstance({}),a.jsPlumbToolkit.DefaultRendererType=null,a.jsPlumbToolkit.ready=jsPlumb.ready,a.jsPlumbToolkit.Renderers={},a.jsPlumbToolkit.Widgets={},a.jsPlumbToolkit.newInstance=function(b){return new a.jsPlumbToolkitInstance(b)}}.call(this),function(){var a=jsPlumbToolkit,b=jsPlumbToolkitUtil,c=jsPlumbUtil;a.Model=function(d,e){d=d||{},d.nodes=d.nodes||{},d.edges=d.edges||{},d.ports=d.ports||{};var f,g,h={},i=function(a){var c=b.mergeWithParents([a,"default"],d.nodes);return delete c.parent,c},j=function(a){var c=b.mergeWithParents([a,"default"],d.edges);return delete c.parent,c},k=function(a,c){var e=c&&c.ports?b.mergeWithParents([a,"default"],c.ports):b.mergeWithParents([a,"default"],d.ports);return delete e.parent,e};if("undefined"!=typeof e){for(var l in d.edges){if(f=j(l),f.overlays)for(g=0;g<f.overlays.length;g++)if(c.isArray(f.overlays[g])&&f.overlays[g][1].events)for(var m in f.overlays[g][1].events)f.overlays[g][1].events[m]=function(a,b){return function(c,d){a.call(b,{overlay:c,e:d,component:c.component,edge:c.component.edge})}}(f.overlays[g][1].events[m],f.overlays[g]);e.registerConnectionType(l,f)}
for(g in d.ports)f=k(g),e.registerEndpointType(g,f);if(d.states)for(var n in d.states)h[n]=new a.UIState(n,d.states[n],e)}
return{getNodeDefinition:i,getEdgeDefinition:j,getPortDefinition:k,getState:function(a){return h[a]}}}}.call(this),function(){var a=jsPlumbToolkit.ready,b=function(a){var b=0,c=function(){b--,0>=b&&e()};this.add=function(d){b++,jsPlumbToolkitUtil.ajax({url:d,success:function(b){var d=a.innerHTML;d+=b,a.innerHTML=d,c()},error:function(a){c()}})},this.ensureNotEmpty=function(){0>=b&&e()}},c=[],d=!1,e=function(){d=!0;for(var b=0;b<c.length;b++)a.call(a,c[b])};jsPlumbToolkit.ready=function(b){d?a.call(a,b):c.push(b)},jsPlumb.ready(function(){var a=document.getElementById("jsPlumbToolkitTemplates");if(a)e();else{a=document.createElement("div"),a.style.display="none",a.id="jsPlumbToolkitTemplates",document.body.appendChild(a);for(var c=new b(a),d=document.getElementsByTagName("script"),f=0;f<d.length;f++){var g=d[f].getAttribute("type"),h=d[f].getAttribute("src");"text/x-jtk-templates"==g&&c.add(h)}
c.ensureNotEmpty()}})}.call(this),function(){"use strict";this.jsPlumbToolkit.Classes={LASSO:"jtk-lasso",LASSO_SELECT_DEFEAT:"jtk-lasso-select-defeat",MINIVIEW:"jtk-miniview",MINIVIEW_CANVAS:"jtk-miniview-canvas",MINIVIEW_PANNER:"jtk-miniview-panner",MINIVIEW_ELEMENT:"jtk-miniview-element",MINIVIEW_PANNING:"jtk-miniview-panning",MINIVIEW_COLLAPSE:"jtk-miniview-collapse",MINIVIEW_COLLAPSED:"jtk-miniview-collapsed",NODE:"jtk-node",PORT:"jtk-port",SURFACE:"jtk-surface",SURFACE_NO_PAN:"jtk-surface-nopan",SURFACE_CANVAS:"jtk-surface-canvas",SURFACE_PAN:"jtk-surface-pan",SURFACE_PAN_LEFT:"jtk-surface-pan-left",SURFACE_PAN_TOP:"jtk-surface-pan-top",SURFACE_PAN_RIGHT:"jtk-surface-pan-right",SURFACE_PAN_BOTTOM:"jtk-surface-pan-bottom",SURFACE_PAN_ACTIVE:"jtk-surface-pan-active",SURFACE_SELECTED_ELEMENT:"jtk-surface-selected-element",SURFACE_SELECTED_CONNECTION:"jtk-surface-selected-connection",SURFACE_PANNING:"jtk-surface-panning",SURFACE_ELEMENT_DRAGGING:"jtk-surface-element-dragging",SURFACE_DROPPABLE_NODE:"jtk-surface-droppable-node",TOOLBAR:"jtk-toolbar",TOOLBAR_TOOL:"jtk-tool",TOOLBAR_TOOL_SELECTED:"jtk-tool-selected",TOOLBAR_TOOL_ICON:"jtk-tool-icon"},this.jsPlumbToolkit.Constants={click:"click",start:"start",stop:"stop",drop:"drop",disabled:"disabled",pan:"pan",select:"select",drag:"drag",left:"left",right:"right",top:"top",bottom:"bottom",width:"width",height:"height",leftmin:"leftmin",leftmax:"leftmax",topmin:"topmin",topmax:"topmax",min:"min",max:"max",nominalSize:"50px",px:"px",onepx:"1px",nopx:"0px",em:"em",absolute:"absolute",relative:"relative",none:"none",block:"block",hidden:"hidden",div:"div",id:"id",plusEquals:"+=",minusEquals:"-=",dot:".",transform:"transform",transformOrigin:"transform-origin",nodeType:"Node",portType:"Port",edgeType:"Edge",surfaceNodeDragScope:"surfaceNodeDrag",mistletoeLayoutType:"Mistletoe",surfaceType:"Surface",jtkStatePrefix:"jtk-state-",msgCannotSaveState:"Cannot save state",msgCannotRestoreState:"Cannot restore state"},this.jsPlumbToolkit.Attributes={jtkNodeId:"jtk-node-id",relatedNodeId:"related-node-id"},this.jsPlumbToolkit.Methods={addClass:"addClass",removeClass:"removeClass"},this.jsPlumbToolkit.Events={beforeDrop:"beforeDrop",beforeDetach:"beforeDetach",click:"click",canvasClick:"canvasClick",canvasDblClick:"canvasDblClick",connection:"connection",connectionDetached:"connectionDetached",connectionMoved:"connectionMoved",contentDimensions:"contentDimensions",contextmenu:"contextmenu",dataLoadStart:"dataLoadStart",dataAppendStart:"dataAppendStart",dataLoadEnd:"dataLoadEnd",dataAppendEnd:"dataAppendEnd",dblclick:"dblclick",drag:"drag",drop:"drop",dragover:"dragover",dragend:"dragend",edgeAdded:"edgeAdded",edgeRemoved:"edgeRemoved",elementDragged:"elementDragged",elementAdded:"elementAdded",elementRemoved:"elementRemoved",endOverlayAnimation:"endOverlayAnimation",graphCleared:"graphCleared",modeChanged:"modeChanged",mousedown:"mousedown",mousemove:"mousemove",mouseout:"mouseout",mouseup:"mouseup",mouseenter:"mouseenter",mouseleave:"mouseleave",mouseover:"mouseover",nodeAdded:"nodeAdded",nodeMoveStart:"nodeMoveStart",nodeMoveEnd:"nodeMoveEnd",nodeRemoved:"nodeRemoved",edgeTarget:"edgeTarget",edgeSource:"edgeSource",objectRepainted:"objectRepainted",pan:"pan",portAdded:"portAdded",portRemoved:"portRemoved",redraw:"redraw",start:"start",startOverlayAnimation:"startOverlayAnimation",stateRestored:"stateRestored",stop:"stop",tap:"tap",touchend:"touchend",touchmove:"touchmove",touchstart:"touchstart",unload:"unload",portRefreshed:"portRefreshed",nodeRefreshed:"nodeRefreshed",edgeRefreshed:"edgeRefreshed",nodeRendered:"nodeRendered",nodeUpdated:"nodeUpdated",portUpdated:"portUpdated",edgeUpdated:"edgeUpdated",zoom:"zoom",relayout:"relayout",deselect:"deselect",selectionCleared:"selectionCleared",resize:"resize",anchorChanged:"anchorChanged"}}.call(this),function(){"use strict";var a=this;a.jsPlumbToolkit.util={Cookies:{get:function(a){document.cookie.match(new RegExp(a+"=[a-zA-Z0-9.()=|%/_]+($|;)","g"));return val&&0!=val.length?unescape(val[0].substring(a.length+1,val[0].length).replace(";",""))||null:null},set:function(a,b,c,d){var e=[a+"="+escape(b),"/",window.location.host],f=function(){if("NaN"==parseInt(d))return"";var a=new Date;return a.setTime(a.getTime()+60*parseInt(d)*60*1e3),a.toGMTString()};return d&&e.push(f(d)),document.cookie=e.join("; ")},unset:function(b,c,d){c=c&&"string"==typeof c?c:"",d=d&&"string"==typeof d?d:"",a.jsPlumbToolkit.util.Cookies.get(b)&&a.jsPlumbToolkit.util.Cookies.set(b,"","Thu, 01-Jan-70 00:00:01 GMT",c,d)}},Storage:{set:function(b,c){"undefined"==typeof localStorage?a.jsPlumbToolkit.util.Cookies.set(b,c):localStorage.setItem(b,c)},get:function(b){return"undefined"==typeof localStorage?a.jsPlumbToolkit.util.Cookies.read(b):localStorage.getItem(b)},clear:function(b){"undefined"==typeof localStorage?a.jsPlumbToolkit.util.Cookies.unset(b):localStorage.removeItem(b)},clearAll:function(){if("undefined"==typeof localStorage);else for(;localStorage.length>0;){var a=localStorage.key(0);localStorage.removeItem(a)}},setJSON:function(b,c){if("undefined"==typeof JSON)throw new TypeError("JSON undefined. Cannot store value.");a.jsPlumbToolkit.util.Storage.set(b,JSON.stringify(c))},getJSON:function(b){if("undefined"==typeof JSON)throw new TypeError("JSON undefined. Cannot retrieve value.");return JSON.parse(a.jsPlumbToolkit.util.Storage.get(b))}}}}.call(this),function(){"use strict";var a=this,b=a.jsPlumbToolkit,c=b;c.Path=function(a,b){this.bind=a.bind,this.getModel=a.getModel,this.setSuspendGraph=a.setSuspendGraph,this.getNodeId=a.getNodeId,this.getEdgeId=a.getEdgeId,this.getPortId=a.getPortId,this.getNodeType=a.getNodeType,this.getEdgeType=a.getEdgeType,this.getPortType=a.getPortType;for(var c=a.getGraph().findPath(b.source,b.target,b.strict,b.nodeFilter,b.edgeFilter),d=function(){for(var b=0;b<c.path.length;b++)c.path[b].edge&&a.removeEdge(c.path[b].edge);return this}.bind(this),e=function(){for(var b=0;b<c.path.length;b++)a.removeNode(c.path[b].vertex);return this}.bind(this),f=function(b,d){var e=a.findGraphObject(b),f=!1;if(e)for(var g=0;g<c.path.length;g++)if(c.path[g].vertex==e||c.path[g].edge==e||!d&&"Port"==c.path[g].vertex.objectType&&c.path[g].vertex.isChildOf(e)){f=!0;break}
return f},g=[],h={},i=0;i<c.path.length;i++)g.push(c.path[i].vertex),h[a.getNodeId(c.path[i].vertex)]=[c.path[i].vertex,i];this.getNodes=function(){return g},this.getNode=function(a){return h["string"==typeof a?a:a.id][0]},this.getAllEdgesFor=function(a){var b=h[a.id][1];return b<c.path.length-1?[c.path[b+1].edge]:[]};var j=function(a,b){for(var d=b||0;d<c.path.length;d++)try{a(d,c.path[d])}catch(e){jsPlumbUtil.log("Path iterator function failed",e)}};this.each=function(a){j(function(b,c){a(b,c)})},this.eachNode=function(a){j(function(b,c){a(b,c.vertex)})},this.eachEdge=function(a){j(function(b,c){a(b,c.edge)},1)},this.getNodeCount=function(){return c.path.length},this.getNodeAt=function(a){return c.path[a].vertex},this.getEdgeCount=function(){return 0==c.path.length?0:c.path.length-1},this.path=c,this.deleteEdges=d,this.deleteNodes=e,this.deleteAll=e,this.isEmpty=function(){return 0==c.path.length},this.getCost=function(){return c.pathDistance},this.contains=f,this.exists=function(){return null!=c.pathDistance},this.selectEdges=function(a){return _selectEdges(a,"getEdges",!1)},this.selectAllEdges=function(a){return _selectEdges(a,"getAllEdges",!0)}}}.call(this),function(){"use strict";var a=this,b=a.jsPlumbToolkitIO={},c=jsPlumbUtil;b.version="0.1",b.name="jsPlumbToolkitIO";var d=function(a,b,c){for(var d=a.nodes||[],e=a.edges||[],f=a.ports||[],g=0;g<d.length;g++)b.addNode(d[g]);for(var h=0;h<f.length;h++){var i=b.getNode(f[h].nodeId);if(null==i)throw new TypeError("Unknown node ["+f[h].nodeId+"]");i.addPort(f[h])}
for(var j=0;j<e.length;j++){var k=e[j].cost||1;b.addEdge({source:e[j].source,target:e[j].target,cost:k,directed:e[j].directed,data:e[j].data})}},e=function(a,b){return a.getGraph().serialize()},f=function(a,b,c){var d=function(a){var c=b.addNode(a);if(a.children)for(var e=0;e<a.children.length;e++){var f=b.addNode(a.children[e]);b.addEdge({source:c,target:f}),d(a.children[e])}};d(a)};b.exporters={json:e},b.parsers={json:d,"hierarchical-json":f},b.managers={json:{removeNode:function(a,b,d){var e=d(b);c.removeWithFunction(a.nodes,function(a){return a.id==e})},removeEdge:function(a,b,d){var e=d(b);c.removeWithFunction(a.edges,function(a){return a.data&&a.data.id==e})},addNode:function(a,b,c){a.nodes=a.nodes||[],a.nodes.push(b)},addEdge:function(a,b,c){var d={source:b.source.getFullId(),target:b.target.getFullId(),data:b.data||{}};a.edges=a.edges||[],a.edges.push(d)},addPort:function(a,b,c){a.ports=a.ports||[];var d=jsPlumb.extend({},b.port.data||{});d.id=b.port.getFullId(),a.ports.push(d)},removePort:function(a,b,d){var e=b.port.getFullId();c.removeWithFunction(a.ports,function(a){return a.id==e})}}},b.parse=function(a,c,d,e){var f=b.parsers[a];if(null==f)throw new Error("jsPlumb Toolkit - parse - ["+a+"] is an unsupported type");return f(c,d,e)},b.exportData=function(a,c,d){var e=b.exporters[a];if(null===e)throw new Error("jsPlumb Toolkit - exportData - ["+a+"]  is an unsupported type");return e(c,d)},b.manage=function(a,c,d,e,f,g){b.managers[d]&&b.managers[d][a](c,e,f)}}.call(this),function(){var a=this,b=a.jsPlumbToolkit,c=b;c.Support={ingest:function(c){var d=c.jsPlumb||a.jsPlumb;if(!d.getContainer())throw new TypeError("No Container set on jsPlumb instance. Cannot continue.");var e=b.newInstance(),f=d.select(),g={},h=function(){return"default"},i=c.idFunction||function(a){return d.getId(a)},j=c.typeFunction||h,k=c.idFunction||function(a){return a.id},l=c.edgeTypeFunction||h,m=c.render!==!1,n=function(a){var b=i(a),c=j(a),f=d.getId(a);null==g[f]&&(g[f]=e.addNode({id:b,type:c},null,!0),a.jtk={node:g[f]})},o=function(a){var b=g[a.sourceId],c=g[a.targetId],d=k(a),f=l(a);a.edge=e.addEdge({source:b,target:c,data:{id:d,type:f}},null,!0)};if(c.nodeSelector)for(var p=d.getContainer().querySelectorAll(c.nodeSelector),q=0;q<p.length;q++){var r=d.getId(p[q]);n(p[q],r),d.manage(r,p[q])}
var s=d.getManagedElements();for(var r in s)n(s[r].el,r);if(f.each(function(a){o(a)}),m){var t=a.jsPlumb.extend({},c.renderParams||{});t.jsPlumbInstance=d,t.container=d.getContainer();var u=e.render(t);return u.ingest=function(a){n(a),u.importNode(a,i(a))},u}
return e}}}.call(this),function(){"use strict";var a=this,b=a.jsPlumbToolkit,c=b.Layouts={Decorators:{}},d=jsPlumbUtil,e=function(a){var b=1/0,c=1/0,d=-(1/0),e=-(1/0);for(var f in a)b=Math.min(b,a[f][0]),d=Math.max(d,a[f][0]),c=Math.min(c,a[f][1]),e=Math.max(e,a[f][1]);return[[b,c],[d,e],Math.abs(b-d),Math.abs(c-e)]},f=function(a){if(null==a)return[];for(var b=[],d=function(a){var b="string"==typeof a?a:a[0],d=c.Decorators[b],e="string"==typeof a?{}:a[1];if(!d)throw new TypeError("Decorator ["+b+"] no registered on jsPlumbToolkit.Layouts.Decorators");return new d(e)},e=0;e<a.length;e++)b.push(d(a[e]));return b};c.AbstractLayout=function(b){b=b||{};var c=this,d=function(){return{padding:[0,0]}},g=function(){var b=a.jsPlumb.extend(d(),c.defaultParameters||{});a.jsPlumb.extend(b,i||{}),i=b},h=b.adapter,i=b.parameters||{},j=b.getElementForNode,k=new Magnetizer({getPosition:function(a){var b=o[a.id];return{left:b[0],top:b[1]}},getSize:function(a){return v[a.id]},getId:function(a){return a.id},setPosition:function(a,b){F(a.id,b.left,b.top)},padding:i.padding,filter:function(a){return c.canMagnetize?c.canMagnetize(a):!0}}),l=b.magnetized===!1?!1:c.defaultMagnetized||b.magnetize===!0;this.decorators=f(b.decorators),this.adapter=b.adapter;var m=b.jsPlumb||a.jsPlumb,n=b.jsPlumbToolkit,o={},p=[],q=1/0,r=1/0,s=-(1/0),t=-(1/0),u={},v={},w=b.container,x=m.getSize(w),y=b.width||x[0],z=b.height||x[1],A=!1,B=function(){A=!1,q=1/0,s=-(1/0),r=1/0,t=-(1/0);for(var a=0;a<c.decorators.length;a++)c.decorators[a].reset({remove:m.remove});o={},p.splice(0),v={},c.reset&&c.reset()};this.magnetize=function(a){a=a||{};var b=a.event?"executeAtEvent":a.origin?"execute":"executeAtCenter",c=a.event?[a.event,a.options]:a.origin?[a.origin,a.options]:[a.options];k[b].apply(k,c),J(m.repaintEverything)},this.nodeAdded=function(a,b){var d=b&&b.position?b.position:a.node.data&&a.node.data.left&&a.node.data.top?a.node.data:c.adapter.getOffset(a.el);this._nodeAdded&&this._nodeAdded(a,b),u[a.node.id]=a.node,F(a.node.id,d.left,d.top),C(a.node.id,a.el),k.addElement(a.node)},this.nodeRemoved=function(a){delete o[a],delete v[a],delete u[a],this._nodeRemoved&&this._nodeRemoved(a),k.removeElement(b.node)};var C=function(a,b){var c=v[a];return c||(b=b||j(a),null!=b?(c=m.getSize(b),v[a]=c):c=[0,0]),c},D=function(a,b,c,d){var e=o[a];if(!e){if(null!=b&&null!=c)e=[b,c];else{if(d)return null;e=[Math.floor(Math.random()*(y+1)),Math.floor(Math.random()*(z+1))]}
F(a,e[0],e[1])}
return e},E=function(a){q=Math.min(q,a[0]),r=Math.min(r,a[1]),s=Math.max(s,a[0]),t=Math.max(t,a[1])},F=this.setPosition=function(a,b,d,e){var f=o[a];f?(f[0]=parseFloat(b),f[1]=parseFloat(d)):(f=o[a]=[parseFloat(b),parseFloat(d)],p.push([f,a])),E(f),e&&c._nodeMoved&&c._nodeMoved(a,b,d)},G=function(a,b,c){b=b||10,c=c||10;var d=o[a];return d||(d=o[a]=[]),d[0]=Math.floor(Math.random()*b),d[1]=Math.floor(Math.random()*c),E(d),d},H=function(){for(var a in o)console.log(a,o[a][0],o[a][1])},I=function(a,b){var d=j(a);if(null!=d){var e=o[a];return c.adapter.setAbsolutePosition(d,e,b),M[a]=[e[0],e[1]],e.concat(C(a))}
return null}.bind(this),J=this.draw=function(a){for(var b in o){var d=I(b);null!=d&&(q=Math.min(d[0],q),r=Math.min(d[1],r),s=Math.max(d[0]+d[2],s),t=Math.max(d[1]+d[3],t))}
for(var e=0;e<c.decorators.length;e++)c.decorators[e].decorate({adapter:c.adapter,layout:c,append:function(a,b,d){c.adapter.append(a,b,d,!0)},setAbsolutePosition:c.adapter.setAbsolutePosition,toolkit:n,jsPlumb:m,bounds:[q,r,s,t],floatElement:c.adapter.floatElement,fixElement:c.adapter.fixElement});a&&a()},K=function(a){console.log(a);var b=e(o,C,j);H(),console.log(b[0],b[1],b[2],b[3])};this.bb=K;var L=this.getPositions=function(){return o},M=(this.getPosition=function(a){return o[a]},{});this.getSize=function(a){return v[a]};this.begin=function(a,b){},this.end=function(a,b){};var N=function(a){if(null!=n){g(),k.setElements(h.getNodes()),this.begin&&this.begin(n,i);for(var b=function(){J(function(){l&&c.magnetize(),c.end&&c.end(n,i),a()})};!A;)this.step(n,i);b()}}.bind(this);return this.relayout=function(a,b){B(),null!=a&&(i=a),N(b)},this.layout=function(a){A=!1,N(a)},this.clear=function(){B()},{adapter:b.adapter,jsPlumb:m,toolkit:n,getPosition:D,setPosition:F,getRandomPosition:G,getSize:C,getPositions:L,setPositions:function(a){o=a},width:y,height:z,reset:B,draw:J,setDone:function(a){A=a}}},c.EmptyLayout=function(a){var b={};this.refresh=this.relayout=this.layout=function(){this.clear();for(var c=a.getNodeCount(),d=0;c>d;d++){var e=a.getNodeAt(d);b[e.getFullId()]=[0,0]}},this.nodeRemoved=function(a){delete b[a.id]},this.nodeAdded=function(a){b[a.id]=!1},this.getPositions=function(){return b},this.getPosition=function(a){return b[a]},this.setPosition=function(a,c,d){b[a]=[c,d]},this.clear=function(){b={}}},c.Mistletoe=function(b){if(!b.parameters.layout)throw"No layout specified for MistletoeLayout";var e={},f=a.jsPlumb.extend({},b);f.getElementForNode=function(a){return e[a]};var g,h,i,j=c.AbstractLayout.apply(this,[f]),k=b.parameters.layout,l=function(){j.setPositions(k.getPositions()),j.draw(),this.fire("redraw")}.bind(this);d.EventGenerator.apply(this,arguments),this.map=function(a,b){e[a]=b};var m=function(){e={},g=k.layout,h=k.relayout,i=k.clear,k.layout=function(){g.apply(k,arguments),l()},k.relayout=function(){j.reset(),h.apply(k,arguments),l()},k.clear=function(){i.apply(k,arguments),j.reset()}};m(),this.setHostLayout=function(a){k=a,m()}};var g=c.AbsoluteBackedLayout=function(){var a=c.AbstractLayout.apply(this,arguments),b=function(a){return[a.data.left,a.data.top]},d=function(a,c){return(c.locationFunction||b)(a)};return this.begin=function(b,c){for(var e=a.adapter.getNodeCount(),f=0;e>f;f++){var g=a.adapter.getNodeAt(f),h=b.getNodeId(g.data),i=a.getPosition(h,null,null,!0);null==i&&(i=d(g,c)),this.setPosition(h,i[0],i[1],!0)}},this.getAbsolutePosition=function(a,b){return d(a,b)},this.step=function(){a.setDone(!0)},a};d.extend(g,c.AbstractLayout),c.Absolute=function(a){c.AbsoluteBackedLayout.apply(this,arguments)},d.extend(c.Absolute,c.AbsoluteBackedLayout);var h=c.AbstractHierarchicalLayout=function(a){var b=this,d=c.AbstractLayout.apply(this,arguments);return b.begin=function(b,c){c.ignoreLoops=!(a.ignoreLoops===!1),c.getRootNode=c.getRootNode||function(a){return d.adapter.getNodeCount()>0?d.adapter.getNodeAt(0):void 0},c.getChildEdges=c.getChildEdges||function(a,b){return d.toolkit.getAllEdgesFor(a,function(b){return b.source===a})},c.rootNode=c.getRootNode(b),c.rootNode?c.root=c.rootNode.id:d.setDone(!0)},d};d.extend(h,c.AbstractLayout)}.call(this),function(){"use strict";var a=this,b=a.jsPlumbToolkit,c=b.Layouts;c.Circular=function(a){a=a||{};var b=c.AbstractLayout.apply(this,arguments);this.defaultParameters={padding:30,locationFunction:a.locationFunction},this.step=function(a,c){var d=b.adapter.getNodeCount();if(0==d)return void b.setDone(!0);var e,f,g=0,h=0,i=10,j=2*Math.PI/d,k=-Math.PI/2;for(e=0;d>e;e++)f=b.adapter.getNodeAt(e),b.setPosition(f.id,g+Math.sin(k)*i,h+Math.cos(k)*i,!0),k+=j;var l=b.adapter.getNodeAt(0),m=b.getSize(l.id),n=b.getPosition(l.id),o={x:n[0]-c.padding,y:n[1]-c.padding,w:m[0]+2*c.padding,h:m[1]+2*c.padding},p=b.adapter.getNodeAt(1),q=b.getSize(p.id),r=b.getPosition(p.id),s={x:r[0]-c.padding,y:r[1]-c.padding,w:q[0]+2*c.padding,h:q[1]+2*c.padding},t=Farahey.calculateSpacingAdjustment(o,s),u=[n[0]+m[0]/2,n[1]+m[1]/2],v=[r[0]+t.left+q[0]/2,r[1]+t.top+ +(q[1]/2)],w=Math.sqrt(Math.pow(u[0]-v[0],2)+Math.pow(u[1]-v[1],2));for(i=w/2/Math.sin(j/2),e=0;d>e;e++)f=b.adapter.getNodeAt(e),b.setPosition(f.id,g+Math.sin(k)*i,h+Math.cos(k)*i,!0),k+=j;b.setDone(!0)}}}.call(this),function(){"use strict";var a=this,b=a.jsPlumbToolkit,c=b.Layouts;c.Hierarchical=function(a){var b,d,e,f,g,h,i,j,k=c.AbstractHierarchicalLayout.apply(this,arguments),l=[],m=null!=a.parameters?a.parameters.compress:!1,n=[],o=[],p=k.toolkit.getNodeId,q=function(a){var b=n[a];return b||(b={nodes:[],pointer:0},n[a]=b),b},r=function(a,b,c,d,f){var g=q(c),i={node:a,parent:d,childGroup:f,loc:g.pointer,index:g.nodes.length,dimensions:b,size:b[e]},j=b[0==e?1:0];return null==l[c]?l[c]=j:l[c]=Math.max(l[c],j),g.pointer+=b[e]+h[e],g.nodes.push(i),i},s=function(a,b){var c=o[b];c||(c=[],o[b]=c),a.index=c.length,c.push(a)},t=function(a){if(a.size>0){var b=a.parent.loc+a.parent.size/2-(a.size-h[e])/2,c=o[a.depth],d=-(1/0),f=0;if(null!=c&&c.length>0){var g=c[c.length-1],i=g.nodes[g.nodes.length-1];d=i.loc+i.size+h[e]}
b>=d?a.loc=b:(f=d-b,a.loc=d);for(var j=a.loc,k=0;k<a.nodes.length;k++)a.nodes[k].loc=j,j+=a.nodes[k].size,j+=h[e];f>0&&v(a),s(a,a.depth)}},u=function(a){var b=a.nodes[0].loc,c=a.nodes[a.nodes.length-1].loc+a.nodes[a.nodes.length-1].size,d=(b+c)/2,e=d-a.parent.size/2,f=e-a.parent.loc;if(a.parent.loc=e,!a.parent.root)for(var g=a.parent.childGroup,h=a.parent.childGroupIndex+1;h<g.nodes.length;h++)g.nodes[h].loc+=f},v=function(a){for(var b=a;null!=b;)u(b),b=b.parent.childGroup},w=function(a,b){if(!i[a.node.id]){i[a.node.id]=!0;var c,d=j(a.node,k.toolkit),f={nodes:[],loc:0,size:0,parent:a,depth:b+1},g=[];for(c=0;c<d.length;c++){var l=d[c].source===a.node?d[c].target:d[c].source;if(l=k.toolkit.getNode(l),null!=l&&l!==a.node){var m=k.getSize(p(l)),n=r(l,m,b+1,a,f);n.childGroupIndex=f.nodes.length,f.nodes.push(n),f.size+=m[e]+h[e],g.push(n)}}
for(t(f),c=0;c<g.length;c++)w(g[c],b+1)}};this.defaultParameters={padding:[60,60],orientation:"horizontal",border:0,locationFunction:a.locationFunction};var x=this.begin;this.begin=function(a,c){x.apply(this,arguments),b=c.orientation,d="horizontal"===b,e=d?0:1,f=d?"width":"height",g=k.adapter.getNodeCount(),h=c.padding,n.length=0,o.length=0,i={},j=c.getChildEdges},this.step=function(a,b){var c=k.getSize(b.root),d=r(b.rootNode,c,0,null,null);d.root=!0,w(d,0,null);for(var f,g,i=0,j=function(a,b){var c=0==e?1:0;return m&&a.parent?k.getPosition(p(a.parent.node))[c]+a.parent.dimensions[c]+h[c]:b},o=0;o<n.length;o++){n[o].otherAxis=i;for(var q=0;q<n[o].nodes.length;q++)f=0==e?n[o].nodes[q].loc:j(n[o].nodes[q],i),n[o].nodes[q].parent&&k.getPosition(p(n[o].nodes[q].parent.node)),g=1==e?n[o].nodes[q].loc:j(n[o].nodes[q],i),k.setPosition(p(n[o].nodes[q].node),f,g,!0);n[o].otherAxisSize=l[o]+h[0==e?1:0],i+=n[o].otherAxisSize}
k.setDone(!0)},this.getHierarchy=function(){return n},this.getOrientation=function(){return b};var y=this.nodeRemoved;this.nodeRemoved=function(){n=[],y.apply(this,arguments)}},jsPlumbUtil.extend(c.Hierarchical,c.AbstractHierarchicalLayout)}.call(this),function(){"use strict";var a=this,b=a.jsPlumbToolkit,c=b.Layouts;c.Spring=function(a){this.defaultMagnetized=!0;var b=c.AbsoluteBackedLayout.apply(this,arguments);this.defaultParameters={padding:[50,50],iterations:500,maxRepulsiveForceDistance:6,k:2,c:.01,maxVertexMovement:.5,locationFunction:a.locationFunction};var d,e=this.defaultParameters,f={},g=a.absoluteBacked!==!1,h=0,i=1/0,j=-(1/0),k=1/0,l=-(1/0),m=1,n=1,o=0,p=function(a){a.getNode&&(a=a.getNode());var c=f[a.id];if(!c){var d=b.getRandomPosition(a.id,.5,.5);c=f[a.id]={id:a.id,n:a,sp:d,p:[d[0],d[1]],f:[0,0]}}
return c},q=function(a,b,c){i=Math.min(i,b),k=Math.min(k,c),j=Math.max(j,b),l=Math.max(l,c),a.p[0]=b,a.p[1]=c},r=function(a,b){if(!a.locked||!b.locked){var c=b.p[0]-a.p[0],d=b.p[1]-a.p[1],f=c*c+d*d;.01>f&&(c=.1*Math.random()+.1,d=.1*Math.random()+.1,f=c*c+d*d);var g=Math.sqrt(f);if(g<e.maxRepulsiveForceDistance){o++;var h=e.k*e.k/g,i=h*c/g,j=h*d/g;b.f[0]+=b.locked?0:(a.locked?2:1)*i,b.f[1]+=b.locked?0:(a.locked?2:1)*j,a.f[0]-=a.locked?0:(b.locked?2:1)*i,a.f[1]-=a.locked?0:(b.locked?2:1)*j}}},s=function(a,b){var c=p(b.target);if(!a.locked||!c.locked){o++;var d=c.p[0]-a.p[0],f=c.p[1]-a.p[1],g=d*d+f*f;.01>g&&(d=.1*Math.random()+.1,f=.1*Math.random()+.1,g=d*d+f*f);var h=Math.sqrt(g);h>e.maxRepulsiveForceDistance&&(h=e.maxRepulsiveForceDistance,g=h*h);var i=(g-e.k*e.k)/e.k;(void 0==b.weight||b.weight<1)&&(b.weight=1),i*=.5*Math.log(b.weight)+1;var j=i*d/h,k=i*f/h;c.f[0]-=c.locked?0:(a.locked?2:1)*j,c.f[1]-=c.locked?0:(a.locked?2:1)*k,a.f[0]+=a.locked?0:(c.locked?2:1)*j,a.f[1]+=a.locked?0:(c.locked?2:1)*k}},t=function(){m=b.width/(j-i)*.62,n=b.height/(l-k)*.62;for(var a in f){var c=f[a];c.locked||(c.sp=v(c.p),b.setPosition(c.id,c.sp[0],c.sp[1],!0))}},u=function(a){return[i+(a[0]-.19*b.width)/m,k+(a[1]-.19*b.height)/n]},v=function(a){return[.19*b.width+(a[0]-i)*m,.19*b.height+(a[1]-k)*n]};this._nodeMoved=function(a,b,c){var d=f[a];d&&(d.sp=[b,c],d.p=u(d.sp))},this.canMagnetize=function(a){return f[a]&&f[a].locked!==!0},this.reset=function(){f={},h=0,i=k=1/0,j=l=-(1/0)},this._nodeRemoved=function(a){delete f[a]},this._nodeAdded=function(a,c){if(c&&c.position){var d=p(a.node);d&&(d.locked=!0,b.setPosition(d.id,c.position.left,c.position.top,!0))}},this.begin=function(a,c){h=0,d=b.adapter.getNodeCount()},this.step=function(a,c){var f,i=[],j=function(a){return i[a]?i[a]:function(){return i[a]=p(b.adapter.getNodeAt(a)),i[a]}()};for(o=0,f=0;d>f;f++){var k=j(f);if(g&&!k.locked){var l=this.getAbsolutePosition(k.n,c);if(null!=l&&2==l.length&&!isNaN(l[0])&&!isNaN(l[1])){q(k,l[0],l[1]),k.sp=k.p,b.setPosition(k.id,l[0],l[1],!0),k.locked=!0;continue}}
for(var m=f+1;d>m;m++){var n=j(m);r(k,n)}
for(var u=b.toolkit.getAllEdgesFor(k.n),v=0;v<u.length;v++)s(k,u[v])}
if(0!=o)for(f=0;d>f;f++){var w=j(f),x=e.c*w.f[0],y=e.c*w.f[1],z=e.maxVertexMovement;x>z&&(x=z),-z>x&&(x=-z),y>z&&(y=z),-z>y&&(y=-z),q(w,w.p[0]+x,w.p[1]+y),w.f[0]=0,w.f[1]=0}
h++,(0==o||h>=e.iterations)&&(t(),b.setDone(!0))},this.end=function(){for(var a in f)f[a].locked=!0}},jsPlumbUtil.extend(c.Spring,c.AbsoluteBackedLayout)}.call(this),function(){"use strict";var a=this,b=a.jsPlumbToolkit.Renderers,c=a.jsPlumbToolkit,d=a.jsPlumbToolkitUtil,e=a.jsPlumbUtil;c.UIState=function(a,b,c){for(var d in b)if(b.hasOwnProperty(d)){var e="*"===d?"e-state-"+a:"e-state-"+a+"-"+d,f="*"===d?"c-state-"+a:"c-state-"+a+"-"+d;c.registerEndpointType(e,b[d]),c.registerConnectionType(f,b[d])}
this.activate=function(d,e,f){d.eachEdge(function(c,d){var h=e.getRenderedConnection(d.getId()),i=f.getEdgeType(d.data),j=i?"c-state-"+a+"-"+i:null;j&&h.addType(j),b["*"]&&h.addType("c-state-"+a),g(d,h,d.source,0,"addType",f),g(d,h,d.target,1,"addType",f)}),d.eachNode(function(a,d){var g=f.getNodeType(d.data),h=g?b[g]:null,i=e.getRenderedNode(d.id);h&&h.cssClass&&c.addClass(i,h.cssClass),b["*"]&&c.addClass(i,b["*"].cssClass)})};var g=function(b,c,d,e,f,g){var h=c.endpoints[e],i=g.getPortType(d.data);h[f]("e-state-"+a+"-"+i),h[f]("e-state-"+a)};this.deactivate=function(d,e,f){d.eachEdge(function(c,d){var h=e.getRenderedConnection(d.getId()),i=f.getEdgeType(d.data),j=i?"c-state-"+a+"-"+i:null;j&&h.removeType(j),b["*"]&&h.removeType("c-state-"+a),g(d,h,d.source,0,"removeType",f),g(d,h,d.target,1,"removeType",f)}),d.eachNode(function(a,d){var g=f.getNodeType(d.data),h=g?b[g]:null,i=e.getRenderedNode(d.id);h&&h.cssClass&&c.removeClass(i,h.cssClass),b["*"]&&c.removeClass(i,b["*"].cssClass)})}};var f=b.atts={NODE:"data-jtk-node-id",PORT:"data-jtk-port-id"},g=b.els={SOURCE:"JTK-SOURCE",PORT:"JTK-PORT",TARGET:"JTK-TARGET"},h=jsPlumbToolkit.Classes,i=jsPlumbToolkit.Constants,j=jsPlumbToolkit.Events;b.mouseEvents=["click","dblclick","contextmenu","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover"],b.createElement=function(a,b){var c=document.createElement(a.type||i.div);a.units||i.px;return null!=a.top&&(c.style.top=a.top+i.px),null!=a.left&&(c.style.left=a.left+i.px),null!=a.right&&(c.style.right=a.right+i.px),null!=a.bottom&&(c.style.bottom=a.bottom+i.px),c.style.width=a.width,c.style.height=a.height,c.style.position=a.position||i.absolute,a.id&&c.setAttribute(i.id,a.id),a.display&&(c.style.display=a.display),a.clazz&&(c.className=a.clazz),null!=b&&jsPlumb.appendElement(c,b),c};var k=function(a,b){var c=document.createElement("div");return c.innerHTML=a.name||a.id,c.className=h.NODE,c.style.border="1px solid #456",c.style.position="absolute",c},l='<div data-jtk-node-id="${id}" class="'+h.NODE+'"></div>',m={rotors:{render:function(a,b){return o.template(a,b).childNodes[0]}}},n="rotors",o=Rotors.newInstance({defaultTemplate:l}),p=b.DOMElementAdapter=function(a){var b=this.getJsPlumb(),c=b.getElement(a.container);this.getWidth=function(){return b.getSize(c)[0]},this.getHeight=function(){return b.getSize(c)[1]},this.append=function(a){var d=b.getElement(a);b.appendElement(d,c)},this.remove=function(a){var c=b.getElement(a);b.removeElement(c)},this.setAbsolutePosition=jsPlumb.setAbsolutePosition,this.getOffset=function(a,c){return b.getOffset(a,c)}},q=b.AbstractRenderer=function(b){b=b||{};var i=this,l=b.toolkit,p=new c.Layouts.EmptyLayout(i),q=jsPlumb.getElement(b.container),r=!(b.elementsDraggable===!1),s=!1,t=b.refreshAutomatically!==!1,u=b.idFunction||l.getNodeId,v=b.typeFunction||l.getNodeType,w=(b.edgeIdFunction||l.getEdgeId,b.edgeTypeFunction||l.getEdgeType),x=b.portIdFunction||l.getPortId,y=b.portTypeFunction||l.getPortType,z=b.templateRenderer?e.isString(b.templateRenderer)?m[b.templateRenderer]:{render:b.templateRenderer}:m[n],A=b.enhancedView!==!1,B=e.merge(b.jsPlumb||{}),C=b.jsPlumbInstance||jsPlumb.getInstance(B),D=C.getId(q);C.bind("beforeDrop",function(a){var b=a.connection.source.jtk.port||a.connection.source.jtk.node,c=a.connection.target.jtk.port||a.connection.target.jtk.node,d=a.connection.edge;return null==d?l.beforeConnect(b,c):l.beforeMoveConnection(b,c,d)}),C.bind("beforeDrag",function(a){var b=a.source.jtk.port||a.source.jtk.node,c=a.endpoint.connectionType;return l.beforeStartConnect(b,c)}),C.bind("beforeDetach",function(a,b){var c=a.source.jtk.port||a.source.jtk.node,d=a.target.jtk.port||a.target.jtk.node,e=a.edge;return l.beforeDetach(c,d,e,b)}),C.bind("beforeStartDetach",function(a){var b=a.source.jtk.port||a.source.jtk.node,c=a.connection.edge;return l.beforeStartDetach(b,c)}),e.EventGenerator.apply(this,arguments),this.getJsPlumb=function(){return C},this.getToolkit=function(){return l};var E=[j.canvasClick,j.canvasDblClick,j.nodeAdded,j.nodeRemoved,j.nodeRendered,j.nodeMoveStart,j.nodeMoveEnd,j.portAdded,j.portRemoved,j.edgeAdded,j.edgeRemoved,j.dataLoadEnd,j.anchorChanged,j.objectRepainted,j.modeChanged,j.pan,j.zoom,j.relayout,j.click,j.tap,j.stateRestored,j.startOverlayAnimation,j.endOverlayAnimation],F=i.bind,G=C.bind;if(this.setHoverSuspended=C.setHoverSuspended,this.isHoverSuspended=C.isHoverSuspended,this.setJsPlumbDefaults=function(a){delete a.Container,C.restoreDefaults(),C.importDefaults(a)},this.bind=function(a,b){-1==e.indexOf(E,a)?G(a,b):F(a,b)},b.events)for(var H in b.events)this.bind(H,b.events[H]);if(b.interceptors)for(var I in b.interceptors)this.bind(I,b.interceptors[I]);var J=!1;G(j.connection,function(a){if(null==a.connection.edge){J=!0,a.sourceEndpoint.getParameter("nodeId")||a.sourceEndpoint.setParameter("nodeId",L[a.sourceEndpoint.elementId].id),a.targetEndpoint.getParameter("nodeId")||a.targetEndpoint.setParameter("nodeId",L[a.targetEndpoint.elementId].id);var b=a.sourceEndpoint.getParameter("portType"),c=Z.getPortDefinition(b),d=null!=c&&c.edgeType?c.edgeType:"default",e=a.sourceEndpoint.getParameter("nodeId"),f=a.sourceEndpoint.getParameter("portId"),g=a.targetEndpoint.getParameter("nodeId"),h=a.targetEndpoint.getParameter("portId"),k=e+(f?"."+f:""),m=g+(h?"."+h:""),n={sourceNodeId:e,sourcePortId:f,targetNodeId:g,targetPortId:h,type:d,source:l.getNode(k),target:l.getNode(m),sourceId:k,targetId:m},o=l.getEdgeFactory()(d,a.connection.getData()||{},function(b){n.edge=l.addEdge({source:k,target:m,cost:a.connection.getCost(),directed:a.connection.isDirected(),data:b,addedByMouse:!0},i),Q[n.edge.getId()]=a.connection,a.connection.edge=n.edge,U(d,n.edge,a.connection),n.addedByMouse=!0,i.fire(j.edgeAdded,n)});o===!1&&C.detach(a.connection),J=!1}}),G(j.connectionMoved,function(a){var b=0==a.index?a.newSourceEndpoint:a.newTargetEndpoint;l.edgeMoved(a.connection.edge,b.element.jtk.port||b.element.jtk.node,a.index)}),G(j.connectionDetached,function(a){J=!0,l.removeEdge(a.connection.edge),J=!1;var b=a.sourceEndpoint.getParameters(),c=a.targetEndpoint.getParameters(),d=b.nodeId+(b.portId?"."+b.portId:""),e=c.nodeId+(c.portId?"."+c.portId:"");i.fire(j.edgeRemoved,{sourceNodeId:b.nodeId,targetNodeId:c.nodeId,sourcePortId:b.portId,targetPortId:c.portId,sourceId:d,targetId:e,source:l.getNode(d),target:l.getNode(e),edge:a.connection.edge})});var K={},L={},M={},N=[],O=function(a){N.push(a)},P=function(a){var b=N.indexOf(a);-1!=b&&N.splice(b,1)};this.getNodeCount=function(){return N.length},this.getNodeAt=function(a){return N[a]},this.getNodes=function(){return N},this.getNode=function(a){return K[a]};var Q={},R=function(a){return Q[a.getId()]},S=function(a){for(var b=[],c=0;c<a.length;c++)b.push(Q[a[c].getId()]);return b},T=function(a,b,c,d){d.bind(a,function(a,e){b.apply(b,[{edge:c,e:e,connection:d,toolkit:l,renderer:i}])})},U=function(a,b,c){if(!c.getParameter("edge")){var d=Z.getEdgeDefinition(a);if(d&&d.events)for(var e in d.events)T(e,d.events[e],b,c)}},V=function(a,b){var c=a.endpoints[0].getParameters(),d=a.endpoints[1].getParameters(),e=c.nodeId+(c.portId?"."+c.portId:""),f=d.nodeId+(d.portId?"."+d.portId:"");i.fire(j.edgeRemoved,{sourceNodeId:c.nodeId,targetNodeId:d.nodeId,sourcePortId:c.portId,targetPortId:d.portId,sourceId:e,targetId:f,source:l.getNode(e),target:l.getNode(f),edge:b})};if(this.setSuspendRendering=function(a,b){s=a,C.setSuspendDrawing(a),b&&this.refresh()},this.bindToolkitEvents!==!1){var W=function(){C.setSuspendDrawing(!0),this.setSuspendRendering(!0)}.bind(this);l.bind(j.dataLoadStart,W),l.bind(j.dataAppendStart,W),l.bind(j.dataLoadEnd,function(){this.setSuspendRendering(!1),i.relayout(),C.setSuspendDrawing(!1,!0),p&&i.fire(j.dataLoadEnd)}.bind(this)),l.bind(j.dataAppendEnd,function(){this.setSuspendRendering(!1),i.refresh(),C.setSuspendDrawing(!1,!0),p&&i.fire(j.dataAppendEnd)}.bind(this));var X=function(a,c){var d=K[a.id];if(null==d){var e=Z.getNodeDefinition(v(a.data));if(e.ignore===!0)return!1;if(d=ca(a,a.data,a),!d)throw new Error("Cannot render node");var f=C.getId(d);K[a.id]=d,L[f]=a,O(a),d.jtk={node:a},i.append(d,f,c?c.position:null),ga(d,a,a.id);var g={node:a,el:d};i.getLayout().nodeAdded(g,b.eventInfo),i.fire(j.nodeAdded,g)}
return d};l.bind(j.nodeAdded,function(a){var b,c=a.node,d=X(c,a.eventInfo);if(null!=d){var e=C.getSelector(d,"[data-port-id]");for(b=0;b<e.length;b++){var f=e[b].getAttribute("data-port-id");M[c.id+"."+f]=e[b],e[b].jtk=e[b].jtk||{node:c,port:c.getPort(f)}}
i.refresh(!0)}}),l.bind(j.nodeRemoved,function(a){i.getLayout().nodeRemoved(a.nodeId),i.fire(j.nodeRemoved,{node:a.nodeId,el:K[a.nodeId]});var b=C.getId(K[a.nodeId]);C.remove(K[a.nodeId]),delete K[a.nodeId],delete L[b],P(a.node),i.refresh(!0)});var Y=function(a){return function(){var b=aa(a);b.doNotFireConnectionEvent=!0,l.isDebugEnabled()&&console.log("Renderer","adding edge with params",b);var c=C.connect(b);c.edge=a,Q[a.getId()]=c,U(b.type,a,c),i.fire(j.edgeAdded,{source:a.source,target:a.target,connection:c,edge:a}),i.refresh(!0)}};l.bind(j.edgeAdded,function(a){if(!J&&a.source!==i){var c=a.edge,d=Z.getEdgeDefinition(v(c.data||{}));if(d&&d.ignore===!0)return;var e=Y(c);b.connectionHandler?b.connectionHandler(c,e):e()}}),l.bind(j.edgeRemoved,function(a){if(!J&&a.source!==i){var b=a.edge,c=Q[b.getId()];c&&(l.isDebugEnabled()&&console.log("Renderer","removing edge",b),V(c,b),C.detach({connection:Q[b.getId()],fireEvent:!1}),delete Q[b.getId()])}}),l.bind(j.edgeTarget,function(a){if(!J){var b=a.edge,c=Q[b.getId()],d=K[b.target.getFullId()];c?null!=d?(l.isDebugEnabled()&&console.log("target change",c),C.setTarget(c,d)):(delete Q[b.getId()],C.detach({connection:c,forceDetach:!0,fireEvent:!1})):null!=d&&l.isDebugEnabled()&&jsPlumbUtil.log("Target for Edge "+b.getId()+" changed to Node "+d.id+"; we have no valid connection.")}}),l.bind(j.edgeSource,function(a){if(!J){var b=a.edge,c=Q[b.getId()],d=K[b.source.getFullId()];c?null!=d?C.setSource(c,d):(delete Q[b.getId()],C.detach({connection:c,forceDetach:!0,fireEvent:!1})):null!=d&&l.isDebugEnabled()&&jsPlumbUtil.log("Source for Edge "+b.getId()+" changed to Node "+d.id+"; we have no valid connection.")}}),l.bind("graphCleared",function(){for(var a in K)C.remove(K[a],!0);p&&p.clear(),C.setSuspendEvents(!0),C.batch(C.deleteEveryEndpoint,!0),C.setSuspendEvents(!1),N.length=0,Q={},K={},L={},M={},ea={},fa.source={},fa.target={}}),l.bind(j.portAdded,function(a){var b=K[a.node.id],c=da(a.port,a.data,a.node);M[a.node.id+"."+a.port.id]=c,ga(jsPlumb.getElement(c),a.node,a.node.id),i.fire(j.portAdded,{node:a.node,nodeEl:b,port:a.port,portEl:c}),C.recalculateOffsets(b),i.refresh(!0)}),l.bind(j.portRemoved,function(a){var b=K[a.node.id],c=a.node.id+"."+a.port.id,d=M[c];C.setSuspendEvents(!0),C.remove(d),C.setSuspendEvents(!1),delete M[c],i.fire(j.portRemoved,{node:a.node,port:a.port,portEl:d,nodeEl:b}),C.recalculateOffsets(b),i.refresh(!0)}),l.bind(j.edgeUpdated,function(a){var b=Q[a.edge.getId()];if(b){var c=aa(a.edge);b.setType(c.type,c.data)}}),l.bind(j.portUpdated,function(a){var b=M[a.port.getFullId()];b&&("undefined"!=typeof Rotors&&o.update(b,a.port.data),i.repaint(K[a.node.id]))}),l.bind(j.nodeUpdated,function(a){var b=K[a.node.getFullId()];b&&("undefined"!=typeof b._rotors&&o.update(b,a.node.data),ga(b,a.node,a.node.id),i.repaint(b))})}
var Z;this.setView=function(a){var b=e.merge(l.getModel(),a||{});Z=new c.Model(b,C)},this.setView(b.view);var $=[],_=function(a){return null==a?l:"string"==typeof a?l.select(a,!0):a.jtk?l.select(a.jtk.port||a.jtk.node,!0):a};this.activateState=function(a,b){var c=Z.getState(a);c&&(b=_(b),c.activate(b,i,l),$.push(c))},this.deactivateState=function(a,b){var c=Z.getState(a);c&&(b=_(b),c.deactivate(b,i,l),jsPlumbUtil.removeWithFunction($,function(a){return a==c}))},this.resetState=function(){for(var a=0;a<$.length;a++)$[a].deactivate(l,i,l);$.length=0};var aa=function(a){var b=w(a.data),c={type:b,data:a.data,cost:a.getCost(),directed:a.isDirected()},f=Z.getEdgeDefinition(b);f&&f.connector&&(c.connector=f.connector);var g=function(b){if(a[b].getNode){var f=a[b].getNode(),g=a[b].getFullId(),h=ea[g];if(null==h&&(h=fa[b][g]),null==h){var i=a[b],j=K[u(f.data)],k=v(f.data),l=Z.getNodeDefinition(k),m=y(i.data),n=Z.getPortDefinition(i.id,l),o=Z.getPortDefinition(m,l),p=e.merge(o,n),q=null==p?{}:d.populate(p,i.data);null==q.maxConnections&&(q.maxConnections=-1),h=C.addEndpoint(j,q),ea[g]=h,h.port=a[b]}
c[b]=h}else c[b]=K[u(a[b].data)]};return g("source"),g("target"),c},ba=function(a,b,c,d,e,f,g,h){return function(i,j,k){var m,n=b(j),o=null,p=c(j),q=Z[d](p),s=j;if(A){s=jsPlumb.extend({},q?q.parameters||{}:{}),jsPlumb.extend(s,j);var t={};for(m in s)s.hasOwnProperty(m)&&null!=s[m]&&(s[m].constructor==Function?t[m]=s[m](j):t[m]=s[m]);s=t}
if(q){var u=q.template||"jtk-template-"+p;o=q.templateRenderer?q.templateRenderer(u,s,l):z.render(u,s,l)}else o=e(s,n);o=C.getElement(o),o.setAttribute(h,n),jsPlumb.addClass(o,g),o.jtk=o.jtk||{},o.jtk[a]=i,o.jtk.node=k,f&&r&&ja.makeDraggable&&ja.makeDraggable(o,q.dragOptions);var v=function(a){C.on(o,a,function(b){q.events[a]({node:k,el:o,e:b})})};if(q&&q.events)for(m in q.events)v(m);return o}},ca=ba("node",u,v,"getNodeDefinition",k,!0,h.NODE,f.NODE),da=ba("port",x,y,"getPortDefinition",k,!1,h.PORT,f.PORT);this.initialize=function(){var a,c;if(l.setSuspendGraph(!0),C.setSuspendDrawing(!0),b.jsPlumbInstance){var d=b.jsPlumbInstance.select();d.each(function(a){Q[a.edge.getId()]=a});var c=b.jsPlumbInstance.getManagedElements();for(var e in c){var f=c[e].el;K[f.jtk.node.id]=f,L[b.jsPlumbInstance.getId(f)]=f.jtk.node}
ja.doImport&&ja.doImport(K,Q)}else{for(a=0;a<l.getNodeCount();a++)c=l.getNodeAt(a),X(c);for(a=0;a<l.getNodeCount();a++)if(c=l.getNodeAt(a),K[c.id])for(var g=l.getAllEdgesFor(c),h=0;h<g.length;h++)if(g[h].source==c||g[h].source.getNode&&g[h].source.getNode()==c){var i=Z.getEdgeDefinition(v(g[h].data));if(i&&i.ignore===!0)continue;var j=aa(g[h]);j.doNotFireConnectionEvent=!0;var k=C.connect(j);null!=k&&(k.edge=g[h],Q[g[h].getId()]=k,U(j.type,g[h],k))}}
this.relayout(),C.setSuspendDrawing(!1,!0),l.setSuspendGraph(!1)},this.getContainer=function(){return q},this.getContainerId=function(){return D},this.getRenderedElement=function(a){return("Port"===a.objectType?M:K)[a.getFullId()]},this.getRenderedNode=function(a){return K[a]},this.getRenderedPort=function(a){return M[a]},this.getRenderedConnection=function(a){return Q[a]},this.setLayout=function(b,c){if(b){var d=C.extend({container:q,getElementForNode:function(a){return K[a]}},b);if(d.jsPlumbToolkit=l,d.adapter=i,!a.jsPlumbToolkit.Layouts[d.type])throw"no such layout ["+d.type+"]";p=new a.jsPlumbToolkit.Layouts[d.type](d),c||i.refresh()}},this.getLayout=function(){return p},this.magnetize=function(a){null!=p&&p.magnetize(a)},this.refresh=function(a){s||a&&!t||(p?p.layout(function(){window.setTimeout(C.repaintEverything,0)}):C.repaintEverything())},this.setRefreshAutomatically=function(a){t=a},this.relayout=function(a){s||(p?p.relayout(a,function(){C.repaintEverything(),this.fire("relayout",this.getBoundsInfo())}.bind(this)):C.repaintEverything())},this.getPath=function(a){var b=l.getPath(a);return b&&(b.setVisible=function(a){i.setVisible(b,a)},b.addNodeClass=function(a){b.eachNode(function(b,c){C.addClass(K[c.id],a)})},b.removeNodeClass=function(a){b.eachNode(function(b,c){C.removeClass(K[c.id],a)})},b.addEdgeClass=function(a){b.eachEdge(function(b,c){Q[c.getId()].addClass(a)})},b.removeEdgeClass=function(a){b.eachEdge(function(b,c){Q[c.getId()].removeClass(a)})},b.addClass=function(a){this.addNodeClass(a),this.addEdgeClass(a)},b.removeClass=function(a){this.removeNodeClass(a),this.removeEdgeClass(a)}),b},this.getPosition=function(a){var b=this.getLayout();if(b){var c=ia(a).id;return b.getPosition(c)}},this.getSize=function(a){return C.getSize(ia(a).el)},this.getCoordinates=function(a){var b=this.getLayout();if(b){var c=ia(a),d=b.getPosition(c.id),e=C.getSize(c.el);return{x:d[0],y:d[1],w:e[0],h:e[1]}}};var ea={},fa={source:{},target:{}},ga=function(a,b,c,f){f=f||0;var h,j=function(a,f,g,h){var j=a.getAttribute("port-id"),k=a.getAttribute("port-type")||"default",l=a.getAttribute("scope")||C.getDefaultScope(),m=v(b),n=Z.getNodeDefinition(m),o=Z.getPortDefinition(j,n),p=Z.getPortDefinition(k,n),q=e.merge(p,o),r=null==q?{}:d.populate(q,b.data),s=function(a){return function(d){var e=b.getPort(j),f=[{portId:j,nodeId:c,port:e,node:b,portType:k,endpoint:d.endpoint,anchor:d.anchor}];a.apply(a,f)}},t=function(a){return function(b){var c=[{connection:b.connection||b,source:ia(b.source),target:ia(b.target),scope:b.scope}];return a.apply(a,c)}},u=r.edgeType||"default",w={paintStyle:"connectorStyle",hoverPaintStyle:"connectorHoverStyle",overlays:"connectorOverlays",endpointStyle:"paintStyle"},x=Z.getEdgeDefinition(u);if(x)for(var y in x){var z=w[y]||y;r[z]=x[y]}
if(r.connectionType=u,r.portId=j,r.portType=k,r.scope=l,r.parameters=r.parameters||{},r.parameters.portId=j,r.parameters.portType=k,r.parameters.scope=l,r.parameters.nodeId=c,r.events={},q.events)for(y in q.events)r.events[y]=s(q.events[y]);if(q.interceptors)for(y in q.interceptors)r[y]=t(q.interceptors[y]);return r.events.anchorChanged=function(a){i.fire("anchorChanged",{portId:j,nodeId:c,portType:k,node:b,port:b.getPort(j),endpoint:a.endpoint,anchor:a.anchor})},r};if(a.childNodes){var k,m=[];for(h=0;h<a.childNodes.length;h++)if(3!=a.childNodes[h].nodeType&&8!=a.childNodes[h].nodeType){if(a.childNodes[h].tagName.toUpperCase()==g.PORT&&null==a.childNodes[h].getAttribute("jtk-processed")){k=j(a.childNodes[h],!0,!0);var n=C.addEndpoint(a,k);ea[c+"."+k.portId]=n;var p=b.addPort({id:k.portId});a.childNodes[h].setAttribute("jtk-processed",!0),n.graph={node:b,port:p},"undefined"!=typeof Rotors&&o.onUpdate(a,function(a,b){})}
if(a.childNodes[h].tagName.toUpperCase()==g.SOURCE&&null==a.childNodes[h].getAttribute("jtk-processed")){k=j(a.childNodes[h],!0,!1);var q=a.childNodes[h].getAttribute("filter");if(0!=f&&(fa.source[c+"."+k.portId]=a,l.addPort(b,{id:k.portId},!0)),q){var r=a.childNodes[h].getAttribute("filter-exclude"),s="true"===r;k.filter=q,k.filterExclude=s}
C.makeSource(a,k),a.childNodes[h].setAttribute("jtk-processed",!0),"undefined"!=typeof Rotors&&o.onUpdate(a,function(a,b){var c=jsPlumb.getSelector(a,"jtk-source");if(1==c.length){var d=j(c[0],!0,!1);d.scope&&C.setSourceScope(a,d.scope)}})}
a.childNodes[h].tagName.toUpperCase()==g.TARGET&&null==a.childNodes[h].getAttribute("jtk-processed")&&(k=j(a.childNodes[h],!1,!0),0!=f&&(fa.target[c+"."+k.portId]=a,l.addPort(b,{id:k.portId},!0)),C.makeTarget(a,k),a.childNodes[h].setAttribute("jtk-processed",!0),"undefined"!=typeof Rotors&&o.onUpdate(a,function(a,b){var c=jsPlumb.getSelector(a,"jtk-target");if(1==c.length){var d=j(c[0],!0,!1);d.scope&&C.setTargetScope(a,d.scope)}})),ga(a.childNodes[h],b,c,f+1)}
for(h=0;h<m.length;h++)m[h].parentNode.removeChild(m[h])}};this.setLayout(b.layout,!0),this.storePositionsInModel=function(a){a=a||{};var b=a.leftAttribute||"left",c=a.topAttribute||"top",d=p.getPositions();for(var e in d){var f=l.getNode(e);f.data[b]=d[e][0],f.data[c]=d[e][1]}},this.storePositionInModel=function(a){var b="string"==typeof a?a:a.id,c="string"==typeof a?"left":a.leftAttribute||"left",d="string"==typeof a?"top":a.topAttribute||"top",e=p.getPosition(b);return l.getNode(b).data[c]=e[0],l.getNode(b).data[d]=e[1],e};var ha=function(a,b,c,d,e,f,g){return a=a||ia(b),a&&(p.setPosition(a.id,c,d),e||(C.setAbsolutePosition(a.el,[c,d],f,g),C.revalidate(a.el))),a};this.setPosition=function(a,b,c,d){return ha(null,a,b,c,d)},this.animateToPosition=function(a,b,c,d){var e=ia(a);if(e){var f=p.getPosition(e.id);ha(e,a,b,c,!1,[f[0],f[1]],d)}},this.setVisible=function(a,b,c){if(null!=a){var d=function(a){var d=R(a);d&&d.setVisible(b),c||(d.endpoints[0].setVisible(b),d.endpoints[1].setVisible(b))},e=function(a,e){if(e&&(e.style.display=b?"block":"none",!c))for(var f=l.getAllEdgesFor(a),g=0;g<f.length;g++)d(f[g])},f=function(a){var c=a.getFullId(),d=ea[c];d.setVisible(b)},g=function(a){var b=ia(a);switch(b.type){case"Edge":d(b.obj);break;case"Node":e(b.obj,b.el);break;case"Port":f(b.obj)}};if(a.eachNode&&a.eachEdge)a.eachNode(function(a,b){g(b)}),a.eachEdge(function(a,b){g(b)});else if(a.length&&"string"!=typeof a)for(var h=0;h<a.length;h++)g(a[h]);else g(a)}};var ia=function(a){return a instanceof C.getDefaultConnectionType()&&(a=a.edge),l.getObjectInfo(a,function(a){return a.getNode?M[a.id]:K[a.id]})},ja={jsPlumb:C,toolkit:l,container:q,containerId:D,getConnectionsForEdges:S,getConnectionForEdge:R,getElement:function(a){return K[a]},getNodeForElementId:function(a){return L[a]},getObjectInfo:ia,nodeMap:K,reverseNodeMap:L};return ja};b.DOM=function(a){q.apply(this,arguments),p.apply(this,arguments)}}.call(this),function(){"use strict";var a=this,b={webkit:{mac:function(a){return a.deltaY/120},win:function(a){return a.deltaY/100}},safari:function(a){return a.wheelDeltaY/120},firefox:{mac:function(a){return-1*a.deltaY*(1==a.deltaMode?25:1)/120},win:function(a){return-1*a.deltaY/3}},ie:function(a){return a.wheelDelta/120},"default":function(a){return a.deltaY||a.wheelDelta}},c=/Mac/.test(navigator.userAgent)?"mac":"win",d=-1!=navigator.userAgent.indexOf("Firefox")?"firefox":/Safari/.test(navigator.userAgent)?"safari":/WebKit/.test(navigator.userAgent)?"webkit":/Trident/.test(navigator.userAgent)?"ie":"default",e="function"==typeof b[d]?b[d]:b[d][c],f=function(a){return e(a||event)},g=function(a,b){return function(c){b&&null!=c.mozInputSource&&1!==c.mozInputSource||(c.normalizedWheelDelta=f(c),a(c))}},h="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";a.addWheelListener=function(a,b,c){var d=g(b,c);a.addEventListener?a.addEventListener(h,d,!1):a.attachEvent&&a.attachEvent("onmousewheel",d)}}.call(this),function(){var a=this;a.PinchListener=function(a){var b="onpointerdown"in document.documentElement,c="ontouchstart"in document.documentElement,d=[0,0],e=0,f=0,g=function(b){a[b](d,f,e,e/f)},h=function(){a.onPinchEnd()},i="onPinchStart",j="onPinch",k="pointerdown",l="pointermove",m="pointerup",n="touchstart",o="touchmove",p="touchend",q=function(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))},r={pointer:function(){var b={},c=[],n=0,o=!1,p=function(){2==n&&(d=[(c[1].p[0]+c[0].p[0])/2,(c[1].p[1]+c[0].p[1])/2],e=q(c[1].p[0],c[1].p[1],c[0].p[0],c[0].p[1]))},r=function(a){n>=2||o||(c[n]={e:a,p:[a.pageX,a.pageY]},b[""+a.pointerId]=n,n++,p(),2==n&&(f=e,g(i)))},s=function(a){var c=b[""+a.pointerId];null!=c&&(delete b[""+a.pointerId],n--,o=0!==n,h())},t=function(a){if(!o&&2==n){var d=b[a.pointerId];null!=d&&(c[d].p=[a.pageX,a.pageY],p(),g(j))}};a.bind(a.el,k,r),a.bind(document,m,s),a.bind(document,l,t)},touch:function(a){var b=function(a){return a.touches||[]},c=function(a,b){return a.item?a.item(b):a[b]},k=function(a){var b=c(a,0),d=c(a,1);return q(b.pageX,b.pageY,d.pageX,d.pageY)},l=function(a){var b=c(a,0),d=c(a,1);return[(b.pageX+d.pageX)/2,(b.pageY+d.pageY)/2]},m=!1,r=function(c){var h=b(c);2==h.length&&a.enableWheelZoom!==!1&&(d=l(h),e=f=k(h),m=!0,a.bind(document,o,t),a.bind(document,p,s),g(i))},s=function(b){m=!1,a.unbind(document,o,t),a.unbind(document,p,s),h()},t=function(a){if(m){var c=b(a);2==c.length&&(e=k(c),d=l(c),g(j))}};a.bind(a.el,n,r)}};b?r.pointer(a):c&&r.touch(a)}}.call(this),function(){"use strict";this.ZoomWidget=function(b){function e(a){if(f())return{w:0,h:0,x:0,y:0,vw:b.width(s),vh:b.height(s),padding:a,z:1,zoom:1};a=0;var c=Math.abs(ia.maxx[0][0][0]+ia.maxx[0][1]-ia.minx[0][0][0]),d=Math.abs(ia.maxy[0][0][1]+ia.maxy[0][2]-ia.miny[0][0][1]),e=b.width(s),g=b.height(s),h=e/c,i=g/d,j=Math.min(h,i);return{w:c,h:d,x:ia.minx[0][0][0],y:ia.miny[0][0][1],vw:e,vh:g,padding:a,z:j,zoom:$}}
function f(){for(var a in ja)return!1;return!0}
b.events=b.events||{};var g,h,i,j,k,l,m=this,n=function(){},o=b.canvas,p=b.domElement||function(a){return a},q=p(o),r=b.viewport,s=p(r),t=b.events.zoom||n,u=(b.events.maybeZoom||function(){return!0},b.events.pan||n),v=b.events.mousedown||n,w=b.events.mouseup||n,x=b.events.mousemove||n,y=b.events.transformOrigin||n,z=!(b.clamp===!1),A=b.clampZoom!==!1,B=b.panDistance||50,C=b.enablePan!==!1,D=b.enableWheelZoom!==!1,E=b.enableAnimation!==!1,F=b.wheelFilter||function(){return!0},G=b.wheelSensitivity||10,H=b.enablePanButtons!==!1,I=b.padding||[0,0],J=b.consumeRightClick!==!1,K=b.smartMinimumZoom,L=!1,M="mousedown",N="mouseup",O="mousemove",P=["webkit","Moz","ms"],Q=b.bind,R=b.unbind,S=!(b.enabled===!1),T=b.clampToBackground,U=b.clampToBackgroundExtents,V=b.filter||function(a){return!1},W=b.width,X=b.height,Y=0,Z=0,$=b.zoom||1,_=[0,0],aa=!1,ba=!1,ca=!1,da=!1,ea=b.zoomRange||[.05,3],fa=150,ga=-1,ha=-1,ia={minx:[],maxx:[],miny:[],maxy:[]},ja={},ka={},la=!1,ma=function(){ia.minx.sort(function(a,b){return a[0][0]<b[0][0]?-1:1}),ia.miny.sort(function(a,b){return a[0][1]<b[0][1]?-1:1}),ia.maxx.sort(function(a,b){return a[0][0]+a[1]>b[0][0]+b[1]?-1:1}),ia.maxy.sort(function(a,b){return a[0][1]+a[2]>b[0][1]+b[2]?-1:1})},na=function(a,b,c,d){null==ja[a]&&(ja[a]=[],ia.minx.push(ja[a]),ia.miny.push(ja[a]),ia.maxx.push(ja[a]),ia.maxy.push(ja[a])),ja[a][0]=b,ja[a][1]=c,ja[a][2]=d,ja[a][3]=a,L?la=!0:ma()};this.setSuspendRendering=function(a){L=a,!a&&la&&ma(),la=!1};var oa=function(a,b){return function(c){Na(q,a*B,b*B,null,!0,function(a){u(a[0],a[1],$,$,c),g&&g.pan(),Ya.pan()})}},pa=150,qa=60,ra=10,sa=null,ta=null,ua=null,va=function(a,c,d){return function(){ua=d,b.addClass(ua,"jtk-surface-pan-active"),b.bind(document,"mouseup",wa),sa=window.setTimeout(function(){b.bind(document,N,ya),ta=window.setInterval(xa(a,c),qa)},pa)}},wa=function(){window.clearTimeout(sa),ua&&b.removeClass(ua,"jtk-surface-pan-active"),ua=null},xa=function(a,b){return function(c){var d=Na(q,a*ra,b*ra,null);u(d[0],d[1],$,$,c),g&&g.pan(),Ya.pan()}},ya=function(){window.clearTimeout(ta)},za=function(a,c,d,e,f){var g=document.createElement("div");g.innerHTML=f||"",g.style.position="absolute";for(var h in c)g.style[h]=c[h];return g.className="jtk-surface-pan jtk-surface-pan-"+a,s.appendChild(g),b.bind(g,"click",oa(d,e)),b.bind(g,"mousedown",va(d,e,g)),g};H&&(za("top",{left:"0px",top:"0px"},0,-1,"&#8593;"),za("bottom",{left:"0px",bottom:"0px"},0,1,"&#8595;"),za("left",{left:"0px",top:"0px"},-1,0,"&#8592;"),za("right",{right:"0px",top:"0px"},1,0,"&#8594;"));var Aa=function(a,b,c){c=c||q;for(var d=0;d<P.length;d++){var e=a.replace(/([a-z]){1}/,function(a){return P[d]+a.toUpperCase()});c.style[e]=b}
c.style[a]=b},Ba=function(a){Aa("transformOrigin",_[0]+"% "+_[1]+"%",a)},Ca=function(a,c){var d=Oa(),e=b.offset(s,!0),f=Ma(q),g=b.width(o),h=b.height(o),i=[(a-(e.left+f[0])-d[0])/$,(c-(e.top+f[1])-d[1])/$];return{w:g,h:h,xy:i,xScale:i[0]/g,yScale:i[1]/h,o:[i[0]/g*100,i[1]/h*100]}},Da=function(a,b,c){var d,e,f,g,h=Ca(a,b),i=_[0]/100*h.w,j=_[1]/100*h.h;d=-(i*(1-$)),e=-(j*(1-$)),_=h.o,Ba(),i=_[0]/100*h.w,j=_[1]/100*h.h,f=-(i*(1-$)),g=-(j*(1-$));var k=Na(q,f-d,g-e,c);y&&y(_,k)},Ea=function(a){var b=Fa(a);Da(b[0],b[1],a)},Fa=this.pageLocation=function(a){if(a.pageX)return[a.pageX,a.pageY];var b=Ga(Ha(a),0);return b?[b.pageX,b.pageY]:[0,0]},Ga=function(a,b){return a.item?a.item(b):a[b]},Ha=function(a){return a.touches||[]},Ia=function(a,b,c,d,f){if(!(null==a||isNaN(a)||0>a)){var h=ea[0];if(K){h=.5;var i=e().z,j=a/i;h>j&&(a=i*h)}else h>a&&(a=h);if(a>ea[1]&&(a=ea[1]),d){var k=a>$?.05:-.05,l=$,m=$>a,n=window.setInterval(function(){l=Ia(l+k),m&&a>=l&&window.clearInterval(n),!m&&l>=a&&window.clearInterval(n)});return $}
Aa("transform","scale("+a+")");var o=$;if($=a,f||t(Y,Z,$,o,b,c),null!=g&&g.setZoom(a),Ya&&Ya.pan(),A){var p=Ma(q),r=La(p[0],p[1]);(r[0]!=p[0]||r[1]!=p[1])&&Ma(q,r[0],r[1],null,null==d?null:!d)}
return $}},Ja=function(a,b,c,d){-fa>b&&(b=-fa),b>fa&&(b=fa),Ka(i,b,-fa,fa,c,d)},Ka=function(a,b,c,d,e,f){var g=b/(b>=0?d:c),h=b>=0?1:0,i=a+g*(ea[h]-a);Ia(i,e,f)},La=function(a,c,d){if(z||T||U){var f=Oa(),h=a,i=c,j=z?e():{x:0,y:0,w:0,h:0,vw:b.width(s),vh:b.height(s),padding:d,z:1};if(d=(d||20)*$,(T||U)&&null!=g){var k=g.getWidth(),l=g.getHeight(),m=Math.max(j.x+j.w,k),n=Math.max(j.y+j.h,l);j.w=m-j.w,j.h=n-j.h;var o=j.vw/j.w,p=j.vh/j.h;j.z=Math.min(o,p),U&&(d=Math.max(j.vw,j.vh))}
var q=[j.x+j.w,j.y+j.h];g&&(q[0]=Math.max(q[0],g.getWidth()),q[1]=Math.max(q[1],g.getHeight()));var r=a+f[0]+q[0]*$-d,t=c+f[1]+q[1]*$-d,u=a+f[0]+j.x*$+d,v=c+f[1]+j.y*$+d;return 0>r&&(h-=r),u>j.vw&&(h-=u-j.vw),0>t&&(i-=t),v>j.vh&&(i-=v-j.vh),[h,i]}
return[a,c]},Ma=function(a,c,d,e,f,g,h){if(1==arguments.length)return[parseInt(a.style.left,10)||0,parseInt(a.style.top,10)||0];var i=La(c,d);return E&&!f&&b.animate?b.animate(a,{left:i[0],top:i[1]},{step:h,complete:function(){g&&g(i)}}):(a.style.left=i[0]+"px",a.style.top=i[1]+"px",g&&g(i)),i};q.style.left="0px",q.style.top="0px";var Na=function(a,b,c,d,e,f){var g=Ma(a);return Ma(a,g[0]+b,g[1]+c,d,!e,f)},Oa=function(){var a=b.width(o),c=b.height(o),d=_[0]/100*a,e=_[1]/100*c;return[d*(1-$),e*(1-$)]},Pa={start:function(a,c){if(!ba){var d=a.srcElement||a.target;S&&(d==q||d==s||d._jtkDecoration||g&&g.owns(d)||V(d,a)===!0)&&(da=!1,ga=-1,ha=-1,3!==a.which||b.enableWheelZoom===!1||null!=a.mozInputSource&&1!==a.mozInputSource?c.length<=1&&(aa=!0,h=Fa(a),l=Ma(q)):(ca=!0,h=Fa(a),Ea(a),l=Ma(q),i=$)),v(a,m)}},move:function(a,b){var c,d,e;if(da=!1,!ba){if(ca)e=Fa(a),c=e[0]-h[0],d=e[1]-h[1],Ja(c,d,a);else if(aa&&C&&null!=h){e=Fa(a),c=e[0]-h[0],d=e[1]-h[1];var f=Ma(q,l[0]+c,l[1]+d,a,!0);u(f[0],f[1],$,$,a),g&&g.pan(),Ya&&Ya.pan()}
x(a,m)}},end:function(a,b){ba||(ca=!1,h=null,aa=!1,da=!1,R(document,O,Ra),R(document,N,Sa),Q(document,O,Ta),w(a,m))},contextmenu:function(a){}},Qa=function(a,b){("contextmenu"!==a||J)&&b.preventDefault&&b.preventDefault();var c=Ha(b);Pa[a](b,c)},Ra=function(a){Qa("move",a)},Sa=function(a){Qa("end",a)},Ta=function(a){da=!1};Q(document,O,Ta);var Ua=this.start=function(a){S&&null!=a&&(R(document,O,Ta),Q(document,O,Ra),Q(document,N,Sa),Pa.start(a,Ha(a)))};if(Q(r,M,Ua),Q(r,"contextmenu",function(a){Qa("contextmenu",a)}),D){var Va=function(a){F(a)&&(a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),i=$,da||(Ea(a),da=!0),Ja(0,a.normalizedWheelDelta*G,a,!0))};addWheelListener(s,Va,!0)}
new PinchListener({el:r,bind:Q,unbind:R,enableWheelZoom:b.enableWheelZoom,onPinch:function(a,b,c,d){Ia(d*i);var e=a[0]-h[0],f=a[1]-h[1];Ma(q,l[0]+e,l[1]+f,null,!0)},onPinchStart:function(a,b){ba=!0,h=a,j=k=b,i=$,Da(h[0],h[1]),l=Ma(q)},onPinchEnd:function(){ba=!1,h=null}}),Ia($,null,!1,!1,!0),Ba(),this.positionChanged=function(a,c,d){d=d||b.id(a);var e=c||Ma(a),f=b.width(a),g=b.height(a);ka[d]=a,na(d,e,f,g)},this.add=function(a,b,c,d){this.positionChanged(a,c,b),d&&(Q(a,M,Ua),a._jtkDecoration=!0)},this.remove=function(a){a=p(a);var c=b.id(a);delete ja[c],delete ka[c];for(var d in ia)if(ia.hasOwnProperty(d)){for(var e=-1,f=0;f<ia[d].length;f++)if(ia[d][f][3]===c){e=f;break}-1!=e&&ia[d].splice(e,1)}},this.reset=function(){ia.minx.length=0,ia.miny.length=0,ia.maxx.length=0,ia.maxy.length=0,ja={},ka={},Ma(q,0,0,null,!0)},this.getBoundsInfo=e,this.zoomToFit=function(a){a=a||{};var b=e(a.padding);a.doNotZoomIfVisible&&b.z>$||Ia(b.z),m.centerContent({bounds:b,doNotAnimate:a.doNotAnimate!==!1,onComplete:a.onComplete,onStep:a.onStep,doNotFirePanEvent:a.doNotFirePanEvent})},this.zoomToFitIfNecessary=function(a){var b=jsPlumb.extend(a||{});b.doNotZoomIfVisible=!0,this.zoomToFit(b)},this.zoomToBackground=function(a){if(a=a||{},null!=g){var b=g.getWidth(),c=g.getHeight(),d=W(s),e=X(s),f=d/b,h=e/c,i=Math.min(f,h),j={w:b,h:c,x:0,y:0,vw:d,vh:e,padding:0,z:i};Ia(j.z),m.centerContent({bounds:j,doNotAnimate:a.doNotAnimate,onComplete:a.onComplete,onStep:a.onStep})}},this.setFilter=function(a){V=a||function(a){return!1}},this.centerBackground=function(){if(null!=g){var a=jsPlumb.extend({},e());a.x=g.getWidth()/2,a.y=g.getHeight()/2,a.w=1,a.h=1,m.centerContent({bounds:a,doNotAnimate:b.doNotAnimate,onComplete:b.onComplete,onStep:b.onStep,vertical:!0,horizontal:!0})}},this.alignBackground=function(a){if(null!=g){var b=a.split(" "),c=b[0]||"left",d=b[1]||"top",f=e(),h="left"===c?0:f.vw-g.getWidth()*$,i="top"===d?0:f.vh-g.getHeight()*$,j=Oa();Ma(q,h-j[0],i-j[1]),g.pan(),Ya&&Ya.pan()}},this.positionElementAt=function(a,c,d,e,f,g){e=e||0,f=f||0;var h=Oa(),i=Ma(q),j=p(a),k=j.parentNode,l=b.offset(k),m=b.offset(r),n=m.left-l.left+(i[0]+h[0])+c*$+e,o=m.top-l.top+(i[1]+h[1])+d*$+f;g&&0>n&&(n=0),g&&0>o&&(o=0),j.style.left=n+"px",j.style.top=o+"px"},this.positionElementAtPageLocation=function(a,b,c,d,e){var f=this.mapLocation(b,c);this.positionElementAt(a,f.left,f.top,d,e)},this.positionElementAtEventLocation=function(a,b,c,d){var e=this.mapEventLocation(b);this.positionElementAt(a,e.left,e.top,c,d)},this.zoomToEvent=function(a,b){Ea(a),Ia($+b,a)},this.relayout=function(a){if(b.enablePan===!1){Ma(q,-a.x+I[0],-a.y+I[1]);var c=a.w+(a.x<0?a.x:0)+I[0],d=a.h+(a.y<0?a.y:0)+I[1];q.style.width=c+"px",q.style.height=d+"px";var e=0==c?0:(a.x-I[0])/c*100,f=0==d?0:(a.y-I[1])/d*100;this.setTransformOrigin(e,f)}},this.nudgeZoom=function(a,c){var d=b.offset(s,!0),e=d.left+b.width(s)/2,f=d.top+b.height(s)/2;return Da(e,f),Ia($+a,c)},this.nudgeWheelZoom=function(a,b){i=$,Ja(0,a,b,!0)},this.centerContent=function(a){a=a||{};var b=a.bounds||e(),c=Oa(),d=b.x*$+b.w*$/2,f=b.y*$+b.h*$/2,h=b.vw/2-d,i=b.vh/2-f,j=Ma(q);Ma(q,a.horizontal!==!1?h-c[0]:j[0],a.vertical!==!1?i-c[1]:j[1],null,a.doNotAnimate,function(){a.doNotFirePanEvent||u(a.horizontal!==!1?h-j[0]:0,a.vertical!==!1?i-j[1]:0,$,$),g&&g.pan(),Ya&&Ya.pan(),a.onComplete&&a.onComplete()},a.onStep)},this.centerContentHorizontally=function(a){this.centerContent(jsPlumb.extend({horizontal:!0},a))},this.centerContentVertically=function(a){this.centerContent(jsPlumb.extend({vertical:!0},a))},this.centerOn=function(a,c,d){var f=jsPlumb.extend({},e()),g=Ma(a),h=W(a),i=X(a);f.x=g[0],f.y=g[1],f.w=h,f.h=i,this.centerContent({bounds:f,doNotAnimate:b.doNotAnimate,onComplete:b.onComplete,onStep:b.onStep,vertical:d!==!1,horizontal:c!==!1})},this.centerOnHorizontally=function(a){this.centerOn(a,!0,!1)},this.centerOnVertically=function(a){this.centerOn(a,!1,!0)},this.getViewportCenter=function(){var a=jsPlumb.extend({},e()),b=Oa(),c=Ma(q),d=[a.vw/2,a.vh/2];return[(d[0]-(c[0]+b[0]))/$,(d[1]-(c[1]+b[1]))/$]},this.setViewportCenter=function(a){var b=jsPlumb.extend({},e()),c=Oa(),d=[b.vw/2,b.vh/2],f=[c[0]+($*a[0]+d[0]),c[1]+($*a[1]+d[1])];Ma(q,f[0],f[1])},this.setClamping=function(a){z=a},this.setZoom=function(a,b,c){return Ia(a,null,null,b,c)},this.setZoomRange=function(a,b){return null!=a&&2==a.length&&a[0]<a[1]&&null!=a[0]&&null!=a[1]&&a[0]>0&&a[1]>0&&(ea=a,b||($<ea[0]||$>ea[1])&&Ia($)),this},this.getZoomRange=function(){return ea},this.getZoom=function(){return $},this.getPan=function(){return Ma(q)},this.pan=function(a,b,c){Na(q,a,b,null,c,function(a){u(a[0],a[1],$,$),g&&g.pan(),Ya&&Ya.pan()})},this.setPan=function(a,b,c,d,e){return Ma(q,a,b,null,!c,d,e)},this.setTransformOrigin=function(a,b){_=[a,b],Ba()},this.mapLocation=function(a,c,d){var e=Oa(),f=Ma(q),g=s.scrollLeft,h=s.scrollTop,i=d?{left:0,top:0}:b.offset(s);return{left:(a-(f[0]+e[0])-i.left+g)/$,top:(c-(f[1]+e[1])-i.top+h)/$}},this.mapEventLocation=function(a,b){var c=Fa(a);return this.mapLocation(c[0],c[1],b)},this.setEnabled=function(a){S=a},this.showElementAt=function(a,c,d){var e=p(a),f=e.parentNode,g=b.offset(f),h=b.offset(r),i=Oa(),j=g.left-h.left+i[0]+c,k=g.top-h.top+i[1]+d;b.offset(a,{left:j,top:k})},this.getApparentCanvasLocation=function(){var a=Oa(),b=Ma(q);return[b[0]+a[0],b[1]+a[1]]},this.setApparentCanvasLocation=function(a,b){var c=Oa(),d=Ma(q,a-c[0],b-c[1],null,!0);return g&&g.pan(),Ya&&Ya.pan(),d},this.applyZoomToElement=function(a,b){b=b||$,Aa("transform","scale("+b+")",a)},this.setTransformOriginForElement=function(a,b){Aa("transformOrigin",b[0]+" "+b[1],a)},this.getTransformOrigin=function(){return _},this.floatElement=function(a,b){null!=a&&(a.style.position="absolute",a.style.left=b[0]+"px",a.style.top=b[1]+"px",s.appendChild(a))};var Wa={},Xa=function(a){var b=m.getApparentCanvasLocation();for(var c in Wa)if(Wa.hasOwnProperty(c)){if(null!=a&&a!=c)continue;var d=Wa[c],e=function(a,c){d[a]&&(b[c]/$+d.pos[c]<0?d.el.style[a]=-(b[c]/$)+"px":d.el.style[a]=d.pos[c]+"px")};e("left",0),e("top",1)}},Ya={pan:Xa};this.fixElement=function(a,c,d){if(null!=a){var e=b.id(a);Wa[e]={el:a,left:c.left,top:c.top,pos:d},a.style.position="absolute",a.style.left=d[0]+"px",a.style.top=d[1]+"px",q.appendChild(a),Xa(e)}},this.findIntersectingNodes=function(a,c,d,e){var f=this.getApparentCanvasLocation(),g=b.offset(s),h=s.scrollLeft,i=s.scrollTop,j=[],k={x:a[0],y:a[1],w:c[0],h:c[1]},l=d?Biltong.encloses:Biltong.intersects,m=[g.left+f[0]-h,g.top+f[1]-i];for(var n in ja){var o=ja[n],p={x:m[0]+o[0][0]*$,y:m[1]+o[0][1]*$,w:o[1]*$,h:o[2]*$};l(k,p)&&(null==e||e(n,ka[n],p))&&j.push({id:n,el:ka[n],r:p})}
return j},this.findNearbyNodes=function(a,b,c,d){var e=[];if(!c||this.isInViewport(a[0],a[1])){e=this.findIntersectingNodes([a[0]-b,a[1]-b],[2*b,2*b],!1,d);var f=this.mapLocation(a[0],a[1]);e.sort(function(a,b){var c=[a.x+a.w/2,a.y+a.h/2],d=[b.x+b.w/2,b.y+b.h/2],e=Biltong.lineLength(f,c),g=Biltong.lineLength(f,d);return g>e?-1:e>g?1:0})}
return e},this.isInViewport=function(a,c){var d=b.offset(s),e=b.width(s),f=b.height(s);return d.left<=a&&a<=d.left+e&&d.top<=c&&c<=d.top+f},this.getElementPositions=function(){return ja},this.setFilter=function(a){V=a||function(a){return!1}},this.setWheelFilter=function(a){F=a||function(a){return!0}},this.setBackground=function(b){var e=b.type||"simple",f={simple:a,tiled:"absolute"==b.tiling?d:c};g=new f[e]({canvas:q,viewport:s,getWidth:W,getHeight:X,url:b.url,zoomWidget:m,onBackgroundReady:b.onBackgroundReady,options:b,img:b.img,resolver:b.resolver})},b.background&&this.setBackground(b.background),this.getBackground=function(){return g}};var a=function(a){var b=a.canvas,c=a.onBackgroundReady||function(){},d=new Image;d.onload=function(){b.style.backgroundImage="url('"+d.src+"')",b.style.backgroundRepeat="no-repeat",b.style.width=d.width+"px",b.style.height=d.height+"px",c(this)},d.src=a.img?a.img.src:a.url,this.owns=function(a){return a==b},this.getWidth=function(){return d.width||0},this.getHeight=function(){return d.height||0},this.setZoom=this.pan=function(a){}},b=function(a){var b=this,c=a.canvas,d=a.viewport;if(null==a.options.maxZoom)throw new TypeError("Parameter `maxZoom` not set; cannot initialize TiledBackground");if(!a.options.tileSize)throw new TypeError("Parameter `tileSize not set; cannot initialize TiledBackground. It should be an array of [x,y] values.");if(!a.options.width||!a.options.height)throw new TypeError("Parameters `width` and `height` must be set");for(var e=function(c){var d=document.createElement("div");d.style.position="relative",d.style.height="100%",d.style.width="100%",d.style.display="none",a.canvas.appendChild(d),this.zoom=c;var e=b.getTileSpecs(c),f=[],g=function(b,c,d){return a.url.replace("{z}",b).replace("{x}",c).replace("{y}",d)},h=function(b,c,d){return null==a.resolver?g(b,c,d):a.resolver(b,c,d)};this.apparentZoom=Math.min(e[2],e[3]),this.setActive=function(a){d.style.display=a?"block":"none"},this.xTiles=e[0],this.yTiles=e[1];for(var i=0;i<this.xTiles;i++){f[i]=f[i]||[];for(var j=0;j<this.yTiles;j++){var k=document.createElement("img");k._tiledBg=!0,k.className="jtk-surface-tile",k.ondragstart=function(){return!1},d.appendChild(k),k.style.position="absolute",k.style.opacity=0,f[i][j]=[k,new Image,!1]}}
var l=Math.pow(2,a.options.maxZoom-c)*a.options.tileSize[0];this.scaledImageSize=l;var m=function(a,b,d,e){a.style.left=d*l+"px",a.style.top=e*l+"px",a.style.width=l+"px",a.style.height=l+"px",b.onload=function(){a.setAttribute("src",b.src),a.style.opacity=1},b.src=h(c,d,e)};this.ensureLoaded=function(a,b,c,d){for(var e=a;c>=e;e++)for(var g=b;d>=g;g++)null!=f[e]&&null!=f[e][g]&&(f[e][g][2]||(m(f[e][g][0],f[e][g][1],e,g),f[e][g][2]=!0))}}.bind(this),f=[],g=null,h=0;h<=a.options.maxZoom;h++)f.push(new e(h));c.style.width=a.options.width+"px",c.style.height=a.options.height+"px";var i,j=function(){if(i<=f[0].apparentZoom)return 0;if(i>=f[f.length-1].apparentZoom)return f.length-1;for(var a=f.length-1;a>0;a--)if(f[a].apparentZoom>=i&&i>=f[a-1].apparentZoom)return a},k=function(a){var b=f[a];null!=g&&g!=b&&g.setActive(!1),b.setActive(!0),g=b},l=function(){var b=a.zoomWidget.getApparentCanvasLocation(),c=a.getWidth(d),e=a.getHeight(d),f=g.scaledImageSize*i,h=g.scaledImageSize*i,j=b[0]<0?Math.floor(-b[0]/f):b[0]<c?0:null,k=b[1]<0?Math.floor(-b[1]/h):b[1]<e?0:null,l=Math.min(g.xTiles,Math.floor((c-b[0])/f)),m=Math.min(g.yTiles,Math.floor((e-b[1])/h));null!=j&&null!=k&&g.ensureLoaded(j,k,l,m)};this.getCurrentLayer=function(){return g},this.getWidth=function(){return a.options.width},this.getHeight=function(){return a.options.height};var m=a.options.panDebounceTimeout||50,n=a.options.zoomDebounceTimeout||120,o=function(a,b){b=b||150;var c=null;return function(){window.clearTimeout(c),c=window.setTimeout(a,b)}},p=function(){k(j()),l()},q=o(p,n),r=o(l,m);this.setZoom=function(a,b){i=a,b?p():q()},this.pan=r,this.owns=function(a){return a==c||1==a._tiledBg},this.setZoom(a.zoomWidget.getZoom(),!0),null!=a.onBackgroundReady&&setTimeout(a.onBackgroundReady,0)},c=function(a){var c=a.options.width,d=a.options.height,e=a.options.tileSize;this.getTileSpecs=function(a){var b=c>d?1:c/d,f=d>c?1:d/c,g=Math.pow(2,a+1)*e[0]*b,h=Math.pow(2,a+1)*e[1]*f,i=Math.ceil(g/e[0]),j=Math.ceil(h/e[1]);return[i,j,g/c,h/d]},b.apply(this,arguments)},d=function(a){var c=a.options.maxZoom,d=a.options.width,e=a.options.height,f=a.options.tileSize;this.getTileSpecs=function(a){var b=Math.pow(2,c-a),g=Math.ceil(d/b/f[0]),h=Math.ceil(e/b/f[1]);return[g,h,g*f[0]/d,h*f[1]/e]},b.apply(this,arguments)}}.call(this),function(){"use strict";var a=this,b=a.jsPlumbToolkit,c=b.Renderers,d=a.jsPlumb,e=a.jsPlumbUtil,f=jsPlumb.getSelector,g=jsPlumbToolkit.Classes,h=jsPlumbToolkit.Constants,i=jsPlumbToolkit.Events;c.Surface=function(a){var j=this;c.Surface.SELECT=h.select,c.Surface.PAN=h.pan,c.Surface.DISABLED=h.disabled;var k=c.AbstractRenderer.apply(this,arguments);c.DOMElementAdapter.apply(this,arguments),this.getObjectInfo=k.getObjectInfo,a=a||{};var l,m=d.getElement(a.container),n=c.createElement({position:h.relative,width:h.nominalSize,height:h.nominalSize,left:0,top:0,clazz:g.SURFACE_CANVAS},m),o=!(a.elementsDraggable===!1),p=a.dragOptions||{},q=a.stateHandle,r=a.storePositionsInModel!==!1,s=a.modelLeftAttribute,t=a.modelTopAttribute,u=new ZoomWidget({viewport:m,canvas:n,domElement:k.jsPlumb.getElement,addClass:k.jsPlumb.addClass,removeClass:k.jsPlumb.removeClass,offset:this.getOffset,consumeRightClick:a.consumeRightClick,bind:function(){k.jsPlumb.on.apply(k.jsPlumb,arguments)},unbind:function(){k.jsPlumb.off.apply(k.jsPlumb,arguments)},width:function(a){return k.jsPlumb.getWidth(k.jsPlumb.getElement(a))},height:function(a){return k.jsPlumb.getHeight(k.jsPlumb.getElement(a))},id:k.jsPlumb.getId,animate:function(){k.jsPlumb.animate.apply(k.jsPlumb,arguments)},dragEvents:{stop:jsPlumb.dragEvents[h.stop],start:jsPlumb.dragEvents[h.start],drag:jsPlumb.dragEvents[h.drag]},background:a.background,padding:a.padding,panDistance:a.panDistance,enablePan:a.enablePan,enableWheelZoom:a.enableWheelZoom,wheelSensitivity:a.wheelSensitivity,enablePanButtons:a.enablePanButtons,enableAnimation:a.enableAnimation,clamp:a.clamp,clampZoom:a.clampZoom,clampToBackground:a.clampToBackground,clampToBackgroundExtents:a.clampToBackgroundExtents,zoom:a.zoom,zoomRange:a.zoomRange,extend:k.jsPlumb.extend,events:{pan:function(a,b,c,d,e){j.fire(i.pan,{x:a,y:b,zoom:c,oldZoom:d,event:e})},zoom:function(a,b,c,d,e){k.jsPlumb.setZoom(c),j.fire(i.zoom,{x:a,y:b,zoom:c,oldZoom:d,event:e})},mousedown:function(){jsPlumb.addClass(m,g.SURFACE_PANNING)},mouseup:function(){jsPlumb.removeClass(m,g.SURFACE_PANNING)}}}),v=[],w=a.autoExitSelectMode!==!1,x=new b.Widgets.Lasso({on:function(){k.jsPlumb.on.apply(k.jsPlumb,arguments)},off:function(){k.jsPlumb.off.apply(k.jsPlumb,arguments)},pageLocation:u.pageLocation,canvas:m,onStart:function(){j.setHoverSuspended(!0),v.length=0},onSelect:function(a,b,c,d){var e=[],f=u.findIntersectingNodes(a,b,!c[0]);k.jsPlumb.clearDragSelection&&k.jsPlumb.clearDragSelection(),k.toolkit.clearSelection(),d&&v.length>0&&k.toolkit.deselect(v);for(var g=0;g<f.length;g++)e.push(f[g].el.jtk.node),k.jsPlumb.addToDragSelection&&k.jsPlumb.addToDragSelection(f[g].el);v=e,k.toolkit.addToSelection(e,d)},onEnd:function(){j.setHoverSuspended(!1),w&&j.setMode(h.pan)},filter:a.lassoFilter}),y={pan:function(){x.setEnabled(!1),u.setEnabled(!0)},select:function(){k.jsPlumb.clearDragSelection&&k.jsPlumb.clearDragSelection(),x.setEnabled(!0),u.setEnabled(!1)},disabled:function(){k.jsPlumb.clearDragSelection&&k.jsPlumb.clearDragSelection(),x.setEnabled(!0),u.setEnabled(!1)}},z=a.mode||h.pan;j.bind(i.relayout,function(a){u.relayout(a)}),j.bind(i.nodeRemoved,function(a){u.remove(a.el)}),k.toolkit.bind(i.graphCleared,function(){u.reset()}),k.toolkit.bind(i.dataLoadStart,function(){u.setSuspendRendering(!0)}),k.toolkit.bind(i.dataLoadEnd,function(){u.setSuspendRendering(!1),l&&l.setVisible(!0),a.zoomToFit&&j.zoomToFit()}),k.jsPlumb.setContainer(n),jsPlumb.addClass(m,g.SURFACE),a.enablePan===!1&&jsPlumb.addClass(m,g.SURFACE_NO_PAN);var A=function(a,b){var c=function(a){var c=a.srcElement||a.target;(c==m||c==n)&&j.fire(b,a)};k.jsPlumb.on(n,a,c),k.jsPlumb.on(m,a,c)};A(i.tap,i.canvasClick),A(i.dblclick,i.canvasDblClick);var B=null;k.makeDraggable=function(a,b){if(o){var c=d.getElement(a),f=k.jsPlumb.getId(c),l=k.jsPlumb.extend({},p),n=d.dragEvents[h.stop],q=d.dragEvents[h.start],v=function(a){var b=d.getDragObject(a),c=d.getElement(b);return{node:c.jtk.node,el:b}};null!=b&&k.jsPlumb.extend(l,b),l[q]=e.wrap(l[q],function(){B=u.getBoundsInfo();var a=v(arguments);a.elementId=f,a.pos=jsPlumb.getAbsolutePosition(c),a.domEl=c,jsPlumb.addClass(m,g.SURFACE_ELEMENT_DRAGGING),j.fire(i.nodeMoveStart,a)}),l[n]=e.wrap(l[n],function(a){for(var b=function(a){u.positionChanged(a[0]),jsPlumb.removeClass(m,g.SURFACE_ELEMENT_DRAGGING);var b={el:a[0],node:a[0].jtk.node,pos:[a[1].left,a[1].top]};j.getLayout().setPosition(b.node.id,b.pos[0],b.pos[1],!0),r!==!1&&(j.storePositionInModel({id:b.node.id,leftAttribute:s,topAttribute:t}),k.toolkit.fire("nodeUpdated",{node:b.node},null)),j.fire(i.nodeMoveEnd,b)},c=0;c<a.selection.length;c++)b(a.selection[c])}),l.canDrag=function(){return!x.isActive()},l.force=!0,k.jsPlumb.draggable(c,l,!1,k.jsPlumb)}},k.doImport=function(b){a.jsPlumbInstance.setContainer(n);var c=a.jsPlumbInstance.getManagedElements();for(var d in c){var e=c[d].el;C(e,d)}};var C=this.importNode=function(b,c){var d=a.jsPlumbInstance.getOffset(b),e=a.jsPlumbInstance.getId(b);b.style.left=d.left+h.px,b.style.top=d.top+h.px,jsPlumb.addClass(b,g.NODE),u.add(b,e,[d.left,d.top],!1),jsPlumb.isAlreadyDraggable(b)&&k.makeDraggable(b),k.nodeMap[c]=b,k.reverseNodeMap[e]=b.jtk.node};this.zoomToFit=u.zoomToFit,this.zoomToFitIfNecessary=u.zoomToFitIfNecessary,this.zoomToBackground=u.zoomToBackground,this.centerOn=function(a,b,c){var d=this.getObjectInfo(a);d&&d.el&&u.centerOn(d.el,b,c)},this.centerOnHorizontally=function(a){this.centerOn(a,!0,!1)},this.centerOnVertically=function(a){this.centerOn(a,!1,!0)},this.centerContent=u.centerContent,this.centerContentHorizontally=u.centerContentHorizontally,this.centerContentVertically=u.centerContentVertically,this.getViewportCenter=u.getViewportCenter,this.setViewportCenter=u.setViewportCenter,this.setStateHandle=function(a){q=a},this.getStateHandle=function(){return q},this.getApparentCanvasLocation=u.getApparentCanvasLocation,this.setApparentCanvasLocation=u.setApparentCanvasLocation,this.getBoundsInfo=u.getBoundsInfo,this.setZoom=u.setZoom,this.setZoomRange=u.setZoomRange,this.getZoomRange=u.getZoomRange,this.getZoom=u.getZoom,this.nudgeZoom=u.nudgeZoom,this.nudgeWheelZoom=u.nudgeWheelZoom,this.pageLocation=u.pageLocation,this.getPan=u.getPan,this.pan=u.pan,this.setPan=u.setPan,this.setPanAndZoom=function(a,b,c,d){this.setPan(a,b,!d),this.setZoom(c,!d)},this.setPanFilter=function(a){u.setFilter(a?function(b,c){return"function"==typeof a?a.apply(a,[c]):e.matchesSelector(b,a)}:null)},this.setWheelFilter=function(a){u.setWheelFilter(function(b){if(a){var c=b.srcElement||b.target;return!e.matchesSelector(c,a)}
return!0})},this.setWheelFilter(a.wheelFilter),this.setPanFilter(a.panFilter),this.mapLocation=u.mapLocation,this.mapEventLocation=u.mapEventLocation,this.findNearbyNodes=u.findNearbyNodes,this.findIntersectingNodes=u.findIntersectingNodes,this.isInViewport=u.isInViewport,this.positionElementAt=u.positionElementAt,this.positionElementAtEventLocation=u.positionElementAtEventLocation,this.positionElementAtPageLocation=u.positionElementAtPageLocation,this.setFilter=u.setFilter,this.floatElement=u.floatElement,this.fixElement=u.fixElement;var D=this.setPosition,E=this.animateToPosition,F=function(a,b,c){a&&(u.positionChanged(a.el,[b,c]),j.fire(i.nodeMoveEnd,{el:a.el,id:a.id,pos:[b,c],node:a.obj,bounds:u.getBoundsInfo()}))};this.setPosition=function(a,b,c,d){var e=D.apply(this,arguments);F(e,b,c)},this.animateToPosition=function(a,b,c,d){var e=E.apply(this,arguments);F(e,b,c)},this.tracePath=function(a){var b=a.path||function(){var b=k.getObjectInfo(a.source),c=k.getObjectInfo(a.target);return k.toolkit.getPath({source:b,target:c})}();if(b.exists()){for(var c=function(b,c){this.fire(b,{edge:c.edge,connection:c,options:a.options})}.bind(this),d=[],e=null,f=null,g=b.path.path.length,h=1;g>h;h++){var i=b.path.path[h].vertex.id,j=b.path.previous[i],l=!0,m=b.path.path[h].edge;null!=j&&(l=j===m.source),e=k.getConnectionForEdge(m),f=e.animateOverlay(a.overlay,jsPlumb.extend(a.options||{},{previous:f,isFinal:h===g-1,forwards:l})),d.push({handler:f,connection:e})}
return d.length>0&&(d[0].handler.bind(jsPlumbToolkit.Events.startOverlayAnimation,function(){c(jsPlumbToolkit.Events.startOverlayAnimation,d[0].connection)}),d[d.length-1].handler.bind(jsPlumbToolkit.Events.endOverlayAnimation,function(){c(jsPlumbToolkit.Events.endOverlayAnimation,d[d.length-1].connection)})),!0}
return k.toolkit.isDebugEnabled()&&jsPlumbUtil.log("Cannot trace non existent path"),!1},this.getNodePositions=function(){var a={},b=u.getElementPositions();for(var c in b){var d=k.getNodeForElementId(c);a[d.id]=[b[c][0][0],b[c][0][1]]}
return a},this.append=function(a,b,c,d){n.appendChild(a),c&&(c=[c.left,c.top]),u.add(a,b,c,d)};var G=this.setLayout;this.setLayout=function(a,b){G(a,b),l&&l.setHostLayout(this.getLayout())};for(var H=function(a){k.jsPlumb.on(n,a,".jtk-node, .jtk-node *",function(b){var c=b.srcElement||b.target;if(null==c&&(b=d.getOriginalEvent(b),c=b.srcElement||b.target),null!=c&&c.jtk){var e=d.extend({e:b,el:c},c.jtk);j.fire(a,e,b)}})},I=0;I<c.mouseEvents.length;I++)H(c.mouseEvents[I]);k.toolkit.bind(h.select,function(a){if(a.obj.objectType==h.nodeType){var b=k.getElement(a.obj.id);b&&(jsPlumb.addClass(b,g.SURFACE_SELECTED_ELEMENT),k.jsPlumb.addToDragSelection&&k.jsPlumb.addToDragSelection(b))}else if(a.obj.objectType==h.edgeType){var c=k.getConnectionForEdge(a.obj);c&&c.addClass(g.SURFACE_SELECTED_CONNECTION)}}),k.toolkit.bind(i.selectionCleared,function(){k.jsPlumb.clearDragSelection&&k.jsPlumb.clearDragSelection(),jsPlumb.removeClass(f("."+g.SURFACE_SELECTED_CONNECTION),g.SURFACE_SELECTED_CONNECTION),jsPlumb.removeClass(f("."+g.SURFACE_SELECTED_ELEMENT),g.SURFACE_SELECTED_ELEMENT)}),k.toolkit.bind(i.deselect,function(a){if(a.obj.objectType==h.nodeType){var b=k.getElement(a.obj.id);b&&(jsPlumb.removeClass(b,g.SURFACE_SELECTED_ELEMENT),k.jsPlumb.removeFromDragSelection&&k.jsPlumb.removeFromDragSelection(b))}else if(a.obj.objectType==h.edgeType){var c=k.getConnectionForEdge(a.obj);c&&c.removeClass(g.SURFACE_SELECTED_CONNECTION)}});var J=this.setOffset;this.setOffset=function(a,b){J.apply(this,arguments),u.positionChanged(a,[b.left,b.top])};var K=this.setAbsolutePosition;this.setAbsolutePosition=function(a,b,c){K.call(this,a,b),u.positionChanged(a,b),k.jsPlumb.revalidate(a),c&&c()},this.setMode=function(a,b){if(!y[a])throw new TypeError("Surface: unknown mode '"+a+"'");z=a,y[a](),a!==h.select||b||k.toolkit.clearSelection(),j.fire(i.modeChanged,a)};var L=function(a,b){var c=jsPlumb.extend({},a);c.source=k.getObjectInfo(a.source).obj,c.target=k.getObjectInfo(a.target).obj,c.element=k.getObjectInfo(a.element).obj;var d=k.toolkit[b](c),e=k.getConnectionsForEdges(d);return k.jsPlumb.select({connections:e})};this.selectEdges=function(a){return L(a,"getEdges")},this.selectAllEdges=function(a){return L(a,"getAllEdges")},this.repaint=function(a){var b=k.getObjectInfo(a);b.el&&(k.jsPlumb.recalculateOffsets(b.el),k.jsPlumb.revalidate(k.jsPlumb.getId(b.el)),j.fire(i.objectRepainted,b))},this.repaintEverything=k.jsPlumb.repaintEverything,this.setElementsDraggable=function(a){o=a!==!1};var M=function(a){a=a||{};var b=a.dataGenerator||function(){return{}},c=a.typeExtractor,f=a.locationSetter||function(a,b,c){c.left=a,c.top=b},l=a.droppables,n=a.dragOptions||{},o=a.dropOptions||{},p="scope_"+(new Date).getTime(),q=function(d,e,g){var h=!0;if(a.drop&&(h=a.drop.apply(this,arguments)!==!1),h){var i=k.jsPlumb.getDragObject(arguments),l=j.getJsPlumb().getOffset(g?A:i,!0),m=u.mapLocation(l.left,l.top),n=c?c(i,d,g,m):null,o=b?b(n,i,d,m):{};null!=n&&(o.type=n),f(m.left,m.top,o),k.toolkit.getNodeFactory()(n,o,function(b){var c=k.toolkit.addNode(b,{position:m});a.onDrop&&a.onDrop(c,d,m)},d,g)}},r=d.dragEvents[h.start],s=d.dragEvents[h.drag],t=d.dragEvents[h.stop],v=d.dragEvents[h.drop],w=function(){},x=a.nativeFilter||[],y=a.allowNative,z={};if(n[r]=e.wrap(n[r],a.start||w),n[s]=e.wrap(n[s],a.drag||w),n[t]=e.wrap(n[t],a.stop||w),o.scope=p,o[v]=e.wrap(o[v],q),y){var A=document.createElement(h.div);A.style.position=h.absolute;for(var B=0;B<x.length;B++)z[x[B]]=!0;var C=function(a){return null!=a.dataTransfer&&1===a.dataTransfer.items.length?0==x.length||z[a.dataTransfer.items[0].type]:!1};document.addEventListener(i.dragover,function(a){a.stopPropagation(),a.preventDefault(),C(a)&&(jsPlumb.setAbsolutePosition(A,[a.pageX,a.pageY]),n[s].apply(null,[a,{helper:A,offset:{left:a.pageX,top:a.pageY}},!0]))},!1),document.addEventListener(i.drop,function(a){a.stopPropagation(),a.preventDefault(),C(a)&&(o[v].apply(null,[a,{helper:A,offset:{left:a.pageX,top:a.pageY}},!0]),n[t].apply(null))},!1),document.addEventListener(i.dragend,function(a){})}
k.jsPlumb.initDroppable(m,o,h.surfaceNodeDragScope),n.scope=p,n.ignoreZoom=!0,n.doNotRemoveHelper=!0;for(var B=0;B<l.length;B++){var D=k.jsPlumb.getElement(l[B]);k.jsPlumb.addClass(D,g.SURFACE_DROPPABLE_NODE),k.jsPlumb.initDraggable(D,n,h.surfaceNodeDragScope,k.jsPlumb)}};this.registerDroppableNodes=function(a){new M(a)},this.createMiniview=function(a){if(null!=l){var c=k.jsPlumb.getId(k.jsPlumb.getElement(a.container));if(l.getContainerId()==c)return!1}
var e=d.extend({surface:j,toolkit:k.toolkit,surfaceContainerElement:m,bounds:u.getBoundsInfo(),visible:a.initiallyVisible!==!1||k.toolkit.getNodeCount()>0,layout:{type:h.mistletoeLayoutType,parameters:{layout:j.getLayout()}}},a);l=new b.Renderers.Miniview(e);for(var f in k.nodeMap){var g=k.nodeMap[f];l.registerNode({el:g,node:g.jtk.node,pos:jsPlumb.getAbsolutePosition(g)})}
return l},a.miniview&&this.createMiniview(a.miniview),this.getMiniview=function(){return l},this.State={save:function(a,c){if(a=2==arguments.length?arguments[0]:1==arguments.length&&"string"==typeof arguments[0]?arguments[0]:q,c=2==arguments.length?arguments[1]:1==arguments.length&&"function"==typeof arguments[0]?arguments[0]:function(a,b){return b(a)},a)try{c(j.State.serialize(),function(c){b.util.Storage.set(h.jtkStatePrefix+a,c)})}catch(d){e.log(g.msgCannotSaveState,d)}},serialize:function(){var a=u.getPan();a.push(u.getZoom()),a.push.apply(a,u.getTransformOrigin());var b=a.join(","),c=j.getLayout().getPositions(),d=[];for(var e in c)d.push(e+" "+c[e][0]+" "+c[e][1]);return b+=","+d.join("|")},restore:function(a,c){if(a=2==arguments.length?arguments[0]:1==arguments.length&&"string"==typeof arguments[0]?arguments[0]:q,c=2==arguments.length?arguments[1]:1==arguments.length&&"function"==typeof arguments[0]?arguments[0]:function(a,b){return b(a)},a)try{var d=b.util.Storage.get(h.jtkStatePrefix+a);d&&c(d,j.State.deserialize)}catch(f){e.log(g.msgCannotRestoreState,f)}},deserialize:function(a){for(var b=a.split(","),c=b[5].split("|"),d=j.getLayout(),e=0;e<c.length;e++){var f=c[e].split(" ");try{j.setPosition(f[0],parseFloat(f[1]),parseFloat(f[2]))}catch(g){}}
d.draw()},clear:function(a){a=a||q,a&&b.util.Storage.clear(h.jtkStatePrefix+a)},clearAll:function(){b.util.Storage.clearAll()}},j.saveState=j.State.save,j.store=b.util.Storage.set,j.retrieve=b.util.Storage.get,j.storeJSON=b.util.Storage.setJSON,j.retrieveJSON=b.util.Storage.getJSON,j.restoreState=function(a){j.State.restore(a),j.getJsPlumb().repaintEverything(),j.fire(i.stateRestored)},j.clearState=function(a){j.state.clear(a)},j.initialize(),a.zoomToFitIfNecessary?j.zoomToFitIfNecessary():a.zoomToFit&&j.zoomToFit()},b.DefaultRendererType=h.surfaceType}.call(this),function(){"use strict";var a=this,b=a.jsPlumbToolkit,c=b.Renderers,d=jsPlumbUtil,e=jsPlumb,f=jsPlumbToolkit.Classes,g=jsPlumbToolkit.Constants,h=jsPlumbToolkit.Events,i=jsPlumbToolkit.Attributes,j=jsPlumbToolkit.Methods;c.Miniview=function(a){function b(a){if(o&&y&&!t){s=o.getBoundsInfo();var b=o.getApparentCanvasLocation(),c=y.getApparentCanvasLocation(),d=y.getZoom(),e=d/s.zoom;r.style.width=s.vw+g.px,r.style.height=s.vh+g.px,y.applyZoomToElement(r,e);var f=[b[0]*e,b[1]*e];n=[c[0]-f[0],c[1]-f[1]],jsPlumb.setAbsolutePosition(r,n)}}
function k(a){if(null!=y){s=o.getBoundsInfo(),a=a||jsPlumb.getAbsolutePosition(r);var b=y.getApparentCanvasLocation(),c=y.getZoom(),d=c/s.zoom,e=(b[0]-a[0])/d,f=(b[1]-a[1])/d,g=o.setApparentCanvasLocation(e,f);return[b[0]-g[0]*d,b[1]-g[1]*d]}}
this.bindToolkitEvents=!1;var l=c.AbstractRenderer.apply(this,arguments),m=this;c.DOMElementAdapter.apply(this,arguments);var n,o=a.surface,p=e.getElement(a.container),q=c.createElement({position:g.relative,width:g.nominalSize,height:g.nominalSize,left:0,top:0,clazz:f.MINIVIEW_CANVAS},p),r=c.createElement({position:g.absolute,width:g.nominalSize,height:g.nominalSize,left:0,top:0,clazz:f.MINIVIEW_PANNER},p),s=a.bounds,t=a.suspended===!0,u=a.collapsible!==!1,v=null,w=!1,x=a.wheelSensitivity||10,y=new ZoomWidget({viewport:p,canvas:q,domElement:e.getElement,offset:this.getOffset,bind:function(){l.jsPlumb.on.apply(l.jsPlumb,arguments)},unbind:function(){l.jsPlumb.off.apply(l.jsPlumb,arguments)},enableWheelZoom:!1,enablePanButtons:!1,enablePan:!1,enableAnimation:!1,width:function(a){return l.jsPlumb.getWidth(l.jsPlumb.getElement(a))},height:function(a){return l.jsPlumb.getHeight(l.jsPlumb.getElement(a))},id:l.jsPlumb.getId,animate:l.jsPlumb.animate,dragEvents:{stop:e.dragEvents[g.stop],start:e.dragEvents[g.start],drag:e.dragEvents[g.drag]},extend:e.extend,events:{pan:function(){k()},mousedown:function(){jsPlumb.addClass(r,f.MINIVIEW_PANNING)},mouseup:function(){jsPlumb.removeClass(r,f.MINIVIEW_PANNING)}},zoomRange:[-(1/0),1/0]}),z=!1,A=null,B=null,C=!1,D=function(a){z=!0,A=y.pageLocation(a),B=jsPlumb.getAbsolutePosition(r),e.on(document,h.mouseup,F),e.on(document,h.mousemove,E),d.consume(a)},E=function(a){if(C=!1,z){var b=y.pageLocation(a),c=b[0]-A[0],d=b[1]-A[1],e=[B[0]+c,B[1]+d];k(e);jsPlumb.setAbsolutePosition(r,e)}},F=function(a){z=!1,A=null,e.off(document,h.mouseup,F),e.off(document,h.mousemove,E)},G=!0,H=function(a){d.consume(a),o.nudgeWheelZoom(a.normalizedWheelDelta*x,a)};e.on(window,h.resize,jsPlumbToolkitUtil.debounce(function(){b()},100)),a.enableWheelZoom!==!1&&addWheelListener(p,H),y.setTransformOriginForElement(r,[0,0]),jsPlumb.addClass(p,f.MINIVIEW),e.on(r,h.mousedown,D),u&&(v=jsPlumb.createElement("div"),v.className=f.MINIVIEW_COLLAPSE,p.appendChild(v),e.on(v,g.click,function(a){w=!w,jsPlumb[w?j.addClass:j.removeClass](p,f.MINIVIEW_COLLAPSED)}));var I=function(a){y.zoomToFit({onComplete:b,onStep:b,doNotFirePanEvent:a})};a.toolkit.bind(h.dataLoadEnd,I);var J=function(a){s=a.bounds,y.positionChanged(a.el,a.pos),jsPlumb.setAbsolutePosition(l.nodeMap[a.node.id],a.pos),I(!0),this.fire(h.nodeMoveEnd,a)}.bind(this),K=function(a){var d=e.getSize(a.el),h=c.createElement({position:g.absolute,width:d[0]+g.px,height:d[1]+g.px,left:0,top:0,clazz:f.MINIVIEW_ELEMENT});h.relatedElement=a.el,s=o.getBoundsInfo(),h.setAttribute(i.jtkNodeId,a.node.id),h.setAttribute(i.relatedNodeId,a.el.getAttribute(g.id)),q.appendChild(h),y.add(h),l.nodeMap[a.node.id]=h,m.getLayout().map(a.node.id,h),b()};this.registerNode=function(a){K(a),J(a)};var L=this.setOffset;this.setOffset=function(a,b){L.apply(this,arguments),y.positionChanged(a,[b.left,b.top])};var M=this.setAbsolutePosition;this.setAbsolutePosition=function(a,b){M.call(this,a,b),y.positionChanged(a,b)},this.setVisible=function(a){G=a,p.style.display=a?g.block:g.none},this.setVisible(a.visible!==!1),this.getPan=y.getPan;var N=function(a){var c=l.nodeMap[a.id];if(c){var d=e.getSize(c.relatedElement);c.style.width=d[0]+g.px,c.style.height=d[1]+g.px,b()}};this.setSuspended=function(a,b){t=a,b&&this.update()},this.update=b;var O=function(a){var c=a.node,d=l.nodeMap[c];d&&(y.remove(d),delete l.nodeMap[c],l.jsPlumb.removeElement(d)),a.dontUpdatePanner||b()},P=function(){for(var a in l.nodeMap)O({node:a,dontUpdatePanner:!0});b()};o.bind(h.pan,b),o.bind(h.zoom,b),o.bind(h.nodeMoveEnd,J),o.bind(h.nodeRemoved,O),o.bind(h.nodeAdded,K),o.bind(h.nodeRendered,K),o.bind(h.relayout,b),o.bind(h.objectRepainted,N),o.bind(h.stateRestored,b),a.toolkit.bind(h.graphCleared,P);var Q=function(){I(!0)};m.getLayout().bind(h.redraw,Q),this.setHostLayout=function(a){var b=m.getLayout();b&&b.setHostLayout(a)},this.setZoom=y.setZoom,this.getZoom=y.getZoom,this.getTransformOrigin=y.getTransformOrigin}}.call(this),function(){"use strict";var a=this,b=a.jsPlumbToolkit,c=b.Widgets,d=jsPlumbUtil,e=(/MSIE\s([\d.]+)/.test(navigator.userAgent)&&new Number(RegExp.$1)<9,"ontouchstart"in document.documentElement),f=e?"touchstart":"mousedown",g=e?"touchend":"mouseup",h=e?"touchmove":"mousemove",i=function(a,b){a.style.width=b[0]+"px",a.style.height=b[1]+"px"};c.Lasso=function(a){var b=a.canvas,c=!1,e=document.createElement("div"),j=[0,0],k=a.onStart||function(){},l=a.onEnd||function(){},m=a.onSelect||function(){},n=!1,o=function(b){c&&!s(b)&&(d.consume(b),n=!0,a.on(document,g,q),a.on(document,h,p),a.on(document,"onselectstart",r),j=a.pageLocation(b),jsPlumb.setAbsolutePosition(e,j),i(e,[1,1]),e.style.display="block",jsPlumb.addClass(document.body,"jtk-lasso-select-defeat"),k(j,b.shiftKey))},p=function(b){if(n){d.consume(b);var c=a.pageLocation(b),f=[Math.abs(c[0]-j[0]),Math.abs(c[1]-j[1])],g=[Math.min(j[0],c[0]),Math.min(j[1],c[1])];[j[0]<c[0],j[1]<c[1]];jsPlumb.setAbsolutePosition(e,g),i(e,f),m(g,f,[j[0]<c[0],j[1]<c[1]],b.shiftKey)}},q=function(b){n&&(n=!1,d.consume(b),a.off(document,g,q),a.off(document,h,p),a.off(document,"onselectstart",r),e.style.display="none",jsPlumb.removeClass(document.body,"jtk-lasso-select-defeat"),l())},r=function(){return!1},s=a.filter?function(b){var c=b.srcElement||b.target;return d.matchesSelector(c,a.filter)}:function(){return!1};e.className="jtk-lasso",document.body.appendChild(e),a.on(b,f,o),this.isActive=function(){return n},this.setEnabled=function(a){c=a}}}.call(this),function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n=this,o={},p={ok:"OK",cancel:"Cancel"},q=document.body,r=!1,s=Rotors.newInstance(),t={},u=!0;jsPlumb.ready(function(){b=document.createElement("div"),b.className="jtk-dialog-underlay",jsPlumb.on(b,"click",function(){I()}),c=document.createElement("div"),c.className="jtk-dialog-overlay",d=document.createElement("div"),d.className="jtk-dialog-title",c.appendChild(d),e=document.createElement("div"),e.className="jtk-dialog-content",c.appendChild(e),f=document.createElement("div"),f.className="jtk-dialog-buttons",c.appendChild(f)});var v=function(){l=document.createElement("button"),l.className="jtk-dialog-button jtk-dialog-button-ok",l.innerHTML=p.ok,f.appendChild(l),jsPlumb.on(l,"click",function(){I()}),m=document.createElement("button"),m.className="jtk-dialog-button jtk-dialog-button-cancel",m.innerHTML=p.cancel,f.appendChild(m),jsPlumb.on(m,"click",function(){I(!0)})},w={x:function(a,b,d){var e=q.clientWidth,f=(e-d[0])/2,g=window.pageXOffset||a.scrollLeft||document.body.scrollLeft;0>f&&(f=10),g=b?g:q.scrollLeft,c.style.left=f+g+"px"},y:function(a,b,d){var e=q.clientHeight,f=.1*e,g=window.pageYOffset||a.scrollTop||document.body.scrollTop;0>f&&(f=10),g=b?g:q.scrollTop,c.style.top=f+g+"px"}},x=function(){if(r){var a=document.documentElement,d=jsPlumb.getSize(c),e=q==document.body,f=c.getAttribute("data-axis");b.style.position=e?"fixed":"absolute",w[f](a,e,d)}},y=function(a){27==a.keyCode&&I(!0)},z=function(a){return null==a?document.body:"string"==typeof a?document.getElementById(a):a},A=function(a){if(a.id&&o[a.id]){u=a.reposition!==!1,g=a.onOK,h=a.onCancel,i=a.onOpen,j=a.onMaybeClose,k=a.onClose;var f=a.position||"top",n="jtk-dialog-overlay-"+f,w="top"===f||"bottom"===f?"x":"y",A="jtk-dialog-overlay-"+w;v(),l.innerHTML=a.labels?a.labels.ok||p.ok:p.ok,m.innerHTML=a.labels?a.labels.cancel||p.cancel:p.cancel,q=z(a.container);var C=a.data||{},D=s.template(a.id,C);d.innerHTML=a.title||o[a.id].title||"",e.innerHTML="";for(var E=D.childNodes.length,G=0;E>G;G++)e.appendChild(D.childNodes[0]);q.appendChild(b),q.appendChild(c),jsPlumb.addClass(c,n),jsPlumb.addClass(c,A),b.style.display="block",c.style.display="block",c.setAttribute("data-position",f),c.setAttribute("data-axis",w),m.style.visibility=o[a.id].cancelable?"visible":"hidden",r=!0,x(),B(C),t.onOpen&&t.onOpen(c),i&&i(c),jsPlumb.addClass(c,"jtk-dialog-overlay-visible"),jsPlumb.on(document,"keyup",y),u&&(jsPlumb.on(window,"resize",x),jsPlumb.on(window,"scroll",x)),jsPlumb.on(c,"click","[jtk-clear]",function(a){var b=this.getAttribute("jtk-att");b&&F(c.querySelectorAll("[jtk-att='"+b+"']:not([jtk-clear])"),this)}),jsPlumb.on(c,"click","[jtk-clear-all]",function(a){F(c.querySelectorAll("[jtk-att]:not([jtk-clear])"),this)});try{var H=e.querySelector("[jtk-focus]");H&&setTimeout(function(){H.focus()},0)}catch(I){}}},B=function(a){for(var b=e.querySelectorAll("[jtk-att]"),c=0;c<b.length;c++){var d=b[c].tagName.toUpperCase(),f="INPUT"===d?(b[c].getAttribute("type")||"TEXT").toUpperCase():d,g=b[c].getAttribute("jtk-att"),h=s.data(a,g);null!=h&&C[f](b[c],h),b[c].getAttribute("jtk-commit")&&("INPUT"===d?jsPlumb.on(b[c],"keyup",function(a){(10==a.keyCode||13==a.keyCode)&&I()}):"TEXTAREA"===d&&jsPlumb.on(b[c],"keyup",function(a){!a.ctrlKey||10!=a.keyCode&&13!=a.keyCode||I()}))}},C={TEXT:function(a,b){a.value=b},RADIO:function(a,b){a.checked=a.value==b},CHECKBOX:function(a,b){a.checked=1==b},SELECT:function(a,b){for(var c=0;c<a.options.length;c++)if(a.options[c].value==b)return void(a.selectedIndex=c)},TEXTAREA:function(a,b){a.value=b}},D={TEXT:function(a){return a.value},RADIO:function(a){return a.checked?a.value:void 0},CHECKBOX:function(a){return a.checked?!0:void 0},SELECT:function(a){return-1!=a.selectedIndex?a.options[a.selectedIndex].value:null},TEXTAREA:function(a){return a.value}},E={TEXT:function(a){a.value=""},RADIO:function(a){a.checked=!1},CHECKBOX:function(a){a.checked=!1},SELECT:function(a){a.selectedIndex=-1;},TEXTAREA:function(a){a.value=""}},F=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!==b){var d=a[c].tagName.toUpperCase(),e="INPUT"===d?(a[c].getAttribute("type")||"TEXT").toUpperCase():d,f=E[e];f&&f(a[c])}},G=function(){for(var a=e.querySelectorAll("[jtk-att]"),b={},c=0;c<a.length;c++){var d=a[c].tagName.toUpperCase(),f="INPUT"===d?(a[c].getAttribute("type")||"TEXT").toUpperCase():d,g=D[f](a[c]),h=a[c].getAttribute("jtk-att");if(null!=g){var i=s.data(b,h);null!=i?(jsPlumbUtil.isArray(i)||s.data(b,h,[i]),i.push(g)):s.data(b,h,g)}}
return b},H=function(a,b){try{null!=a&&a.apply(a,Array.prototype.slice.apply(arguments,[1]))}catch(c){}},I=function(d){var f=d?null:G();(d||null==j||j(f)!==!1)&&(r=!1,b.style.display="none",c.style.display="none",jsPlumb.off(document,"keyup",y),jsPlumb.off(window,"resize",x),jsPlumb.off(window,"scroll",x),jsPlumb.removeClass(c,"jtk-dialog-overlay-visible"),jsPlumb.removeClass(c,"jtk-dialog-overlay-top"),jsPlumb.removeClass(c,"jtk-dialog-overlay-bottom"),jsPlumb.removeClass(c,"jtk-dialog-overlay-left"),jsPlumb.removeClass(c,"jtk-dialog-overlay-right"),jsPlumb.removeClass(c,"jtk-dialog-overlay-x"),jsPlumb.removeClass(c,"jtk-dialog-overlay-y"),c.setAttribute("data-position",""),c.setAttribute("data-axis",""),q.removeChild(b),q.removeChild(c),l.parentNode.removeChild(l),m.parentNode.removeChild(m),d?(H(t.onCancel,e),H(h,e)):(H(t.onOK,f,e),H(g,f,e)),H(t.onClose),H(k),g=h=i=k=j=a=null)};n.jsPlumbToolkit.Dialogs={initialize:function(a){a=a||{};for(var b=a.selector||".jtk-dialog",c=jsPlumb.getSelector(b),d=0;d<c.length;d++){var e=c[d].getAttribute("id");null!=e&&(o[e]={content:c[d].innerHTML,title:c[d].getAttribute("title")||"",el:c[d],cancelable:"false"!==c[d].getAttribute("cancel")})}
a.labels&&jsPlumb.extend(p,a.labels),a.globals&&jsPlumb.extend(t,a.globals)},show:A,hide:function(){I(!0)},clear:F}}.call(this),function(){"use strict";var a=this;a.jsPlumbToolkit.DrawingTools=function(a){var b,c,d,e,f,g,h,i,j,k=a.renderer,l=k.getToolkit(),m=k.getJsPlumb(),n={},o=a.widthAttribute||"w",p=a.heightAttribute||"h",q=a.leftAttribute||"left",r=a.topAttribute||"top",s=function(){for(var a in n){var b=n[a];b[0]&&b[0].parentNode&&b[0].parentNode.removeChild(b[0]),delete n[a]}},t=function(a,b,c,d){var e=document.createElement(a);if(b&&(e.className=b),c&&c.appendChild(e),d)for(var f in d)e.setAttribute(f,d[f]);return e},u=function(a){var b=n[a];b&&b[0]&&b[0].parentNode&&b[0].parentNode.removeChild(b[0]),delete n[a]},v=function(a,b){var c=b.getRenderedNode(a.id);return u(a.id),c},w=function(a,b){var c=v(a,b);if(null!=c){var d=t("div","jtk-draw-skeleton",c),e=c.getAttribute("jtk-x-resize"),f=c.getAttribute("jtk-y-resize");t("div","jtk-draw-drag",d),t("div","jtk-draw-handle jtk-draw-handle-tl",d,{"data-dir":"tl","data-node-id":a.id}),t("div","jtk-draw-handle jtk-draw-handle-tr",d,{"data-dir":"tr","data-node-id":a.id}),t("div","jtk-draw-handle jtk-draw-handle-bl",d,{"data-dir":"bl","data-node-id":a.id}),t("div","jtk-draw-handle jtk-draw-handle-br",d,{"data-dir":"br","data-node-id":a.id}),n[a.id]=[d,"false"!==e,"false"!==f]}},x=function(a,d,e,f){var k={};return k[o]=b?e:h-g,k[p]=c?f:j-i,k[q]=b?a:g,k[r]=c?d:i,k},y={tl:function(a,b){var c=g+a,d=i+b,e=h-c,f=j-d;return c>=h&&(e=c-h,c=h),d>=j&&(f=d-j,d=j),x(c,d,e,f)},tr:function(a,b){var c=h-g+a,d=i+b,e=j-d,f=g;return 0>=c&&(f=g+c,c*=-1),d>=j&&(e=d-j,d=j),x(f,d,c,e)},bl:function(a,b){var c=g+a,d=j-i+b,e=h-c,f=i;return c>=h&&(e=c-h,c=h),0>=d&&(f+=d,d*=-1),x(c,f,e,d)},br:function(a,b){var c=h-g+a,d=j-i+b,e=g,f=i;return 0>=c&&(e=g+c,c*=-1),0>=d&&(f+=d,d*=-1),x(e,f,c,d)}};l.bind("selectionCleared",function(){s()}),l.bind("select",function(a){w(a.obj,k)}),l.bind("deselect",function(a){v(a.obj,k)});var z=function(a){var b=k.mapEventLocation(a),c=b.left-d.left,g=b.top-d.top,h=e(c,g,"");l.updateNode(f,h),k.setPosition(f,h[q],h[r],!0)},A=function(a){k.storePositionInModel(f.id),m.removeClass(document.body,"jtk-draw-select-defeat"),m.off(document,"mousemove",z),m.off(document,"mouseup",A),jsPlumbUtil.consume(a)};m.on(document,"mousedown",".jtk-draw-handle",function(a){var o=this.getAttribute("data-dir"),p=this.getAttribute("data-node-id");f=l.getNode(p),b=n[p][1],c=n[p][2],d=k.mapEventLocation(a);var q=k.getCoordinates(f);g=q.x,i=q.y,h=g+q.w,j=i+q.h,e=y[o],m.addClass(document.body,"jtk-draw-select-defeat"),m.on(document,"mousemove",z),m.on(document,"mouseup",A)})}}.call(this)